{"version":3,"sources":["webpack://overbot/./node_modules/unpoly/unpoly.js","webpack://overbot/webpack/bootstrap","webpack://overbot/webpack/runtime/compat get default export","webpack://overbot/webpack/runtime/define property getters","webpack://overbot/webpack/runtime/hasOwnProperty shorthand","webpack://overbot/./src/index.js"],"names":["window","up","version","call","this","mockable","originalFn","obj","spy","apply","arguments","mock","jasmine","createSpy","document","addEventListener","APP_HOSTNAME","APP_PROTOCOL","ESCAPE_HTML_ENTITY_MAP","NORMALIZE_URL_DEFAULTS","SPRINTF_PLACEHOLDERS","abortableMicrotask","allSettled","always","arrayToSet","assign","assignPolyfill","asyncNoop","asyncify","compact","compactObject","contains","copy","copyArrayLike","defineDelegates","defineGetter","each","eachIterator","escapeHTML","escapeRegExp","evalOption","every","extractCallback","extractLastArg","extractOptions","filterList","findInList","findResult","flatMap","flatten","identity","intersect","isArguments","isArray","isBasicObjectProperty","isBlank","isBoolean","isCrossOrigin","isDefined","isElement","isElementish","isEqual","isEqualList","isFormData","isFunction","isGiven","isHTMLCollection","isJQuery","isList","isMissing","isNodeList","isNull","isNumber","isObject","isOptions","isPresent","isPromise","isRegExp","isStandardPort","isString","isTruthy","isUndefined","iteratee","last","literal","lowerCaseFirst","map","mapObject","matchURLs","memoize","merge","mergeDefined","methodAllowsPayload","muteRejection","newDeferred","newOptions","nextUid","noop","normalizeMethod","normalizeURL","nullToUndefined","objectContains","objectValues","omit","parseArgIntoOptions","parseURL","pick","pickBy","pluckKey","prefixCamelCase","presence","queueMicrotask","queueTask","reject","remove","renameKey","reverse","scheduleTimer","sequence","setToArray","some","splitValues","sprintf","sprintfWithFormattedArgs","stringifyArg","times","toArray","uniq","uniqBy","unprefixCamelCase","unresolvablePromise","upperCaseFirst","urlWithoutHost","valuesPolyfill","wrapList","slice","hasProp","hasOwnProperty","util","Promise","resolve","func","cached","cachedValue","args","length","protocol","port","toString","host","stripTrailingSlash","search","hash","urlOrAnchor","options","normalized","parts","pathname","hostname","replace","url","leftURL","rightURL","location","indexOf","urlOrLink","link","element","get","createElement","href","method","toUpperCase","j","key","len","source","sources","target","value","Object","object","results","push","values","block","item","array","pairer","merger","pair","reduce","index","iterator","callback","entry","next","done","count","iteration","ref","keys","tester","String","Boolean","Number","constructor","typeOfResult","Element","RegExp","jquery","then","Array","FormData","NodeList","HTMLCollection","prototype","arrayLike","Date","concat","result","defaults","argKey","list","match","mapper","set","Set","elem","mapped","has","add","forEach","matches","array1","array2","millis","setTimeout","task","aborted","subValue","subObject","reducedValue","filtered","splice","string","char","oldKey","newKey","pop","arg","functions","f","flattened","promise","nativePromise","rejectFn","resolveFn","givenResolve","givenReject","error","error1","k","a","b","aKeys","bKeys","valueOf","aKey","separator","split","v","trim","str","prefix","pattern","props","targetProvider","prop","defineProperty","bind","newValue","unprefixedKey","attr","closer","join","tagName","toLowerCase","getAttribute","JSON","stringify","name","substr","message","promises","all","find","filter","timer","microtask","endsWith","substring","wrapValue","ctor","child","simpleEase","x","uid","getter","delegate","camelToKebabCase","formatter","i","renameKeys","renameKeyFn","renamed","timestamp","Math","floor","now","build","errorInterface","failed","notApplicable","notImplemented","u","Error","init","fn","is","async","change","reason","invalidSelector","selector","emitGlobal","emit","log","migrate","config","assertConfirmed","callJQuery","canFormatLog","canJQuery","canPassiveEventListener","canPromise","canPushState","isIE11","isSupported","loadPage","popCookie","submitForm","browser","requestsAttrs","Request","form","submit","history","pushState","initialRequestMethod","jQuery","cookie","confirm","fail","CSS_LENGTH_PROPS","MATCH_FN_NAME","SINGLETON_PATTERN","SINGLETON_TAG_NAMES","affix","ancestor","around","attributeSelector","booleanAttr","booleanOrStringAttr","callbackAttr","classSelector","closest","closestAttr","computedStyle","computedStyleNumber","concludeCSSTransition","createDocumentFromHTML","createFromHTML","createFromSelector","cssLength","elementTagName","extractFromStyleObject","first","fixedToAbsolute","getList","getOne","getRoot","hasCSSTransition","hide","idSelector","inlineStyle","insertBefore","isDetached","isInSubtree","isSingleton","isSingletonSelector","isVisible","jsonAttr","metaContent","normalizeStyleValueForWrite","numberAttr","paint","setAttrs","setInlineStyle","setMissingAttr","setMissingAttrs","setTemporaryAttrs","setTemporaryStyle","show","stringAttr","subtree","toSelector","toggle","toggleAttr","toggleClass","trueAttributeSelector","unwrap","upAttrs","valueToList","wrapChildren","querySelector","querySelectorAll","root","selectorOrElement","parentElement","parent","parentNode","removeChild","style","display","newVisible","klass","newPresent","classList","hasAttribute","setAttribute","removeAttribute","attrs","results1","oldAttrs","existingElement","newElement","insertAdjacentElement","oldElement","replaceChild","attrValues","classValue","contentValue","depthElement","depthSelector","depths","len1","previousElement","rootElement","styleValue","textValue","_match","attrName","_quote","attrValue","id","className","shift","appendChild","textContent","innerHTML","attributes","position","fragment","toTarget","test","attribute","html","DOMParser","parseFromString","range","createRange","setStart","body","createContextualFragment","childNodes","documentElement","offsetHeight","undo","transition","elementOrStyleHash","duration","styleHash","transitionProperty","transitionDuration","elementRectAsFixed","offsetParentRect","getBoundingClientRect","offsetParent","left","top","right","bottom","wrapper","wrappedNodes","wrappedNode","wrapperSelector","childNode","firstChild","pass","parseFloat","json","parse","exposedKeys","code","Function","event","exposedValues","newStyles","oldStyles","getComputedStyle","rawValue","keyOrKeys","offsetWidth","getClientRects","upAttributePattern","get_root","styleNumber","setStyle","Class","accessor","descriptor","targetProp","wrap","Record","superClass","__super__","extend","variant","changes","other","e","BodyShifter","unshiftFns","reset","unshiftNow","shiftCount","anchor","bodyRightShift","elementRightShift","overflowElement","scrollbarTookSpace","scrollbarWidth","viewport","rootHasReducedWidthFromScrollbar","rootOverflowElement","changeStyle","overflowY","paddingRight","anchoredRight","styles","unshift","unshiftFn","me","Cache","isFresh","alias","store","Memory","size","maxSize","expiryMillis","expiry","normalizeStoreKey","isEnabled","clear","logPrefix","puts","_this","makeRoomForAnotherEntry","oldestKey","oldestTimestamp","hasRoomForAnotherEntry","request","silent","storeKey","Change","execute","onFinished","base","improveHistoryValue","existingValue","Addition","responseDoc","acceptLayer","dismissLayer","eventPlans","handleLayerChangeRequests","layer","isOverlay","tryAcceptLayerFromServer","abortWhenLayerClosed","tryAcceptForLocation","tryDismissLayerFromServer","tryDismissForLocation","asCurrent","eventPlan","accept","dismiss","isClosed","setSource","Removal","CloseLayer","verb","origin","preventable","isOpen","network","abort","emitCloseEvent","defaultPrevented","peel","stack","restoreHistory","handleFocus","teardownHandlers","destroyElements","emitClosedEvent","buildEvent","formerParent","verbPast","verbPastUpperCaseFirst","baseLayer","ensureBubbles","overlayFocus","teardown","moveToFront","focus","preventScroll","DestroyFragment","current","animation","markAsDestroying","motion","willAnimate","emitDestroyed","animate","wipe","syntax","clean","FromContent","layers","getAll","isRenderableLayer","preview","mode","originLayer","getPlans","plans","getResponseDoc","rootSelector","expandIntoPlans","fallback","targets","expandTargets","placement","defaultPlacement","OpenLayer","UpdateLayer","executePlan","preload","plan","seekPlan","postflightTargetNotApplicable","docOptions","handleResponseDocOptions","firstExpandedTarget","ResponseDoc","preflightProps","opts","getPlanProps","optional","preflightTargetNotApplicable","targetNotApplicable","humanizedLayerOption","planTargets","optionToString","FromURL","normalizeLayerOptions","successOptions","failOptions","RenderOptions","deriveFailOptions","newPageReason","makeRequest","responseOrError","onRequestSettled","failAttrs","requestAttrs","successAttrs","preflightPropsForRenderOptions","failKey","renderOptions","requestAttributesOptions","response","Response","isSuccessfulResponse","updateContentFromResponse","description","status","ok","type","defaultProps","assertEmitted","onLoaded","augmentOptionsFromResponse","responseURL","serverLocation","serverTarget","title","text","context","buildLayer","bestPreflightSelector","content","select","getTitle","emitOpenEvent","createElements","setupHandlers","handleHistory","finalizeElement","hello","handleScroll","startOpenAnimation","opening","emitOpenedEvent","RenderResult","fragments","historyVisible","hasAutoHistory","saveHistory","updateHistory","moveToBack","FragmentFocus","autoMeans","process","scrollingOptions","FragmentScrolling","scroll","layerOptions","executeStep","parseSteps","matchPreflight","steps","swapPromises","matchPostflight","setScrollAndFocusOptions","saveScroll","step","keepPlan","morphOptions","newWrapper","oldWrapper","wrapperStep","findKeepPlan","emitKept","transferKeepableElements","beforeStart","afterInsert","beforeDetach","afterDetach","scrollNew","morph","lookupOpts","partner","partnerSelector","keep","descendantsOnly","newData","data","emitKeep","keepPlans","keepable","keepableClone","cloneNode","expressionParts","simpleTarget","finder","matchedPreflight","FragmentFinder","resolveOldNesting","matchedPostflight","hungry","addHungrySteps","hungries","radio","hungrySelector","containedByRivalStep","candidateStep","rivalStep","compressed","scrollBehavior","focusCapsule","FocusCapsule","preserveWithin","autoFocus","autoScroll","oldFragments","oldFragment","CompilerPass","compilers","isInSkippedSubtree","skipSubtrees","skip","errors","run","compiler","runCompiler","isDefault","batch","compileBatch","compileOneElement","postCompile","compileArgs","destructorOrDestructors","applyCompilerFunction","destructorPresence","destructor","elements","dataList","elementOrElements","Config","blueprintFn","CSSTransition","lastFrameKebab","onTransitionEnd","onFinishEvent","lastFrameKeysKebab","finishEvent","easing","finished","start","deferred","pauseOldTransition","startTime","startFallbackTimer","listenToFinishEvent","listenToTransitionEnd","startMotion","stopListenToFinishEvent","stopPropagation","finish","fallbackTimer","stopFallbackTimer","clearTimeout","stopListenToTransitionEnd","on","completedPropertyKebab","propertyName","resumeOldTransition","oldTransition","oldTransitionFrameKebab","oldTransitionProperties","setOldTransitionTargetFrame","setOldTransition","transitionTimingFunction","DestructorPass","cleanable","destructors","selectCleanables","applyDestructorFunction","selectOptions","destroying","EventEmitter","logEmission","dispatchEvent","messageArgs","fromEmitArgs","Layer","preventDefault","EventListener","nativeCallback","buildKey","framework","booting","upEventListeners","eventType","addListenerArgs","passive","unbind","removeEventListener","applyCallback","elementArg","expectedArgCount","once","guard","fromElement","upUid","unbindNonDefault","listener","listeners","EventListenerGroup","unbindFns","eachListenerAttributes","ref1","eventTypes","listenerAttributes","fromBindArgs","fixTypes","fixEventTypes","FieldObserver","fieldOrFields","isNewValues","scheduleValues","fields","delay","scheduledValues","processedValues","readFieldValues","currentTimer","callbackRunning","check","stop","cancelTimer","requestCallback","callbackReturnValues","diff","changedValues","previous","nextValue","previousValue","Params","fromFields","toObject","PRESERVE_KEYS","focusedElementWithin","transferProps","from","to","scopeElement","focusedElement","activeElement","restore","scope","rediscoveredElement","wasLost","DESCENDANT_SELECTOR","findAroundOrigin","findInLayer","matchAroundOrigin","findClosest","findInVicinity","getDumb","FragmentProcessor","opt","tryProcess","processElement","resolveCondition","processPrimitive","condition","findSelector","warn","PREVENT_SCROLL_OPTIONS","restoreFocus","focusElement","getFocusElement","focusSelector","focusHash","autofocus","wasFocusLost","autofocusElement","makeFocusable","hashTarget","firstHashTarget","handleScrollOptions","revealLayer","revealSelector","revealHash","revealElement","reveal","getBoxElement","resetScroll","restoreScroll","HTMLWrapper","closeTag","openTag","wrapMatch","strip","didWrap","originalHTML","restoredElement","wrappedChild","containsEventTarget","lastScrollTops","convertClicks","mainTargets","sync","option","isCurrent","isFront","isRoot","parentOf","childOf","ancestorsOf","descendantsOf","getContentElement","contentElement","boxElement","getFirstSwappableElement","anySelector","buildEventListenerGroup","off","wasHitByMouseEvent","hittableElement","elementFromPoint","clientX","clientY","buildEventEmitter","isHistoryVisible","savedTitle","savedLocation","showsLiveHistory","enabled","part","Overlay","dismissable","acceptLocation","URLPattern","dismissLocation","elementAttrs","nesting","suggestVisualNesting","align","affixPart","createBackdropElement","backdropElement","createViewportElement","viewportElement","createBoxElement","createContentElement","createDismissElement","dismissElement","dismissAriaLabel","dismissLabel","OverlayFocus","supportsDismissMethod","unbindParentClicked","originClicked","onOutsideClicked","unbindEscapePressed","onEscape","onEscapePressed","registerClickCloser","closeOptions","registerLayerCloser","registerEventCloser","acceptEvent","dismissEvent","halt","field","focusedField","blur","closeFn","parser","OptionsParser","booleanOrString","number","tryCloseForLocation","urlPattern","closeValue","resolution","recognize","destroyOptions","startCloseAnimation","onElementsRemoved","destroy","startAnimation","backdropDone","boxDone","boxAnimation","backdrop","isNone","backdropAnimation","openAnimation","openEasing","openDuration","wasEverVisible","closeAnimation","closeEasing","closeDuration","executeCloseChange","children","OverlayWithViewport","bodyShifter","getParentElement","shiftBody","unshiftBody","Cover","Drawer","Modal","OverlayWithTether","tether","Tether","Popup","Root","upHandlersApplied","cannotCloseRoot","LayerLookup","recursiveOptions","normalizeOptions","forElement","resolveValue","reversed","forIndex","selfAndAncestorsOf","ancestors","descendants","overlays","front","LayerStack","currentOverrides","buildRoot","dismissDescendant","dismissOptions","descendant","dismissOverlays","overlay","LinkFeedbackURLs","normalize","upHREF","feedback","isSafe","aliasPattern","normalizedLocation","LinkPreloader","considerPreload","observeLink","stopPreload","applyDelay","currentLink","shouldFollowEvent","preloadAfterDelay","preloadNow","currentRequest","preloadDelay","onQueued","muteUncriticalRejection","queued","MotionController","whileForwardingFinishEvent","unmarkCluster","markCluster","whenElementFinished","emitFinishEvent","finishOneElement","isActive","expandFinishRequest","startFunction","activeClass","dataKey","finishCount","clusterCount","cluster","memory","mutedAnimator","trackMotion","unbindFinish","allFinished","el","eventAttrs","doForward","forwarded","parserOptions","keyOptions","boolean","attrValueFn","attrNames","failAttrNames","failKeyOptions","normalizeFn","attrNameForKey","deriveFailAttrName","untrapFocus","onFocus","unsetAttrs","focusTrapBefore","focusTrapAfter","processingFocusEvent","focusEnd","focusStart","focusOptions","focusLastDescendant","tryFocus","raw","arrayEntryToQuery","addAll","entries","isArrayKey","toFormData","formData","append","originalArray","toQuery","query","isBinaryValue","encodeURIComponent","Blob","hasBinaryValues","toURL","addAllFromQuery","addAllFromFormData","addAllFromObject","valueElement","valueElements","decodeURIComponent","matchEntryFn","getFirst","fromForm","params","addField","file","disabled","selected","files","checked","fromURL","stripURL","Rect","height","width","CONTENT_KEYS","GLOBAL_DEFAULTS","PRELOAD_OVERRIDES","SHARED_KEYS","failOverrides","navigateDefaults","preloadOverrides","preprocess","solo","navigate","navigateOptions","overrides","unprefixed","successKey","preprocessedOptions","handleRenderOptions","assertContentGiven","contentKey","defaultToEmptyContent","headers","cache","wrapMethod","normalizeForCaching","basic","failLayer","failContext","failMode","state","followState","sourceRequest","extractHashFromURL","transferParamsToURL","evictExpensiveAttrs","allowsPayload","isSafeMethod","will302RedirectWithGET","willCache","autoCache","runQueuedCallbacks","load","xhr","XHRRenderer","buildAndSend","onload","onXHRLoad","onerror","onXHRError","ontimeout","onXHRTimeout","onabort","onXHRAbort","FormRenderer","buildAndSubmit","extractResponseFromXHR","respondWith","setAbortedState","csrfHeader","csrfParam","csrfToken","methodFromResponse","responseAttrs","urlFromResponse","responseText","titleFromXHR","targetFromXHR","acceptLayerFromXHR","dismissLayerFromXHR","eventPlansFromXHR","contextFromXHR","clearCache","clearCacheFromXHR","methodFromXHR","locationFromXHR","cacheKey","metaProps","requestMetaKeys","cacheSize","cacheExpiry","HTML_FORM_METHODS","action","contentType","paramsFromQuery","Queue","concurrency","badResponseTime","queuedRequests","currentRequests","checkSlowTimout","emittedSlow","asap","queueTime","setSlowTimer","hasConcurrencyLeft","sendRequestNow","queueRequest","promoteToForeground","checkSlow","maxConcurrency","isBusy","pluckNextRequest","registerAliasForRedirect","poke","conditions","requestMatches","abortExcept","excusedRequest","additionalConditions","excusedCacheKey","queuedRequest","currentSlow","isSlow","allForegroundRequests","allRequests","CONTENT_TYPE_FORM_DATA","handlers","header","XMLHttpRequest","timeout","open","getMethod","headerize","addHeader","getContentType","send","getPayload","finalizePayload","payload","setRequestHeader","payloadFinalized","getHeader","getResponseHeader","parsedJSON","noscriptWrapper","scriptWrapper","parseDocument","parseFragment","parseContent","matchingElement","wrapHTML","parseFn","runScripts","titleParsed","RevealMotion","ref2","ref3","ref4","ref5","ref6","ref7","viewportConfig","obstructionsLayer","snap","revealSnap","padding","revealPadding","revealTop","max","revealMax","topObstructions","fixedTop","bottomObstructions","fixedBottom","elementRect","maxPixels","newScrollTop","originalScrollTop","viewportRect","getViewportRect","min","addPadding","substractObstructions","scrollTop","scrollTo","scrollMotion","ScrollMotion","rootWidth","rootHeight","selectObstructions","selectors","obstruction","obstructionRect","scrollable","targetTop","behavior","speed","scrollSpeed","startTop","topDiff","sqrt","abs","requestAnimationFrame","animationFrame","timeElapsed","timeFraction","settled","frameTop","Selector","filters","unionSelector","passesFilter","Session","rootKey","loadFromSessionStorage","saveToSessionStorage","sessionStorage","getItem","setItem","scheduleSync","handleTetherOptions","alignAxis","syncOnScroll","setOffset","changeEventSubscription","syncTimer","anchorBox","elementBox","moveTo","describeConstraints","targetLeft","offsetLeft","offsetTop","fullPattern","negativeList","positiveList","groups","positiveRegexp","buildRegexp","negativeRegexp","capture","reCode","cast","doNormalize","isExcluded","exec","group","groupIndex","boot","emitReset","startExtension","stopExtension","onReady","console","get_booting","$bind","bindNow","buildEmitter","fork","isUnmodified","keyModifiers","wasEscapePressed","originalPreventDefault","createEvent","initEvent","stopImmediatePropagation","readyState","button","modifier","originalEvent","newType","copyKeys","newEvent","originalMethod","eventProps","forkedEvent","$on","$off","extractHeader","camel","shortHeader","methodParam","printBanner","printToError","printToStandard","printToStream","printToWarn","sessionStore","setEnabled","banner","stream","trace","color","logo","loaded","enable","disable","SYSTEM_MACRO_PRIORITIES","buildCompiler","compile","detectSystemMacroPriority","insertCompiler","macros","parseCompilerArgs","readData","registerCompiler","registerDestructor","registerJQueryCompiler","registerJQueryMacro","registerMacro","macro","priority","macroSelector","queue","newCompiler","existingCompiler","orderedCompilers","upDestructors","$compiler","$macro","buildState","currentLocation","isCurrentLocation","manipulate","nextPreviousLocation","previousLocation","restoreStateOnPop","trackCurrentLocation","restoreTargets","render","historyLayer","register","scrollRestoration","makeFollowable","get_location","get_previousLocation","isLocation","CSS_HAS_SUFFIX_PATTERN","emitFragmentDestroyed","emitFragmentInserted","emitFragmentKeep","emitFragmentKept","emitFromKeepPlan","getSmart","getSubtree","isDestroying","isGoodClassForTarget","isNotDestroying","markFragmentAsDestroying","parseSelector","parseTargetAndOptions","reload","renderLocalContent","renderRemoteContent","resolveOriginReference","sourceOf","timeOf","visit","badTargetClasses","autoHistoryTargets","any","guardEvent","aroundForOptions","mimicLocalRequest","emitDetails","newFragment","formerlyAsync","goodClasses","upId","matchesPattern","expanded","expandedTargets","descendantSelector","emitInserted","extract","absolutize","allSelector","doFocus","fixedElements","getAround","getScrollTops","isNativelyFocusable","parseOptions","pureHash","scrollTopKey","scrollTops","scrollingController","setScrollTops","userScrolled","wasChosenAsOverflowingElement","viewportSelectors","innerHeight","oldScrollTop","scrollingElement","clientWidth","clientHeight","innerWidth","outer","outerStyle","queryParts","tops","viewports","scrollTopsForURL","allScrollPromises","bounds","boundsRect","moveBounds","newElementRect","originalRect","afterMeasure","diffX","diffY","animateNow","applyConfig","composeTransitionFn","findAnimationFn","findNamedAnimation","findTransitionFn","motionController","namedAnimations","namedTransitions","pickDefault","registerAnimation","registerMoveAnimations","registerOpacityAnimation","registerTransition","skipAnimate","swapElementsDirectly","translateCSS","untranslatedBox","warnIfDisabled","matchMedia","registry","animationFn","runNow","animationOrTransition","lastFrame","transitionObject","oldRemote","scrollTopBeforeReveal","trackable","transitionFn","willMorph","scrollTopAfterReveal","namedTransition","oldAnimation","newAnimation","newAnimationFn","oldAnimationFn","opacity","dx","dy","transform","direction","boxToTransform","animationFromName","box","travelDistance","abortRequests","handleCaching","isIdle","parseRequestOptions","shouldReduceRequests","useCachedRequest","badDownlink","badRTT","_response","handleRequestOptions","cachedRequest","netInfo","navigator","connection","saveData","rtt","downlink","newRequest","LAYER_CLASSES","OVERLAY_CLASSES","api","ask","closeCallbackAttr","modeConfigs","openCallbackAttr","newConfig","cover","drawer","modal","popup","openMethod","shorthandMode","handleLayerOptions","configs","handleDeprecatedConfig","handleLayerConfig","onAccepted","onDismissed","get_stack","ATTRIBUTES_SUGGESTING_FOLLOW","LINKS_WITH_LOCAL_HTML","LINKS_WITH_REMOTE_HTML","combineFollowableSelectors","didUserDragAway","follow","followMethod","followOptions","followURL","forkEventAsUpClick","fullClickableSelector","fullFollowSelector","fullInstantSelector","fullPreloadSelector","isFollowDisabled","isFollowable","isInstant","isInstantDisabled","isPreloadDisabled","lastMousedownTarget","linkPreloader","makeClickable","shouldPreload","elementSelectors","attributeSelectors","elementSelector","followSelectors","noFollowSelectors","instantSelectors","noInstantSelectors","preloadSelectors","noPreloadSelectors","clickableSelectors","preloadEnabled","base1","parseFollowOptions","setting","tabindex","role","betterTarget","betterTargetSelector","fieldSelector","linkOrDescendant","clickEvent","area","areaAttrs","childLink","ATTRIBUTES_SUGGESTING_SUBMIT","abortScheduledValidate","autosubmit","findFields","findSwitcherForTarget","findValidateTarget","findValidateTargetFromConfig","fullSubmitSelector","getContainer","isSubmitDisabled","isSubmittable","observe","observeCallbackFromElement","submitButtonSelector","submitOptions","submittingButton","switchTarget","switchTargets","switcherValues","validate","validateTargets","fieldSelectors","submitSelectors","noSubmitSelectors","submitButtonSelectors","observeDelay","suffix","outsideFieldSelector","outsideFields","submitButton","observer","rawCallback","container","givenTarget","defaultTarget","checkedButton","groupName","meta","switcher","fieldValues","targetSelector","hideValues","showValues","switchers","formOrField","CLASS_ACTIVE","SELECTOR_LINK","findActivatableArea","getLayerLocation","linkURLs","navSelector","onBrowserLocationChanged","updateFragment","updateLayerIfLocationChanged","updateLinks","updateLinksWithinNavs","currentClasses","navSelectors","upFeedbackURLs","layerOption","links","navs","nav","feedbackLocation","layerLocation","currentClass","feedbackOpt","processedLocation","frontLayer","_event","shouldPoll","startPolling","stopPolling","hungrySelectors","pollInterval","pollEnabled","doReload","doSchedule","interval","lastRequest","stopped","hidden","isRails","rails","_rails_loaded","Rails","feature","dataAttribute","upAttribute","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","n","__esModule","d","definition","o","enumerable"],"mappings":"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","file":"index.js","sourcesContent":["\n/***\n@module up\n */\n\n(function() {\n  window.up = {\n    version: \"2.0.0\"\n  };\n\n}).call(this);\n(function() {\n  up.mockable = function(originalFn) {\n    var obj, spy;\n    spy = null;\n    obj = function() {\n      return (spy || originalFn).apply(null, arguments);\n    };\n    obj.mock = function() {\n      return spy = jasmine.createSpy('mockable', originalFn);\n    };\n    document.addEventListener('up:framework:reset', function() {\n      return spy = null;\n    });\n    return obj;\n  };\n\n}).call(this);\n\n/***\nUtility functions\n=================\n\nThe `up.util` module contains functions to facilitate the work with basic JavaScript\nvalues like lists, strings or functions.\n\nYou will recognize many functions form other utility libraries like [Lodash](https://lodash.com/).\nWhile feature parity with Lodash is not a goal of `up.util`, you might find it sufficient\nto not include another library in your asset bundle.\n\n@module up.util\n */\n\n(function() {\n  var slice = [].slice,\n    hasProp = {}.hasOwnProperty;\n\n  up.util = (function() {\n\n    /***\n    A function that does nothing.\n    \n    @function up.util.noop\n    @experimental\n     */\n    var APP_HOSTNAME, APP_PROTOCOL, ESCAPE_HTML_ENTITY_MAP, NORMALIZE_URL_DEFAULTS, SPRINTF_PLACEHOLDERS, abortableMicrotask, allSettled, always, arrayToSet, assign, assignPolyfill, asyncNoop, asyncify, camelToKebabCase, compact, compactObject, contains, copy, copyArrayLike, defineDelegates, defineGetter, each, eachIterator, endsWith, escapeHTML, escapeRegExp, evalOption, every, extractCallback, extractLastArg, extractOptions, filterList, findInList, findResult, flatMap, flatten, identity, intersect, isArguments, isArray, isBasicObjectProperty, isBlank, isBoolean, isCrossOrigin, isDefined, isElement, isElementish, isEqual, isEqualList, isFormData, isFunction, isGiven, isHTMLCollection, isJQuery, isList, isMissing, isNodeList, isNull, isNumber, isObject, isOptions, isPresent, isPromise, isRegExp, isStandardPort, isString, isTruthy, isUndefined, iteratee, last, literal, lowerCaseFirst, map, mapObject, matchURLs, memoize, merge, mergeDefined, methodAllowsPayload, muteRejection, newDeferred, newOptions, nextUid, noop, normalizeMethod, normalizeURL, nullToUndefined, objectContains, objectValues, omit, parseArgIntoOptions, parseURL, pick, pickBy, pluckKey, prefixCamelCase, presence, queueMicrotask, queueTask, reject, remove, renameKey, renameKeys, reverse, scheduleTimer, secondsSinceEpoch, sequence, setToArray, simpleEase, some, splitValues, sprintf, sprintfWithFormattedArgs, stringifyArg, times, toArray, uid, uniq, uniqBy, unprefixCamelCase, unresolvablePromise, upperCaseFirst, urlWithoutHost, valuesPolyfill, wrapList, wrapValue;\n    noop = (function() {});\n\n    /***\n    A function that returns a resolved promise.\n    \n    @function up.util.asyncNoop\n    @internal\n     */\n    asyncNoop = function() {\n      return Promise.resolve();\n    };\n\n    /***\n    Ensures that the given function can only be called a single time.\n    Subsequent calls will return the return value of the first call.\n    \n    Note that this is a simple implementation that\n    doesn't distinguish between argument lists.\n    \n    @function up.util.memoize\n    @internal\n     */\n    memoize = function(func) {\n      var cached, cachedValue;\n      cachedValue = void 0;\n      cached = false;\n      return function() {\n        var args;\n        args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n        if (cached) {\n          return cachedValue;\n        } else {\n          cached = true;\n          return cachedValue = func.apply(this, args);\n        }\n      };\n    };\n\n    /***\n    Returns if the given port is the default port for the given protocol.\n    \n    @function up.util.isStandardPort\n    @internal\n     */\n    isStandardPort = function(protocol, port) {\n      port = port.toString();\n      return ((port === \"\" || port === \"80\") && protocol === 'http:') || (port === \"443\" && protocol === 'https:');\n    };\n    NORMALIZE_URL_DEFAULTS = {\n      host: 'cross-domain',\n      stripTrailingSlash: false,\n      search: true,\n      hash: false\n    };\n\n    /***\n    Normalizes the given URL or path.\n    \n    @function up.util.normalizeURL\n    @param {boolean} [options.host='cross-domain']\n      Whether to include protocol, hostname and port in the normalized URL.\n    \n      By default the host is only included if it differ's from the page's hostname.\n    @param {boolean} [options.hash=false]\n      Whether to include an `#hash` anchor in the normalized URL\n    @param {boolean} [options.search=true]\n      Whether to include a `?query` string in the normalized URL\n    @param {boolean} [options.stripTrailingSlash=false]\n      Whether to strip a trailing slash from the pathname\n    @return {string}\n      The normalized URL.\n    @internal\n     */\n    normalizeURL = function(urlOrAnchor, options) {\n      var normalized, parts, pathname;\n      options = newOptions(options, NORMALIZE_URL_DEFAULTS);\n      parts = parseURL(urlOrAnchor);\n      normalized = '';\n      if (options.host === 'cross-domain') {\n        options.host = isCrossOrigin(parts);\n      }\n      if (options.host) {\n        normalized += parts.protocol + \"//\" + parts.hostname;\n        if (!isStandardPort(parts.protocol, parts.port)) {\n          normalized += \":\" + parts.port;\n        }\n      }\n      pathname = parts.pathname;\n      if (options.stripTrailingSlash) {\n        pathname = pathname.replace(/\\/$/, '');\n      }\n      normalized += pathname;\n      if (options.search) {\n        normalized += parts.search;\n      }\n      if (options.hash) {\n        normalized += parts.hash;\n      }\n      return normalized;\n    };\n    urlWithoutHost = function(url) {\n      return normalizeURL(url, {\n        host: false\n      });\n    };\n    matchURLs = function(leftURL, rightURL) {\n      return normalizeURL(leftURL) === normalizeURL(rightURL);\n    };\n    APP_PROTOCOL = location.protocol;\n    APP_HOSTNAME = location.hostname;\n    isCrossOrigin = function(urlOrAnchor) {\n      var parts;\n      if (isString(urlOrAnchor) && urlOrAnchor.indexOf('//') === -1) {\n        return false;\n      }\n      parts = parseURL(urlOrAnchor);\n      return APP_HOSTNAME !== parts.hostname || APP_PROTOCOL !== parts.protocol;\n    };\n\n    /***\n    Parses the given URL into components such as hostname and path.\n    \n    If the given URL is not fully qualified, it is assumed to be relative\n    to the current page.\n    \n    \\#\\#\\# Example\n    \n    ```js\n    let parsed = up.util.parseURL('/path?foo=value')\n    parsed.pathname // => '/path'\n    parsed.search // => '/?foo=value'\n    parsed.hash // => ''\n    ```\n    \n    @function up.util.parseURL\n    @return {Object}\n      The parsed URL as an object with\n      `protocol`, `hostname`, `port`, `pathname`, `search` and `hash`\n      properties.\n    @stable\n     */\n    parseURL = function(urlOrLink) {\n      var link;\n      if (isJQuery(urlOrLink)) {\n        link = up.element.get(urlOrLink);\n      } else if (urlOrLink.pathname) {\n        link = urlOrLink;\n      } else {\n        link = document.createElement('a');\n        link.href = urlOrLink;\n      }\n      if (!link.hostname) {\n        link.href = link.href;\n      }\n      if (link.pathname[0] !== '/') {\n        link = pick(link, ['protocol', 'hostname', 'port', 'pathname', 'search', 'hash']);\n        link.pathname = '/' + link.pathname;\n      }\n      return link;\n    };\n\n    /***\n    @function up.util.normalizeMethod\n    @internal\n     */\n    normalizeMethod = function(method) {\n      if (method) {\n        return method.toUpperCase();\n      } else {\n        return 'GET';\n      }\n    };\n\n    /***\n    @function up.util.methodAllowsPayload\n    @internal\n     */\n    methodAllowsPayload = function(method) {\n      return method !== 'GET' && method !== 'HEAD';\n    };\n    assignPolyfill = function() {\n      var j, key, len, source, sources, target, value;\n      target = arguments[0], sources = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n      for (j = 0, len = sources.length; j < len; j++) {\n        source = sources[j];\n        for (key in source) {\n          if (!hasProp.call(source, key)) continue;\n          value = source[key];\n          target[key] = value;\n        }\n      }\n      return target;\n    };\n\n    /***\n    Merge the own properties of one or more `sources` into the `target` object.\n    \n    @function up.util.assign\n    @param {Object} target\n    @param {Array<Object>} sources...\n    @stable\n     */\n    assign = Object.assign || assignPolyfill;\n    valuesPolyfill = function(object) {\n      var key, results, value;\n      results = [];\n      for (key in object) {\n        value = object[key];\n        results.push(value);\n      }\n      return results;\n    };\n\n    /***\n    Returns an array of values of the given object.\n    \n    @function up.util.values\n    @param {Object} object\n    @return {Array<string>}\n    @stable\n     */\n    objectValues = Object.values || valuesPolyfill;\n    iteratee = function(block) {\n      if (isString(block)) {\n        return function(item) {\n          return item[block];\n        };\n      } else {\n        return block;\n      }\n    };\n\n    /***\n    Translate all items in an array to new array of items.\n    \n    @function up.util.map\n    @param {Array} array\n    @param {Function(element, index): any|String} block\n      A function that will be called with each element and (optional) iteration index.\n    \n      You can also pass a property name as a String,\n      which will be collected from each item in the array.\n    @return {Array}\n      A new array containing the result of each function call.\n    @stable\n     */\n    map = function(array, block) {\n      var index, item, j, len, results;\n      if (array.length === 0) {\n        return [];\n      }\n      block = iteratee(block);\n      results = [];\n      for (index = j = 0, len = array.length; j < len; index = ++j) {\n        item = array[index];\n        results.push(block(item, index));\n      }\n      return results;\n    };\n\n    /***\n    @function up.util.mapObject\n    @internal\n     */\n    mapObject = function(array, pairer) {\n      var merger;\n      merger = function(object, pair) {\n        object[pair[0]] = pair[1];\n        return object;\n      };\n      return map(array, pairer).reduce(merger, {});\n    };\n\n    /***\n    Calls the given function for each element (and, optional, index)\n    of the given array.\n    \n    @function up.util.each\n    @param {Array} array\n    @param {Function(element, index)} block\n      A function that will be called with each element and (optional) iteration index.\n    @stable\n     */\n    each = map;\n    eachIterator = function(iterator, callback) {\n      var entry, results;\n      results = [];\n      while ((entry = iterator.next()) && !entry.done) {\n        results.push(callback(entry.value));\n      }\n      return results;\n    };\n\n    /***\n    Calls the given function for the given number of times.\n    \n    @function up.util.times\n    @param {number} count\n    @param {Function()} block\n    @stable\n     */\n    times = function(count, block) {\n      var iteration, j, ref, results;\n      results = [];\n      for (iteration = j = 0, ref = count - 1; 0 <= ref ? j <= ref : j >= ref; iteration = 0 <= ref ? ++j : --j) {\n        results.push(block(iteration));\n      }\n      return results;\n    };\n\n    /***\n    Returns whether the given argument is `null`.\n    \n    @function up.util.isNull\n    @param object\n    @return {boolean}\n    @stable\n     */\n    isNull = function(object) {\n      return object === null;\n    };\n\n    /***\n    Returns whether the given argument is `undefined`.\n    \n    @function up.util.isUndefined\n    @param object\n    @return {boolean}\n    @stable\n     */\n    isUndefined = function(object) {\n      return object === void 0;\n    };\n\n    /***\n    Returns whether the given argument is not `undefined`.\n    \n    @function up.util.isDefined\n    @param object\n    @return {boolean}\n    @stable\n     */\n    isDefined = function(object) {\n      return !isUndefined(object);\n    };\n\n    /***\n    Returns whether the given argument is either `undefined` or `null`.\n    \n    Note that empty strings or zero are *not* considered to be \"missing\".\n    \n    For the opposite of `up.util.isMissing()` see [`up.util.isGiven()`](/up.util.isGiven).\n    \n    @function up.util.isMissing\n    @param object\n    @return {boolean}\n    @stable\n     */\n    isMissing = function(object) {\n      return isUndefined(object) || isNull(object);\n    };\n\n    /***\n    Returns whether the given argument is neither `undefined` nor `null`.\n    \n    Note that empty strings or zero *are* considered to be \"given\".\n    \n    For the opposite of `up.util.isGiven()` see [`up.util.isMissing()`](/up.util.isMissing).\n    \n    @function up.util.isGiven\n    @param object\n    @return {boolean}\n    @stable\n     */\n    isGiven = function(object) {\n      return !isMissing(object);\n    };\n\n    /***\n    Return whether the given argument is considered to be blank.\n    \n    By default, this function returns `true` for:\n    \n    - `undefined`\n    - `null`\n    - Empty strings\n    - Empty arrays\n    - A plain object without own enumerable properties\n    \n    All other arguments return `false`.\n    \n    To check implement blank-ness checks for user-defined classes,\n    see `up.util.isBlank.key`.\n    \n    @function up.util.isBlank\n    @param value\n      The value is to check.\n    @return {boolean}\n      Whether the value is blank.\n    @stable\n     */\n    isBlank = function(value) {\n      if (isMissing(value)) {\n        return true;\n      }\n      if (isObject(value) && value[isBlank.key]) {\n        return value[isBlank.key]();\n      }\n      if (isString(value) || isList(value)) {\n        return value.length === 0;\n      }\n      if (isOptions(value)) {\n        return Object.keys(value).length === 0;\n      }\n      return false;\n    };\n\n    /***\n    This property contains the name of a method that user-defined classes\n    may implement to hook into the `up.util.isBlank()` protocol.\n    \n    \\#\\#\\# Example\n    \n    We have a user-defined `Account` class that we want to use with `up.util.isBlank()`:\n    \n    ```\n    class Account {\n      constructor(email) {\n        this.email = email\n      }\n    \n      [up.util.isBlank.key]() {\n        return up.util.isBlank(this.email)\n      }\n    }\n    ```\n    \n    Note that the protocol method is not actually named `'up.util.isBlank.key'`.\n    Instead it is named after the *value* of the `up.util.isBlank.key` property.\n    To do so, the code sample above is using a\n    [computed property name](https://medium.com/front-end-weekly/javascript-object-creation-356e504173a8)\n    in square brackets.\n    \n    We may now use `Account` instances with `up.util.isBlank()`:\n    \n    ```\n    foo = new Account('foo@foo.com')\n    bar = new Account('')\n    \n    console.log(up.util.isBlank(foo)) // prints false\n    console.log(up.util.isBlank(bar)) // prints true\n    ```\n    \n    @property up.util.isBlank.key\n    @experimental\n     */\n    isBlank.key = 'up.util.isBlank';\n\n    /***\n    Returns the given argument if the argument is [present](/up.util.isPresent),\n    otherwise returns `undefined`.\n    \n    @function up.util.presence\n    @param value\n    @param {Function(value): boolean} [tester=up.util.isPresent]\n      The function that will be used to test whether the argument is present.\n    @return {any|undefined}\n    @stable\n     */\n    presence = function(value, tester) {\n      if (tester == null) {\n        tester = isPresent;\n      }\n      if (tester(value)) {\n        return value;\n      } else {\n        return void 0;\n      }\n    };\n\n    /***\n    Returns whether the given argument is not [blank](/up.util.isBlank).\n    \n    @function up.util.isPresent\n    @param object\n    @return {boolean}\n    @stable\n     */\n    isPresent = function(object) {\n      return !isBlank(object);\n    };\n\n    /***\n    Returns whether the given argument is a function.\n    \n    @function up.util.isFunction\n    @param object\n    @return {boolean}\n    @stable\n     */\n    isFunction = function(object) {\n      return typeof object === 'function';\n    };\n\n    /***\n    Returns whether the given argument is a string.\n    \n    @function up.util.isString\n    @param object\n    @return {boolean}\n    @stable\n     */\n    isString = function(object) {\n      return typeof object === 'string' || object instanceof String;\n    };\n\n    /***\n    Returns whether the given argument is a boolean value.\n    \n    @function up.util.isBoolean\n    @param object\n    @return {boolean}\n    @stable\n     */\n    isBoolean = function(object) {\n      return typeof object === 'boolean' || object instanceof Boolean;\n    };\n\n    /***\n    Returns whether the given argument is a number.\n    \n    Note that this will check the argument's *type*.\n    It will return `false` for a string like `\"123\"`.\n    \n    @function up.util.isNumber\n    @param object\n    @return {boolean}\n    @stable\n     */\n    isNumber = function(object) {\n      return typeof object === 'number' || object instanceof Number;\n    };\n\n    /***\n    Returns whether the given argument is an options hash,\n    \n    Differently from [`up.util.isObject()`], this returns false for\n    functions, jQuery collections, promises, `FormData` instances and arrays.\n    \n    @function up.util.isOptions\n    @param object\n    @return {boolean}\n    @internal\n     */\n    isOptions = function(object) {\n      return typeof object === 'object' && !isNull(object) && (isUndefined(object.constructor) || object.constructor === Object);\n    };\n\n    /***\n    Returns whether the given argument is an object.\n    \n    This also returns `true` for functions, which may behave like objects in JavaScript.\n    \n    @function up.util.isObject\n    @param object\n    @return {boolean}\n    @stable\n     */\n    isObject = function(object) {\n      var typeOfResult;\n      typeOfResult = typeof object;\n      return (typeOfResult === 'object' && !isNull(object)) || typeOfResult === 'function';\n    };\n\n    /***\n    Returns whether the given argument is a [DOM element](https://developer.mozilla.org/de/docs/Web/API/Element).\n    \n    @function up.util.isElement\n    @param object\n    @return {boolean}\n    @stable\n     */\n    isElement = function(object) {\n      return object instanceof Element;\n    };\n\n    /***\n    Returns whether the given argument is a [regular expression](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp).\n    \n    @function up.util.isRegExp\n    @param object\n    @return {boolean}\n    @internal\n     */\n    isRegExp = function(object) {\n      return object instanceof RegExp;\n    };\n\n    /***\n    Returns whether the given argument is a [jQuery collection](https://learn.jquery.com/using-jquery-core/jquery-object/).\n    \n    @function up.util.isJQuery\n    @param object\n    @return {boolean}\n    @stable\n     */\n    isJQuery = function(object) {\n      return !!(object != null ? object.jquery : void 0);\n    };\n\n    /***\n    @function up.util.isElementish\n    @param object\n    @return {boolean}\n    @internal\n     */\n    isElementish = function(object) {\n      var ref;\n      return !!(object && (object.addEventListener || ((ref = object[0]) != null ? ref.addEventListener : void 0)));\n    };\n\n    /***\n    Returns whether the given argument is an object with a `then` method.\n    \n    @function up.util.isPromise\n    @param object\n    @return {boolean}\n    @stable\n     */\n    isPromise = function(object) {\n      return isObject(object) && isFunction(object.then);\n    };\n\n    /***\n    Returns whether the given argument is an array.\n    \n    @function up.util.isArray\n    @param object\n    @return {boolean}\n    @stable\n     */\n    isArray = Array.isArray;\n\n    /***\n    Returns whether the given argument is a `FormData` instance.\n    \n    Always returns `false` in browsers that don't support `FormData`.\n    \n    @function up.util.isFormData\n    @param object\n    @return {boolean}\n    @internal\n     */\n    isFormData = function(object) {\n      return object instanceof FormData;\n    };\n\n    /***\n    Converts the given [array-like value](/up.util.isList) into an array.\n    \n    If the given value is already an array, it is returned unchanged.\n    \n    @function up.util.toArray\n    @param object\n    @return {Array}\n    @stable\n     */\n    toArray = function(value) {\n      if (isArray(value)) {\n        return value;\n      } else {\n        return copyArrayLike(value);\n      }\n    };\n\n    /***\n    Returns whether the given argument is an array-like value.\n    \n    Return true for `Array`, a\n    [`NodeList`](https://developer.mozilla.org/en-US/docs/Web/API/NodeList),\n     the [arguments object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/arguments)\n     or a jQuery collection.\n    \n    Use [`up.util.isArray()`](/up.util.isArray) to test whether a value is an actual `Array`.\n    \n    @function up.util.isList\n    @param value\n    @return {boolean}\n    @stable\n     */\n    isList = function(value) {\n      return isArray(value) || isNodeList(value) || isArguments(value) || isJQuery(value) || isHTMLCollection(value);\n    };\n\n    /***\n    Returns whether the given value is a [`NodeList`](https://developer.mozilla.org/en-US/docs/Web/API/NodeList).\n    \n    `NodeLists` are array-like objects returned by [`document.querySelectorAll()`](https://developer.mozilla.org/en-US/docs/Web/API/Element/querySelectorAll).\n    \n    @function up.util.isNodeList\n    @param value\n    @return {boolean}\n    @internal\n     */\n    isNodeList = function(value) {\n      return value instanceof NodeList;\n    };\n    isHTMLCollection = function(value) {\n      return value instanceof HTMLCollection;\n    };\n\n    /***\n    Returns whether the given value is an [arguments object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/arguments).\n    \n    @function up.util.isArguments\n    @param value\n    @return {boolean}\n    @internal\n     */\n    isArguments = function(value) {\n      return Object.prototype.toString.call(value) === '[object Arguments]';\n    };\n    nullToUndefined = function(value) {\n      if (isNull(value)) {\n        return void 0;\n      } else {\n        return value;\n      }\n    };\n\n    /***\n    Returns the given value if it is [array-like](/up.util.isList), otherwise\n    returns an array with the given value as its only element.\n    \n    \\#\\#\\# Example\n    \n    ```js\n    up.util.wrapList([1, 2, 3]) // => [1, 2, 3]\n    up.util.wrapList('foo') // => ['foo']\n    ```\n    \n    @function up.util.wrapList\n    @param {any} value\n    @return {Array|NodeList|jQuery}\n    @experimental\n     */\n    wrapList = function(value) {\n      if (isList(value)) {\n        return value;\n      } else if (isMissing(value)) {\n        return [];\n      } else {\n        return [value];\n      }\n    };\n\n    /***\n    Returns a shallow copy of the given value.\n    \n    \\#\\#\\# Copying protocol\n    \n    - By default `up.util.copy()` can copy [array-like values](/up.util.isList),\n      plain objects and `Date` instances.\n    - Array-like objects are copied into new arrays.\n    - Unsupported types of values are returned unchanged.\n    - To make the copying protocol work with user-defined class,\n      see `up.util.copy.key`.\n    - Immutable objects, like strings or numbers, do not need to be copied.\n    \n    @function up.util.copy\n    @param {any} object\n    @return {any}\n    @stable\n     */\n    copy = function(value) {\n      if (isObject(value) && value[copy.key]) {\n        value = value[copy.key]();\n      } else if (isList(value)) {\n        value = copyArrayLike(value);\n      } else if (isOptions(value)) {\n        value = assign({}, value);\n      }\n      return value;\n    };\n    copyArrayLike = function(arrayLike) {\n      return Array.prototype.slice.call(arrayLike);\n    };\n\n    /***\n    This property contains the name of a method that user-defined classes\n    may implement to hook into the `up.util.copy()` protocol.\n    \n    \\#\\#\\# Example\n    \n    We have a user-defined `Account` class that we want to use with `up.util.copy()`:\n    \n    ```\n    class Account {\n      constructor(email) {\n        this.email = email\n      }\n    \n      [up.util.copy.key]() {\n        return new Account(this.email)\n      }\n    }\n    ```\n    \n    Note that the protocol method is not actually named `'up.util.copy.key'`.\n    Instead it is named after the *value* of the `up.util.copy.key` property.\n    To do so, the code sample above is using a\n    [computed property name](https://medium.com/front-end-weekly/javascript-object-creation-356e504173a8)\n    in square brackets.\n    \n    We may now use `Account` instances with `up.util.copy()`:\n    \n    ```\n    original = new User('foo@foo.com')\n    \n    copy = up.util.copy(original)\n    console.log(copy.email) // prints 'foo@foo.com'\n    \n    original.email = 'bar@bar.com' // change the original\n    console.log(copy.email) // still prints 'foo@foo.com'\n    ```\n    \n    @property up.util.copy.key\n    @param {string} key\n    @experimental\n     */\n    copy.key = 'up.util.copy';\n    Date.prototype[copy.key] = function() {\n      return new Date(+this);\n    };\n\n    /***\n    Creates a new object by merging together the properties from the given objects.\n    \n    @function up.util.merge\n    @param {Array<Object>} sources...\n    @return Object\n    @stable\n     */\n    merge = function() {\n      var sources;\n      sources = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      return assign.apply(null, [{}].concat(slice.call(sources)));\n    };\n\n    /***\n    @function up.util.mergeDefined\n    @param {Array<Object>} sources...\n    @return Object\n    @internal\n     */\n    mergeDefined = function() {\n      var j, key, len, result, source, sources, value;\n      sources = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      result = {};\n      for (j = 0, len = sources.length; j < len; j++) {\n        source = sources[j];\n        if (source) {\n          for (key in source) {\n            value = source[key];\n            if (isDefined(value)) {\n              result[key] = value;\n            }\n          }\n        }\n      }\n      return result;\n    };\n\n    /***\n    Creates an options hash from the given argument and some defaults.\n    \n    The semantics of this function are confusing.\n    We want to get rid of this in the future.\n    \n    @function up.util.options\n    @param {Object} object\n    @param {Object} [defaults]\n    @return {Object}\n    @internal\n     */\n    newOptions = function(object, defaults) {\n      if (defaults) {\n        return merge(defaults, object);\n      } else if (object) {\n        return copy(object);\n      } else {\n        return {};\n      }\n    };\n    parseArgIntoOptions = function(args, argKey) {\n      var options;\n      options = extractOptions(args);\n      if (isDefined(args[0])) {\n        options = copy(options);\n        options[argKey] = args[0];\n      }\n      return options;\n    };\n\n    /***\n    Passes each element in the given [array-like value](/up.util.isList) to the given function.\n    Returns the first element for which the function returns a truthy value.\n    \n    If no object matches, returns `undefined`.\n    \n    @function up.util.find\n    @param {List<T>} list\n    @param {Function(value): boolean} tester\n    @return {T|undefined}\n    @stable\n     */\n    findInList = function(list, tester) {\n      var element, j, len, match;\n      tester = iteratee(tester);\n      match = void 0;\n      for (j = 0, len = list.length; j < len; j++) {\n        element = list[j];\n        if (tester(element)) {\n          match = element;\n          break;\n        }\n      }\n      return match;\n    };\n\n    /***\n    Returns whether the given function returns a truthy value\n    for any element in the given [array-like value](/up.util.isList).\n    \n    @function up.util.some\n    @param {List} list\n    @param {Function(value, index): boolean} tester\n      A function that will be called with each element and (optional) iteration index.\n    \n    @return {boolean}\n    @stable\n     */\n    some = function(list, tester) {\n      return !!findResult(list, tester);\n    };\n\n    /***\n    Consecutively calls the given function which each element\n    in the given array. Returns the first truthy return value.\n    \n    Returned `undefined` iff the function does not return a truthy\n    value for any element in the array.\n    \n    @function up.util.findResult\n    @param {Array} array\n    @param {Function(element): any} tester\n      A function that will be called with each element and (optional) iteration index.\n    \n    @return {any|undefined}\n    @experimental\n     */\n    findResult = function(array, tester) {\n      var element, index, j, len, result;\n      tester = iteratee(tester);\n      for (index = j = 0, len = array.length; j < len; index = ++j) {\n        element = array[index];\n        if (result = tester(element, index)) {\n          return result;\n        }\n      }\n      return void 0;\n    };\n\n    /***\n    Returns whether the given function returns a truthy value\n    for all elements in the given [array-like value](/up.util.isList).\n    \n    @function up.util.every\n    @param {List} list\n    @param {Function(element, index): boolean} tester\n      A function that will be called with each element and (optional) iteration index.\n    \n    @return {boolean}\n    @experimental\n     */\n    every = function(list, tester) {\n      var element, index, j, len, match;\n      tester = iteratee(tester);\n      match = true;\n      for (index = j = 0, len = list.length; j < len; index = ++j) {\n        element = list[index];\n        if (!tester(element, index)) {\n          match = false;\n          break;\n        }\n      }\n      return match;\n    };\n\n    /***\n    Returns all elements from the given array that are\n    neither `null` or `undefined`.\n    \n    @function up.util.compact\n    @param {Array<T>} array\n    @return {Array<T>}\n    @stable\n     */\n    compact = function(array) {\n      return filterList(array, isGiven);\n    };\n    compactObject = function(object) {\n      return pickBy(object, isGiven);\n    };\n\n    /***\n    Returns the given array without duplicates.\n    \n    @function up.util.uniq\n    @param {Array<T>} array\n    @return {Array<T>}\n    @stable\n     */\n    uniq = function(array) {\n      if (array.length < 2) {\n        return array;\n      }\n      return setToArray(arrayToSet(array));\n    };\n\n    /***\n    This function is like [`uniq`](/up.util.uniq), accept that\n    the given function is invoked for each element to generate the value\n    for which uniquness is computed.\n    \n    @function up.util.uniqBy\n    @param {Array} array\n    @param {Function(value): any} array\n    @return {Array}\n    @experimental\n     */\n    uniqBy = function(array, mapper) {\n      var set;\n      if (array.length < 2) {\n        return array;\n      }\n      mapper = iteratee(mapper);\n      set = new Set();\n      return filterList(array, function(elem, index) {\n        var mapped;\n        mapped = mapper(elem, index);\n        if (set.has(mapped)) {\n          return false;\n        } else {\n          set.add(mapped);\n          return true;\n        }\n      });\n    };\n\n    /***\n    @function up.util.setToArray\n    @internal\n     */\n    setToArray = function(set) {\n      var array;\n      array = [];\n      set.forEach(function(elem) {\n        return array.push(elem);\n      });\n      return array;\n    };\n\n    /***\n    @function up.util.arrayToSet\n    @internal\n     */\n    arrayToSet = function(array) {\n      var set;\n      set = new Set();\n      array.forEach(function(elem) {\n        return set.add(elem);\n      });\n      return set;\n    };\n\n    /***\n    Returns all elements from the given [array-like value](/up.util.isList) that return\n    a truthy value when passed to the given function.\n    \n    @function up.util.filter\n    @param {List} list\n    @param {Function(value, index): boolean} tester\n    @return {Array}\n    @stable\n     */\n    filterList = function(list, tester) {\n      var matches;\n      tester = iteratee(tester);\n      matches = [];\n      each(list, function(element, index) {\n        if (tester(element, index)) {\n          return matches.push(element);\n        }\n      });\n      return matches;\n    };\n\n    /***\n    Returns all elements from the given [array-like value](/up.util.isList) that do not return\n    a truthy value when passed to the given function.\n    \n    @function up.util.reject\n    @param {List} list\n    @param {Function(element, index): boolean} tester\n    @return {Array}\n    @stable\n     */\n    reject = function(list, tester) {\n      tester = iteratee(tester);\n      return filterList(list, function(element, index) {\n        return !tester(element, index);\n      });\n    };\n\n    /***\n    Returns the intersection of the given two arrays.\n    \n    Implementation is not optimized. Don't use it for large arrays.\n    \n    @function up.util.intersect\n    @internal\n     */\n    intersect = function(array1, array2) {\n      return filterList(array1, function(element) {\n        return contains(array2, element);\n      });\n    };\n\n    /***\n    Waits for the given number of milliseconds, the runs the given callback.\n    \n    Instead of `up.util.timer(0, fn)` you can also use [`up.util.task(fn)`](/up.util.task).\n    \n    @function up.util.timer\n    @param {number} millis\n    @param {Function()} callback\n    @return {number}\n      The ID of the scheduled timeout.\n    \n      You may pass this ID to `clearTimeout()` to un-schedule the timeout.\n    @stable\n     */\n    scheduleTimer = function(millis, callback) {\n      return setTimeout(callback, millis);\n    };\n\n    /***\n    Pushes the given function to the [JavaScript task queue](https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/) (also \"macrotask queue\").\n    \n    Equivalent to calling `setTimeout(fn, 0)`.\n    \n    Also see `up.util.microtask()`.\n    \n    @function up.util.task\n    @param {Function()} block\n    @stable\n     */\n    queueTask = function(block) {\n      return setTimeout(block, 0);\n    };\n\n    /***\n    Pushes the given function to the [JavaScript microtask queue](https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/).\n    \n    @function up.util.microtask\n    @param {Function()} task\n    @return {Promise}\n      A promise that is resolved with the return value of `task`.\n    \n      If `task` throws an error, the promise is rejected with that error.\n    @experimental\n     */\n    queueMicrotask = function(task) {\n      return Promise.resolve().then(task);\n    };\n    abortableMicrotask = function(task) {\n      var aborted;\n      aborted = false;\n      queueMicrotask(function() {\n        if (!aborted) {\n          return task();\n        }\n      });\n      return function() {\n        return aborted = true;\n      };\n    };\n\n    /***\n    Returns the last element of the given array.\n    \n    @function up.util.last\n    @param {Array<T>} array\n    @return {T}\n    @stable\n     */\n    last = function(array) {\n      return array[array.length - 1];\n    };\n\n    /***\n    Returns whether the given value contains another value.\n    \n    If `value` is a string, this returns whether `subValue` is a sub-string of `value`.\n    \n    If `value` is an array, this returns whether `subValue` is an element of `value`.\n    \n    @function up.util.contains\n    @param {Array|string} value\n    @param {Array|string} subValue\n    @stable\n     */\n    contains = function(value, subValue) {\n      return value.indexOf(subValue) >= 0;\n    };\n\n    /***\n    Returns whether `object`'s entries are a superset\n    of `subObject`'s entries.\n    \n    @function up.util.objectContains\n    @param {Object} object\n    @param {Object} subObject\n    @internal\n     */\n    objectContains = function(object, subObject) {\n      var reducedValue;\n      reducedValue = pick(object, Object.keys(subObject));\n      return isEqual(subObject, reducedValue);\n    };\n\n    /***\n    Returns a copy of the given object that only contains\n    the given keys.\n    \n    @function up.util.pick\n    @param {Object} object\n    @param {Array} keys\n    @return {Object}\n    @stable\n     */\n    pick = function(object, keys) {\n      var filtered, j, key, len;\n      filtered = {};\n      for (j = 0, len = keys.length; j < len; j++) {\n        key = keys[j];\n        if (key in object) {\n          filtered[key] = object[key];\n        }\n      }\n      return filtered;\n    };\n\n    /***\n    Returns a copy of the given object that only contains\n    properties that pass the given tester function.\n    \n    @function up.util.pickBy\n    @param {Object} object\n    @param {Function<string, string, object>} tester\n      A function that will be called with each property.\n    \n      The arguments are the property value, key and the entire object.\n    @return {Object}\n    @experimental\n     */\n    pickBy = function(object, tester) {\n      var filtered, key, value;\n      tester = iteratee(tester);\n      filtered = {};\n      for (key in object) {\n        value = object[key];\n        if (tester(value, key, object)) {\n          filtered[key] = object[key];\n        }\n      }\n      return filtered;\n    };\n\n    /***\n    Returns a copy of the given object that contains all except\n    the given keys.\n    \n    @function up.util.omit\n    @param {Object} object\n    @param {Array} keys\n    @stable\n     */\n    omit = function(object, keys) {\n      return pickBy(object, function(value, key) {\n        return !contains(keys, key);\n      });\n    };\n\n    /***\n    Returns a promise that will never be resolved.\n    \n    @function up.util.unresolvablePromise\n    @internal\n     */\n    unresolvablePromise = function() {\n      return new Promise(noop);\n    };\n\n    /***\n    Removes the given element from the given array.\n    \n    This changes the given array.\n    \n    @function up.util.remove\n    @param {Array<T>} array\n      The array to change.\n    @param {T} element\n      The element to remove.\n    @return {T|undefined}\n      The removed element, or `undefined` if the array didn't contain the element.\n    @stable\n     */\n    remove = function(array, element) {\n      var index;\n      index = array.indexOf(element);\n      if (index >= 0) {\n        array.splice(index, 1);\n        return element;\n      }\n    };\n\n    /***\n    If the given `value` is a function, calls the function with the given `args`.\n    Otherwise it just returns `value`.\n    \n    \\#\\#\\# Example\n    \n    ```js\n    up.util.evalOption(5) // => 5\n    \n    let fn = () => 1 + 2\n    up.util.evalOption(fn) // => 3\n    ```\n    \n    @function up.util.evalOption\n    @param {any} value\n    @param {Array} ...args\n    @return {any}\n    @experimental\n     */\n    evalOption = function() {\n      var args, value;\n      value = arguments[0], args = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n      if (isFunction(value)) {\n        return value.apply(null, args);\n      } else {\n        return value;\n      }\n    };\n    ESCAPE_HTML_ENTITY_MAP = {\n      \"&\": \"&amp;\",\n      \"<\": \"&lt;\",\n      \">\": \"&gt;\",\n      '\"': '&quot;',\n      \"'\": '&#x27;'\n    };\n\n    /***\n    Escapes the given string of HTML by replacing control chars with their HTML entities.\n    \n    @function up.util.escapeHTML\n    @param {string} string\n      The text that should be escaped.\n    @stable\n     */\n    escapeHTML = function(string) {\n      return string.replace(/[&<>\"']/g, function(char) {\n        return ESCAPE_HTML_ENTITY_MAP[char];\n      });\n    };\n\n    /***\n    @function up.util.escapeRegExp\n    @internal\n     */\n    escapeRegExp = function(string) {\n      return string.replace(/[\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n    };\n\n    /***\n    Deletes the property with the given key from the given object\n    and returns its value.\n    \n    @function up.util.pluckKey\n    @param {Object} object\n    @param {string} key\n    @return {any}\n    @experimental\n     */\n    pluckKey = function(object, key) {\n      var value;\n      value = object[key];\n      delete object[key];\n      return value;\n    };\n    renameKey = function(object, oldKey, newKey) {\n      return object[newKey] = pluckKey(object, oldKey);\n    };\n    extractLastArg = function(args, tester) {\n      var lastArg;\n      lastArg = last(args);\n      if (tester(lastArg)) {\n        return args.pop();\n      }\n    };\n    extractCallback = function(args) {\n      return extractLastArg(args, isFunction);\n    };\n    extractOptions = function(args) {\n      return extractLastArg(args, isOptions) || {};\n    };\n    identity = function(arg) {\n      return arg;\n    };\n\n    /***\n    @function up.util.sequence\n    @param {Array<Function()>} functions\n    @return {Function()}\n      A function that will call all `functions` if called.\n    @internal\n     */\n    sequence = function(functions) {\n      if (functions.length === 1) {\n        return functions[0];\n      } else {\n        return function() {\n          return map(functions, function(f) {\n            return f();\n          });\n        };\n      }\n    };\n\n    /***\n    Flattens the given `array` a single depth level.\n    \n    \\#\\#\\# Example\n    \n    ```js\n    let nested = [1, [2, 3], [4]]\n    up.util.flatten(nested) // => [1, 2, 3, 4]\n    \n    @function up.util.flatten\n    @param {Array} array\n      An array which might contain other arrays\n    @return {Array}\n      The flattened array\n    @experimental\n     */\n    flatten = function(array) {\n      var flattened, j, len, object;\n      flattened = [];\n      for (j = 0, len = array.length; j < len; j++) {\n        object = array[j];\n        if (isList(object)) {\n          flattened.push.apply(flattened, object);\n        } else {\n          flattened.push(object);\n        }\n      }\n      return flattened;\n    };\n\n    /***\n    Maps each element using a mapping function,\n    then [flattens](/up.util.flatten) the result into a new array.\n    \n    @function up.util.flatMap\n    @param {Array} array\n    @param {Function(element)} mapping\n    @return {Array}\n    @experimental\n     */\n    flatMap = function(array, block) {\n      return flatten(map(array, block));\n    };\n\n    /***\n    Returns whether the given value is truthy.\n    \n    @function up.util.isTruthy\n    @internal\n     */\n    isTruthy = function(object) {\n      return !!object;\n    };\n\n    /***\n    Sets the given callback as both fulfillment and rejection handler for the given promise.\n    \n    [Unlike `promise#finally()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/finally#Description), `up.util.always()` may change the settlement value\n    of the given promise.\n    \n    @function up.util.always\n    @internal\n     */\n    always = function(promise, callback) {\n      return promise.then(callback, callback);\n    };\n\n    /***\n    Registers an empty rejection handler with the given promise.\n    This prevents browsers from printing \"Uncaught (in promise)\" to the error\n    console when the promise is rejected.\n    \n    This is helpful for event handlers where it is clear that no rejection\n    handler will be registered:\n    \n        up.on('submit', 'form[up-target]', (event, $form) => {\n          promise = up.submit($form)\n          up.util.muteRejection(promise)\n        })\n    \n    Does nothing if passed a missing value.\n    \n    @function up.util.muteRejection\n    @param {Promise|undefined|null} promise\n    @return {Promise}\n    @internal\n     */\n    muteRejection = function(promise) {\n      return promise != null ? promise[\"catch\"](noop) : void 0;\n    };\n\n    /***\n    @function up.util.newDeferred\n    @internal\n     */\n    newDeferred = function() {\n      var nativePromise, rejectFn, resolveFn;\n      resolveFn = void 0;\n      rejectFn = void 0;\n      nativePromise = new Promise(function(givenResolve, givenReject) {\n        resolveFn = givenResolve;\n        return rejectFn = givenReject;\n      });\n      nativePromise.resolve = resolveFn;\n      nativePromise.reject = rejectFn;\n      nativePromise.promise = function() {\n        return nativePromise;\n      };\n      return nativePromise;\n    };\n    asyncify = function(block) {\n      var error;\n      try {\n        return Promise.resolve(block());\n      } catch (error1) {\n        error = error1;\n        return Promise.reject(error);\n      }\n    };\n    isBasicObjectProperty = function(k) {\n      return Object.prototype.hasOwnProperty(k);\n    };\n\n    /***\n    Returns whether the two arguments are equal by value.\n    \n    \\#\\#\\# Comparison protocol\n    \n    - By default `up.util.isEqual()` can compare strings, numbers,\n      [array-like values](/up.util.isList), plain objects and `Date` objects.\n    - To make the copying protocol work with user-defined classes,\n      see `up.util.isEqual.key`.\n    - Objects without a defined comparison protocol are\n      defined by reference (`===`).\n    \n    @function up.util.isEqual\n    @param {any} a\n    @param {any} b\n    @return {boolean}\n      Whether the arguments are equal by value.\n    @experimental\n     */\n    isEqual = function(a, b) {\n      var aKeys, bKeys;\n      if (a != null ? a.valueOf : void 0) {\n        a = a.valueOf();\n      }\n      if (b != null ? b.valueOf : void 0) {\n        b = b.valueOf();\n      }\n      if (typeof a !== typeof b) {\n        return false;\n      } else if (isList(a) && isList(b)) {\n        return isEqualList(a, b);\n      } else if (isObject(a) && a[isEqual.key]) {\n        return a[isEqual.key](b);\n      } else if (isOptions(a) && isOptions(b)) {\n        aKeys = Object.keys(a);\n        bKeys = Object.keys(b);\n        if (isEqualList(aKeys, bKeys)) {\n          return every(aKeys, function(aKey) {\n            return isEqual(a[aKey], b[aKey]);\n          });\n        } else {\n          return false;\n        }\n      } else {\n        return a === b;\n      }\n    };\n\n    /***\n    This property contains the name of a method that user-defined classes\n    may implement to hook into the `up.util.isEqual()` protocol.\n    \n    \\#\\#\\# Example\n    \n    We have a user-defined `Account` class that we want to use with `up.util.isEqual()`:\n    \n    ```\n    class Account {\n      constructor(email) {\n        this.email = email\n      }\n    \n      [up.util.isEqual.key](other) {\n        return this.email === other.email;\n      }\n    }\n    ```\n    \n    Note that the protocol method is not actually named `'up.util.isEqual.key'`.\n    Instead it is named after the *value* of the `up.util.isEqual.key` property.\n    To do so, the code sample above is using a\n    [computed property name](https://medium.com/front-end-weekly/javascript-object-creation-356e504173a8)\n    in square brackets.\n    \n    We may now use `Account` instances with `up.util.isEqual()`:\n    \n    ```\n    one = new User('foo@foo.com')\n    two = new User('foo@foo.com')\n    three = new User('bar@bar.com')\n    \n    isEqual = up.util.isEqual(one, two)\n    // isEqual is now true\n    \n    isEqual = up.util.isEqual(one, three)\n    // isEqual is now false\n    ```\n    \n    @property up.util.isEqual.key\n    @param {string} key\n    @experimental\n     */\n    isEqual.key = 'up.util.isEqual';\n    isEqualList = function(a, b) {\n      return a.length === b.length && every(a, function(elem, index) {\n        return isEqual(elem, b[index]);\n      });\n    };\n    splitValues = function(value, separator) {\n      if (separator == null) {\n        separator = ' ';\n      }\n      if (isString(value)) {\n        value = value.split(separator);\n        value = map(value, function(v) {\n          return v.trim();\n        });\n        value = filterList(value, isPresent);\n        return value;\n      } else {\n        return wrapList(value);\n      }\n    };\n    endsWith = function(string, search) {\n      if (search.length > string.length) {\n        return false;\n      } else {\n        return string.substring(string.length - search.length) === search;\n      }\n    };\n    simpleEase = function(x) {\n      if (x < 0.5) {\n        return 2 * x * x;\n      } else {\n        return x * (4 - x * 2) - 1;\n      }\n    };\n    wrapValue = function() {\n      var args, constructor;\n      constructor = arguments[0], args = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n      if (args[0] instanceof constructor) {\n        return args[0];\n      } else {\n        return (function(func, args, ctor) {\n          ctor.prototype = func.prototype;\n          var child = new ctor, result = func.apply(child, args);\n          return Object(result) === result ? result : child;\n        })(constructor, args, function(){});\n      }\n    };\n    nextUid = 0;\n    uid = function() {\n      return nextUid++;\n    };\n\n    /***\n    Returns a copy of the given list, in reversed order.\n    \n    @function up.util.reverse\n    @param {List<T>} list\n    @return {Array<T>}\n    @internal\n     */\n    reverse = function(list) {\n      return copy(list).reverse();\n    };\n    renameKeys = function(object, renameKeyFn) {\n      var key, renamed, value;\n      renamed = {};\n      for (key in object) {\n        value = object[key];\n        renamed[renameKeyFn(key)] = value;\n      }\n      return renamed;\n    };\n    camelToKebabCase = function(str) {\n      return str.replace(/[A-Z]/g, function(char) {\n        return '-' + char.toLowerCase();\n      });\n    };\n    prefixCamelCase = function(str, prefix) {\n      return prefix + upperCaseFirst(str);\n    };\n    unprefixCamelCase = function(str, prefix) {\n      var match, pattern;\n      pattern = new RegExp('^' + prefix + '(.+)$');\n      if (match = str.match(pattern)) {\n        return lowerCaseFirst(match[1]);\n      }\n    };\n    lowerCaseFirst = function(str) {\n      return str[0].toLowerCase() + str.slice(1);\n    };\n    upperCaseFirst = function(str) {\n      return str[0].toUpperCase() + str.slice(1);\n    };\n    defineGetter = function(object, prop, get) {\n      return Object.defineProperty(object, prop, {\n        get: get\n      });\n    };\n    defineDelegates = function(object, props, targetProvider) {\n      return wrapList(props).forEach(function(prop) {\n        return Object.defineProperty(object, prop, {\n          get: function() {\n            var target, value;\n            target = targetProvider.call(this);\n            value = target[prop];\n            if (isFunction(value)) {\n              value = value.bind(target);\n            }\n            return value;\n          },\n          set: function(newValue) {\n            var target;\n            target = targetProvider.call(this);\n            return target[prop] = newValue;\n          }\n        });\n      });\n    };\n    literal = function(obj) {\n      var key, result, unprefixedKey, value;\n      result = {};\n      for (key in obj) {\n        value = obj[key];\n        if (unprefixedKey = unprefixCamelCase(key, 'get_')) {\n          defineGetter(result, unprefixedKey, value);\n        } else {\n          result[key] = value;\n        }\n      }\n      return result;\n    };\n    stringifyArg = function(arg) {\n      var attr, closer, error, j, len, maxLength, ref, string, value;\n      maxLength = 200;\n      closer = '';\n      if (isString(arg)) {\n        string = arg.replace(/[\\n\\r\\t ]+/g, ' ');\n        string = string.replace(/^[\\n\\r\\t ]+/, '');\n        string = string.replace(/[\\n\\r\\t ]$/, '');\n      } else if (isUndefined(arg)) {\n        string = 'undefined';\n      } else if (isNumber(arg) || isFunction(arg)) {\n        string = arg.toString();\n      } else if (isArray(arg)) {\n        string = \"[\" + (map(arg, stringifyArg).join(', ')) + \"]\";\n        closer = ']';\n      } else if (isJQuery(arg)) {\n        string = \"$(\" + (map(arg, stringifyArg).join(', ')) + \")\";\n        closer = ')';\n      } else if (isElement(arg)) {\n        string = \"<\" + (arg.tagName.toLowerCase());\n        ref = ['id', 'name', 'class'];\n        for (j = 0, len = ref.length; j < len; j++) {\n          attr = ref[j];\n          if (value = arg.getAttribute(attr)) {\n            string += \" \" + attr + \"=\\\"\" + value + \"\\\"\";\n          }\n        }\n        string += \">\";\n        closer = '>';\n      } else if (isRegExp(arg)) {\n        string = arg.toString();\n      } else {\n        try {\n          string = JSON.stringify(arg);\n        } catch (error1) {\n          error = error1;\n          if (error.name === 'TypeError') {\n            string = '(circular structure)';\n          } else {\n            throw error;\n          }\n        }\n      }\n      if (string.length > maxLength) {\n        string = (string.substr(0, maxLength)) + \" …\";\n        string += closer;\n      }\n      return string;\n    };\n    SPRINTF_PLACEHOLDERS = /\\%[oOdisf]/g;\n    secondsSinceEpoch = function() {\n      return Math.floor(Date.now() * 0.001);\n    };\n\n    /***\n    See https://developer.mozilla.org/en-US/docs/Web/API/Console#Using_string_substitutions\n    \n    @function up.util.sprintf\n    @internal\n     */\n    sprintf = function() {\n      var args, message;\n      message = arguments[0], args = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n      return sprintfWithFormattedArgs.apply(null, [identity, message].concat(slice.call(args)));\n    };\n\n    /***\n    @function up.util.sprintfWithFormattedArgs\n    @internal\n     */\n    sprintfWithFormattedArgs = function() {\n      var args, formatter, i, message;\n      formatter = arguments[0], message = arguments[1], args = 3 <= arguments.length ? slice.call(arguments, 2) : [];\n      if (!message) {\n        return '';\n      }\n      i = 0;\n      return message.replace(SPRINTF_PLACEHOLDERS, function() {\n        var arg;\n        arg = args[i];\n        arg = formatter(stringifyArg(arg));\n        i += 1;\n        return arg;\n      });\n    };\n    allSettled = function(promises) {\n      return Promise.all(map(promises, muteRejection));\n    };\n    return {\n      parseURL: parseURL,\n      normalizeURL: normalizeURL,\n      urlWithoutHost: urlWithoutHost,\n      matchURLs: matchURLs,\n      normalizeMethod: normalizeMethod,\n      methodAllowsPayload: methodAllowsPayload,\n      assign: assign,\n      assignPolyfill: assignPolyfill,\n      copy: copy,\n      copyArrayLike: copyArrayLike,\n      merge: merge,\n      mergeDefined: mergeDefined,\n      options: newOptions,\n      parseArgIntoOptions: parseArgIntoOptions,\n      each: each,\n      eachIterator: eachIterator,\n      map: map,\n      flatMap: flatMap,\n      mapObject: mapObject,\n      times: times,\n      findResult: findResult,\n      some: some,\n      every: every,\n      find: findInList,\n      filter: filterList,\n      reject: reject,\n      intersect: intersect,\n      compact: compact,\n      compactObject: compactObject,\n      uniq: uniq,\n      uniqBy: uniqBy,\n      last: last,\n      isNull: isNull,\n      isDefined: isDefined,\n      isUndefined: isUndefined,\n      isGiven: isGiven,\n      isMissing: isMissing,\n      isPresent: isPresent,\n      isBlank: isBlank,\n      presence: presence,\n      isObject: isObject,\n      isFunction: isFunction,\n      isString: isString,\n      isBoolean: isBoolean,\n      isNumber: isNumber,\n      isElement: isElement,\n      isJQuery: isJQuery,\n      isElementish: isElementish,\n      isPromise: isPromise,\n      isOptions: isOptions,\n      isArray: isArray,\n      isFormData: isFormData,\n      isNodeList: isNodeList,\n      isArguments: isArguments,\n      isList: isList,\n      isRegExp: isRegExp,\n      timer: scheduleTimer,\n      contains: contains,\n      objectContains: objectContains,\n      toArray: toArray,\n      pick: pick,\n      pickBy: pickBy,\n      omit: omit,\n      unresolvablePromise: unresolvablePromise,\n      remove: remove,\n      memoize: memoize,\n      pluckKey: pluckKey,\n      renameKey: renameKey,\n      extractOptions: extractOptions,\n      extractCallback: extractCallback,\n      noop: noop,\n      asyncNoop: asyncNoop,\n      identity: identity,\n      escapeHTML: escapeHTML,\n      escapeRegExp: escapeRegExp,\n      sequence: sequence,\n      evalOption: evalOption,\n      flatten: flatten,\n      isTruthy: isTruthy,\n      newDeferred: newDeferred,\n      always: always,\n      muteRejection: muteRejection,\n      asyncify: asyncify,\n      isBasicObjectProperty: isBasicObjectProperty,\n      isCrossOrigin: isCrossOrigin,\n      task: queueTask,\n      microtask: queueMicrotask,\n      abortableMicrotask: abortableMicrotask,\n      isEqual: isEqual,\n      splitValues: splitValues,\n      endsWith: endsWith,\n      wrapList: wrapList,\n      wrapValue: wrapValue,\n      simpleEase: simpleEase,\n      values: objectValues,\n      arrayToSet: arrayToSet,\n      setToArray: setToArray,\n      uid: uid,\n      upperCaseFirst: upperCaseFirst,\n      lowerCaseFirst: lowerCaseFirst,\n      getter: defineGetter,\n      delegate: defineDelegates,\n      literal: literal,\n      reverse: reverse,\n      prefixCamelCase: prefixCamelCase,\n      unprefixCamelCase: unprefixCamelCase,\n      camelToKebabCase: camelToKebabCase,\n      nullToUndefined: nullToUndefined,\n      sprintf: sprintf,\n      sprintfWithFormattedArgs: sprintfWithFormattedArgs,\n      renameKeys: renameKeys,\n      timestamp: secondsSinceEpoch,\n      allSettled: allSettled\n    };\n  })();\n\n}).call(this);\n(function() {\n  var slice = [].slice;\n\n  up.error = (function() {\n    var aborted, build, emitGlobal, errorInterface, failed, invalidSelector, notApplicable, notImplemented, u;\n    u = up.util;\n    build = function(message, props) {\n      var error;\n      if (props == null) {\n        props = {};\n      }\n      if (u.isArray(message)) {\n        message = u.sprintf.apply(u, message);\n      }\n      error = new Error(message);\n      u.assign(error, props);\n      return error;\n    };\n    errorInterface = function(name, init) {\n      var fn;\n      if (init == null) {\n        init = build;\n      }\n      fn = function() {\n        var args, error;\n        args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n        error = init.apply(null, args);\n        error.name = name;\n        return error;\n      };\n      fn.is = function(error) {\n        return error.name === name;\n      };\n      fn.async = function() {\n        var args;\n        args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n        return Promise.reject(fn.apply(null, args));\n      };\n      return fn;\n    };\n    failed = errorInterface('up.Failed');\n    aborted = errorInterface('AbortError', function(message) {\n      return build(message || 'Aborted');\n    });\n    notImplemented = errorInterface('up.NotImplemented');\n    notApplicable = errorInterface('up.NotApplicable', function(change, reason) {\n      return build(\"Cannot apply change: \" + change + \" (\" + reason + \")\");\n    });\n    invalidSelector = errorInterface('up.InvalidSelector', function(selector) {\n      return build(\"Cannot parse selector: \" + selector);\n    });\n    emitGlobal = function(error) {\n      var message;\n      message = error.message;\n      return up.emit(window, 'error', {\n        message: message,\n        error: error,\n        log: false\n      });\n    };\n    return {\n      failed: failed,\n      aborted: aborted,\n      invalidSelector: invalidSelector,\n      notApplicable: notApplicable,\n      notImplemented: notImplemented,\n      emitGlobal: emitGlobal\n    };\n  })();\n\n}).call(this);\n(function() {\n  up.migrate = {\n    config: {}\n  };\n\n}).call(this);\n\n/***\nBrowser support\n===============\n\nUnpoly supports all modern browsers.\n\nChrome, Firefox, Edge, Safari\n: Full support\n\nInternet Explorer 11\n: Full support with a `Promise` polyfill like [es6-promise](https://github.com/stefanpenner/es6-promise) (2.4 KB).\\\n  Support may be removed when Microsoft retires IE11 in [June 2022](https://blogs.windows.com/windowsexperience/2021/05/19/the-future-of-internet-explorer-on-windows-10-is-in-microsoft-edge/).\n\nInternet Explorer 10 or lower\n: Unpoly will not boot or [run compilers](/up.compiler),\n  leaving you with a classic server-side application.\n\n@module up.browser\n */\n\n(function() {\n  var slice = [].slice;\n\n  up.browser = (function() {\n    var assertConfirmed, callJQuery, canFormatLog, canJQuery, canPassiveEventListener, canPromise, canPushState, isIE11, isSupported, loadPage, popCookie, submitForm, u;\n    u = up.util;\n\n    /***\n    Makes a full-page request, replacing the entire browser environment with a new page from the server response.\n    \n    Also see `up.Request#loadPage()`.\n    \n    @function up.browser.loadPage\n    @param {string} options.url\n      The URL to load.\n    @param {string} [options.method='get']\n      The method for the request.\n    \n      Methods other than GET or POST will be [wrapped](/up.protocol.config#config.methodParam) in a POST request.\n    @param {Object|Array|FormData|string} [options.params]\n    @experimental\n     */\n    loadPage = function(requestsAttrs) {\n      return new up.Request(requestsAttrs).loadPage();\n    };\n\n    /***\n    Submits the given form with a full page load.\n    \n    For mocking in specs.\n    \n    @function up.browser.submitForm\n    @internal\n     */\n    submitForm = function(form) {\n      return form.submit();\n    };\n    isIE11 = u.memoize(function() {\n      return 'ActiveXObject' in window;\n    });\n\n    /***\n    Returns whether this browser supports manipulation of the current URL\n    via [`history.pushState`](https://developer.mozilla.org/en-US/docs/Web/API/History/pushState).\n    \n    When `pushState`  (e.g. through [`up.follow()`](/up.follow)), it will gracefully\n    fall back to a full page load.\n    \n    Note that Unpoly will not use `pushState` if the initial page was loaded with\n    a request method other than GET.\n    \n    @function up.browser.canPushState\n    @return {boolean}\n    @internal\n     */\n    canPushState = function() {\n      return history.pushState && up.protocol.initialRequestMethod() === 'GET';\n    };\n\n    /***\n    Returns whether this browser supports promises.\n    \n    @function up.browser.canPromise\n    @return {boolean}\n    @internal\n     */\n    canPromise = u.memoize(function() {\n      return !!window.Promise;\n    });\n    canFormatLog = u.memoize(function() {\n      return !isIE11();\n    });\n    canPassiveEventListener = u.memoize(function() {\n      return !isIE11();\n    });\n    canJQuery = function() {\n      return !!window.jQuery;\n    };\n    popCookie = function(name) {\n      var ref, value;\n      if (value = (ref = document.cookie.match(new RegExp(name + \"=(\\\\w+)\"))) != null ? ref[1] : void 0) {\n        document.cookie = name + '=; expires=Thu, 01-Jan-70 00:00:01 GMT; path=/';\n      }\n      return value;\n    };\n\n    /***\n    @return {Promise}\n    @function up,browser.ensureConfirmed\n    @param {string} options.confirm\n    @param {boolean} options.preload\n    @internal\n     */\n    assertConfirmed = function(options) {\n      return !options.confirm || window.confirm(options.confirm) || (function() {\n        throw up.error.aborted('User canceled action');\n      })();\n    };\n\n    /***\n    Returns whether Unpoly supports the current browser.\n    \n    If this returns `false` Unpoly will prevent itself from [booting](/up.boot)\n    and ignores all registered [event handlers](/up.on) and [compilers](/up.compiler).\n    This leaves you with a classic server-side application.\n    This is usually a better fallback than loading incompatible Javascript and causing\n    many errors on load.\n    \n    @function up.browser.isSupported\n    @stable\n     */\n    isSupported = function() {\n      return canPromise();\n    };\n    callJQuery = function() {\n      var args;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      canJQuery() || up.fail(\"jQuery must be published as window.jQuery\");\n      return jQuery.apply(null, args);\n    };\n    return u.literal({\n      loadPage: loadPage,\n      submitForm: submitForm,\n      canPushState: canPushState,\n      canFormatLog: canFormatLog,\n      canPassiveEventListener: canPassiveEventListener,\n      canJQuery: canJQuery,\n      assertConfirmed: assertConfirmed,\n      isSupported: isSupported,\n      popCookie: popCookie,\n      jQuery: callJQuery,\n      isIE11: isIE11\n    });\n  })();\n\n}).call(this);\n\n/***\nDOM helpers\n===========\n\nThe `up.element` module offers functions for DOM manipulation and traversal.\n\nIt complements [native `Element` methods](https://www.w3schools.com/jsref/dom_obj_all.asp) and works across all [supported browsers](/up.browser).\n\n@module up.element\n */\n\n(function() {\n  var slice = [].slice;\n\n  up.element = (function() {\n    var CSS_LENGTH_PROPS, MATCH_FN_NAME, SINGLETON_PATTERN, SINGLETON_TAG_NAMES, affix, all, ancestor, around, attributeSelector, booleanAttr, booleanOrStringAttr, callbackAttr, classSelector, closest, closestAttr, computedStyle, computedStyleNumber, concludeCSSTransition, createDocumentFromHTML, createFromHTML, createFromSelector, cssLength, elementTagName, extractFromStyleObject, first, fixedToAbsolute, getList, getOne, getRoot, hasCSSTransition, hide, idSelector, inlineStyle, insertBefore, isDetached, isInSubtree, isSingleton, isSingletonSelector, isVisible, jsonAttr, matches, metaContent, normalizeStyleValueForWrite, numberAttr, paint, remove, replace, setAttrs, setInlineStyle, setMissingAttr, setMissingAttrs, setTemporaryAttrs, setTemporaryStyle, show, stringAttr, subtree, toSelector, toggle, toggleAttr, toggleClass, trueAttributeSelector, u, unwrap, upAttrs, valueToList, wrapChildren;\n    u = up.util;\n    MATCH_FN_NAME = up.browser.isIE11() ? 'msMatchesSelector' : 'matches';\n\n    /***\n    Returns the first descendant element matching the given selector.\n    \n    @function first\n    @param {Element} [parent=document]\n      The parent element whose descendants to search.\n    \n      If omitted, all elements in the `document` will be searched.\n    @param {string} selector\n      The CSS selector to match.\n    @return {Element|undefined|null}\n      The first element matching the selector.\n    \n      Returns `null` or `undefined` if no element macthes.\n    @internal\n     */\n    first = function() {\n      var args, root, selector;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      selector = args.pop();\n      root = args[0] || document;\n      return root.querySelector(selector);\n    };\n\n    /***\n    Returns all descendant elements matching the given selector.\n    \n    @function up.element.all\n    @param {Element} [parent=document]\n      The parent element whose descendants to search.\n    \n      If omitted, all elements in the `document` will be searched.\n    @param {string} selector\n      The CSS selector to match.\n    @return {NodeList<Element>|Array<Element>}\n      A list of all elements matching the selector.\n    \n      Returns an empty list if there are no matches.\n    @stable\n     */\n    all = function() {\n      var args, root, selector;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      selector = args.pop();\n      root = args[0] || document;\n      return root.querySelectorAll(selector);\n    };\n\n    /***\n    Returns a list of the given parent's descendants matching the given selector.\n    The list will also include the parent element if it matches the selector itself.\n    \n    @function up.element.subtree\n    @param {Element} parent\n      The parent element for the search.\n    @param {string} selector\n      The CSS selector to match.\n    @return {NodeList<Element>|Array<Element>}\n      A list of all matching elements.\n    @stable\n     */\n    subtree = function(root, selector) {\n      var results;\n      results = [];\n      if (matches(root, selector)) {\n        results.push(root);\n      }\n      results.push.apply(results, all(root, selector));\n      return results;\n    };\n\n    /***\n    Returns whether the given element is either the given root element\n    or its descendants.\n    \n    @function isInSubtree\n    @internal\n     */\n    isInSubtree = function(root, selectorOrElement) {\n      var element;\n      element = getOne(selectorOrElement);\n      return root.contains(element);\n    };\n\n    /***\n    Returns the first element that matches the selector by testing the element itself\n    and traversing up through its ancestors in the DOM tree.\n    \n    @function up.element.closest\n    @param {Element} element\n      The element on which to start the search.\n    @param {string} selector\n      The CSS selector to match.\n    @return {Element|null|undefined} element\n      The matching element.\n    \n      Returns `null` or `undefined` if no element matches.\n    @stable\n     */\n    closest = function(element, selector) {\n      if (element.closest) {\n        return element.closest(selector);\n      } else if (matches(element, selector)) {\n        return element;\n      } else {\n        return ancestor(element, selector);\n      }\n    };\n\n    /***\n    Returns whether the given element matches the given CSS selector.\n    \n    To match against a non-standard selector like `:main`,\n    use `up.fragment.matches()` instead.\n    \n    @function up.element.matches\n    @param {Element} element\n      The element to check.\n    @param {string} selector\n      The CSS selector to match.\n    @return {boolean}\n      Whether `element` matches `selector`.\n    @stable\n     */\n    matches = function(element, selector) {\n      return typeof element[MATCH_FN_NAME] === \"function\" ? element[MATCH_FN_NAME](selector) : void 0;\n    };\n\n    /***\n    @function up.element.ancestor\n    @internal\n     */\n    ancestor = function(element, selector) {\n      var parentElement;\n      if (parentElement = element.parentElement) {\n        if (matches(parentElement, selector)) {\n          return parentElement;\n        } else {\n          return ancestor(parentElement, selector);\n        }\n      }\n    };\n    around = function(element, selector) {\n      return getList(closest(element, selector), subtree(element, selector));\n    };\n\n    /***\n    Returns the native [Element](https://developer.mozilla.org/en-US/docs/Web/API/Element) for the given value.\n    \n    \\#\\#\\# Casting rules\n    \n    - If given an element, returns that element.\n    - If given a CSS selector string, returns the first element matching that selector.\n    - If given a jQuery collection , returns the first element in the collection.\n      Throws an error if the collection contains more than one element.\n    - If given any other argument (`undefined`, `null`, `document`, `window`…), returns the argument unchanged.\n    \n    @function up.element.get\n    @param {Element} [parent=document]\n      The parent element whose descendants to search if `value` is a CSS selector string.\n    \n      If omitted, all elements in the `document` will be searched.\n    @param {Element|jQuery|string} value\n      The value to look up.\n    @return {Element}\n      The obtained `Element`.\n    @stable\n     */\n    getOne = function() {\n      var args, value;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      value = args.pop();\n      if (u.isElement(value)) {\n        return value;\n      } else if (u.isString(value)) {\n        return first.apply(null, slice.call(args).concat([value]));\n      } else if (u.isList(value)) {\n        if (value.length > 1) {\n          up.fail('up.element.get(): Cannot cast multiple elements (%o) to a single element', value);\n        }\n        return value[0];\n      } else {\n        return value;\n      }\n    };\n\n    /***\n    Composes a list of elements from the given arguments.\n    \n    \\#\\#\\# Casting rules\n    \n    - If given a string, returns the all elements matching that string.\n    - If given any other argument, returns the argument [wrapped as a list](/up.util.wrapList).\n    \n    \\#\\#\\# Example\n    \n    ```javascript\n    $jquery = $('.jquery')                          // returns jQuery (2) [div.jquery, div.jquery]\n    nodeList = document.querySelectorAll('.node')   // returns NodeList (2) [div.node, div.node]\n    element = document.querySelector('.element')    // returns Element div.element\n    selector = '.selector'                          // returns String '.selector'\n    \n    elements = up.element.list($jquery, nodeList, undefined, element, selector)\n    // returns [div.jquery, div.jquery, div.node, div.node, div.element, div.selector]\n    ```\n    \n    @function up.element.list\n    @param {Array<jQuery|Element|Array<Element>|String|undefined|null>} ...args\n    @return {Array<Element>}\n    @internal\n     */\n    getList = function() {\n      var args;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      return u.flatMap(args, valueToList);\n    };\n    valueToList = function(value) {\n      if (u.isString(value)) {\n        return all(value);\n      } else {\n        return u.wrapList(value);\n      }\n    };\n\n    /***\n    Removes the given element from the DOM tree.\n    \n    If you don't need IE11 support you may also use the built-in\n    [`Element#remove()`](https://developer.mozilla.org/en-US/docs/Web/API/ChildNode/remove) to the same effect.\n    \n    @function up.element.remove\n    @param {Element} element\n      The element to remove.\n    @stable\n     */\n    remove = function(element) {\n      var parent;\n      if (element.remove) {\n        return element.remove();\n      } else if (parent = element.parentNode) {\n        return parent.removeChild(element);\n      }\n    };\n\n    /***\n    Hides the given element.\n    \n    The element is hidden by setting an [inline style](https://www.codecademy.com/articles/html-inline-styles)\n    of `{ display: none }`.\n    \n    Also see `up.element.show()`.\n    \n    @function up.element.hide\n    @param {Element} element\n    @stable\n     */\n    hide = function(element) {\n      return element.style.display = 'none';\n    };\n\n    /***\n    Shows the given element.\n    \n    Also see `up.element.hide()`.\n    \n    \\#\\#\\# Limitations\n    \n    The element is shown by setting an [inline style](https://www.codecademy.com/articles/html-inline-styles)\n    of `{ display: '' }`.\n    \n    You might have CSS rules causing the element to remain hidden after calling `up.element.show(element)`.\n    Unpoly will not handle such cases in order to keep this function performant. As a workaround, you may\n    manually set the `element.style.display` property. Also see discussion\n    in jQuery issues [#88](https://github.com/jquery/jquery.com/issues/88),\n    [#2057](https://github.com/jquery/jquery/issues/2057) and\n    [this WHATWG mailing list post](http://lists.w3.org/Archives/Public/public-whatwg-archive/2014Apr/0094.html).\n    \n    @function up.element.show\n    @param {Element} element\n    @stable\n     */\n    show = function(element) {\n      return element.style.display = '';\n    };\n\n    /***\n    Display or hide the given element, depending on its current visibility.\n    \n    @function up.element.toggle\n    @param {Element} element\n    @param {boolean} [newVisible]\n      Pass `true` to show the element or `false` to hide it.\n    \n      If omitted, the element will be hidden if shown and shown if hidden.\n    @stable\n     */\n    toggle = function(element, newVisible) {\n      if (newVisible == null) {\n        newVisible = !isVisible(element);\n      }\n      if (newVisible) {\n        return show(element);\n      } else {\n        return hide(element);\n      }\n    };\n\n    /***\n    Adds or removes the given class from the given element.\n    \n    If you don't need IE11 support you may also use the built-in\n    [`Element#classList.toggle(className)`](https://developer.mozilla.org/en-US/docs/Web/API/Element/classList) to the same effect.\n    \n    @function up.element.toggleClass\n    @param {Element} element\n      The element for which to add or remove the class.\n    @param {string} className\n      The class which should be added or removed.\n    @param {Boolean} [newPresent]\n      Pass `true` to add the class to the element or `false` to remove it.\n    \n      If omitted, the class will be added if missing and removed if present.\n    @stable\n     */\n    toggleClass = function(element, klass, newPresent) {\n      var list;\n      list = element.classList;\n      if (newPresent == null) {\n        newPresent = !list.contains(klass);\n      }\n      if (newPresent) {\n        return list.add(klass);\n      } else {\n        return list.remove(klass);\n      }\n    };\n    toggleAttr = function(element, attr, value, newPresent) {\n      if (newPresent == null) {\n        newPresent = !element.hasAttribute(attr);\n      }\n      if (newPresent) {\n        return element.setAttribute(attr, value);\n      } else {\n        return element.removeAttribute(attr);\n      }\n    };\n\n    /***\n    Sets all key/values from the given object as attributes on the given element.\n    \n    \\#\\#\\# Example\n    \n        up.element.setAttrs(element, { title: 'Tooltip', tabindex: 1 })\n    \n    @function up.element.setAttrs\n    @param {Element} element\n      The element on which to set attributes.\n    @param {Object} attributes\n      An object of attributes to set.\n    @stable\n     */\n    setAttrs = function(element, attrs) {\n      var key, results1, value;\n      results1 = [];\n      for (key in attrs) {\n        value = attrs[key];\n        if (u.isGiven(value)) {\n          results1.push(element.setAttribute(key, value));\n        } else {\n          results1.push(element.removeAttribute(key));\n        }\n      }\n      return results1;\n    };\n    setTemporaryAttrs = function(element, attrs) {\n      var i, key, len, oldAttrs, ref;\n      oldAttrs = {};\n      ref = Object.keys(attrs);\n      for (i = 0, len = ref.length; i < len; i++) {\n        key = ref[i];\n        oldAttrs[key] = element.getAttribute(key);\n      }\n      setAttrs(element, attrs);\n      return function() {\n        return setAttrs(element, oldAttrs);\n      };\n    };\n\n    /***\n    @function up.element.metaContent\n    @internal\n     */\n    metaContent = function(name) {\n      var ref, selector;\n      selector = \"meta\" + attributeSelector('name', name);\n      return (ref = first(selector)) != null ? ref.getAttribute('content') : void 0;\n    };\n\n    /***\n    @function up.element.insertBefore\n    @internal\n     */\n    insertBefore = function(existingElement, newElement) {\n      return existingElement.insertAdjacentElement('beforebegin', newElement);\n    };\n\n    /***\n    Replaces the given old element with the given new element.\n    \n    The old element will be removed from the DOM tree.\n    \n    If you don't need IE11 support you may also use the built-in\n    [`Element#replaceWith()`](https://developer.mozilla.org/en-US/docs/Web/API/ChildNode/replaceWith) to the same effect.\n    \n    @function up.element.replace\n    @param {Element} oldElement\n    @param {Element} newElement\n    @stable\n     */\n    replace = function(oldElement, newElement) {\n      return oldElement.parentElement.replaceChild(newElement, oldElement);\n    };\n\n    /***\n    Creates an element matching the given CSS selector.\n    \n    The created element will not yet be attached to the DOM tree.\n    Attach it with [`Element#appendChild()`](https://developer.mozilla.org/en-US/docs/Web/API/Node/appendChild)\n    or use `up.element.affix()` to create an attached element.\n    \n    Use `up.hello()` to activate JavaScript behavior within the created element.\n    \n    \\#\\#\\# Examples\n    \n    To create an element with a given tag name:\n    \n        element = up.element.createFromSelector('span')\n        // element is <span></span>\n    \n    To create an element with a given class:\n    \n        element = up.element.createFromSelector('.klass')\n        // element is <div class=\"klass\"></div>\n    \n    To create an element with a given ID:\n    \n        element = up.element.createFromSelector('#foo')\n        // element is <div id=\"foo\"></div>\n    \n    To create an element with a given boolean attribute:\n    \n        element = up.element.createFromSelector('[attr]')\n        // element is <div attr></div>\n    \n    To create an element with a given attribute value:\n    \n        element = up.element.createFromSelector('[attr=\"value\"]')\n        // element is <div attr=\"value\"></div>\n    \n    You may also pass an object of attribute names/values as a second argument:\n    \n        element = up.element.createFromSelector('div', { attr: 'value' })\n        // element is <div attr=\"value\"></div>\n    \n    You may set the element's inner text by passing a `{ text }` option (HTML control characters will\n    be escaped):\n    \n        element = up.element.createFromSelector('div', { text: 'inner text' })\n        // element is <div>inner text</div>\n    \n    You may set the element's inner HTML by passing a `{ content }` option:\n    \n        element = up.element.createFromSelector('div', { content: '<span>inner text</span>' })\n        // element is <div>inner text</div>\n    \n    You may set inline styles by passing an object of CSS properties as a second argument:\n    \n        element = up.element.createFromSelector('div', { style: { color: 'red' }})\n        // element is <div style=\"color: red\"></div>\n    \n    @function up.element.createFromSelector\n    @param {string} selector\n      The CSS selector from which to create an element.\n    @param {Object} [attrs]\n      An object of attributes to set on the created element.\n    @param {Object} [attrs.text]\n      The [text content](https://developer.mozilla.org/en-US/docs/Web/API/Node/textContent) of the created element.\n    @param {Object} [attrs.content]\n      The [inner HTML](https://developer.mozilla.org/en-US/docs/Web/API/Element/innerHTML) of the created element.\n    @param {Object} [attrs.style]\n      An object of CSS properties that will be set as the inline style\n      of the created element.\n    \n      The given object may use kebab-case or camelCase keys.\n    @return {Element}\n      The created element.\n    @stable\n     */\n    createFromSelector = function(selector, attrs) {\n      var attrValues, classValue, contentValue, depthElement, depthSelector, depths, i, j, klass, len, len1, previousElement, ref, rootElement, selectorWithoutAttrValues, styleValue, tagName, textValue;\n      attrValues = [];\n      selectorWithoutAttrValues = selector.replace(/\\[([\\w-]+)(?:[\\~\\|\\^\\$\\*]?=([\"'])?([^\\2\\]]*?)\\2)?\\]/g, function(_match, attrName, _quote, attrValue) {\n        attrValues.push(attrValue || '');\n        return \"[\" + attrName + \"]\";\n      });\n      depths = selectorWithoutAttrValues.split(/[ >]+/);\n      rootElement = void 0;\n      depthElement = void 0;\n      previousElement = void 0;\n      for (i = 0, len = depths.length; i < len; i++) {\n        depthSelector = depths[i];\n        tagName = void 0;\n        depthSelector = depthSelector.replace(/^[\\w-]+/, function(match) {\n          tagName = match;\n          return '';\n        });\n        depthElement = document.createElement(tagName || 'div');\n        rootElement || (rootElement = depthElement);\n        depthSelector = depthSelector.replace(/\\#([\\w-]+)/, function(_match, id) {\n          depthElement.id = id;\n          return '';\n        });\n        depthSelector = depthSelector.replace(/\\.([\\w-]+)/g, function(_match, className) {\n          depthElement.classList.add(className);\n          return '';\n        });\n        if (attrValues.length) {\n          depthSelector = depthSelector.replace(/\\[([\\w-]+)\\]/g, function(_match, attrName) {\n            depthElement.setAttribute(attrName, attrValues.shift());\n            return '';\n          });\n        }\n        if (depthSelector !== '') {\n          throw up.error.invalidSelector(selector);\n        }\n        if (previousElement != null) {\n          previousElement.appendChild(depthElement);\n        }\n        previousElement = depthElement;\n      }\n      if (attrs) {\n        if (classValue = u.pluckKey(attrs, 'class')) {\n          ref = u.wrapList(classValue);\n          for (j = 0, len1 = ref.length; j < len1; j++) {\n            klass = ref[j];\n            rootElement.classList.add(klass);\n          }\n        }\n        if (styleValue = u.pluckKey(attrs, 'style')) {\n          setInlineStyle(rootElement, styleValue);\n        }\n        if (textValue = u.pluckKey(attrs, 'text')) {\n          rootElement.textContent = textValue;\n        }\n        if (contentValue = u.pluckKey(attrs, 'content')) {\n          rootElement.innerHTML = contentValue;\n        }\n        setAttrs(rootElement, attrs);\n      }\n      return rootElement;\n    };\n\n    /***\n    Creates an element matching the given CSS selector and attaches it to the given parent element.\n    \n    To create a detached element from a selector, see `up.element.createFromSelector()`.\n    \n    Use `up.hello()` to activate JavaScript behavior within the created element.\n    \n    \\#\\#\\# Example\n    \n    ```js\n    element = up.element.affix(document.body, '.klass')\n    element.parentElement // returns document.body\n    element.className // returns 'klass'\n    ```\n    \n    @function up.element.affix\n    @param {Element} parent\n      The parent to which to attach the created element.\n    @param {string} [position='beforeend']\n      The position of the new element in relation to `parent`.\n      Can be one of the following values:\n    \n      - `'beforebegin'`: Before `parent`, as a new sibling.\n      - `'afterbegin'`: Just inside `parent`, before its first child.\n      - `'beforeend'`: Just inside `parent`, after its last child.\n      - `'afterend'`: After `parent`, as a new sibling.\n    @param {string} selector\n      The CSS selector from which to create an element.\n    @param {Object} attrs\n      An object of attributes to set on the created element.\n    @param {Object} attrs.text\n      The [text content](https://developer.mozilla.org/en-US/docs/Web/API/Node/textContent) of the created element.\n    @param {Object} attrs.style\n      An object of CSS properties that will be set as the inline style\n      of the created element.\n    \n      The given object may use kebab-case or camelCase keys.\n    @return {Element}\n      The created element.\n    @stable\n     */\n    affix = function() {\n      var args, attributes, element, parent, position, selector;\n      parent = arguments[0], args = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n      attributes = u.extractOptions(args);\n      if (args.length === 2) {\n        position = args[0], selector = args[1];\n      } else {\n        position = 'beforeend';\n        selector = args[0];\n      }\n      element = createFromSelector(selector, attributes);\n      parent.insertAdjacentElement(position, element);\n      return element;\n    };\n\n    /***\n    Returns a CSS selector that matches the given element as good as possible.\n    \n    Alias for `up.fragment.toTarget()`.\n    \n    @function up.element.toSelector\n    @param {string|Element|jQuery}\n      The element for which to create a selector.\n    @stable\n     */\n    toSelector = function() {\n      var args, ref;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      return (ref = up.fragment).toTarget.apply(ref, args);\n    };\n    SINGLETON_TAG_NAMES = ['HTML', 'BODY', 'HEAD', 'TITLE'];\n    SINGLETON_PATTERN = new RegExp('\\\\b(' + SINGLETON_TAG_NAMES.join('|') + ')\\\\b', 'i');\n\n    /***\n    @function up.element.isSingleton\n    @internal\n     */\n    isSingleton = up.mockable(function(element) {\n      return matches(element, SINGLETON_TAG_NAMES.join(','));\n    });\n    isSingletonSelector = function(selector) {\n      return SINGLETON_PATTERN.test(selector);\n    };\n    elementTagName = function(element) {\n      return element.tagName.toLowerCase();\n    };\n\n    /***\n    @function up.element.attributeSelector\n    @internal\n     */\n    attributeSelector = function(attribute, value) {\n      value = value.replace(/\"/g, '\\\\\"');\n      return \"[\" + attribute + \"=\\\"\" + value + \"\\\"]\";\n    };\n    trueAttributeSelector = function(attribute) {\n      return \"[\" + attribute + \"]:not([\" + attribute + \"=false])\";\n    };\n    idSelector = function(id) {\n      if (id.match(/^[a-z0-9\\-_]+$/i)) {\n        return \"#\" + id;\n      } else {\n        return attributeSelector('id', id);\n      }\n    };\n\n    /***\n    @function up.element.classSelector\n    @internal\n     */\n    classSelector = function(klass) {\n      klass = klass.replace(/:/g, '\\\\:');\n      return \".\" + klass;\n    };\n\n    /***\n    Always creates a full document with a <html> root, even if the given `html`\n    is only a fragment.\n    \n    @function up.element.createDocumentFromHTML\n    @internal\n     */\n    createDocumentFromHTML = function(html) {\n      var parser;\n      parser = new DOMParser();\n      return parser.parseFromString(html, 'text/html');\n    };\n\n    /***\n    Creates an element from the given HTML fragment.\n    \n    Use `up.hello()` to activate JavaScript behavior within the created element.\n    \n    \\#\\#\\# Example\n    \n    ```js\n    element = up.element.createFromHTML('<div class=\"foo\"><span>text</span></div>')\n    element.className // returns 'foo'\n    element.children[0] // returns <span> element\n    element.children[0].textContent // returns 'text'\n    ```\n    \n    @function up.element.createFromHTML\n    @stable\n     */\n    createFromHTML = function(html) {\n      var fragment, range;\n      range = document.createRange();\n      range.setStart(document.body, 0);\n      fragment = range.createContextualFragment(html);\n      return fragment.childNodes[0];\n    };\n\n    /***\n    @function up.element.root\n    @internal\n     */\n    getRoot = function() {\n      return document.documentElement;\n    };\n\n    /***\n    Forces the browser to paint the given element now.\n    \n    @function up.element.paint\n    @internal\n     */\n    paint = function(element) {\n      return element.offsetHeight;\n    };\n\n    /***\n    @function up.element.concludeCSSTransition\n    @internal\n     */\n    concludeCSSTransition = function(element) {\n      var undo;\n      undo = setTemporaryStyle(element, {\n        transition: 'none'\n      });\n      paint(element);\n      return undo;\n    };\n\n    /***\n    Returns whether the given element has a CSS transition set.\n    \n    @function up.element.hasCSSTransition\n    @return {boolean}\n    @internal\n     */\n    hasCSSTransition = function(elementOrStyleHash) {\n      var duration, noTransition, prop, styleHash;\n      if (u.isOptions(elementOrStyleHash)) {\n        styleHash = elementOrStyleHash;\n      } else {\n        styleHash = computedStyle(elementOrStyleHash);\n      }\n      prop = styleHash.transitionProperty;\n      duration = styleHash.transitionDuration;\n      noTransition = prop === 'none' || (prop === 'all' && duration === 0);\n      return !noTransition;\n    };\n\n    /***\n    @function up.element.fixedToAbsolute\n    @internal\n     */\n    fixedToAbsolute = function(element) {\n      var elementRectAsFixed, offsetParentRect;\n      elementRectAsFixed = element.getBoundingClientRect();\n      element.style.position = 'absolute';\n      offsetParentRect = element.offsetParent.getBoundingClientRect();\n      return setInlineStyle(element, {\n        left: elementRectAsFixed.left - computedStyleNumber(element, 'margin-left') - offsetParentRect.left,\n        top: elementRectAsFixed.top - computedStyleNumber(element, 'margin-top') - offsetParentRect.top,\n        right: '',\n        bottom: ''\n      });\n    };\n\n    /***\n    On the given element, set attributes that are still missing.\n    \n    @function up.element.setMissingAttrs\n    @internal\n     */\n    setMissingAttrs = function(element, attrs) {\n      var key, results1, value;\n      results1 = [];\n      for (key in attrs) {\n        value = attrs[key];\n        results1.push(setMissingAttr(element, key, value));\n      }\n      return results1;\n    };\n    setMissingAttr = function(element, key, value) {\n      if (u.isMissing(element.getAttribute(key))) {\n        return element.setAttribute(key, value);\n      }\n    };\n\n    /***\n    @function up.element.unwrap\n    @internal\n     */\n    unwrap = function(wrapper) {\n      var parent, wrappedNodes;\n      parent = wrapper.parentNode;\n      wrappedNodes = u.toArray(wrapper.childNodes);\n      u.each(wrappedNodes, function(wrappedNode) {\n        return parent.insertBefore(wrappedNode, wrapper);\n      });\n      return parent.removeChild(wrapper);\n    };\n    wrapChildren = function(element, wrapperSelector) {\n      var childNode, wrapper;\n      if (wrapperSelector == null) {\n        wrapperSelector = 'up-wrapper';\n      }\n      wrapper = createFromSelector(wrapperSelector);\n      while (childNode = element.firstChild) {\n        wrapper.appendChild(childNode);\n      }\n      element.appendChild(wrapper);\n      return wrapper;\n    };\n\n    /***\n    Returns the given `attribute` value for the given `element`.\n    \n    If the element does not have the given attribute, it returns `undefined`.\n    This is a difference to the native `Element#getAttribute()`, which [mostly returns `null` in that case](https://developer.mozilla.org/en-US/docs/Web/API/Element/getAttribute#Non-existing_attributes).\n    \n    If the element has the attribute but without value (e.g. '<input readonly>'>), it returns an empty string.\n    \n    @function up.element.attr\n    @stable\n     */\n    stringAttr = function(element, attribute) {\n      return u.nullToUndefined(element.getAttribute(attribute));\n    };\n\n    /***\n    Returns the value of the given attribute on the given element, cast as a boolean value.\n    \n    If the attribute value cannot be cast to `true` or `false`, `undefined` is returned.\n    \n    \\#\\#\\# Casting rules\n    \n    This function deviates from the\n    [HTML Standard for boolean attributes](https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#boolean-attributes)\n    in order to allow `undefined` values. When an attribute is missing, Unpoly considers the value to be `undefined`\n    (where the standard would assume `false`).\n    \n    Unpoly also allows `\"true\"` and `\"false\"` as attribute values.\n    \n    The table below shows return values for `up.element.booleanAttr(element, 'foo')` given different elements:\n    \n    | Element             | Return value |\n    |---------------------|--------------|\n    | `<div foo>`         | `true`       |\n    | `<div foo=\"foo\">`   | `true`       |\n    | `<div foo=\"true\">`  | `true`       |\n    | `<div foo=\"\">`      | `true`       |\n    | `<div foo=\"false\">` | `false`      |\n    | `<div>`             | `undefined`  |\n    | `<div foo=\"bar\">`   | `undefined`  |\n    \n    @function up.element.booleanAttr\n    @param {Element} element\n      The element from which to retrieve the attribute value.\n    @param {string} attribute\n      The attribute name.\n    @return {boolean|undefined}\n      The cast attribute value.\n    @stable\n     */\n    booleanAttr = function(element, attribute, pass) {\n      var value;\n      value = stringAttr(element, attribute);\n      switch (value) {\n        case 'false':\n          return false;\n        case 'true':\n        case '':\n        case attribute:\n          return true;\n        default:\n          if (pass) {\n            return value;\n          }\n      }\n    };\n\n    /***\n    Returns the given attribute value cast as boolean.\n    \n    If the attribute value cannot be cast, returns the attribute value unchanged.\n    \n    @internal\n     */\n    booleanOrStringAttr = function(element, attribute) {\n      return booleanAttr(element, attribute, true);\n    };\n\n    /***\n    Returns the value of the given attribute on the given element, cast to a number.\n    \n    If the attribute value cannot be cast to a number, `undefined` is returned.\n    \n    @function up.element.numberAttr\n    @param {Element} element\n      The element from which to retrieve the attribute value.\n    @param {string} attribute\n      The attribute name.\n    @return {number|undefined}\n      The cast attribute value.\n    @stable\n     */\n    numberAttr = function(element, attribute) {\n      var value;\n      if (value = element.getAttribute(attribute)) {\n        value = value.replace(/_/g, '');\n        if (value.match(/^[\\d\\.]+$/)) {\n          return parseFloat(value);\n        }\n      }\n    };\n\n    /***\n    Reads the given attribute from the element, parsed as [JSON](https://www.json.org/).\n    \n    Returns `undefined` if the attribute value is [blank](/up.util.isBlank).\n    \n    Throws a `SyntaxError` if the attribute value is an invalid JSON string.\n    \n    @function up.element.jsonAttr\n    @param {Element} element\n      The element from which to retrieve the attribute value.\n    @param {string} attribute\n      The attribute name.\n    @return {Object|undefined}\n      The cast attribute value.\n    @stable\n     */\n    jsonAttr = function(element, attribute) {\n      var json, ref;\n      if (json = typeof element.getAttribute === \"function\" ? (ref = element.getAttribute(attribute)) != null ? ref.trim() : void 0 : void 0) {\n        return JSON.parse(json);\n      }\n    };\n    callbackAttr = function(link, attr, exposedKeys) {\n      var callback, code;\n      if (exposedKeys == null) {\n        exposedKeys = [];\n      }\n      if (code = link.getAttribute(attr)) {\n        callback = (function(func, args, ctor) {\n          ctor.prototype = func.prototype;\n          var child = new ctor, result = func.apply(child, args);\n          return Object(result) === result ? result : child;\n        })(Function, ['event'].concat(slice.call(exposedKeys), [code]), function(){});\n        return function(event) {\n          var exposedValues;\n          exposedValues = u.values(u.pick(event, exposedKeys));\n          return callback.call.apply(callback, [link, event].concat(slice.call(exposedValues)));\n        };\n      }\n    };\n    closestAttr = function(element, attr) {\n      var ref;\n      return (ref = closest(element, '[' + attr + ']')) != null ? ref.getAttribute(attr) : void 0;\n    };\n\n    /***\n    Temporarily sets the inline CSS styles on the given element.\n    \n    Returns a function that restores the original inline styles when called.\n    \n    \\#\\#\\# Example\n    \n        element = document.querySelector('div')\n        unhide = up.element.setTemporaryStyle(element, { 'visibility': 'hidden' })\n        // do things while element is invisible\n        unhide()\n        // element is visible again\n    \n    @function up.element.setTemporaryStyle\n    @param {Element} element\n      The element to style.\n    @param {Object} styles\n      An object of CSS property names and values.\n    @return {Function()}\n      A function that restores the original inline styles when called.\n    @internal\n     */\n    setTemporaryStyle = function(element, newStyles, block) {\n      var oldStyles;\n      oldStyles = inlineStyle(element, Object.keys(newStyles));\n      setInlineStyle(element, newStyles);\n      return function() {\n        return setInlineStyle(element, oldStyles);\n      };\n    };\n\n    /***\n    Receives [computed CSS styles](https://developer.mozilla.org/en-US/docs/Web/API/Window/getComputedStyle)\n    for the given element.\n    \n    \\#\\#\\# Examples\n    \n    When requesting a single CSS property, its value will be returned as a string:\n    \n        value = up.element.style(element, 'font-size')\n        // value is '16px'\n    \n    When requesting multiple CSS properties, the function returns an object of property names and values:\n    \n        value = up.element.style(element, ['font-size', 'margin-top'])\n        // value is { 'font-size': '16px', 'margin-top': '10px' }\n    \n    @function up.element.style\n    @param {Element} element\n    @param {String|Array} propOrProps\n      One or more CSS property names in kebab-case or camelCase.\n    @return {string|object}\n    @stable\n     */\n    computedStyle = function(element, props) {\n      var style;\n      style = window.getComputedStyle(element);\n      return extractFromStyleObject(style, props);\n    };\n\n    /***\n    Receives a [computed CSS property value](https://developer.mozilla.org/en-US/docs/Web/API/Window/getComputedStyle)\n    for the given element, casted as a number.\n    \n    The value is casted by removing the property's [unit](https://www.w3schools.com/cssref/css_units.asp) (which is usually `px` for computed properties).\n    The result is then parsed as a floating point number.\n    \n    Returns `undefined` if the property value is missing, or if it cannot\n    be parsed as a number.\n    \n    \\#\\#\\# Examples\n    \n    When requesting a single CSS property, its value will be returned as a string:\n    \n        value = up.element.style(element, 'font-size')\n        // value is '16px'\n    \n        value = up.element.styleNumber(element, 'font-size')\n        // value is 16\n    \n    @function up.element.styleNumber\n    @param {Element} element\n    @param {string} prop\n      A single property name in kebab-case or camelCase.\n    @return {number|undefined}\n    @stable\n     */\n    computedStyleNumber = function(element, prop) {\n      var rawValue;\n      rawValue = computedStyle(element, prop);\n      if (u.isGiven(rawValue)) {\n        return parseFloat(rawValue);\n      } else {\n        return void 0;\n      }\n    };\n\n    /***\n    Gets the given inline style(s) from the given element's `[style]` attribute.\n    \n    @function up.element.inlineStyle\n    @param {Element} element\n    @param {String|Array} propOrProps\n      One or more CSS property names in kebab-case or camelCase.\n    @return {string|object}\n    @internal\n     */\n    inlineStyle = function(element, props) {\n      var style;\n      style = element.style;\n      return extractFromStyleObject(style, props);\n    };\n    extractFromStyleObject = function(style, keyOrKeys) {\n      if (u.isString(keyOrKeys)) {\n        return style[keyOrKeys];\n      } else {\n        return u.pick(style, keyOrKeys);\n      }\n    };\n\n    /***\n    Sets the given CSS properties as inline styles on the given element.\n    \n    @function up.element.setStyle\n    @param {Element} element\n    @param {Object} props\n      One or more CSS properties with kebab-case keys or camelCase keys.\n    @return {string|object}\n    @stable\n     */\n    setInlineStyle = function(element, props) {\n      var key, results1, style, value;\n      style = element.style;\n      results1 = [];\n      for (key in props) {\n        value = props[key];\n        value = normalizeStyleValueForWrite(key, value);\n        results1.push(style[key] = value);\n      }\n      return results1;\n    };\n    normalizeStyleValueForWrite = function(key, value) {\n      if (u.isMissing(value)) {\n        value = '';\n      } else if (CSS_LENGTH_PROPS.has(key.toLowerCase().replace(/-/, ''))) {\n        value = cssLength(value);\n      }\n      return value;\n    };\n    CSS_LENGTH_PROPS = u.arrayToSet(['top', 'right', 'bottom', 'left', 'padding', 'paddingtop', 'paddingright', 'paddingbottom', 'paddingleft', 'margin', 'margintop', 'marginright', 'marginbottom', 'marginleft', 'borderwidth', 'bordertopwidth', 'borderrightwidth', 'borderbottomwidth', 'borderleftwidth', 'width', 'height', 'maxwidth', 'maxheight', 'minwidth', 'minheight']);\n\n    /***\n    Converts the given value to a CSS length value, adding a `px` unit if required.\n    \n    @function cssLength\n    @internal\n     */\n    cssLength = function(obj) {\n      if (u.isNumber(obj) || (u.isString(obj) && /^\\d+$/.test(obj))) {\n        return obj.toString() + \"px\";\n      } else {\n        return obj;\n      }\n    };\n\n    /***\n    Returns whether the given element is currently visible.\n    \n    An element is considered visible if it consumes space in the document.\n    Elements with `{ visibility: hidden }` or `{ opacity: 0 }` are considered visible, since they still consume space in the layout.\n    \n    Elements not attached to the DOM are considered hidden.\n    \n    @function up.element.isVisible\n    @param {Element} element\n      The element to check.\n    @return {boolean}\n    @stable\n     */\n    isVisible = function(element) {\n      return !!(element.offsetWidth || element.offsetHeight || element.getClientRects().length);\n    };\n    upAttrs = function(element) {\n      var attribute, attrs, i, len, name, ref, upAttributePattern;\n      upAttributePattern = /^up-/;\n      attrs = {};\n      ref = element.attributes;\n      for (i = 0, len = ref.length; i < len; i++) {\n        attribute = ref[i];\n        name = attribute.name;\n        if (name.match(upAttributePattern)) {\n          attrs[name] = attribute.value;\n        }\n      }\n      return attrs;\n    };\n\n    /***\n    Returns whether the given element has been removed from the DOM tree.\n    \n    up.element.isDetached\n    @param {Element} element\n    @return {boolean}\n    @stable\n     */\n    isDetached = function(element) {\n      return element !== document && !getRoot().contains(element);\n    };\n    return u.literal({\n      all: all,\n      subtree: subtree,\n      isInSubtree: isInSubtree,\n      closest: closest,\n      closestAttr: closestAttr,\n      matches: matches,\n      ancestor: ancestor,\n      around: around,\n      get: getOne,\n      list: getList,\n      remove: remove,\n      toggle: toggle,\n      toggleClass: toggleClass,\n      hide: hide,\n      show: show,\n      metaContent: metaContent,\n      replace: replace,\n      insertBefore: insertBefore,\n      createFromSelector: createFromSelector,\n      setAttrs: setAttrs,\n      setTemporaryAttrs: setTemporaryAttrs,\n      affix: affix,\n      toSelector: toSelector,\n      idSelector: idSelector,\n      classSelector: classSelector,\n      isSingleton: isSingleton,\n      isSingletonSelector: isSingletonSelector,\n      attributeSelector: attributeSelector,\n      trueAttributeSelector: trueAttributeSelector,\n      elementTagName: elementTagName,\n      createDocumentFromHTML: createDocumentFromHTML,\n      createFromHTML: createFromHTML,\n      get_root: getRoot,\n      paint: paint,\n      concludeCSSTransition: concludeCSSTransition,\n      hasCSSTransition: hasCSSTransition,\n      fixedToAbsolute: fixedToAbsolute,\n      setMissingAttrs: setMissingAttrs,\n      setMissingAttr: setMissingAttr,\n      unwrap: unwrap,\n      wrapChildren: wrapChildren,\n      attr: stringAttr,\n      booleanAttr: booleanAttr,\n      numberAttr: numberAttr,\n      jsonAttr: jsonAttr,\n      callbackAttr: callbackAttr,\n      booleanOrStringAttr: booleanOrStringAttr,\n      setTemporaryStyle: setTemporaryStyle,\n      style: computedStyle,\n      styleNumber: computedStyleNumber,\n      inlineStyle: inlineStyle,\n      setStyle: setInlineStyle,\n      isVisible: isVisible,\n      upAttrs: upAttrs,\n      toggleAttr: toggleAttr,\n      isDetached: isDetached\n    });\n  })();\n\n}).call(this);\n(function() {\n  var u,\n    slice = [].slice;\n\n  u = up.util;\n\n  up.Class = (function() {\n    function Class() {}\n\n    Class.getter = function(prop, get) {\n      return u.getter(this.prototype, prop, get);\n    };\n\n    Class.accessor = function(prop, descriptor) {\n      return Object.defineProperty(this.prototype, prop, descriptor);\n    };\n\n    Class.delegate = function(props, targetProp) {\n      return u.delegate(this.prototype, props, function() {\n        return this[targetProp];\n      });\n    };\n\n    Class.wrap = function() {\n      var args;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      return u.wrapValue.apply(u, [this].concat(slice.call(args)));\n    };\n\n    return Class;\n\n  })();\n\n}).call(this);\n(function() {\n  var u,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  u = up.util;\n\n  up.Record = (function(superClass) {\n    extend(Record, superClass);\n\n    Record.prototype.keys = function() {\n      throw 'Return an array of keys';\n    };\n\n    Record.prototype.defaults = function(options) {\n      return {};\n    };\n\n    function Record(options) {\n      u.assign(this, this.defaults(options), this.attributes(options));\n    }\n\n    Record.prototype.attributes = function(source) {\n      if (source == null) {\n        source = this;\n      }\n      return u.pick(source, this.keys());\n    };\n\n    Record.prototype[\"\" + u.copy.key] = function() {\n      return this.variant();\n    };\n\n    Record.prototype.variant = function(changes) {\n      if (changes == null) {\n        changes = {};\n      }\n      return new this.constructor(u.merge(this.attributes(), changes));\n    };\n\n    Record.prototype[\"\" + u.isEqual.key] = function(other) {\n      return this.constructor === other.constructor && u.isEqual(this.attributes(), other.attributes());\n    };\n\n    return Record;\n\n  })(up.Class);\n\n}).call(this);\n(function() {\n\n\n}).call(this);\n(function() {\n  var e;\n\n  e = up.element;\n\n  up.BodyShifter = (function() {\n    function BodyShifter() {\n      this.unshiftFns = [];\n      this.reset();\n    }\n\n    BodyShifter.prototype.reset = function() {\n      this.unshiftNow();\n      return this.shiftCount = 0;\n    };\n\n    BodyShifter.prototype.shift = function() {\n      var anchor, body, bodyRightPadding, bodyRightShift, elementRight, elementRightShift, i, len, overflowElement, ref, results, scrollbarTookSpace, scrollbarWidth;\n      this.shiftCount++;\n      if (this.shiftCount > 1) {\n        return;\n      }\n      scrollbarTookSpace = up.viewport.rootHasReducedWidthFromScrollbar();\n      overflowElement = up.viewport.rootOverflowElement();\n      this.changeStyle(overflowElement, {\n        overflowY: 'hidden'\n      });\n      if (!scrollbarTookSpace) {\n        return;\n      }\n      body = document.body;\n      scrollbarWidth = up.viewport.scrollbarWidth();\n      bodyRightPadding = e.styleNumber(body, 'paddingRight');\n      bodyRightShift = scrollbarWidth + bodyRightPadding;\n      this.changeStyle(body, {\n        paddingRight: bodyRightShift\n      });\n      ref = up.viewport.anchoredRight();\n      results = [];\n      for (i = 0, len = ref.length; i < len; i++) {\n        anchor = ref[i];\n        elementRight = e.styleNumber(anchor, 'right');\n        elementRightShift = scrollbarWidth + elementRight;\n        results.push(this.changeStyle(anchor, {\n          right: elementRightShift\n        }));\n      }\n      return results;\n    };\n\n    BodyShifter.prototype.changeStyle = function(element, styles) {\n      return this.unshiftFns.push(e.setTemporaryStyle(element, styles));\n    };\n\n    BodyShifter.prototype.unshift = function() {\n      this.shiftCount--;\n      if (this.shiftCount > 0) {\n        return;\n      }\n      return this.unshiftNow();\n    };\n\n    BodyShifter.prototype.unshiftNow = function() {\n      var results, unshiftFn;\n      results = [];\n      while (unshiftFn = this.unshiftFns.pop()) {\n        results.push(unshiftFn());\n      }\n      return results;\n    };\n\n    return BodyShifter;\n\n  })();\n\n}).call(this);\n(function() {\n  var u,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    slice = [].slice;\n\n  u = up.util;\n\n\n  /***\n  @class up.Cache\n  @internal\n   */\n\n  up.Cache = (function() {\n\n    /***\n    @constructor\n    @param {number|Function(): number} [config.size]\n      Maximum number of cache entries.\n      Set to `undefined` to not limit the cache size.\n    @param {number|Function(): number} [config.expiry]\n      The number of milliseconds after which a cache entry\n      will be discarded.\n    @param {string} [config.logPrefix]\n      A prefix for log entries printed by this cache object.\n    @param {Function(entry): string} [config.key]\n      A function that takes an argument and returns a string key\n      for storage. If omitted, `toString()` is called on the argument.\n    @param {Function(entry): boolean} [config.cacheable]\n      A function that takes a potential cache entry and returns whether\n      this entry  can be stored in the hash. If omitted, all entries are considered\n      cacheable.\n     */\n    function Cache(config) {\n      this.config = config != null ? config : {};\n      this.get = bind(this.get, this);\n      this.isFresh = bind(this.isFresh, this);\n      this.remove = bind(this.remove, this);\n      this.set = bind(this.set, this);\n      this.alias = bind(this.alias, this);\n      this.store = this.config.store || new up.store.Memory();\n    }\n\n    Cache.prototype.size = function() {\n      return this.store.size();\n    };\n\n    Cache.prototype.maxSize = function() {\n      return u.evalOption(this.config.size);\n    };\n\n    Cache.prototype.expiryMillis = function() {\n      return u.evalOption(this.config.expiry);\n    };\n\n    Cache.prototype.normalizeStoreKey = function(key) {\n      if (this.config.key) {\n        return this.config.key(key);\n      } else {\n        return key.toString();\n      }\n    };\n\n    Cache.prototype.isEnabled = function() {\n      return this.maxSize() !== 0 && this.expiryMillis() !== 0;\n    };\n\n    Cache.prototype.clear = function() {\n      return this.store.clear();\n    };\n\n    Cache.prototype.log = function() {\n      var args;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      if (this.config.logPrefix) {\n        args[0] = \"[\" + this.config.logPrefix + \"] \" + args[0];\n        return up.puts.apply(up, ['up.Cache'].concat(slice.call(args)));\n      }\n    };\n\n    Cache.prototype.keys = function() {\n      return this.store.keys();\n    };\n\n    Cache.prototype.each = function(fn) {\n      return u.each(this.keys(), (function(_this) {\n        return function(key) {\n          var entry;\n          entry = _this.store.get(key);\n          return fn(key, entry.value, entry.timestamp);\n        };\n      })(this));\n    };\n\n    Cache.prototype.makeRoomForAnotherEntry = function() {\n      var oldestKey, oldestTimestamp;\n      if (this.hasRoomForAnotherEntry()) {\n        return;\n      }\n      oldestKey = void 0;\n      oldestTimestamp = void 0;\n      this.each(function(key, request, timestamp) {\n        if (!oldestTimestamp || oldestTimestamp > timestamp) {\n          oldestKey = key;\n          return oldestTimestamp = timestamp;\n        }\n      });\n      if (oldestKey) {\n        return this.store.remove(oldestKey);\n      }\n    };\n\n    Cache.prototype.hasRoomForAnotherEntry = function() {\n      var maxSize;\n      maxSize = this.maxSize();\n      return !maxSize || this.size() < maxSize;\n    };\n\n    Cache.prototype.alias = function(oldKey, newKey) {\n      var value;\n      value = this.get(oldKey, {\n        silent: true\n      });\n      if (u.isDefined(value)) {\n        return this.set(newKey, value);\n      }\n    };\n\n    Cache.prototype.timestamp = function() {\n      return (new Date()).valueOf();\n    };\n\n    Cache.prototype.set = function(key, value) {\n      var entry, storeKey;\n      if (this.isEnabled()) {\n        this.makeRoomForAnotherEntry();\n        storeKey = this.normalizeStoreKey(key);\n        entry = {\n          timestamp: this.timestamp(),\n          value: value\n        };\n        return this.store.set(storeKey, entry);\n      }\n    };\n\n    Cache.prototype.remove = function(key) {\n      var storeKey;\n      storeKey = this.normalizeStoreKey(key);\n      return this.store.remove(storeKey);\n    };\n\n    Cache.prototype.isFresh = function(entry) {\n      var millis, timeSinceTouch;\n      millis = this.expiryMillis();\n      if (millis) {\n        timeSinceTouch = this.timestamp() - entry.timestamp;\n        return timeSinceTouch < millis;\n      } else {\n        return true;\n      }\n    };\n\n    Cache.prototype.get = function(key, options) {\n      var entry, storeKey;\n      if (options == null) {\n        options = {};\n      }\n      storeKey = this.normalizeStoreKey(key);\n      if (entry = this.store.get(storeKey)) {\n        if (this.isFresh(entry)) {\n          if (!options.silent) {\n            this.log(\"Cache hit for '%s'\", key);\n          }\n          return entry.value;\n        } else {\n          if (!options.silent) {\n            this.log(\"Discarding stale cache entry for '%s'\", key);\n          }\n          this.remove(key);\n          return void 0;\n        }\n      } else {\n        if (!options.silent) {\n          this.log(\"Cache miss for '%s'\", key);\n        }\n        return void 0;\n      }\n    };\n\n    return Cache;\n\n  })();\n\n}).call(this);\n(function() {\n  var u,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  u = up.util;\n\n  up.Change = (function(superClass) {\n    extend(Change, superClass);\n\n    function Change(options) {\n      this.options = options;\n    }\n\n    Change.prototype.notApplicable = function(reason) {\n      return up.error.notApplicable(this, reason);\n    };\n\n    Change.prototype.execute = function() {\n      throw up.error.notImplemented();\n    };\n\n    Change.prototype.onFinished = function() {\n      var base;\n      return typeof (base = this.options).onFinished === \"function\" ? base.onFinished() : void 0;\n    };\n\n    Change.prototype.improveHistoryValue = function(existingValue, newValue) {\n      if (existingValue === false || u.isString(existingValue)) {\n        return existingValue;\n      } else {\n        return newValue;\n      }\n    };\n\n    return Change;\n\n  })(up.Class);\n\n}).call(this);\n(function() {\n  var e, u,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  u = up.util;\n\n  e = up.element;\n\n  up.Change.Addition = (function(superClass) {\n    extend(Addition, superClass);\n\n    function Addition(options) {\n      Addition.__super__.constructor.call(this, options);\n      this.responseDoc = options.responseDoc;\n      this.acceptLayer = options.acceptLayer;\n      this.dismissLayer = options.dismissLayer;\n      this.eventPlans = options.eventPlans || [];\n    }\n\n    Addition.prototype.handleLayerChangeRequests = function() {\n      if (this.layer.isOverlay()) {\n        this.tryAcceptLayerFromServer();\n        this.abortWhenLayerClosed();\n        this.layer.tryAcceptForLocation();\n        this.abortWhenLayerClosed();\n        this.tryDismissLayerFromServer();\n        this.abortWhenLayerClosed();\n        this.layer.tryDismissForLocation();\n        this.abortWhenLayerClosed();\n      }\n      return this.layer.asCurrent((function(_this) {\n        return function() {\n          var eventPlan, i, len, ref, results;\n          ref = _this.eventPlans;\n          results = [];\n          for (i = 0, len = ref.length; i < len; i++) {\n            eventPlan = ref[i];\n            up.emit(eventPlan);\n            results.push(_this.abortWhenLayerClosed());\n          }\n          return results;\n        };\n      })(this));\n    };\n\n    Addition.prototype.tryAcceptLayerFromServer = function() {\n      if (u.isDefined(this.acceptLayer) && this.layer.isOverlay()) {\n        return this.layer.accept(this.acceptLayer);\n      }\n    };\n\n    Addition.prototype.tryDismissLayerFromServer = function() {\n      if (u.isDefined(this.dismissLayer) && this.layer.isOverlay()) {\n        return this.layer.dismiss(this.dismissLayer);\n      }\n    };\n\n    Addition.prototype.abortWhenLayerClosed = function() {\n      if (this.layer.isClosed()) {\n        throw up.error.aborted('Layer was closed');\n      }\n    };\n\n    Addition.prototype.setSource = function(arg) {\n      var newElement, oldElement, source;\n      oldElement = arg.oldElement, newElement = arg.newElement, source = arg.source;\n      if (source === 'keep') {\n        source = oldElement && up.fragment.source(oldElement);\n      }\n      if (source) {\n        return e.setMissingAttr(newElement, 'up-source', u.normalizeURL(source));\n      }\n    };\n\n    return Addition;\n\n  })(up.Change);\n\n}).call(this);\n(function() {\n  var u,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  u = up.util;\n\n  up.Change.Removal = (function(superClass) {\n    extend(Removal, superClass);\n\n    function Removal() {\n      return Removal.__super__.constructor.apply(this, arguments);\n    }\n\n    return Removal;\n\n  })(up.Change);\n\n}).call(this);\n(function() {\n  var e, u,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  u = up.util;\n\n  e = up.element;\n\n  up.Change.CloseLayer = (function(superClass) {\n    extend(CloseLayer, superClass);\n\n    function CloseLayer(options) {\n      var ref;\n      CloseLayer.__super__.constructor.call(this, options);\n      this.verb = options.verb;\n      this.layer = up.layer.get(options);\n      this.origin = options.origin;\n      this.value = options.value;\n      this.preventable = (ref = options.preventable) != null ? ref : true;\n    }\n\n    CloseLayer.prototype.execute = function() {\n      var parent, value;\n      if (this.origin && u.isUndefined(value)) {\n        value = e.jsonAttr(this.origin, \"up-\" + this.verb);\n      }\n      if (!this.layer.isOpen()) {\n        return Promise.resolve();\n      }\n      up.browser.assertConfirmed(this.options);\n      up.network.abort((function(_this) {\n        return function(request) {\n          return request.layer === _this.layer;\n        };\n      })(this));\n      if (this.emitCloseEvent().defaultPrevented && this.preventable) {\n        throw up.error.aborted('Close event was prevented');\n      }\n      parent = this.layer.parent;\n      this.layer.peel();\n      this.layer.stack.remove(this.layer);\n      parent.restoreHistory();\n      this.handleFocus(parent);\n      this.layer.teardownHandlers();\n      this.layer.destroyElements(this.options);\n      this.emitClosedEvent(parent);\n    };\n\n    CloseLayer.prototype.emitCloseEvent = function() {\n      return this.layer.emit(this.buildEvent(\"up:layer:\" + this.verb), {\n        callback: this.layer.callback(\"on\" + (u.upperCaseFirst(this.verb))),\n        log: \"Will \" + this.verb + \" \" + this.layer\n      });\n    };\n\n    CloseLayer.prototype.emitClosedEvent = function(formerParent) {\n      var verbPast, verbPastUpperCaseFirst;\n      verbPast = this.verb + \"ed\";\n      verbPastUpperCaseFirst = u.upperCaseFirst(verbPast);\n      return this.layer.emit(this.buildEvent(\"up:layer:\" + verbPast), {\n        baseLayer: formerParent,\n        callback: this.layer.callback(\"on\" + verbPastUpperCaseFirst),\n        ensureBubbles: true,\n        log: verbPastUpperCaseFirst + \" \" + this.layer\n      });\n    };\n\n    CloseLayer.prototype.buildEvent = function(name) {\n      return up.event.build(name, {\n        layer: this.layer,\n        value: this.value,\n        origin: this.origin\n      });\n    };\n\n    CloseLayer.prototype.handleFocus = function(formerParent) {\n      var ref;\n      this.layer.overlayFocus.teardown();\n      if ((ref = formerParent.overlayFocus) != null) {\n        ref.moveToFront();\n      }\n      return (this.layer.origin || formerParent.element).focus({\n        preventScroll: true\n      });\n    };\n\n    return CloseLayer;\n\n  })(up.Change.Removal);\n\n}).call(this);\n(function() {\n  var e,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  e = up.element;\n\n  up.Change.DestroyFragment = (function(superClass) {\n    extend(DestroyFragment, superClass);\n\n    function DestroyFragment(options) {\n      DestroyFragment.__super__.constructor.call(this, options);\n      this.layer = up.layer.get(options) || up.layer.current;\n      this.element = this.options.element;\n      this.animation = this.options.animation;\n      this.log = this.options.log;\n    }\n\n    DestroyFragment.prototype.execute = function() {\n      this.parent = this.element.parentNode;\n      up.fragment.markAsDestroying(this.element);\n      if (up.motion.willAnimate(this.element, this.animation, this.options)) {\n        this.emitDestroyed();\n        return this.animate().then((function(_this) {\n          return function() {\n            return _this.wipe();\n          };\n        })(this)).then((function(_this) {\n          return function() {\n            return _this.onFinished();\n          };\n        })(this));\n      } else {\n        this.wipe();\n        this.emitDestroyed();\n        return this.onFinished();\n      }\n    };\n\n    DestroyFragment.prototype.animate = function() {\n      return up.motion.animate(this.element, this.animation, this.options);\n    };\n\n    DestroyFragment.prototype.wipe = function() {\n      return this.layer.asCurrent((function(_this) {\n        return function() {\n          up.syntax.clean(_this.element, {\n            layer: _this.layer\n          });\n          if (up.browser.canJQuery()) {\n            return jQuery(_this.element).remove();\n          } else {\n            return e.remove(_this.element);\n          }\n        };\n      })(this));\n    };\n\n    DestroyFragment.prototype.emitDestroyed = function() {\n      return up.fragment.emitDestroyed(this.element, {\n        parent: this.parent,\n        log: this.log\n      });\n    };\n\n    return DestroyFragment;\n\n  })(up.Change.Removal);\n\n}).call(this);\n(function() {\n  var e, u,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  u = up.util;\n\n  e = up.element;\n\n  up.Change.FromContent = (function(superClass) {\n    extend(FromContent, superClass);\n\n    function FromContent(options) {\n      FromContent.__super__.constructor.call(this, options);\n      this.layers = u.filter(up.layer.getAll(this.options), this.isRenderableLayer);\n      this.origin = this.options.origin;\n      this.preview = this.options.preview;\n      this.mode = this.options.mode;\n      if (this.origin) {\n        this.originLayer = up.layer.get(this.origin);\n      }\n    }\n\n    FromContent.prototype.isRenderableLayer = function(layer) {\n      return layer === 'new' || layer.isOpen();\n    };\n\n    FromContent.prototype.getPlans = function() {\n      if (!this.plans) {\n        this.plans = [];\n        if (this.options.fragment) {\n          this.options.target = this.getResponseDoc().rootSelector();\n        }\n        this.expandIntoPlans(this.layers, this.options.target);\n        this.expandIntoPlans(this.layers, this.options.fallback);\n      }\n      return this.plans;\n    };\n\n    FromContent.prototype.expandIntoPlans = function(layers, targets) {\n      var change, i, layer, len, props, results, target;\n      results = [];\n      for (i = 0, len = layers.length; i < len; i++) {\n        layer = layers[i];\n        results.push((function() {\n          var j, len1, ref, results1;\n          ref = this.expandTargets(targets, layer);\n          results1 = [];\n          for (j = 0, len1 = ref.length; j < len1; j++) {\n            target = ref[j];\n            props = u.merge(this.options, {\n              target: target,\n              layer: layer,\n              placement: this.defaultPlacement()\n            });\n            if (layer === 'new') {\n              change = new up.Change.OpenLayer(props);\n            } else {\n              change = new up.Change.UpdateLayer(props);\n            }\n            results1.push(this.plans.push(change));\n          }\n          return results1;\n        }).call(this));\n      }\n      return results;\n    };\n\n    FromContent.prototype.expandTargets = function(targets, layer) {\n      return up.fragment.expandTargets(targets, {\n        layer: layer,\n        mode: this.mode,\n        origin: this.origin\n      });\n    };\n\n    FromContent.prototype.execute = function() {\n      var executePlan;\n      if (this.options.preload) {\n        return Promise.resolve();\n      }\n      executePlan = (function(_this) {\n        return function(plan) {\n          return plan.execute(_this.getResponseDoc());\n        };\n      })(this);\n      return this.seekPlan(executePlan) || this.postflightTargetNotApplicable();\n    };\n\n    FromContent.prototype.getResponseDoc = function() {\n      var base, docOptions;\n      if (!(this.preview || this.responseDoc)) {\n        docOptions = u.pick(this.options, ['target', 'content', 'fragment', 'document', 'html']);\n        if (typeof (base = up.migrate).handleResponseDocOptions === \"function\") {\n          base.handleResponseDocOptions(docOptions);\n        }\n        if (this.defaultPlacement() === 'content') {\n          docOptions.target = this.firstExpandedTarget(docOptions.target);\n        }\n        this.responseDoc = new up.ResponseDoc(docOptions);\n      }\n      return this.responseDoc;\n    };\n\n    FromContent.prototype.defaultPlacement = function() {\n      if (!this.options.document && !this.options.fragment) {\n        return 'content';\n      }\n    };\n\n    FromContent.prototype.firstExpandedTarget = function(target) {\n      return this.expandTargets(target || ':main', this.layers[0])[0];\n    };\n\n    FromContent.prototype.preflightProps = function(opts) {\n      var getPlanProps;\n      if (opts == null) {\n        opts = {};\n      }\n      getPlanProps = function(plan) {\n        return plan.preflightProps();\n      };\n      return this.seekPlan(getPlanProps) || opts.optional || this.preflightTargetNotApplicable();\n    };\n\n    FromContent.prototype.preflightTargetNotApplicable = function() {\n      return this.targetNotApplicable('Could not find target in current page');\n    };\n\n    FromContent.prototype.postflightTargetNotApplicable = function() {\n      return this.targetNotApplicable('Could not find common target in current page and response');\n    };\n\n    FromContent.prototype.targetNotApplicable = function(reason) {\n      var humanizedLayerOption, planTargets;\n      if (this.getPlans().length) {\n        planTargets = u.uniq(u.map(this.getPlans(), 'target'));\n        humanizedLayerOption = up.layer.optionToString(this.options.layer);\n        return up.fail(reason + \" (tried selectors %o in %s)\", planTargets, humanizedLayerOption);\n      } else if (this.layers.length) {\n        return up.fail('No target selector given');\n      } else {\n        return up.fail('Layer %o does not exist', this.options.layer);\n      }\n    };\n\n    FromContent.prototype.seekPlan = function(fn) {\n      var error, i, len, plan, ref;\n      ref = this.getPlans();\n      for (i = 0, len = ref.length; i < len; i++) {\n        plan = ref[i];\n        try {\n          return fn(plan);\n        } catch (error1) {\n          error = error1;\n          up.error.notApplicable.is(error) || (function() {\n            throw error;\n          })();\n        }\n      }\n    };\n\n    return FromContent;\n\n  })(up.Change);\n\n}).call(this);\n(function() {\n  var u,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  u = up.util;\n\n  up.Change.FromURL = (function(superClass) {\n    extend(FromURL, superClass);\n\n    function FromURL(options) {\n      this.options = options;\n      FromURL.__super__.constructor.call(this, this.options);\n      this.options.layer = up.layer.getAll(this.options);\n      this.options.normalizeLayerOptions = false;\n      this.successOptions = this.options;\n      this.failOptions = up.RenderOptions.deriveFailOptions(this.successOptions);\n    }\n\n    FromURL.prototype.execute = function() {\n      var newPageReason, promise;\n      if (newPageReason = this.newPageReason()) {\n        up.puts('up.render()', newPageReason);\n        up.browser.loadPage(this.options);\n        return u.unresolvablePromise();\n      }\n      promise = this.makeRequest();\n      if (this.options.preload) {\n        return promise;\n      }\n      return u.always(promise, (function(_this) {\n        return function(responseOrError) {\n          return _this.onRequestSettled(responseOrError);\n        };\n      })(this));\n    };\n\n    FromURL.prototype.newPageReason = function() {\n      if (u.isCrossOrigin(this.options.url)) {\n        return 'Loading cross-origin content in new page';\n      }\n      if (!up.browser.canPushState()) {\n        return 'Loading content in new page to restore history support';\n      }\n    };\n\n    FromURL.prototype.makeRequest = function() {\n      var failAttrs, requestAttrs, successAttrs;\n      successAttrs = this.preflightPropsForRenderOptions(this.successOptions);\n      failAttrs = this.preflightPropsForRenderOptions(this.failOptions, {\n        optional: true\n      });\n      requestAttrs = u.merge(this.successOptions, successAttrs, u.renameKeys(failAttrs, up.fragment.failKey));\n      this.request = up.request(requestAttrs);\n      return this.request;\n    };\n\n    FromURL.prototype.preflightPropsForRenderOptions = function(renderOptions, requestAttributesOptions) {\n      var preview;\n      preview = new up.Change.FromContent(u.merge(renderOptions, {\n        preview: true\n      }));\n      return preview.preflightProps(requestAttributesOptions);\n    };\n\n    FromURL.prototype.onRequestSettled = function(response) {\n      var log;\n      this.response = response;\n      if (!(this.response instanceof up.Response)) {\n        throw this.response;\n      } else if (this.isSuccessfulResponse()) {\n        return this.updateContentFromResponse(['Loaded fragment from successful response to %s', this.request.description], this.successOptions);\n      } else {\n        log = ['Loaded fragment from failed response to %s (HTTP %d)', this.request.description, this.response.status];\n        throw this.updateContentFromResponse(log, this.failOptions);\n      }\n    };\n\n    FromURL.prototype.isSuccessfulResponse = function() {\n      return this.successOptions.fail === false || this.response.ok;\n    };\n\n    FromURL.prototype.buildEvent = function(type, props) {\n      var defaultProps;\n      defaultProps = {\n        request: this.request,\n        response: this.response,\n        renderOptions: this.options\n      };\n      return up.event.build(type, u.merge(defaultProps, props));\n    };\n\n    FromURL.prototype.updateContentFromResponse = function(log, renderOptions) {\n      var event;\n      event = this.buildEvent('up:fragment:loaded', {\n        renderOptions: renderOptions\n      });\n      this.request.assertEmitted(event, {\n        log: log,\n        callback: this.options.onLoaded\n      });\n      this.augmentOptionsFromResponse(renderOptions);\n      return new up.Change.FromContent(renderOptions).execute();\n    };\n\n    FromURL.prototype.augmentOptionsFromResponse = function(renderOptions) {\n      var hash, isReloadable, responseURL, serverLocation, serverTarget;\n      responseURL = this.response.url;\n      serverLocation = responseURL;\n      if (hash = this.request.hash) {\n        renderOptions.hash = hash;\n        serverLocation += hash;\n      }\n      isReloadable = this.response.method === 'GET';\n      if (isReloadable) {\n        renderOptions.source = this.improveHistoryValue(renderOptions.source, responseURL);\n      } else {\n        renderOptions.source = this.improveHistoryValue(renderOptions.source, 'keep');\n        renderOptions.history = !!renderOptions.location;\n      }\n      renderOptions.location = this.improveHistoryValue(renderOptions.location, serverLocation);\n      renderOptions.title = this.improveHistoryValue(renderOptions.title, this.response.title);\n      renderOptions.eventPlans = this.response.eventPlans;\n      if (serverTarget = this.response.target) {\n        renderOptions.target = serverTarget;\n      }\n      renderOptions.document = this.response.text;\n      renderOptions.acceptLayer = this.response.acceptLayer;\n      renderOptions.dismissLayer = this.response.dismissLayer;\n      if (!renderOptions.document && (u.isDefined(renderOptions.acceptLayer) || u.isDefined(renderOptions.dismissLayer))) {\n        renderOptions.target = ':none';\n      }\n      return renderOptions.context = u.merge(renderOptions.context, this.response.context);\n    };\n\n    return FromURL;\n\n  })(up.Change);\n\n}).call(this);\n(function() {\n  var u,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  u = up.util;\n\n  up.Change.OpenLayer = (function(superClass) {\n    extend(OpenLayer, superClass);\n\n    function OpenLayer(options) {\n      OpenLayer.__super__.constructor.call(this, options);\n      this.target = options.target;\n      this.origin = options.origin;\n      this.baseLayer = options.baseLayer;\n    }\n\n    OpenLayer.prototype.preflightProps = function() {\n      return {\n        layer: this.baseLayer,\n        mode: this.options.mode,\n        context: this.buildLayer().context,\n        target: this.target\n      };\n    };\n\n    OpenLayer.prototype.bestPreflightSelector = function() {\n      return this.target;\n    };\n\n    OpenLayer.prototype.execute = function(responseDoc) {\n      if (this.target === ':none') {\n        this.content = document.createElement('up-none');\n      } else {\n        this.content = responseDoc.select(this.target);\n      }\n      if (!this.content || this.baseLayer.isClosed()) {\n        throw this.notApplicable();\n      }\n      up.puts('up.render()', \"Opening element \\\"\" + this.target + \"\\\" in new overlay\");\n      this.options.title = this.improveHistoryValue(this.options.title, responseDoc.getTitle());\n      if (this.emitOpenEvent().defaultPrevented) {\n        throw up.error.aborted('Open event was prevented');\n      }\n      this.baseLayer.peel();\n      this.layer = this.buildLayer();\n      up.layer.stack.push(this.layer);\n      this.layer.createElements(this.content);\n      this.layer.setupHandlers();\n      this.handleHistory();\n      this.setSource({\n        newElement: this.content,\n        source: this.options.source\n      });\n      responseDoc.finalizeElement(this.content);\n      up.hello(this.layer.element, {\n        layer: this.layer,\n        origin: this.origin\n      });\n      this.handleLayerChangeRequests();\n      this.handleScroll();\n      this.layer.startOpenAnimation().then((function(_this) {\n        return function() {\n          if (_this.layer.isOpen()) {\n            _this.handleFocus();\n          }\n          return _this.onFinished();\n        };\n      })(this));\n      this.layer.opening = false;\n      this.emitOpenedEvent();\n      this.abortWhenLayerClosed();\n      return new up.RenderResult({\n        layer: this.layer,\n        fragments: [this.content]\n      });\n    };\n\n    OpenLayer.prototype.buildLayer = function() {\n      return up.layer.build(u.merge(this.options, {\n        opening: true\n      }));\n    };\n\n    OpenLayer.prototype.handleHistory = function() {\n      if (this.layer.historyVisible === 'auto') {\n        this.layer.historyVisible = up.fragment.hasAutoHistory(this.content);\n      }\n      this.layer.parent.saveHistory();\n      this.options.history = true;\n      return this.layer.updateHistory(this.options);\n    };\n\n    OpenLayer.prototype.handleFocus = function() {\n      var fragmentFocus, ref;\n      if ((ref = this.baseLayer.overlayFocus) != null) {\n        ref.moveToBack();\n      }\n      this.layer.overlayFocus.moveToFront();\n      fragmentFocus = new up.FragmentFocus({\n        fragment: this.content,\n        layer: this.layer,\n        autoMeans: ['autofocus', 'layer']\n      });\n      return fragmentFocus.process(this.options.focus);\n    };\n\n    OpenLayer.prototype.handleScroll = function() {\n      var scrolling, scrollingOptions;\n      scrollingOptions = u.merge(this.options, {\n        fragment: this.content,\n        layer: this.layer,\n        autoMeans: ['hash', 'layer']\n      });\n      scrolling = new up.FragmentScrolling(scrollingOptions);\n      return scrolling.process(this.options.scroll);\n    };\n\n    OpenLayer.prototype.emitOpenEvent = function() {\n      return up.emit('up:layer:open', {\n        origin: this.origin,\n        baseLayer: this.baseLayer,\n        layerOptions: this.options,\n        log: \"Opening new overlay\"\n      });\n    };\n\n    OpenLayer.prototype.emitOpenedEvent = function() {\n      return this.layer.emit('up:layer:opened', {\n        origin: this.origin,\n        callback: this.layer.callback('onOpened'),\n        log: \"Opened new \" + this.layer\n      });\n    };\n\n    return OpenLayer;\n\n  })(up.Change.Addition);\n\n}).call(this);\n(function() {\n  var e, u,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  u = up.util;\n\n  e = up.element;\n\n  up.Change.UpdateLayer = (function(superClass) {\n    extend(UpdateLayer, superClass);\n\n    function UpdateLayer(options) {\n      this.executeStep = bind(this.executeStep, this);\n      UpdateLayer.__super__.constructor.call(this, options);\n      this.layer = options.layer;\n      this.target = options.target;\n      this.placement = options.placement;\n      this.context = options.context;\n      this.parseSteps();\n    }\n\n    UpdateLayer.prototype.preflightProps = function() {\n      this.matchPreflight();\n      return {\n        layer: this.layer,\n        mode: this.layer.mode,\n        context: u.merge(this.layer.context, this.context),\n        target: this.bestPreflightSelector()\n      };\n    };\n\n    UpdateLayer.prototype.bestPreflightSelector = function() {\n      this.matchPreflight();\n      return u.map(this.steps, 'selector').join(', ') || ':none';\n    };\n\n    UpdateLayer.prototype.execute = function(responseDoc) {\n      var swapPromises;\n      this.responseDoc = responseDoc;\n      this.matchPostflight();\n      up.puts('up.render()', \"Updating \\\"\" + (this.bestPreflightSelector()) + \"\\\" in \" + this.layer);\n      this.options.title = this.improveHistoryValue(this.options.title, this.responseDoc.getTitle());\n      this.setScrollAndFocusOptions();\n      if (this.options.saveScroll) {\n        up.viewport.saveScroll({\n          layer: this.layer\n        });\n      }\n      if (this.options.peel) {\n        this.layer.peel();\n      }\n      u.assign(this.layer.context, this.context);\n      if (this.options.history === 'auto') {\n        this.options.history = this.hasAutoHistory();\n      }\n      this.layer.updateHistory(u.pick(this.options, ['history', 'location', 'title']));\n      this.handleLayerChangeRequests();\n      swapPromises = this.steps.map(this.executeStep);\n      Promise.all(swapPromises).then((function(_this) {\n        return function() {\n          _this.abortWhenLayerClosed();\n          return _this.onFinished();\n        };\n      })(this));\n      return new up.RenderResult({\n        layer: this.layer,\n        fragments: u.map(this.steps, 'newElement')\n      });\n    };\n\n    UpdateLayer.prototype.executeStep = function(step) {\n      var keepPlan, morphOptions, newWrapper, oldWrapper, parent, position, promise, wrapper, wrapperStep;\n      this.setSource(step);\n      switch (step.placement) {\n        case 'swap':\n          if (keepPlan = this.findKeepPlan(step)) {\n            up.fragment.emitKept(keepPlan);\n            this.handleFocus(step.oldElement, step);\n            return this.handleScroll(step.oldElement, step);\n          } else {\n            this.transferKeepableElements(step);\n            parent = step.oldElement.parentNode;\n            morphOptions = u.merge(step, {\n              beforeStart: function() {\n                return up.fragment.markAsDestroying(step.oldElement);\n              },\n              afterInsert: (function(_this) {\n                return function() {\n                  _this.responseDoc.finalizeElement(step.newElement);\n                  return up.hello(step.newElement, step);\n                };\n              })(this),\n              beforeDetach: (function(_this) {\n                return function() {\n                  return up.syntax.clean(step.oldElement, {\n                    layer: _this.layer\n                  });\n                };\n              })(this),\n              afterDetach: function() {\n                e.remove(step.oldElement);\n                return up.fragment.emitDestroyed(step.oldElement, {\n                  parent: parent,\n                  log: false\n                });\n              },\n              scrollNew: (function(_this) {\n                return function() {\n                  _this.handleFocus(step.newElement, step);\n                  return _this.handleScroll(step.newElement, step);\n                };\n              })(this)\n            });\n            return up.morph(step.oldElement, step.newElement, step.transition, morphOptions);\n          }\n          break;\n        case 'content':\n          oldWrapper = e.wrapChildren(step.oldElement);\n          newWrapper = e.wrapChildren(step.newElement);\n          wrapperStep = u.merge(step, {\n            placement: 'swap',\n            oldElement: oldWrapper,\n            newElement: newWrapper,\n            focus: false\n          });\n          promise = this.executeStep(wrapperStep);\n          promise = promise.then((function(_this) {\n            return function() {\n              e.unwrap(newWrapper);\n              return _this.handleFocus(step.oldElement, step);\n            };\n          })(this));\n          return promise;\n        case 'before':\n        case 'after':\n          wrapper = e.wrapChildren(step.newElement);\n          position = step.placement === 'before' ? 'afterbegin' : 'beforeend';\n          step.oldElement.insertAdjacentElement(position, wrapper);\n          this.responseDoc.finalizeElement(wrapper);\n          up.hello(wrapper, step);\n          this.handleFocus(wrapper, step);\n          promise = this.handleScroll(wrapper, step);\n          promise = promise.then(function() {\n            return up.animate(wrapper, step.transition, step);\n          });\n          promise = promise.then(function() {\n            return e.unwrap(wrapper);\n          });\n          return promise;\n        default:\n          return up.fail('Unknown placement: %o', step.placement);\n      }\n    };\n\n    UpdateLayer.prototype.findKeepPlan = function(options) {\n      var lookupOpts, newElement, oldElement, partner, partnerSelector, plan;\n      if (!options.keep) {\n        return;\n      }\n      oldElement = options.oldElement, newElement = options.newElement;\n      if (partnerSelector = e.booleanOrStringAttr(oldElement, 'up-keep')) {\n        if (partnerSelector === true) {\n          partnerSelector = '&';\n        }\n        lookupOpts = {\n          layer: this.layer,\n          origin: oldElement\n        };\n        if (options.descendantsOnly) {\n          partner = up.fragment.get(newElement, partnerSelector, lookupOpts);\n        } else {\n          partner = up.fragment.subtree(newElement, partnerSelector, lookupOpts)[0];\n        }\n        if (partner && e.matches(partner, '[up-keep]')) {\n          plan = {\n            oldElement: oldElement,\n            newElement: partner,\n            newData: up.syntax.data(partner)\n          };\n          if (!up.fragment.emitKeep(plan).defaultPrevented) {\n            return plan;\n          }\n        }\n      }\n    };\n\n    UpdateLayer.prototype.transferKeepableElements = function(step) {\n      var j, keepPlans, keepable, keepableClone, len, plan, ref;\n      keepPlans = [];\n      if (step.keep) {\n        ref = step.oldElement.querySelectorAll('[up-keep]');\n        for (j = 0, len = ref.length; j < len; j++) {\n          keepable = ref[j];\n          if (plan = this.findKeepPlan(u.merge(step, {\n            oldElement: keepable,\n            descendantsOnly: true\n          }))) {\n            keepableClone = keepable.cloneNode(true);\n            e.replace(keepable, keepableClone);\n            e.replace(plan.newElement, keepable);\n            keepPlans.push(plan);\n          }\n        }\n      }\n      return step.keepPlans = keepPlans;\n    };\n\n    UpdateLayer.prototype.parseSteps = function() {\n      var expressionParts, j, len, ref, results, simpleTarget, step;\n      this.steps = [];\n      ref = u.splitValues(this.target, ',');\n      results = [];\n      for (j = 0, len = ref.length; j < len; j++) {\n        simpleTarget = ref[j];\n        if (simpleTarget !== ':none') {\n          expressionParts = simpleTarget.match(/^(.+?)(?:\\:(before|after))?$/) || (function() {\n            throw up.error.invalidSelector(simpleTarget);\n          })();\n          step = u.merge(this.options, {\n            selector: expressionParts[1],\n            placement: expressionParts[2] || this.placement || 'swap'\n          });\n          results.push(this.steps.push(step));\n        } else {\n          results.push(void 0);\n        }\n      }\n      return results;\n    };\n\n    UpdateLayer.prototype.matchPreflight = function() {\n      var finder, j, len, ref, step;\n      if (this.matchedPreflight) {\n        return;\n      }\n      ref = this.steps;\n      for (j = 0, len = ref.length; j < len; j++) {\n        step = ref[j];\n        finder = new up.FragmentFinder(step);\n        step.oldElement || (step.oldElement = finder.find() || (function() {\n          throw this.notApplicable(\"Could not find element \\\"\" + this.target + \"\\\" in current page\");\n        }).call(this));\n      }\n      this.resolveOldNesting();\n      return this.matchedPreflight = true;\n    };\n\n    UpdateLayer.prototype.matchPostflight = function() {\n      var j, len, ref, step;\n      if (this.matchedPostflight) {\n        return;\n      }\n      this.matchPreflight();\n      ref = this.steps;\n      for (j = 0, len = ref.length; j < len; j++) {\n        step = ref[j];\n        step.newElement = this.responseDoc.select(step.selector) || (function() {\n          throw this.notApplicable(\"Could not find element \\\"\" + this.target + \"\\\" in server response\");\n        }).call(this);\n      }\n      if (this.options.hungry) {\n        this.addHungrySteps();\n      }\n      this.resolveOldNesting();\n      return this.matchedPostflight = true;\n    };\n\n    UpdateLayer.prototype.addHungrySteps = function() {\n      var hungries, j, len, newElement, oldElement, results, selector, transition;\n      hungries = up.fragment.all(up.radio.hungrySelector(), this.options);\n      results = [];\n      for (j = 0, len = hungries.length; j < len; j++) {\n        oldElement = hungries[j];\n        selector = up.fragment.toTarget(oldElement);\n        if (newElement = this.responseDoc.select(selector)) {\n          transition = e.booleanOrStringAttr(oldElement, 'transition');\n          results.push(this.steps.push({\n            selector: selector,\n            oldElement: oldElement,\n            newElement: newElement,\n            transition: transition,\n            placement: 'swap'\n          }));\n        } else {\n          results.push(void 0);\n        }\n      }\n      return results;\n    };\n\n    UpdateLayer.prototype.containedByRivalStep = function(steps, candidateStep) {\n      return u.some(steps, function(rivalStep) {\n        return rivalStep !== candidateStep && (rivalStep.placement === 'swap' || rivalStep.placement === 'content') && rivalStep.oldElement.contains(candidateStep.oldElement);\n      });\n    };\n\n    UpdateLayer.prototype.resolveOldNesting = function() {\n      var compressed;\n      compressed = u.uniqBy(this.steps, 'oldElement');\n      compressed = u.reject(compressed, (function(_this) {\n        return function(step) {\n          return _this.containedByRivalStep(compressed, step);\n        };\n      })(this));\n      return this.steps = compressed;\n    };\n\n    UpdateLayer.prototype.setScrollAndFocusOptions = function() {\n      return this.steps.forEach((function(_this) {\n        return function(step, i) {\n          if (i > 0) {\n            step.scroll = false;\n            step.focus = false;\n          }\n          if (step.placement === 'swap' || step.placement === 'content') {\n            step.scrollBehavior = 'auto';\n            return _this.focusCapsule != null ? _this.focusCapsule : _this.focusCapsule = up.FocusCapsule.preserveWithin(step.oldElement);\n          }\n        };\n      })(this));\n    };\n\n    UpdateLayer.prototype.handleFocus = function(fragment, step) {\n      var fragmentFocus;\n      fragmentFocus = new up.FragmentFocus(u.merge(step, {\n        fragment: fragment,\n        layer: this.layer,\n        focusCapsule: this.focusCapsule,\n        autoMeans: up.fragment.config.autoFocus\n      }));\n      return fragmentFocus.process(step.focus);\n    };\n\n    UpdateLayer.prototype.handleScroll = function(fragment, step) {\n      var scrolling;\n      scrolling = new up.FragmentScrolling(u.merge(step, {\n        fragment: fragment,\n        layer: this.layer,\n        autoMeans: up.fragment.config.autoScroll\n      }));\n      return scrolling.process(step.scroll);\n    };\n\n    UpdateLayer.prototype.hasAutoHistory = function() {\n      var oldFragments;\n      oldFragments = u.map(this.steps, 'oldElement');\n      return u.some(oldFragments, function(oldFragment) {\n        return up.fragment.hasAutoHistory(oldFragment);\n      });\n    };\n\n    return UpdateLayer;\n\n  })(up.Change.Addition);\n\n}).call(this);\n(function() {\n  var e, u,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  u = up.util;\n\n  e = up.element;\n\n  up.CompilerPass = (function() {\n    function CompilerPass(root, compilers, options) {\n      this.root = root;\n      this.compilers = compilers;\n      if (options == null) {\n        options = {};\n      }\n      this.isInSkippedSubtree = bind(this.isInSkippedSubtree, this);\n      this.skipSubtrees = options.skip;\n      if (!(this.skipSubtrees.length && this.root.querySelector('[up-keep]'))) {\n        this.skipSubtrees = void 0;\n      }\n      this.layer = options.layer || up.layer.get(this.root) || up.layer.current;\n      this.errors = [];\n    }\n\n    CompilerPass.prototype.run = function() {\n      up.puts('up.hello()', \"Compiling fragment %o\", this.root);\n      this.layer.asCurrent((function(_this) {\n        return function() {\n          var compiler, i, len, ref, results;\n          ref = _this.compilers;\n          results = [];\n          for (i = 0, len = ref.length; i < len; i++) {\n            compiler = ref[i];\n            results.push(_this.runCompiler(compiler));\n          }\n          return results;\n        };\n      })(this));\n      if (this.errors.length) {\n        throw up.error.failed('Errors while compiling', {\n          errors: this.errors\n        });\n      }\n    };\n\n    CompilerPass.prototype.runCompiler = function(compiler) {\n      var base, i, len, match, matches;\n      matches = this.select(compiler.selector);\n      if (!matches.length) {\n        return;\n      }\n      if (!compiler.isDefault) {\n        up.puts('up.hello()', 'Compiling \"%s\" on %d element(s)', compiler.selector, matches.length);\n      }\n      if (compiler.batch) {\n        this.compileBatch(compiler, matches);\n      } else {\n        for (i = 0, len = matches.length; i < len; i++) {\n          match = matches[i];\n          this.compileOneElement(compiler, match);\n        }\n      }\n      return typeof (base = up.migrate).postCompile === \"function\" ? base.postCompile(matches, compiler) : void 0;\n    };\n\n    CompilerPass.prototype.compileOneElement = function(compiler, element) {\n      var compileArgs, data, destructorOrDestructors, elementArg, result;\n      elementArg = compiler.jQuery ? up.browser.jQuery(element) : element;\n      compileArgs = [elementArg];\n      if (compiler.length !== 1) {\n        data = up.syntax.data(element);\n        compileArgs.push(data);\n      }\n      result = this.applyCompilerFunction(compiler, element, compileArgs);\n      if (destructorOrDestructors = this.destructorPresence(result)) {\n        return up.destructor(element, destructorOrDestructors);\n      }\n    };\n\n    CompilerPass.prototype.compileBatch = function(compiler, elements) {\n      var compileArgs, dataList, elementsArgs, result;\n      elementsArgs = compiler.jQuery ? up.browser.jQuery(elements) : elements;\n      compileArgs = [elementsArgs];\n      if (compiler.length !== 1) {\n        dataList = u.map(elements, up.syntax.data);\n        compileArgs.push(dataList);\n      }\n      result = this.applyCompilerFunction(compiler, elements, compileArgs);\n      if (this.destructorPresence(result)) {\n        return up.fail('Compilers with { batch: true } cannot return destructors');\n      }\n    };\n\n    CompilerPass.prototype.applyCompilerFunction = function(compiler, elementOrElements, compileArgs) {\n      var error;\n      try {\n        return compiler.apply(elementOrElements, compileArgs);\n      } catch (error1) {\n        error = error1;\n        this.errors.push(error);\n        up.log.error('up.hello()', 'While compiling %o: %o', elementOrElements, error);\n        return up.error.emitGlobal(error);\n      }\n    };\n\n    CompilerPass.prototype.destructorPresence = function(result) {\n      if (u.isFunction(result) || u.isArray(result) && (u.every(result, u.isFunction))) {\n        return result;\n      }\n    };\n\n    CompilerPass.prototype.select = function(selector) {\n      var matches;\n      matches = e.subtree(this.root, u.evalOption(selector));\n      if (this.skipSubtrees) {\n        matches = u.reject(matches, this.isInSkippedSubtree);\n      }\n      return matches;\n    };\n\n    CompilerPass.prototype.isInSkippedSubtree = function(element) {\n      var parent;\n      if (u.contains(this.skipSubtrees, element)) {\n        return true;\n      } else if (parent = element.parentElement) {\n        return this.isInSkippedSubtree(parent);\n      } else {\n        return false;\n      }\n    };\n\n    return CompilerPass;\n\n  })();\n\n}).call(this);\n(function() {\n  var u,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  u = up.util;\n\n  up.Config = (function(superClass) {\n    extend(Config, superClass);\n\n    function Config(blueprintFn) {\n      this.blueprintFn = blueprintFn != null ? blueprintFn : (function() {\n        return {};\n      });\n      this.reset();\n    }\n\n    Config.prototype.reset = function() {\n      return u.assign(this, this.blueprintFn());\n    };\n\n    return Config;\n\n  })(up.Class);\n\n}).call(this);\n(function() {\n  var e, u,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  u = up.util;\n\n  e = up.element;\n\n  up.CSSTransition = (function() {\n    function CSSTransition(element, lastFrameKebab, options) {\n      this.element = element;\n      this.lastFrameKebab = lastFrameKebab;\n      this.onTransitionEnd = bind(this.onTransitionEnd, this);\n      this.onFinishEvent = bind(this.onFinishEvent, this);\n      this.lastFrameKeysKebab = Object.keys(this.lastFrameKebab);\n      if (u.some(this.lastFrameKeysKebab, function(key) {\n        return key.match(/A-Z/);\n      })) {\n        up.fail('Animation keys must be kebab-case');\n      }\n      this.finishEvent = options.finishEvent;\n      this.duration = options.duration;\n      this.easing = options.easing;\n      this.finished = false;\n    }\n\n    CSSTransition.prototype.start = function() {\n      if (this.lastFrameKeysKebab.length === 0) {\n        this.finished = true;\n        return Promise.resolve();\n      }\n      this.deferred = u.newDeferred();\n      this.pauseOldTransition();\n      this.startTime = new Date();\n      this.startFallbackTimer();\n      this.listenToFinishEvent();\n      this.listenToTransitionEnd();\n      this.startMotion();\n      return this.deferred.promise();\n    };\n\n    CSSTransition.prototype.listenToFinishEvent = function() {\n      if (this.finishEvent) {\n        return this.stopListenToFinishEvent = this.element.addEventListener(this.finishEvent, this.onFinishEvent);\n      }\n    };\n\n    CSSTransition.prototype.onFinishEvent = function(event) {\n      event.stopPropagation();\n      return this.finish();\n    };\n\n    CSSTransition.prototype.startFallbackTimer = function() {\n      var timingTolerance;\n      timingTolerance = 100;\n      return this.fallbackTimer = u.timer(this.duration + timingTolerance, (function(_this) {\n        return function() {\n          return _this.finish();\n        };\n      })(this));\n    };\n\n    CSSTransition.prototype.stopFallbackTimer = function() {\n      return clearTimeout(this.fallbackTimer);\n    };\n\n    CSSTransition.prototype.listenToTransitionEnd = function() {\n      return this.stopListenToTransitionEnd = up.on(this.element, 'transitionend', this.onTransitionEnd);\n    };\n\n    CSSTransition.prototype.onTransitionEnd = function(event) {\n      var completedPropertyKebab, elapsed;\n      if (event.target !== this.element) {\n        return;\n      }\n      elapsed = new Date() - this.startTime;\n      if (!(elapsed > 0.25 * this.duration)) {\n        return;\n      }\n      completedPropertyKebab = event.propertyName;\n      if (!u.contains(this.lastFrameKeysKebab, completedPropertyKebab)) {\n        return;\n      }\n      return this.finish();\n    };\n\n    CSSTransition.prototype.finish = function() {\n      if (this.finished) {\n        return;\n      }\n      this.finished = true;\n      this.stopFallbackTimer();\n      if (typeof this.stopListenToFinishEvent === \"function\") {\n        this.stopListenToFinishEvent();\n      }\n      if (typeof this.stopListenToTransitionEnd === \"function\") {\n        this.stopListenToTransitionEnd();\n      }\n      e.concludeCSSTransition(this.element);\n      this.resumeOldTransition();\n      return this.deferred.resolve();\n    };\n\n    CSSTransition.prototype.pauseOldTransition = function() {\n      var oldTransition, oldTransitionFrameKebab, oldTransitionProperties;\n      oldTransition = e.style(this.element, ['transitionProperty', 'transitionDuration', 'transitionDelay', 'transitionTimingFunction']);\n      if (e.hasCSSTransition(oldTransition)) {\n        if (oldTransition.transitionProperty !== 'all') {\n          oldTransitionProperties = oldTransition.transitionProperty.split(/\\s*,\\s*/);\n          oldTransitionFrameKebab = e.style(this.element, oldTransitionProperties);\n          this.setOldTransitionTargetFrame = e.setTemporaryStyle(this.element, oldTransitionFrameKebab);\n        }\n        return this.setOldTransition = e.concludeCSSTransition(this.element);\n      }\n    };\n\n    CSSTransition.prototype.resumeOldTransition = function() {\n      if (typeof this.setOldTransitionTargetFrame === \"function\") {\n        this.setOldTransitionTargetFrame();\n      }\n      return typeof this.setOldTransition === \"function\" ? this.setOldTransition() : void 0;\n    };\n\n    CSSTransition.prototype.startMotion = function() {\n      e.setStyle(this.element, {\n        transitionProperty: Object.keys(this.lastFrameKebab).join(', '),\n        transitionDuration: this.duration + \"ms\",\n        transitionTimingFunction: this.easing\n      });\n      return e.setStyle(this.element, this.lastFrameKebab);\n    };\n\n    return CSSTransition;\n\n  })();\n\n}).call(this);\n(function() {\n  var e, u;\n\n  u = up.util;\n\n  e = up.element;\n\n  up.DestructorPass = (function() {\n    function DestructorPass(fragment, options) {\n      this.fragment = fragment;\n      this.options = options;\n      this.errors = [];\n    }\n\n    DestructorPass.prototype.run = function() {\n      var cleanable, destructor, destructors, i, j, len, len1, ref;\n      ref = this.selectCleanables();\n      for (i = 0, len = ref.length; i < len; i++) {\n        cleanable = ref[i];\n        if (destructors = u.pluckKey(cleanable, 'upDestructors')) {\n          for (j = 0, len1 = destructors.length; j < len1; j++) {\n            destructor = destructors[j];\n            this.applyDestructorFunction(destructor, cleanable);\n          }\n        }\n        cleanable.classList.remove('up-can-clean');\n      }\n      if (this.errors.length) {\n        throw up.error.failed('Errors while destroying', {\n          errors: this.errors\n        });\n      }\n    };\n\n    DestructorPass.prototype.selectCleanables = function() {\n      var selectOptions;\n      selectOptions = u.merge(this.options, {\n        destroying: true\n      });\n      return up.fragment.subtree(this.fragment, '.up-can-clean', selectOptions);\n    };\n\n    DestructorPass.prototype.applyDestructorFunction = function(destructor, element) {\n      var error;\n      try {\n        return destructor();\n      } catch (error1) {\n        error = error1;\n        this.errors.push(error);\n        up.log.error('up.destroy()', 'While destroying %o: %o', element, error);\n        return up.error.emitGlobal(error);\n      }\n    };\n\n    return DestructorPass;\n\n  })();\n\n}).call(this);\n(function() {\n  var e, u,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    slice = [].slice;\n\n  u = up.util;\n\n  e = up.element;\n\n  up.EventEmitter = (function(superClass) {\n    extend(EventEmitter, superClass);\n\n    function EventEmitter() {\n      return EventEmitter.__super__.constructor.apply(this, arguments);\n    }\n\n    EventEmitter.prototype.keys = function() {\n      return ['target', 'event', 'baseLayer', 'callback', 'log', 'ensureBubbles'];\n    };\n\n    EventEmitter.prototype.emit = function() {\n      this.logEmission();\n      if (this.baseLayer) {\n        this.baseLayer.asCurrent((function(_this) {\n          return function() {\n            return _this.dispatchEvent();\n          };\n        })(this));\n      } else {\n        this.dispatchEvent();\n      }\n      return this.event;\n    };\n\n    EventEmitter.prototype.dispatchEvent = function() {\n      this.target.dispatchEvent(this.event);\n      if (this.ensureBubbles && e.isDetached(this.target)) {\n        document.dispatchEvent(this.event);\n      }\n      return typeof this.callback === \"function\" ? this.callback(this.event) : void 0;\n    };\n\n    EventEmitter.prototype.assertEmitted = function() {\n      var event;\n      event = this.emit();\n      return !event.defaultPrevented || (function() {\n        throw up.error.aborted(\"Event \" + event.type + \" was prevented\");\n      })();\n    };\n\n    EventEmitter.prototype.logEmission = function() {\n      var message, messageArgs, ref, type;\n      if (!up.log.isEnabled()) {\n        return;\n      }\n      message = this.log;\n      if (u.isArray(message)) {\n        ref = message, message = ref[0], messageArgs = 2 <= ref.length ? slice.call(ref, 1) : [];\n      } else {\n        messageArgs = [];\n      }\n      type = this.event.type;\n      if (u.isString(message)) {\n        return up.puts.apply(up, [type, message].concat(slice.call(messageArgs)));\n      } else if (message !== false) {\n        return up.puts(type, \"Event \" + type);\n      }\n    };\n\n    EventEmitter.fromEmitArgs = function(args, defaults) {\n      var layer, options, ref;\n      if (defaults == null) {\n        defaults = {};\n      }\n      options = u.extractOptions(args);\n      options = u.merge(defaults, options);\n      if (u.isElementish(args[0])) {\n        options.target = e.get(args.shift());\n      } else if (args[0] instanceof up.Layer) {\n        options.layer = args.shift();\n      }\n      if (options.layer) {\n        layer = up.layer.get(options.layer);\n        if (options.target == null) {\n          options.target = layer.element;\n        }\n        if (options.baseLayer == null) {\n          options.baseLayer = layer;\n        }\n      }\n      if (options.baseLayer) {\n        options.baseLayer = up.layer.get(options.baseLayer);\n      }\n      if (u.isString(options.target)) {\n        options.target = up.fragment.get(options.target, {\n          layer: options.layer\n        });\n      } else if (!options.target) {\n        options.target = document;\n      }\n      if ((ref = args[0]) != null ? ref.preventDefault : void 0) {\n        options.event = args[0];\n        if (options.log == null) {\n          options.log = args[0].log;\n        }\n      } else if (u.isString(args[0])) {\n        options.event = up.event.build(args[0], options);\n      } else {\n        options.event = up.event.build(options);\n      }\n      return new this(options);\n    };\n\n    return EventEmitter;\n\n  })(up.Record);\n\n}).call(this);\n(function() {\n  var e, u,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  u = up.util;\n\n  e = up.element;\n\n  up.EventListener = (function(superClass) {\n    extend(EventListener, superClass);\n\n    EventListener.prototype.keys = function() {\n      return ['element', 'eventType', 'selector', 'callback', 'jQuery', 'guard', 'baseLayer', 'passive', 'once'];\n    };\n\n    function EventListener(attributes) {\n      this.nativeCallback = bind(this.nativeCallback, this);\n      EventListener.__super__.constructor.call(this, attributes);\n      this.key = this.constructor.buildKey(attributes);\n      this.isDefault = up.framework.booting;\n    }\n\n    EventListener.prototype.bind = function() {\n      var base, map, ref;\n      map = ((base = this.element).upEventListeners || (base.upEventListeners = {}));\n      if (map[this.key]) {\n        up.fail('up.on(): The %o callback %o cannot be registered more than once', this.eventType, this.callback);\n      }\n      map[this.key] = this;\n      return (ref = this.element).addEventListener.apply(ref, this.addListenerArgs());\n    };\n\n    EventListener.prototype.addListenerArgs = function() {\n      var args;\n      args = [this.eventType, this.nativeCallback];\n      if (this.passive && up.browser.canPassiveEventListener()) {\n        args.push({\n          passive: true\n        });\n      }\n      return args;\n    };\n\n    EventListener.prototype.unbind = function() {\n      var map, ref;\n      if (map = this.element.upEventListeners) {\n        delete map[this.key];\n      }\n      return (ref = this.element).removeEventListener.apply(ref, this.addListenerArgs());\n    };\n\n    EventListener.prototype.nativeCallback = function(event) {\n      var applyCallback, args, data, element, elementArg, expectedArgCount;\n      if (this.once) {\n        this.unbind();\n      }\n      element = event.target;\n      if (this.selector) {\n        element = e.closest(element, u.evalOption(this.selector));\n      }\n      if (this.guard && !this.guard(event)) {\n        return;\n      }\n      if (element) {\n        elementArg = this.jQuery ? up.browser.jQuery(element) : element;\n        args = [event, elementArg];\n        expectedArgCount = this.callback.length;\n        if (!(expectedArgCount === 1 || expectedArgCount === 2)) {\n          data = up.syntax.data(element);\n          args.push(data);\n        }\n        applyCallback = (function(_this) {\n          return function() {\n            return _this.callback.apply(element, args);\n          };\n        })(this);\n        if (this.baseLayer) {\n          return this.baseLayer.asCurrent(applyCallback);\n        } else {\n          return applyCallback();\n        }\n      }\n    };\n\n    EventListener.fromElement = function(attributes) {\n      var key, map;\n      if (map = attributes.element.upEventListeners) {\n        key = this.buildKey(attributes);\n        return map[key];\n      }\n    };\n\n    EventListener.buildKey = function(attributes) {\n      var base;\n      (base = attributes.callback).upUid || (base.upUid = u.uid());\n      return [attributes.eventType, attributes.selector, attributes.callback.upUid].join('|');\n    };\n\n    EventListener.unbindNonDefault = function(element) {\n      var i, len, listener, listeners, map, results;\n      if (map = element.upEventListeners) {\n        listeners = u.values(map);\n        results = [];\n        for (i = 0, len = listeners.length; i < len; i++) {\n          listener = listeners[i];\n          if (!listener.isDefault) {\n            results.push(listener.unbind());\n          } else {\n            results.push(void 0);\n          }\n        }\n        return results;\n      }\n    };\n\n    return EventListener;\n\n  })(up.Record);\n\n}).call(this);\n(function() {\n  var u,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  u = up.util;\n\n  up.EventListenerGroup = (function(superClass) {\n    extend(EventListenerGroup, superClass);\n\n    function EventListenerGroup() {\n      return EventListenerGroup.__super__.constructor.apply(this, arguments);\n    }\n\n    EventListenerGroup.prototype.keys = function() {\n      return ['elements', 'eventTypes', 'selector', 'callback', 'jQuery', 'guard', 'baseLayer', 'passive', 'once'];\n    };\n\n    EventListenerGroup.prototype.bind = function() {\n      var unbindFns;\n      unbindFns = [];\n      this.eachListenerAttributes(function(attrs) {\n        var listener;\n        listener = new up.EventListener(attrs);\n        listener.bind();\n        return unbindFns.push(function() {\n          return listener.unbind();\n        });\n      });\n      return u.sequence(unbindFns);\n    };\n\n    EventListenerGroup.prototype.eachListenerAttributes = function(fn) {\n      var element, eventType, i, len, ref, results;\n      ref = this.elements;\n      results = [];\n      for (i = 0, len = ref.length; i < len; i++) {\n        element = ref[i];\n        results.push((function() {\n          var j, len1, ref1, results1;\n          ref1 = this.eventTypes;\n          results1 = [];\n          for (j = 0, len1 = ref1.length; j < len1; j++) {\n            eventType = ref1[j];\n            results1.push(fn(this.listenerAttributes(element, eventType)));\n          }\n          return results1;\n        }).call(this));\n      }\n      return results;\n    };\n\n    EventListenerGroup.prototype.listenerAttributes = function(element, eventType) {\n      return u.merge(this.attributes(), {\n        element: element,\n        eventType: eventType\n      });\n    };\n\n    EventListenerGroup.prototype.unbind = function() {\n      return this.eachListenerAttributes(function(attrs) {\n        var listener;\n        if (listener = up.EventListener.fromElement(attrs)) {\n          return listener.unbind();\n        }\n      });\n    };\n\n\n    /*\n    Constructs a new up.EventListenerGroup from arguments with many different combinations:\n    \n        [[elements], eventTypes, [selector], [options], callback]\n    \n    @function up.EventListenerGroup.fromBindArgs\n    @internal\n     */\n\n    EventListenerGroup.fromBindArgs = function(args, defaults) {\n      var attributes, callback, elements, eventTypes, fixTypes, options, selector;\n      args = u.copy(args);\n      callback = args.pop();\n      if (args[0].addEventListener) {\n        elements = [args.shift()];\n      } else if (u.isJQuery(args[0]) || (u.isList(args[0]) && args[0][0].addEventListener)) {\n        elements = args.shift();\n      } else {\n        elements = [document];\n      }\n      eventTypes = u.splitValues(args.shift());\n      if (fixTypes = up.migrate.fixEventTypes) {\n        eventTypes = fixTypes(eventTypes);\n      }\n      options = u.extractOptions(args);\n      selector = args[0];\n      attributes = u.merge({\n        elements: elements,\n        eventTypes: eventTypes,\n        selector: selector,\n        callback: callback\n      }, options, defaults);\n      return new this(attributes);\n    };\n\n    return EventListenerGroup;\n\n  })(up.Record);\n\n}).call(this);\n(function() {\n  var e, u,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  u = up.util;\n\n  e = up.element;\n\n  up.FieldObserver = (function() {\n    function FieldObserver(fieldOrFields, options, callback) {\n      this.callback = callback;\n      this.isNewValues = bind(this.isNewValues, this);\n      this.scheduleValues = bind(this.scheduleValues, this);\n      this.fields = e.list(fieldOrFields);\n      this.delay = options.delay;\n      this.batch = options.batch;\n    }\n\n    FieldObserver.prototype.start = function() {\n      this.scheduledValues = null;\n      this.processedValues = this.readFieldValues();\n      this.currentTimer = void 0;\n      this.callbackRunning = false;\n      return this.unbind = up.on(this.fields, 'input change', (function(_this) {\n        return function() {\n          return _this.check();\n        };\n      })(this));\n    };\n\n    FieldObserver.prototype.stop = function() {\n      this.unbind();\n      return this.cancelTimer();\n    };\n\n    FieldObserver.prototype.cancelTimer = function() {\n      clearTimeout(this.currentTimer);\n      return this.currentTimer = void 0;\n    };\n\n    FieldObserver.prototype.scheduleTimer = function() {\n      this.cancelTimer();\n      return this.currentTimer = u.timer(this.delay, (function(_this) {\n        return function() {\n          _this.currentTimer = void 0;\n          return _this.requestCallback();\n        };\n      })(this));\n    };\n\n    FieldObserver.prototype.scheduleValues = function(values) {\n      this.scheduledValues = values;\n      return this.scheduleTimer();\n    };\n\n    FieldObserver.prototype.isNewValues = function(values) {\n      return !u.isEqual(values, this.processedValues) && !u.isEqual(this.scheduledValues, values);\n    };\n\n    FieldObserver.prototype.requestCallback = function() {\n      var callbackReturnValues, callbacksDone, diff, name, value;\n      if (this.scheduledValues !== null && !this.currentTimer && !this.callbackRunning) {\n        diff = this.changedValues(this.processedValues, this.scheduledValues);\n        this.processedValues = this.scheduledValues;\n        this.scheduledValues = null;\n        this.callbackRunning = true;\n        callbackReturnValues = [];\n        if (this.batch) {\n          callbackReturnValues.push(this.callback(diff));\n        } else {\n          for (name in diff) {\n            value = diff[name];\n            callbackReturnValues.push(this.callback(value, name));\n          }\n        }\n        callbacksDone = u.allSettled(callbackReturnValues);\n        return callbacksDone.then((function(_this) {\n          return function() {\n            _this.callbackRunning = false;\n            return _this.requestCallback();\n          };\n        })(this));\n      }\n    };\n\n    FieldObserver.prototype.changedValues = function(previous, next) {\n      var changes, i, key, keys, len, nextValue, previousValue;\n      changes = {};\n      keys = Object.keys(previous);\n      keys = keys.concat(Object.keys(next));\n      keys = u.uniq(keys);\n      for (i = 0, len = keys.length; i < len; i++) {\n        key = keys[i];\n        previousValue = previous[key];\n        nextValue = next[key];\n        if (!u.isEqual(previousValue, nextValue)) {\n          changes[key] = nextValue;\n        }\n      }\n      return changes;\n    };\n\n    FieldObserver.prototype.readFieldValues = function() {\n      return up.Params.fromFields(this.fields).toObject();\n    };\n\n    FieldObserver.prototype.check = function() {\n      var values;\n      values = this.readFieldValues();\n      if (this.isNewValues(values)) {\n        return this.scheduleValues(values);\n      }\n    };\n\n    return FieldObserver;\n\n  })();\n\n}).call(this);\n(function() {\n  var PRESERVE_KEYS, e, focusedElementWithin, transferProps, u,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  u = up.util;\n\n  e = up.element;\n\n  PRESERVE_KEYS = ['selectionStart', 'selectionEnd', 'scrollLeft', 'scrollTop'];\n\n  transferProps = function(from, to) {\n    var error, i, key, len, results;\n    results = [];\n    for (i = 0, len = PRESERVE_KEYS.length; i < len; i++) {\n      key = PRESERVE_KEYS[i];\n      try {\n        results.push(to[key] = from[key]);\n      } catch (error1) {\n        error = error1;\n      }\n    }\n    return results;\n  };\n\n  focusedElementWithin = function(scopeElement) {\n    var focusedElement;\n    focusedElement = document.activeElement;\n    if (e.isInSubtree(scopeElement, focusedElement)) {\n      return focusedElement;\n    }\n  };\n\n  up.FocusCapsule = (function(superClass) {\n    extend(FocusCapsule, superClass);\n\n    function FocusCapsule() {\n      return FocusCapsule.__super__.constructor.apply(this, arguments);\n    }\n\n    FocusCapsule.prototype.keys = function() {\n      return ['selector', 'oldElement'].concat(PRESERVE_KEYS);\n    };\n\n    FocusCapsule.prototype.restore = function(scope, options) {\n      var rediscoveredElement;\n      if (!this.wasLost()) {\n        return;\n      }\n      if (rediscoveredElement = e.get(scope, this.selector)) {\n        transferProps(this, rediscoveredElement);\n        up.focus(rediscoveredElement, options);\n        return true;\n      }\n    };\n\n    FocusCapsule.preserveWithin = function(oldElement) {\n      var focusedElement, plan;\n      if (focusedElement = focusedElementWithin(oldElement)) {\n        plan = {\n          oldElement: oldElement,\n          selector: up.fragment.toTarget(focusedElement)\n        };\n        transferProps(focusedElement, plan);\n        return new this(plan);\n      }\n    };\n\n    FocusCapsule.prototype.wasLost = function() {\n      return !focusedElementWithin(this.oldElement);\n    };\n\n    return FocusCapsule;\n\n  })(up.Record);\n\n}).call(this);\n(function() {\n  var DESCENDANT_SELECTOR;\n\n  DESCENDANT_SELECTOR = /^([^ >+(]+) (.+)$/;\n\n  up.FragmentFinder = (function() {\n    function FragmentFinder(options) {\n      this.options = options;\n      this.origin = this.options.origin;\n      this.selector = this.options.selector;\n      this.layer = this.options.layer;\n    }\n\n    FragmentFinder.prototype.find = function() {\n      return this.findAroundOrigin() || this.findInLayer();\n    };\n\n    FragmentFinder.prototype.findAroundOrigin = function() {\n      if (this.origin && up.fragment.config.matchAroundOrigin && !up.element.isDetached(this.origin)) {\n        return this.findClosest() || this.findInVicinity();\n      }\n    };\n\n    FragmentFinder.prototype.findClosest = function() {\n      return up.fragment.closest(this.origin, this.selector, this.options);\n    };\n\n    FragmentFinder.prototype.findInVicinity = function() {\n      var parent, parts;\n      if ((parts = this.selector.match(DESCENDANT_SELECTOR))) {\n        if (parent = up.fragment.closest(this.origin, parts[1], this.options)) {\n          return up.fragment.getDumb(parent, parts[2]);\n        }\n      }\n    };\n\n    FragmentFinder.prototype.findInLayer = function() {\n      return up.fragment.getDumb(this.selector, this.options);\n    };\n\n    return FragmentFinder;\n\n  })();\n\n}).call(this);\n(function() {\n  var u,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  u = up.util;\n\n  up.FragmentProcessor = (function(superClass) {\n    extend(FragmentProcessor, superClass);\n\n    function FragmentProcessor() {\n      return FragmentProcessor.__super__.constructor.apply(this, arguments);\n    }\n\n    FragmentProcessor.prototype.keys = function() {\n      return ['fragment', 'autoMeans', 'origin', 'layer'];\n    };\n\n    FragmentProcessor.prototype.process = function(opt) {\n      return this.tryProcess(opt);\n    };\n\n    FragmentProcessor.prototype.tryProcess = function(opt) {\n      var match;\n      if (u.isArray(opt)) {\n        return u.find(opt, (function(_this) {\n          return function(opt) {\n            return _this.tryProcess(opt);\n          };\n        })(this));\n      }\n      if (u.isFunction(opt)) {\n        return this.tryProcess(opt(this.fragment, this.attributes()));\n      }\n      if (u.isElement(opt)) {\n        return this.processElement();\n      }\n      if (u.isString(opt)) {\n        if (opt === 'auto') {\n          return this.tryProcess(this.autoMeans);\n        }\n        if (match = opt.match(/^(.+?)-if-(.+?)$/)) {\n          return this.resolveCondition(match[2]) && this.process(match[1]);\n        }\n      }\n      return this.processPrimitive(opt);\n    };\n\n    FragmentProcessor.prototype.resolveCondition = function(condition) {\n      if (condition === 'main') {\n        return up.fragment.contains(this.fragment, ':main');\n      }\n    };\n\n    FragmentProcessor.prototype.findSelector = function(selector) {\n      var lookupOpts, match;\n      lookupOpts = {\n        layer: this.layer,\n        origin: this.origin\n      };\n      if ((match = up.fragment.get(this.fragment, selector, lookupOpts) || up.fragment.get(selector, lookupOpts))) {\n        return match;\n      } else {\n        up.warn('up.render()', 'Could not find an element matching \"%s\"', selector);\n      }\n    };\n\n    return FragmentProcessor;\n\n  })(up.Record);\n\n}).call(this);\n(function() {\n  var PREVENT_SCROLL_OPTIONS, e, u,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  u = up.util;\n\n  e = up.element;\n\n  PREVENT_SCROLL_OPTIONS = {\n    preventScroll: true\n  };\n\n  up.FragmentFocus = (function(superClass) {\n    extend(FragmentFocus, superClass);\n\n    function FragmentFocus() {\n      return FragmentFocus.__super__.constructor.apply(this, arguments);\n    }\n\n    FragmentFocus.prototype.keys = function() {\n      return FragmentFocus.__super__.keys.call(this).concat(['hash', 'focusCapsule']);\n    };\n\n    FragmentFocus.prototype.processPrimitive = function(opt) {\n      switch (opt) {\n        case 'keep':\n          return this.restoreFocus();\n        case 'target':\n        case true:\n          return this.focusElement(this.fragment);\n        case 'layer':\n          return this.focusElement(this.layer.getFocusElement());\n        case 'main':\n          return this.focusSelector(':main');\n        case 'hash':\n          return this.focusHash();\n        case 'autofocus':\n          return this.autofocus();\n        default:\n          if (u.isString(opt)) {\n            return this.focusSelector(opt);\n          }\n      }\n    };\n\n    FragmentFocus.prototype.processElement = function(element) {\n      return this.focusElement(element);\n    };\n\n    FragmentFocus.prototype.resolveCondition = function(condition) {\n      if (condition === 'lost') {\n        return this.wasFocusLost();\n      } else {\n        return FragmentFocus.__super__.resolveCondition.call(this, condition);\n      }\n    };\n\n    FragmentFocus.prototype.focusSelector = function(selector) {\n      var match;\n      if (match = this.findSelector(selector)) {\n        return this.focusElement(match);\n      }\n    };\n\n    FragmentFocus.prototype.restoreFocus = function() {\n      var ref;\n      return (ref = this.focusCapsule) != null ? ref.restore(this.fragment, PREVENT_SCROLL_OPTIONS) : void 0;\n    };\n\n    FragmentFocus.prototype.autofocus = function() {\n      var autofocusElement;\n      if (autofocusElement = e.subtree(this.fragment, '[autofocus]')[0]) {\n        up.focus(autofocusElement, PREVENT_SCROLL_OPTIONS);\n        return true;\n      }\n    };\n\n    FragmentFocus.prototype.focusElement = function(element) {\n      up.viewport.makeFocusable(element);\n      up.focus(element, PREVENT_SCROLL_OPTIONS);\n      return true;\n    };\n\n    FragmentFocus.prototype.focusHash = function() {\n      var hashTarget;\n      if (hashTarget = up.viewport.firstHashTarget(this.hash, {\n        layer: this.layer\n      })) {\n        return this.focusElement(hashTarget);\n      }\n    };\n\n    FragmentFocus.prototype.wasFocusLost = function() {\n      var ref;\n      return (ref = this.focusCapsule) != null ? ref.wasLost() : void 0;\n    };\n\n    return FragmentFocus;\n\n  })(up.FragmentProcessor);\n\n}).call(this);\n(function() {\n  var e, u,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  u = up.util;\n\n  e = up.element;\n\n  up.FragmentScrolling = (function(superClass) {\n    extend(FragmentScrolling, superClass);\n\n    FragmentScrolling.prototype.keys = function() {\n      return FragmentScrolling.__super__.keys.apply(this, arguments).concat(['hash', 'mode', 'revealTop', 'revealMax', 'revealSnap', 'scrollBehavior', 'scrollSpeed']);\n    };\n\n    function FragmentScrolling(options) {\n      var base;\n      if (typeof (base = up.migrate).handleScrollOptions === \"function\") {\n        base.handleScrollOptions(options);\n      }\n      FragmentScrolling.__super__.constructor.call(this, options);\n    }\n\n    FragmentScrolling.prototype.process = function(opt) {\n      return FragmentScrolling.__super__.process.call(this, opt) || Promise.resolve();\n    };\n\n    FragmentScrolling.prototype.processPrimitive = function(opt) {\n      switch (opt) {\n        case 'reset':\n          return this.reset();\n        case 'layer':\n          return this.revealLayer();\n        case 'main':\n          return this.revealSelector(':main');\n        case 'restore':\n          return this.restore();\n        case 'hash':\n          return this.hash && up.viewport.revealHash(this.hash, this.attributes());\n        case 'target':\n        case 'reveal':\n        case true:\n          return this.revealElement(this.fragment);\n        default:\n          if (u.isString(opt)) {\n            return this.revealSelector(opt);\n          }\n      }\n    };\n\n    FragmentScrolling.prototype.processElement = function(element) {\n      return this.revealElement(element);\n    };\n\n    FragmentScrolling.prototype.revealElement = function(element) {\n      return up.reveal(element, this.attributes());\n    };\n\n    FragmentScrolling.prototype.revealSelector = function(selector) {\n      var match;\n      if (match = this.findSelector(selector)) {\n        return this.revealElement(match);\n      }\n    };\n\n    FragmentScrolling.prototype.revealLayer = function() {\n      return this.revealElement(this.layer.getBoxElement());\n    };\n\n    FragmentScrolling.prototype.reset = function() {\n      return up.viewport.resetScroll(u.merge(this.attributes(), {\n        around: this.fragment\n      }));\n    };\n\n    FragmentScrolling.prototype.restore = function() {\n      return up.viewport.restoreScroll(u.merge(this.attributes(), {\n        around: this.fragment\n      }));\n    };\n\n    return FragmentScrolling;\n\n  })(up.FragmentProcessor);\n\n}).call(this);\n(function() {\n  var e, u,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  u = up.util;\n\n  e = up.element;\n\n  up.HTMLWrapper = (function() {\n    function HTMLWrapper(tagName, options) {\n      var closeTag, innerHTML, openTag;\n      this.tagName = tagName;\n      if (options == null) {\n        options = {};\n      }\n      this.wrapMatch = bind(this.wrapMatch, this);\n      openTag = \"<\" + this.tagName + \"[^>]*>\";\n      closeTag = \"<\\/\" + this.tagName + \">\";\n      innerHTML = \"(.|\\\\s)*?\";\n      this.pattern = new RegExp(openTag + innerHTML + closeTag, 'ig');\n      this.attrName = \"up-wrapped-\" + this.tagName;\n    }\n\n    HTMLWrapper.prototype.strip = function(html) {\n      return html.replace(this.pattern, '');\n    };\n\n    HTMLWrapper.prototype.wrap = function(html) {\n      return html.replace(this.pattern, this.wrapMatch);\n    };\n\n    HTMLWrapper.prototype.wrapMatch = function(match) {\n      this.didWrap = true;\n      return '<meta name=\"' + this.attrName + '\" value=\"' + u.escapeHTML(match) + '\">';\n    };\n\n    HTMLWrapper.prototype.unwrap = function(element) {\n      var i, len, originalHTML, ref, restoredElement, results, wrappedChild;\n      if (!this.didWrap) {\n        return;\n      }\n      ref = element.querySelectorAll(\"meta[name='\" + this.attrName + \"']\");\n      results = [];\n      for (i = 0, len = ref.length; i < len; i++) {\n        wrappedChild = ref[i];\n        originalHTML = wrappedChild.getAttribute('value');\n        restoredElement = e.createFromHTML(originalHTML);\n        results.push(e.replace(wrappedChild, restoredElement));\n      }\n      return results;\n    };\n\n    return HTMLWrapper;\n\n  })();\n\n}).call(this);\n(function() {\n  var e, u,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    slice = [].slice;\n\n  e = up.element;\n\n  u = up.util;\n\n\n  /***\n  Each layer has an `up.Layer` instance.\n  \n  Most functions in the `up.layer` package interact with the [current layer](/up.layer.current).\n  For example, `up.layer.dismiss()` is a shortcut for `up.layer.current.dismiss()`.\n  \n  `up.layer.current` is set to the right layer in compilers and most events,\n  even if that layer is not the frontmost layer. E.g. if you're compiling a fragment for a background layer, `up.layer.current` will be\n  the background layer during compilation.\n  \n  @class up.Layer\n   */\n\n  up.Layer = (function(superClass) {\n    extend(Layer, superClass);\n\n\n    /***\n    This layer's outmost element.\n    \n    \\#\\#\\# Example\n    \n        let rootLayer = up.layer.root\n        let overlay = await up.layer.open()\n    \n        rootLayer.element // returns <body>\n        overlay.element   // returns <up-modal>\n    \n    @property up.Layer#element\n    @param {Element} element\n    @stable\n     */\n\n\n    /***\n    Whether fragment updates within this layer can affect browser history and window title.\n    \n    If a layer does not have visible history, its desendant layers cannot have history either.\n    \n    @property up.Layer#historyVisible\n    @param {boolean} historyVisible\n    @stable\n     */\n\n\n    /***\n    This layer's mode which governs its appearance and behavior.\n    \n    @see layer-terminology\n    \n    @property up.Layer#mode\n    @param {string} mode\n    @stable\n     */\n\n\n    /***\n    This layer's [context](/context).\n    \n    \\#\\#\\# Example\n    \n    You may access the context properties like a regular JavaScript object.\n    \n    ```js\n    let layer = up.layer.current\n    layer.context.message = 'Please select a contact'\n    console.log(layer.context) // logs \"{ message: 'Please select a contact' }\"\n    ```\n    \n    @property up.Layer#context\n    @param {Object} context\n      The context object.\n    \n      If no context has been set an empty object is returned.\n    @experimental\n     */\n\n    Layer.prototype.keys = function() {\n      return ['element', 'stack', 'historyVisible', 'mode', 'context', 'lastScrollTops'];\n    };\n\n    Layer.prototype.defaults = function() {\n      return {\n        context: {},\n        lastScrollTops: new up.Cache({\n          size: 30,\n          key: up.history.normalizeURL\n        })\n      };\n    };\n\n    function Layer(options) {\n      if (options == null) {\n        options = {};\n      }\n      this.containsEventTarget = bind(this.containsEventTarget, this);\n      this.contains = bind(this.contains, this);\n      Layer.__super__.constructor.call(this, options);\n      if (!this.mode) {\n        throw \"missing { mode } option\";\n      }\n    }\n\n    Layer.prototype.setupHandlers = function() {\n      return up.link.convertClicks(this);\n    };\n\n    Layer.prototype.teardownHandlers = function() {};\n\n    Layer.prototype.mainTargets = function() {\n      return up.layer.mainTargets(this.mode);\n    };\n\n\n    /***\n    Synchronizes this layer with the rest of the page.\n    \n    For instance, a popup overlay will re-calculate its position arounds its anchoring element.\n    \n    You only need to call this method after DOM changes unknown to Unpoly have brought\n    overlays out of alignment with the rest of the page.\n    \n    @function up.Layer#sync\n    @experimental\n     */\n\n    Layer.prototype.sync = function() {};\n\n\n    /***\n    [Closes this overlay](/closing-overlays) with an accepting intent,\n    e.g. when a change was confirmed or when a value was selected.\n    \n    To dismiss a layer *without* an accepting intent, use `up.Layer#dismiss()` instead.\n    \n    @function up.Layer#accept\n    @param {any} [value]\n      The acceptance value that will be passed to `{ onAccepted }` callbacks.\n    \n      If there isn't an acceptance value, omit this argument.\n      If you need to pass options without an acceptance value, pass `null`:\n    \n      ```js\n      up.layer.accept(null, { animation: 'move-to-bottom' })\n      ```\n    @param {string} [options.confirm]\n      A message the user needs to confirm before the overlay is closed.\n    @param {boolean} [options.preventable=true]\n      Whether the closing can be prevented by an event listener.\n    @param {string|Function(Element, Object)} [options.animation]\n      The [animation](/up.animate) to use for closing this layer.\n    \n      Defaults to the close animation configured for this layer mode.\n    @param {number} [options.duration]\n      The duration for the close animation in milliseconds.\n    @param {number} [options.easing]\n      The [timing function]((http://www.w3.org/TR/css3-transitions/#transition-timing-function))\n      that controls the acceleration of the close animation.\n    @param {Function} [options.onFinished]\n      A callback that will run when the elements have been removed from the DOM.\n    \n      If the layer has a close animation, the callback will run after the animation has finished.\n    @stable\n     */\n\n    Layer.prototype.accept = function() {\n      throw up.error.notImplemented();\n    };\n\n\n    /***\n    [Closes this overlay](/closing-overlays) *without* an accepting intent,\n    e.g. when a \"Cancel\" button was clicked.\n    \n    To close an overlay with an accepting intent, use `up.Layer#accept()` instead.\n    \n    @function up.Layer#dismiss\n    @param {any} [value]\n      The dismissal value that will be passed to `{ onDismissed }` callbacks.\n    \n      If there isn't an acceptance value, omit this argument.\n      If you need to pass options without a dismissal value, pass `null`:\n    \n      ```js\n      up.layer.dismiss(null, { animation: 'move-to-bottom' })\n      ```\n    @param {Object} [options]\n      See options for `up.Layer#accept()`.\n    @stable\n     */\n\n    Layer.prototype.dismiss = function() {\n      throw up.error.notImplemented();\n    };\n\n\n    /***\n    [Dismisses](/up.Layer.prototype.dismiss) all descendant overlays,\n    making this layer the [frontmost layer](/up.layer.front) in the [layer stack](/up.layer.stack).\n    \n    Descendant overlays will be dismissed with value `':peel'`.\n    \n    @function up.Layer#peel\n    @param {Object} options\n      See options for `up.Layer#accept()`.\n    @stable\n     */\n\n    Layer.prototype.peel = function(options) {\n      return this.stack.peel(this, options);\n    };\n\n    Layer.prototype.evalOption = function(option) {\n      return u.evalOption(option, this);\n    };\n\n\n    /***\n    Returns whether this layer is the [current layer](/up.layer.current).\n    \n    @function up.Layer#isCurrent\n    @return {boolean}\n    @stable\n     */\n\n    Layer.prototype.isCurrent = function() {\n      return this.stack.isCurrent(this);\n    };\n\n\n    /***\n    Returns whether this layer is the [frontmost layer](/up.layer.front).\n    \n    @function up.Layer#isFront\n    @return {boolean}\n    @stable\n     */\n\n    Layer.prototype.isFront = function() {\n      return this.stack.isFront(this);\n    };\n\n\n    /***\n    Returns whether this layer is the [root layer](/up.layer.root).\n    \n    @function up.Layer#isRoot\n    @return {boolean}\n    @stable\n     */\n\n    Layer.prototype.isRoot = function() {\n      return this.stack.isRoot(this);\n    };\n\n\n    /***\n    Returns whether this layer is *not* the [root layer](/up.layer.root).\n    \n    @function up.Layer#isOverlay\n    @return {boolean}\n    @stable\n     */\n\n    Layer.prototype.isOverlay = function() {\n      return this.stack.isOverlay(this);\n    };\n\n\n    /***\n    Returns whether this layer is still part of the [layer stack](/up.layer.stack).\n    \n    A layer is considered \"closed\" immediately after it has been [dismissed](/up.Layer.prototype.dismiss)\n    or [accepted](/up.Layer.prototype.dismiss). If the closing is animated, a layer may be considered \"closed\" while\n    closing animation is still playing.\n    \n    @function up.Layer#isOpen\n    @return {boolean}\n    @stable\n     */\n\n    Layer.prototype.isOpen = function() {\n      return this.stack.isOpen(this);\n    };\n\n\n    /***\n    Returns whether this layer is no longer part of the [layer stack](/up.layer.stack).\n    \n    A layer is considered \"closed\" immediately after it has been [dismissed](/up.Layer.prototype.dismiss)\n    or [accepted](/up.Layer.prototype.dismiss). If the closing is animated, a layer may be considered \"closed\" while\n    closing animation is still playing.\n    \n    @function up.Layer#isClosed\n    @return {boolean}\n    @stable\n     */\n\n    Layer.prototype.isClosed = function() {\n      return this.stack.isClosed(this);\n    };\n\n\n    /***\n    Returns this layer's parent layer.\n    \n    The parent layer is the layer that opened this layer. It is visually in the background of this layer.\n    \n    Returns `undefined` for the [root layer](/up.layer.root).\n    \n    @property up.Layer#parent\n    @param {up.Layer} parent\n    @stable\n     */\n\n    Layer.getter('parent', function() {\n      return this.stack.parentOf(this);\n    });\n\n\n    /***\n    Returns this layer's child layer.\n    \n    The child layer is the layer that was opened on top of this layer. It visually overlays this layer.\n    \n    Returns `undefined` if this layer has not opened a child layer.\n    \n    A layer can have at most one child layer. Opening an overlay on a layer with an existing child will\n    first dismiss the existing child before replacing it with the new child.\n    \n    @property up.Layer#child\n    @return {up.Layer} child\n    @stable\n     */\n\n    Layer.getter('child', function() {\n      return this.stack.childOf(this);\n    });\n\n\n    /***\n    Returns an array of this layer's ancestor layers.\n    \n    The array elements are ordered by distance to this layer.\n    The first element is this layer's direct parent. The last element\n    is the [root layer](/up.layer.root).\n    \n    @property up.Layer#ancestors\n    @return {Array<up.Layer>} ancestors\n    @stable\n     */\n\n    Layer.getter('ancestors', function() {\n      return this.stack.ancestorsOf(this);\n    });\n\n\n    /***\n    Returns an array of this layer's descendant layers, with the closest descendants listed first.\n    \n    Descendant layers are all layers that visually overlay this layer.\n    \n    The array elements are ordered by distance to this layer.\n    The first element is this layer's direct child. The last element\n    is the [frontmost layer](/up.layer.front).\n    \n    @property up.Layer#descendants\n    @return {Array<up.Layer>} descendants\n    @stable\n     */\n\n    Layer.getter('descendants', function() {\n      return this.stack.descendantsOf(this);\n    });\n\n\n    /***\n    Returns the zero-based position of this layer in the [layer stack](/up.layer.stack).\n    \n    The [root layer](/up.layer.root) has an index of `0`, its child overlay has an index of `1`, and so on.\n    \n    @property up.Layer#index\n    @return {number} index\n    @stable\n     */\n\n    Layer.getter('index', function() {\n      return this.stack.indexOf(this);\n    });\n\n    Layer.prototype.getContentElement = function() {\n      return this.contentElement || this.element;\n    };\n\n    Layer.prototype.getBoxElement = function() {\n      return this.boxElement || this.element;\n    };\n\n    Layer.prototype.getFocusElement = function() {\n      return this.getBoxElement();\n    };\n\n    Layer.prototype.getFirstSwappableElement = function() {\n      throw up.error.notImplemented();\n    };\n\n\n    /***\n    Returns whether the given `element` is contained by this layer.\n    \n    Note that this will always return `false` for elements in [descendant](/up.Layer.prototype.descendants) overlays,\n    even if the descendant overlay's element is nested into the DOM tree of this layer.\n    \n    @function up.Layer#contains\n    @param {Element} element\n    @return {boolean}\n    @stable\n     */\n\n    Layer.prototype.contains = function(element) {\n      return e.closest(element, up.layer.anySelector()) === this.element;\n    };\n\n\n    /***\n    Listens to a [DOM event](https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model/Events) that originated\n    on an element [contained](/up.Layer.prototype.contains) by this layer.\n    \n    This will ignore events emitted on elements in [descendant](/up.Layer.prototype.descendants) overlays,\n    even if the descendant overlay's element is nested into the DOM tree of this layer.\n    \n    The arguments for this function are the same as for `up.on()`.\n    \n    \\#\\#\\# Example\n    \n        let rootLayer = up.layer.root\n        let overlay = await up.layer.open()\n    \n        rootLayer.on('foo', (event) => console.log('Listener called'))\n    \n        rootLayer.emit('foo') // logs \"Listener called\"\n        overlay.emit('foo')   // listener is not called\n    \n    \\#\\#\\# Most Unpoly events have a layer reference\n    \n    Whenever possible Unpoly will emit its events on associated layers instead of `document`.\n    This way you can listen to events on one layer without receiving events from other layers.\n    \n    E.g. to listen to all [requests](/up.request) originating from a given layer:\n    \n        let rootLayer = up.layer.root\n        let rootLink = rootLayer.affix('a[href=/foo]')\n    \n        let overlay = await up.layer.open()\n        let overlayLink = overlay.affix('a[href=/bar]')\n    \n        rootLayer.on('up:request:load', (event) => console.log('Listener called'))\n    \n        up.follow(rootLink)    // logs \"Listener called\"\n        up.follow(overlayLink) // listener is not called\n    \n    @function up.Layer#on\n    \n    @param {string} types\n      A space-separated list of event types to bind to.\n    \n    @param {string|Function(): string} [selector]\n      The selector of an element on which the event must be triggered.\n    \n      Omit the selector to listen to all events of the given type, regardless\n      of the event target.\n    \n      If the selector is not known in advance you may also pass a function\n      that returns the selector. The function is evaluated every time\n      an event with the given type is observed.\n    \n    @param {boolean} [options.passive=false]\n      Whether to register a [passive event listener](https://developers.google.com/web/updates/2016/06/passive-event-listeners).\n    \n      A passive event listener may not call `event.preventDefault()`.\n      This in particular may improve the frame rate when registering\n      `touchstart` and `touchmove` events.\n    \n    @param {boolean} [options.once=true]\n      Whether the listener should run at most once.\n    \n      If `true` the listener will automatically be unbound\n      after the first invocation.\n    \n    @param {Function(event, [element], [data])} listener\n      The listener function that should be called.\n    \n      The function takes the affected element as the second argument.\n      If the element has an [`up-data`](/up-data) attribute, its value is parsed as JSON\n      and passed as a third argument.\n    \n    @return {Function()}\n      A function that unbinds the event listeners when called.\n    \n    @stable\n     */\n\n    Layer.prototype.on = function() {\n      var args;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      return this.buildEventListenerGroup(args).bind();\n    };\n\n\n    /***\n    Unbinds an event listener previously bound with `up.Layer#on()`.\n    \n    @function up.Layer#off\n    @param {string} events\n    @param {string|Function(): string} [selector]\n    @param {Function(event, [element], [data])} listener\n      The listener function to unbind.\n    \n      Note that you must pass a reference to the same function reference\n      that was passed to `up.Layer#on()` earlier.\n    @stable\n     */\n\n    Layer.prototype.off = function() {\n      var args;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      return this.buildEventListenerGroup(args).unbind();\n    };\n\n    Layer.prototype.buildEventListenerGroup = function(args) {\n      return up.EventListenerGroup.fromBindArgs(args, {\n        guard: this.containsEventTarget,\n        elements: [this.element],\n        baseLayer: this\n      });\n    };\n\n    Layer.prototype.containsEventTarget = function(event) {\n      return this.contains(event.target);\n    };\n\n    Layer.prototype.wasHitByMouseEvent = function(event) {\n      var hittableElement;\n      hittableElement = document.elementFromPoint(event.clientX, event.clientY);\n      return !hittableElement || this.contains(hittableElement);\n    };\n\n    Layer.prototype.buildEventEmitter = function(args) {\n      return up.EventEmitter.fromEmitArgs(args, {\n        layer: this\n      });\n    };\n\n\n    /***\n    [Emits](/up.emit) an event on [this layer's element](/up.Layer.prototype.element).\n    \n    The value of [up.layer.current](/up.layer.current) will be set to the this layer\n    while event listeners are running.\n    \n    \\#\\#\\# Example\n    \n        let rootLayer = up.layer.root\n        let overlay = await up.layer.open()\n    \n        rootLayer.on('foo', (event) => console.log('Listener called'))\n    \n        rootLayer.emit('foo') // logs \"Listener called\"\n        overlay.emit('foo')   // listener is not called\n    \n    @function up.Layer#emit\n    @param {Element|jQuery} [target=this.element]\n      The element on which the event is triggered.\n    \n      If omitted, the event will be emitted on the [this layer's element](/up.Layer.prototype.element).\n    @param {string} eventType\n      The event type, e.g. `my:event`.\n    @param {Object} [props={}]\n      A list of properties to become part of the event object that will be passed to listeners.\n    @param {string|Array} [props.log]\n      A message to print to the [log](/up.log) when the event is emitted.\n    \n      Pass `false` to not log this event emission.\n    @param {Element|jQuery} [props.target=this.element]\n      The element on which the event is triggered.\n    \n      Alternatively the target element may be passed as the first argument.\n    @stable\n     */\n\n    Layer.prototype.emit = function() {\n      var args;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      return this.buildEventEmitter(args).emit();\n    };\n\n    Layer.prototype.isDetached = function() {\n      return e.isDetached(this.element);\n    };\n\n    Layer.prototype.saveHistory = function() {\n      if (!this.isHistoryVisible()) {\n        return;\n      }\n      this.savedTitle = document.title;\n      return this.savedLocation = up.history.location;\n    };\n\n    Layer.prototype.restoreHistory = function() {\n      if (this.savedLocation) {\n        up.history.push(this.savedLocation);\n        this.savedLocation = null;\n      }\n      if (this.savedTitle) {\n        document.title = this.savedTitle;\n        return this.savedTitle = null;\n      }\n    };\n\n\n    /***\n    Temporarily changes the [current layer](/up.layer.current) while the given\n    function is running.\n    \n    Calls the given function and restores the original current layer when the function\n    terminates.\n    \n    @param {Function()} fn\n      The synchronous function to call.\n    \n      Async functions are not supported.\n    @function up.Layer#asCurrent\n    @experimental\n     */\n\n    Layer.prototype.asCurrent = function(fn) {\n      return this.stack.asCurrent(this, fn);\n    };\n\n    Layer.prototype.updateHistory = function(options) {\n      if (!options.history) {\n        return;\n      }\n      if (u.isString(options.title)) {\n        this.title = options.title;\n      }\n      if (u.isString(options.location)) {\n        return this.location = options.location;\n      }\n    };\n\n\n    /***\n    This layer's window title.\n    \n    If the [frontmost layer](/up.layer.front) does not have [visible history](/up.Layer.prototype.historyVisible),\n    the browser window will show the title of an ancestor layer.\n    This property will return the title the layer would use if it had visible history.\n    \n    If this layer does not [affect browser history](/up.Layer.prototype.historyVisible), this property will\n    still return the title the layer would otherwise use.\n    \n    When this layer opens a child layer with visible history, the browser window will change to the child\n    layer's title. When the child layer is closed, this layer's title will be restored.\n    \n    @property up.Layer#title\n    @param {string} title\n    @experimental\n     */\n\n    Layer.accessor('title', {\n      get: function() {\n        if (this.showsLiveHistory()) {\n          return document.title;\n        } else {\n          return this.savedTitle;\n        }\n      },\n      set: function(title) {\n        this.savedTitle = title;\n        if (this.showsLiveHistory()) {\n          return document.title = title;\n        }\n      }\n    });\n\n\n    /***\n    This layer's location URL.\n    \n    If the layer has [no visible history](/up.Layer.prototype.historyVisible), this property\n    still returns the URL of the content in the overlay. In this case\n    the browser's address bar will show the location of an ancestor layer.\n    \n    When this layer opens a child layer with visible history, the browser URL will change to the child\n    layer's location. When the child layer is closed, this layer's location will be restored.\n    \n    @property up.Layer#location\n    @param {string} location\n    @experimental\n     */\n\n    Layer.accessor('location', {\n      get: function() {\n        if (this.showsLiveHistory()) {\n          return up.history.location;\n        } else {\n          return this.savedLocation;\n        }\n      },\n      set: function(location) {\n        var previousLocation;\n        previousLocation = this.savedLocation;\n        location = up.history.normalizeURL(location);\n        if (previousLocation !== location) {\n          this.savedLocation = location;\n          this.emit('up:layer:location:changed', {\n            location: location,\n            log: false\n          });\n          if (this.showsLiveHistory()) {\n            return up.history.push(location);\n          }\n        }\n      }\n    });\n\n    Layer.prototype.isHistoryVisible = function() {\n      return this.historyVisible && (this.isRoot() || this.parent.isHistoryVisible());\n    };\n\n    Layer.prototype.showsLiveHistory = function() {\n      return this.isHistoryVisible() && this.isFront() && (up.history.config.enabled || this.isRoot());\n    };\n\n    Layer.prototype.selector = function(part) {\n      return this.constructor.selector(part);\n    };\n\n    Layer.selector = function(part) {\n      throw up.error.notImplemented();\n    };\n\n    Layer.prototype.toString = function() {\n      throw up.error.notImplemented();\n    };\n\n    Layer.prototype.affix = function() {\n      var args;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      return e.affix.apply(e, [this.getFirstSwappableElement()].concat(slice.call(args)));\n    };\n\n    return Layer;\n\n  })(up.Record);\n\n}).call(this);\n(function() {\n  var e, u,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  e = up.element;\n\n  u = up.util;\n\n\n  /***\n  @class up.Layer\n   */\n\n  up.Layer.Overlay = (function(superClass) {\n    extend(Overlay, superClass);\n\n\n    /***\n    The link or form element that opened this overlay.\n    \n    @property up.Layer#origin\n    @param {Element} origin\n    @stable\n     */\n\n    Overlay.prototype.keys = function() {\n      return Overlay.__super__.keys.call(this).concat(['position', 'align', 'size', 'origin', 'class', 'backdrop', 'openAnimation', 'closeAnimation', 'openDuration', 'closeDuration', 'openEasing', 'closeEasing', 'backdropOpenAnimation', 'backdropCloseAnimation', 'dismissable', 'dismissLabel', 'dismissAriaLabel', 'onOpened', 'onAccept', 'onAccepted', 'onDismiss', 'onDismissed', 'acceptEvent', 'dismissEvent', 'acceptLocation', 'dismissLocation', 'opening']);\n    };\n\n    function Overlay(options) {\n      Overlay.__super__.constructor.call(this, options);\n      if (this.dismissable === true) {\n        this.dismissable = ['button', 'key', 'outside'];\n      } else if (this.dismissable === false) {\n        this.dismissable = [];\n      } else {\n        this.dismissable = u.splitValues(this.dismissable);\n      }\n      if (this.acceptLocation) {\n        this.acceptLocation = new up.URLPattern(this.acceptLocation);\n      }\n      if (this.dismissLocation) {\n        this.dismissLocation = new up.URLPattern(this.dismissLocation);\n      }\n    }\n\n    Overlay.prototype.callback = function(name) {\n      var fn;\n      if (fn = this[name]) {\n        return fn.bind(this);\n      }\n    };\n\n    Overlay.prototype.createElement = function(parentElement) {\n      var elementAttrs;\n      this.nesting || (this.nesting = this.suggestVisualNesting());\n      elementAttrs = u.compactObject({\n        align: this.align,\n        position: this.position,\n        size: this.size,\n        \"class\": this[\"class\"],\n        nesting: this.nesting\n      });\n      return this.element = this.affixPart(parentElement, null, elementAttrs);\n    };\n\n    Overlay.prototype.createBackdropElement = function(parentElement) {\n      return this.backdropElement = this.affixPart(parentElement, 'backdrop');\n    };\n\n    Overlay.prototype.createViewportElement = function(parentElement) {\n      return this.viewportElement = this.affixPart(parentElement, 'viewport', {\n        'up-viewport': ''\n      });\n    };\n\n    Overlay.prototype.createBoxElement = function(parentElement) {\n      return this.boxElement = this.affixPart(parentElement, 'box');\n    };\n\n    Overlay.prototype.createContentElement = function(parentElement, content) {\n      this.contentElement = this.affixPart(parentElement, 'content');\n      return this.contentElement.appendChild(content);\n    };\n\n    Overlay.prototype.createDismissElement = function(parentElement) {\n      this.dismissElement = this.affixPart(parentElement, 'dismiss', {\n        'up-dismiss': '\":button\"',\n        'aria-label': this.dismissAriaLabel\n      });\n      return e.affix(this.dismissElement, 'span[aria-hidden=\"true\"]', {\n        text: this.dismissLabel\n      });\n    };\n\n    Overlay.prototype.affixPart = function(parentElement, part, options) {\n      if (options == null) {\n        options = {};\n      }\n      return e.affix(parentElement, this.selector(part), options);\n    };\n\n    Overlay.selector = function(part) {\n      return u.compact(['up', this.mode, part]).join('-');\n    };\n\n    Overlay.prototype.suggestVisualNesting = function() {\n      var parent;\n      parent = this.parent;\n      if (this.mode === parent.mode) {\n        return 1 + parent.suggestVisualNesting();\n      } else {\n        return 0;\n      }\n    };\n\n    Overlay.prototype.setupHandlers = function() {\n      var base;\n      Overlay.__super__.setupHandlers.call(this);\n      this.overlayFocus = new up.OverlayFocus(this);\n      if (this.supportsDismissMethod('button')) {\n        this.createDismissElement(this.getBoxElement());\n      }\n      if (this.supportsDismissMethod('outside')) {\n        this.unbindParentClicked = this.parent.on('up:click', (function(_this) {\n          return function(event, element) {\n            var originClicked;\n            originClicked = _this.origin && _this.origin.contains(element);\n            return _this.onOutsideClicked(event, originClicked);\n          };\n        })(this));\n        if (this.viewportElement) {\n          up.on(this.viewportElement, 'up:click', (function(_this) {\n            return function(event) {\n              if (event.target === _this.viewportElement) {\n                return _this.onOutsideClicked(event, true);\n              }\n            };\n          })(this));\n        }\n      }\n      if (this.supportsDismissMethod('key')) {\n        this.unbindEscapePressed = up.event.onEscape((function(_this) {\n          return function(event) {\n            return _this.onEscapePressed(event);\n          };\n        })(this));\n      }\n      this.registerClickCloser('up-accept', (function(_this) {\n        return function(value, closeOptions) {\n          return _this.accept(value, closeOptions);\n        };\n      })(this));\n      this.registerClickCloser('up-dismiss', (function(_this) {\n        return function(value, closeOptions) {\n          return _this.dismiss(value, closeOptions);\n        };\n      })(this));\n      if (typeof (base = up.migrate).registerLayerCloser === \"function\") {\n        base.registerLayerCloser(this);\n      }\n      this.registerEventCloser(this.acceptEvent, this.accept);\n      return this.registerEventCloser(this.dismissEvent, this.dismiss);\n    };\n\n    Overlay.prototype.onOutsideClicked = function(event, halt) {\n      if (halt) {\n        up.event.halt(event);\n      }\n      return this.dismiss(':outside');\n    };\n\n    Overlay.prototype.onEscapePressed = function(event) {\n      var field;\n      if (this.isFront()) {\n        if (field = up.form.focusedField()) {\n          return field.blur();\n        } else if (this.supportsDismissMethod('key')) {\n          up.event.halt(event);\n          return this.dismiss(':key');\n        }\n      }\n    };\n\n    Overlay.prototype.registerClickCloser = function(attribute, closeFn) {\n      return this.on('up:click', \"[\" + attribute + \"]\", function(event) {\n        var closeOptions, origin, parser, value;\n        up.event.halt(event);\n        origin = event.target;\n        value = e.jsonAttr(origin, attribute);\n        closeOptions = {\n          origin: origin\n        };\n        parser = new up.OptionsParser(closeOptions, origin);\n        parser.booleanOrString('animation');\n        parser.string('easing');\n        parser.number('duration');\n        parser.string('confirm');\n        return closeFn(value, closeOptions);\n      });\n    };\n\n    Overlay.prototype.registerEventCloser = function(eventTypes, closeFn) {\n      if (!eventTypes) {\n        return;\n      }\n      return this.on(eventTypes, (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          return closeFn.call(_this, event);\n        };\n      })(this));\n    };\n\n    Overlay.prototype.tryAcceptForLocation = function() {\n      return this.tryCloseForLocation(this.acceptLocation, this.accept);\n    };\n\n    Overlay.prototype.tryDismissForLocation = function() {\n      return this.tryCloseForLocation(this.dismissLocation, this.dismiss);\n    };\n\n    Overlay.prototype.tryCloseForLocation = function(urlPattern, closeFn) {\n      var closeValue, location, resolution;\n      if (urlPattern && (location = this.location) && (resolution = urlPattern.recognize(location))) {\n        closeValue = u.merge(resolution, {\n          location: location\n        });\n        return closeFn.call(this, closeValue);\n      }\n    };\n\n    Overlay.prototype.teardownHandlers = function() {\n      Overlay.__super__.teardownHandlers.call(this);\n      if (typeof this.unbindParentClicked === \"function\") {\n        this.unbindParentClicked();\n      }\n      if (typeof this.unbindEscapePressed === \"function\") {\n        this.unbindEscapePressed();\n      }\n      return this.overlayFocus.teardown();\n    };\n\n\n    /***\n    Destroys the elements that make up this overlay.\n    \n    @function up.Layer.prototype.destroyElements\n    @param {string|Function(Element, Object)} [options.animation=this.closeAnimation]\n    @param {number} [options.duration=this.closeDuration]\n    @param {string} [options.easing=this.closeEasing]\n    @param {Function} [options.onFinished]\n      A callback that will run when the elements have been removed from the DOM.\n      If the destruction is animated, the callback will run after the animation has finished.\n    @return {Promise}\n      A resolved promise.\n    @internal\n     */\n\n    Overlay.prototype.destroyElements = function(options) {\n      var animation, destroyOptions, onFinished;\n      animation = (function(_this) {\n        return function() {\n          return _this.startCloseAnimation(options);\n        };\n      })(this);\n      onFinished = (function(_this) {\n        return function() {\n          _this.onElementsRemoved();\n          return typeof options.onFinished === \"function\" ? options.onFinished() : void 0;\n        };\n      })(this);\n      destroyOptions = u.merge(options, {\n        animation: animation,\n        onFinished: onFinished,\n        log: false\n      });\n      return up.destroy(this.element, destroyOptions);\n    };\n\n    Overlay.prototype.onElementsRemoved = function() {};\n\n    Overlay.prototype.startAnimation = function(options) {\n      var backdropDone, boxDone;\n      if (options == null) {\n        options = {};\n      }\n      boxDone = up.animate(this.getBoxElement(), options.boxAnimation, options);\n      if (this.backdrop && !up.motion.isNone(options.boxAnimation)) {\n        backdropDone = up.animate(this.backdropElement, options.backdropAnimation, options);\n      }\n      return Promise.all([boxDone, backdropDone]);\n    };\n\n    Overlay.prototype.startOpenAnimation = function(options) {\n      var ref;\n      if (options == null) {\n        options = {};\n      }\n      return this.startAnimation({\n        boxAnimation: (ref = options.animation) != null ? ref : this.evalOption(this.openAnimation),\n        backdropAnimation: 'fade-in',\n        easing: options.easing || this.openEasing,\n        duration: options.duration || this.openDuration\n      }).then((function(_this) {\n        return function() {\n          return _this.wasEverVisible = true;\n        };\n      })(this));\n    };\n\n    Overlay.prototype.startCloseAnimation = function(options) {\n      var boxAnimation, ref;\n      if (options == null) {\n        options = {};\n      }\n      boxAnimation = this.wasEverVisible && ((ref = options.animation) != null ? ref : this.evalOption(this.closeAnimation));\n      return this.startAnimation({\n        boxAnimation: boxAnimation,\n        backdropAnimation: 'fade-out',\n        easing: options.easing || this.closeEasing,\n        duration: options.duration || this.closeDuration\n      });\n    };\n\n    Overlay.prototype.accept = function(value, options) {\n      if (value == null) {\n        value = null;\n      }\n      if (options == null) {\n        options = {};\n      }\n      return this.executeCloseChange('accept', value, options);\n    };\n\n    Overlay.prototype.dismiss = function(value, options) {\n      if (value == null) {\n        value = null;\n      }\n      if (options == null) {\n        options = {};\n      }\n      return this.executeCloseChange('dismiss', value, options);\n    };\n\n    Overlay.prototype.supportsDismissMethod = function(method) {\n      return u.contains(this.dismissable, method);\n    };\n\n    Overlay.prototype.executeCloseChange = function(verb, value, options) {\n      options = u.merge(options, {\n        verb: verb,\n        value: value,\n        layer: this\n      });\n      return new up.Change.CloseLayer(options).execute();\n    };\n\n    Overlay.prototype.getFirstSwappableElement = function() {\n      return this.getContentElement().children[0];\n    };\n\n    Overlay.prototype.toString = function() {\n      return this.mode + \" overlay\";\n    };\n\n    return Overlay;\n\n  })(up.Layer);\n\n}).call(this);\n(function() {\n  var e,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  e = up.element;\n\n  up.Layer.OverlayWithViewport = (function(superClass) {\n    extend(OverlayWithViewport, superClass);\n\n    function OverlayWithViewport() {\n      return OverlayWithViewport.__super__.constructor.apply(this, arguments);\n    }\n\n    OverlayWithViewport.bodyShifter = new up.BodyShifter();\n\n    OverlayWithViewport.getParentElement = function() {\n      return document.body;\n    };\n\n\n    /***\n    @function up.Layer.OverlayWithViewport#openNow\n    @param {Element} options.content\n    @internal\n     */\n\n    OverlayWithViewport.prototype.createElements = function(content) {\n      this.shiftBody();\n      this.createElement(this.constructor.getParentElement());\n      if (this.backdrop) {\n        this.createBackdropElement(this.element);\n      }\n      this.createViewportElement(this.element);\n      this.createBoxElement(this.viewportElement);\n      return this.createContentElement(this.boxElement, content);\n    };\n\n    OverlayWithViewport.prototype.onElementsRemoved = function() {\n      return this.unshiftBody();\n    };\n\n    OverlayWithViewport.prototype.shiftBody = function() {\n      return this.constructor.bodyShifter.shift();\n    };\n\n    OverlayWithViewport.prototype.unshiftBody = function() {\n      return this.constructor.bodyShifter.unshift();\n    };\n\n    OverlayWithViewport.prototype.sync = function() {\n      if (this.isDetached() && this.isOpen()) {\n        return this.constructor.getParentElement().appendChild(this.element);\n      }\n    };\n\n    return OverlayWithViewport;\n\n  })(up.Layer.Overlay);\n\n}).call(this);\n(function() {\n  var extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  up.Layer.Cover = (function(superClass) {\n    extend(Cover, superClass);\n\n    function Cover() {\n      return Cover.__super__.constructor.apply(this, arguments);\n    }\n\n    Cover.mode = 'cover';\n\n    return Cover;\n\n  })(up.Layer.OverlayWithViewport);\n\n}).call(this);\n(function() {\n  var extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  up.Layer.Drawer = (function(superClass) {\n    extend(Drawer, superClass);\n\n    function Drawer() {\n      return Drawer.__super__.constructor.apply(this, arguments);\n    }\n\n    Drawer.mode = 'drawer';\n\n    return Drawer;\n\n  })(up.Layer.OverlayWithViewport);\n\n}).call(this);\n(function() {\n  var extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  up.Layer.Modal = (function(superClass) {\n    extend(Modal, superClass);\n\n    function Modal() {\n      return Modal.__super__.constructor.apply(this, arguments);\n    }\n\n    Modal.mode = 'modal';\n\n    return Modal;\n\n  })(up.Layer.OverlayWithViewport);\n\n}).call(this);\n(function() {\n  var e,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  e = up.element;\n\n  up.Layer.OverlayWithTether = (function(superClass) {\n    extend(OverlayWithTether, superClass);\n\n    function OverlayWithTether() {\n      return OverlayWithTether.__super__.constructor.apply(this, arguments);\n    }\n\n    OverlayWithTether.prototype.createElements = function(content) {\n      if (!this.origin) {\n        up.fail('Missing { origin } option');\n      }\n      this.tether = new up.Tether({\n        anchor: this.origin,\n        align: this.align,\n        position: this.position\n      });\n      this.createElement(this.tether.parent);\n      this.createContentElement(this.element, content);\n      return this.tether.start(this.element);\n    };\n\n    OverlayWithTether.prototype.onElementsRemoved = function() {\n      return this.tether.stop();\n    };\n\n    OverlayWithTether.prototype.sync = function() {\n      if (this.isOpen()) {\n        if (this.isDetached() || this.tether.isDetached()) {\n          return this.dismiss(':detached', {\n            animation: false,\n            preventable: false\n          });\n        } else {\n          return this.tether.sync();\n        }\n      }\n    };\n\n    return OverlayWithTether;\n\n  })(up.Layer.Overlay);\n\n}).call(this);\n(function() {\n  var extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  up.Layer.Popup = (function(superClass) {\n    extend(Popup, superClass);\n\n    function Popup() {\n      return Popup.__super__.constructor.apply(this, arguments);\n    }\n\n    Popup.mode = 'popup';\n\n    return Popup;\n\n  })(up.Layer.OverlayWithTether);\n\n}).call(this);\n(function() {\n  var e, u,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  u = up.util;\n\n  e = up.element;\n\n  up.Layer.Root = (function(superClass) {\n    extend(Root, superClass);\n\n    Root.mode = 'root';\n\n    function Root(options) {\n      Root.__super__.constructor.call(this, options);\n      this.setupHandlers();\n    }\n\n    Root.getter('element', function() {\n      return e.root;\n    });\n\n    Root.prototype.getFirstSwappableElement = function() {\n      return document.body;\n    };\n\n    Root.selector = function() {\n      return 'html';\n    };\n\n    Root.prototype.setupHandlers = function() {\n      if (!this.element.upHandlersApplied) {\n        this.element.upHandlersApplied = true;\n        return Root.__super__.setupHandlers.call(this);\n      }\n    };\n\n    Root.prototype.sync = function() {\n      return this.setupHandlers();\n    };\n\n    Root.prototype.accept = function() {\n      return this.cannotCloseRoot();\n    };\n\n    Root.prototype.dismiss = function() {\n      return this.cannotCloseRoot();\n    };\n\n    Root.prototype.cannotCloseRoot = function() {\n      throw up.error.failed('Cannot close the root layer');\n    };\n\n    Root.prototype.reset = function() {\n      return u.assign(this, this.defaults());\n    };\n\n    Root.prototype.toString = function() {\n      return \"root layer\";\n    };\n\n    return Root;\n\n  })(up.Layer);\n\n}).call(this);\n(function() {\n  var e, u,\n    slice = [].slice;\n\n  u = up.util;\n\n  e = up.element;\n\n  up.LayerLookup = (function() {\n    function LayerLookup() {\n      var args, options, recursiveOptions, stack;\n      stack = arguments[0], args = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n      this.stack = stack;\n      options = u.parseArgIntoOptions(args, 'layer');\n      if (options.normalizeLayerOptions !== false) {\n        up.layer.normalizeOptions(options);\n      }\n      this.values = u.splitValues(options.layer);\n      this.origin = options.origin;\n      this.baseLayer = options.baseLayer || this.stack.current;\n      if (u.isString(this.baseLayer)) {\n        recursiveOptions = u.merge(options, {\n          baseLayer: this.stack.current,\n          normalizeLayerOptions: false\n        });\n        this.baseLayer = new this.constructor(this.stack, this.baseLayer, recursiveOptions).first();\n      }\n    }\n\n    LayerLookup.prototype.originLayer = function() {\n      if (this.origin) {\n        return this.forElement(this.origin);\n      }\n    };\n\n    LayerLookup.prototype.first = function() {\n      return this.all()[0];\n    };\n\n    LayerLookup.prototype.all = function() {\n      var results;\n      results = u.flatMap(this.values, (function(_this) {\n        return function(value) {\n          return _this.resolveValue(value);\n        };\n      })(this));\n      results = u.compact(results);\n      results = u.uniq(results);\n      return results;\n    };\n\n    LayerLookup.prototype.forElement = function(element) {\n      element = e.get(element);\n      return u.find(this.stack.reversed(), function(layer) {\n        return layer.contains(element);\n      });\n    };\n\n    LayerLookup.prototype.forIndex = function(value) {\n      return this.stack[value];\n    };\n\n    LayerLookup.prototype.resolveValue = function(value) {\n      if (value instanceof up.Layer) {\n        return value;\n      }\n      if (u.isNumber(value)) {\n        return this.forIndex(value);\n      }\n      if (/^\\d+$/.test(value)) {\n        return this.forIndex(Number(value));\n      }\n      if (u.isElementish(value)) {\n        return this.forElement(value);\n      }\n      switch (value) {\n        case 'any':\n          return [this.baseLayer].concat(slice.call(this.stack.reversed()));\n        case 'current':\n          return this.baseLayer;\n        case 'closest':\n          return this.stack.selfAndAncestorsOf(this.baseLayer);\n        case 'parent':\n          return this.baseLayer.parent;\n        case 'ancestor':\n        case 'ancestors':\n          return this.baseLayer.ancestors;\n        case 'child':\n          return this.baseLayer.child;\n        case 'descendant':\n        case 'descendants':\n          return this.baseLayer.descendants;\n        case 'new':\n          return 'new';\n        case 'root':\n          return this.stack.root;\n        case 'overlay':\n        case 'overlays':\n          return u.reverse(this.stack.overlays);\n        case 'front':\n          return this.stack.front;\n        case 'origin':\n          return this.originLayer();\n        default:\n          return up.fail(\"Unknown { layer } option: %o\", value);\n      }\n    };\n\n    return LayerLookup;\n\n  })();\n\n}).call(this);\n(function() {\n  var e, u,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    slice = [].slice;\n\n  u = up.util;\n\n  e = up.element;\n\n  up.LayerStack = (function(superClass) {\n    extend(LayerStack, superClass);\n\n    function LayerStack() {\n      LayerStack.__super__.constructor.call(this);\n      this.currentOverrides = [];\n      this.push(this.buildRoot());\n    }\n\n    LayerStack.prototype.buildRoot = function() {\n      return up.layer.build({\n        mode: 'root',\n        stack: this\n      });\n    };\n\n    LayerStack.prototype.remove = function(layer) {\n      return u.remove(this, layer);\n    };\n\n    LayerStack.prototype.peel = function(layer, options) {\n      var descendants, dismissDescendant, dismissOptions, promises;\n      descendants = u.reverse(layer.descendants);\n      dismissOptions = u.merge(options, {\n        preventable: false\n      });\n      dismissDescendant = function(descendant) {\n        return descendant.dismiss(':peel', dismissOptions);\n      };\n      promises = u.map(descendants, dismissDescendant);\n      return Promise.all(promises);\n    };\n\n    LayerStack.prototype.reset = function() {\n      this.peel(this.root, {\n        animation: false\n      });\n      this.currentOverrides = [];\n      return this.root.reset();\n    };\n\n    LayerStack.prototype.isOpen = function(layer) {\n      return layer.index >= 0;\n    };\n\n    LayerStack.prototype.isClosed = function(layer) {\n      return !this.isOpen(layer);\n    };\n\n    LayerStack.prototype.parentOf = function(layer) {\n      return this[layer.index - 1];\n    };\n\n    LayerStack.prototype.childOf = function(layer) {\n      return this[layer.index + 1];\n    };\n\n    LayerStack.prototype.ancestorsOf = function(layer) {\n      return u.reverse(this.slice(0, layer.index));\n    };\n\n    LayerStack.prototype.selfAndAncestorsOf = function(layer) {\n      return [layer].concat(slice.call(layer.ancestors));\n    };\n\n    LayerStack.prototype.descendantsOf = function(layer) {\n      return this.slice(layer.index + 1);\n    };\n\n    LayerStack.prototype.isRoot = function(layer) {\n      return this[0] === layer;\n    };\n\n    LayerStack.prototype.isOverlay = function(layer) {\n      return !this.isRoot(layer);\n    };\n\n    LayerStack.prototype.isCurrent = function(layer) {\n      return this.current === layer;\n    };\n\n    LayerStack.prototype.isFront = function(layer) {\n      return this.front === layer;\n    };\n\n    LayerStack.prototype.get = function() {\n      var args;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      return this.getAll.apply(this, args)[0];\n    };\n\n    LayerStack.prototype.getAll = function() {\n      var args;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      return (function(func, args, ctor) {\n        ctor.prototype = func.prototype;\n        var child = new ctor, result = func.apply(child, args);\n        return Object(result) === result ? result : child;\n      })(up.LayerLookup, [this].concat(slice.call(args)), function(){}).all();\n    };\n\n    LayerStack.prototype.sync = function() {\n      var i, layer, len, ref, results;\n      ref = this;\n      results = [];\n      for (i = 0, len = ref.length; i < len; i++) {\n        layer = ref[i];\n        results.push(layer.sync());\n      }\n      return results;\n    };\n\n    LayerStack.prototype.asCurrent = function(layer, fn) {\n      try {\n        this.currentOverrides.push(layer);\n        return fn();\n      } finally {\n        this.currentOverrides.pop();\n      }\n    };\n\n    LayerStack.prototype.reversed = function() {\n      return u.reverse(this);\n    };\n\n    LayerStack.prototype.dismissOverlays = function(value, options) {\n      var i, len, overlay, ref, results;\n      if (value == null) {\n        value = null;\n      }\n      if (options == null) {\n        options = {};\n      }\n      options.dismissable = false;\n      ref = u.reverse(this.overlays);\n      results = [];\n      for (i = 0, len = ref.length; i < len; i++) {\n        overlay = ref[i];\n        results.push(overlay.dismiss(value, options));\n      }\n      return results;\n    };\n\n    LayerStack.prototype[\"\" + u.copy.key] = function() {\n      return u.copyArrayLike(this);\n    };\n\n    u.getter(LayerStack.prototype, 'count', function() {\n      return this.length;\n    });\n\n    u.getter(LayerStack.prototype, 'root', function() {\n      return this[0];\n    });\n\n    u.getter(LayerStack.prototype, 'overlays', function() {\n      return this.root.descendants;\n    });\n\n    u.getter(LayerStack.prototype, 'current', function() {\n      return u.last(this.currentOverrides) || this.front;\n    });\n\n    u.getter(LayerStack.prototype, 'front', function() {\n      return u.last(this);\n    });\n\n    return LayerStack;\n\n  })(Array);\n\n}).call(this);\n(function() {\n  var u;\n\n  u = up.util;\n\n  up.LinkFeedbackURLs = (function() {\n    function LinkFeedbackURLs(link) {\n      var alias, href, normalize, upHREF;\n      normalize = up.feedback.normalizeURL;\n      this.isSafe = up.link.isSafe(link);\n      if (this.isSafe) {\n        href = link.getAttribute('href');\n        if (href && href !== '#') {\n          this.href = normalize(href);\n        }\n        upHREF = link.getAttribute('up-href');\n        if (upHREF) {\n          this.upHREF = normalize(upHREF);\n        }\n        alias = link.getAttribute('up-alias');\n        if (alias) {\n          this.aliasPattern = new up.URLPattern(alias, normalize);\n        }\n      }\n    }\n\n    LinkFeedbackURLs.prototype.isCurrent = function(normalizedLocation) {\n      return this.isSafe && !!((this.href && this.href === normalizedLocation) || (this.upHREF && this.upHREF === normalizedLocation) || (this.aliasPattern && this.aliasPattern.test(normalizedLocation, false)));\n    };\n\n    return LinkFeedbackURLs;\n\n  })();\n\n}).call(this);\n(function() {\n  var e, u,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  u = up.util;\n\n  e = up.element;\n\n  up.LinkPreloader = (function() {\n    function LinkPreloader() {\n      this.considerPreload = bind(this.considerPreload, this);\n    }\n\n    LinkPreloader.prototype.observeLink = function(link) {\n      if (up.link.isSafe(link)) {\n        this.on(link, 'mouseenter', (function(_this) {\n          return function(event) {\n            return _this.considerPreload(event, true);\n          };\n        })(this));\n        this.on(link, 'mousedown touchstart', (function(_this) {\n          return function(event) {\n            return _this.considerPreload(event);\n          };\n        })(this));\n        return this.on(link, 'mouseleave', (function(_this) {\n          return function(event) {\n            return _this.stopPreload(event);\n          };\n        })(this));\n      }\n    };\n\n    LinkPreloader.prototype.on = function(link, eventTypes, callback) {\n      return up.on(link, eventTypes, {\n        passive: true\n      }, callback);\n    };\n\n    LinkPreloader.prototype.considerPreload = function(event, applyDelay) {\n      var link;\n      link = event.target;\n      if (link !== this.currentLink) {\n        this.reset();\n        this.currentLink = link;\n        if (up.link.shouldFollowEvent(event, link)) {\n          if (applyDelay) {\n            return this.preloadAfterDelay(link);\n          } else {\n            return this.preloadNow(link);\n          }\n        }\n      }\n    };\n\n    LinkPreloader.prototype.stopPreload = function(event) {\n      if (event.target === this.currentLink) {\n        return this.reset();\n      }\n    };\n\n    LinkPreloader.prototype.reset = function() {\n      var ref;\n      if (!this.currentLink) {\n        return;\n      }\n      clearTimeout(this.timer);\n      if ((ref = this.currentRequest) != null ? ref.preload : void 0) {\n        this.currentRequest.abort();\n      }\n      this.currentLink = void 0;\n      return this.currentRequest = void 0;\n    };\n\n    LinkPreloader.prototype.preloadAfterDelay = function(link) {\n      var delay, ref;\n      delay = (ref = e.numberAttr(link, 'up-delay')) != null ? ref : up.link.config.preloadDelay;\n      return this.timer = u.timer(delay, (function(_this) {\n        return function() {\n          return _this.preloadNow(link);\n        };\n      })(this));\n    };\n\n    LinkPreloader.prototype.preloadNow = function(link) {\n      var onQueued;\n      if (e.isDetached(link)) {\n        this.reset();\n        return;\n      }\n      onQueued = (function(_this) {\n        return function(request) {\n          return _this.currentRequest = request;\n        };\n      })(this);\n      up.log.muteUncriticalRejection(up.link.preload(link, {\n        onQueued: onQueued\n      }));\n      return this.queued = true;\n    };\n\n    return LinkPreloader;\n\n  })();\n\n}).call(this);\n(function() {\n  var e, u,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  u = up.util;\n\n  e = up.element;\n\n  up.MotionController = (function() {\n    function MotionController(name) {\n      this.whileForwardingFinishEvent = bind(this.whileForwardingFinishEvent, this);\n      this.unmarkCluster = bind(this.unmarkCluster, this);\n      this.markCluster = bind(this.markCluster, this);\n      this.whenElementFinished = bind(this.whenElementFinished, this);\n      this.emitFinishEvent = bind(this.emitFinishEvent, this);\n      this.finishOneElement = bind(this.finishOneElement, this);\n      this.isActive = bind(this.isActive, this);\n      this.expandFinishRequest = bind(this.expandFinishRequest, this);\n      this.finish = bind(this.finish, this);\n      this.startFunction = bind(this.startFunction, this);\n      this.activeClass = \"up-\" + name;\n      this.dataKey = \"up-\" + name + \"-finished\";\n      this.selector = \".\" + this.activeClass;\n      this.finishEvent = \"up:\" + name + \":finish\";\n      this.finishCount = 0;\n      this.clusterCount = 0;\n    }\n\n\n    /***\n    Finishes all animations in the given elements' ancestors and\n    descendants, then calls the given function.\n    \n    The function is expected to return a promise that is fulfilled when\n    the animation ends. The function is also expected to listen to\n    `this.finishEvent` and instantly skip to the last frame\n    when the event is observed.\n    \n    The animation is tracked so it can be\n    [`finished`](/up.MotionController.finish) later.\n    \n    @function startFunction\n    @param {Element|List<Element>} cluster\n      A list of elements that will be affected by the motion.\n    @param {Function(): Promise} startMotion\n    @param {Object} [memory.trackMotion=true]\n    @return {Promise}\n      A promise that fulfills when the animation ends.\n     */\n\n    MotionController.prototype.startFunction = function(cluster, startMotion, memory) {\n      var mutedAnimator, ref;\n      if (memory == null) {\n        memory = {};\n      }\n      cluster = e.list(cluster);\n      mutedAnimator = function() {\n        return up.log.muteUncriticalRejection(startMotion());\n      };\n      memory.trackMotion = (ref = memory.trackMotion) != null ? ref : up.motion.isEnabled();\n      if (memory.trackMotion === false) {\n        return u.microtask(mutedAnimator);\n      } else {\n        memory.trackMotion = false;\n        return this.finish(cluster).then((function(_this) {\n          return function() {\n            var promise;\n            promise = _this.whileForwardingFinishEvent(cluster, mutedAnimator);\n            promise = promise.then(function() {\n              return _this.unmarkCluster(cluster);\n            });\n            _this.markCluster(cluster, promise);\n            return promise;\n          };\n        })(this));\n      }\n    };\n\n\n    /***\n    Finishes all animations in the given elements' ancestors and\n    descendants, then calls `motion.start()`.\n    \n    Also listens to `this.finishEvent` on the given elements.\n    When this event is observed, calls `motion.finish()`.\n    \n    @function startMotion\n    @param {Element|List<Element>} cluster\n    @param {up.Motion} motion\n    @param {Object} [memory.trackMotion=true]\n     */\n\n    MotionController.prototype.startMotion = function(cluster, motion, memory) {\n      var finish, promise, start, unbindFinish;\n      if (memory == null) {\n        memory = {};\n      }\n      start = function() {\n        return motion.start();\n      };\n      finish = function() {\n        return motion.finish();\n      };\n      unbindFinish = up.on(cluster, this.finishEvent, finish);\n      promise = this.startFunction(cluster, start, memory);\n      promise = promise.then(unbindFinish);\n      return promise;\n    };\n\n\n    /***\n    @function finish\n    @param {List<Element>} [elements]\n      If no element is given, finishes all animations in the documnet.\n      If an element is given, only finishes animations in its subtree and ancestors.\n    @return {Promise} A promise that fulfills when animations have finished.\n     */\n\n    MotionController.prototype.finish = function(elements) {\n      var allFinished;\n      this.finishCount++;\n      if (this.clusterCount === 0 || !up.motion.isEnabled()) {\n        return Promise.resolve();\n      }\n      elements = this.expandFinishRequest(elements);\n      allFinished = u.map(elements, this.finishOneElement);\n      return Promise.all(allFinished);\n    };\n\n    MotionController.prototype.expandFinishRequest = function(elements) {\n      if (elements) {\n        return u.flatMap(elements, (function(_this) {\n          return function(el) {\n            return e.list(e.closest(el, _this.selector), e.all(el, _this.selector));\n          };\n        })(this));\n      } else {\n        return e.all(this.selector);\n      }\n    };\n\n    MotionController.prototype.isActive = function(element) {\n      return element.classList.contains(this.activeClass);\n    };\n\n    MotionController.prototype.finishOneElement = function(element) {\n      this.emitFinishEvent(element);\n      return this.whenElementFinished(element);\n    };\n\n    MotionController.prototype.emitFinishEvent = function(element, eventAttrs) {\n      if (eventAttrs == null) {\n        eventAttrs = {};\n      }\n      eventAttrs = u.merge({\n        target: element,\n        log: false\n      }, eventAttrs);\n      return up.emit(this.finishEvent, eventAttrs);\n    };\n\n    MotionController.prototype.whenElementFinished = function(element) {\n      return element[this.dataKey] || Promise.resolve();\n    };\n\n    MotionController.prototype.markCluster = function(cluster, promise) {\n      var element, i, len, results;\n      this.clusterCount++;\n      results = [];\n      for (i = 0, len = cluster.length; i < len; i++) {\n        element = cluster[i];\n        element.classList.add(this.activeClass);\n        results.push(element[this.dataKey] = promise);\n      }\n      return results;\n    };\n\n    MotionController.prototype.unmarkCluster = function(cluster) {\n      var element, i, len, results;\n      this.clusterCount--;\n      results = [];\n      for (i = 0, len = cluster.length; i < len; i++) {\n        element = cluster[i];\n        element.classList.remove(this.activeClass);\n        results.push(delete element[this.dataKey]);\n      }\n      return results;\n    };\n\n    MotionController.prototype.whileForwardingFinishEvent = function(cluster, fn) {\n      var doForward, unbindFinish;\n      if (cluster.length < 2) {\n        return fn();\n      }\n      doForward = (function(_this) {\n        return function(event) {\n          if (!event.forwarded) {\n            return u.each(cluster, function(element) {\n              if (element !== event.target && _this.isActive(element)) {\n                return _this.emitFinishEvent(element, {\n                  forwarded: true\n                });\n              }\n            });\n          }\n        };\n      })(this);\n      unbindFinish = up.on(cluster, this.finishEvent, doForward);\n      return fn().then(unbindFinish);\n    };\n\n    MotionController.prototype.reset = function() {\n      return this.finish().then((function(_this) {\n        return function() {\n          _this.finishCount = 0;\n          return _this.clusterCount = 0;\n        };\n      })(this));\n    };\n\n    return MotionController;\n\n  })();\n\n}).call(this);\n(function() {\n  var e, u;\n\n  u = up.util;\n\n  e = up.element;\n\n  up.OptionsParser = (function() {\n    function OptionsParser(options, element, parserOptions) {\n      this.options = options;\n      this.element = element;\n      this.fail = parserOptions != null ? parserOptions.fail : void 0;\n    }\n\n    OptionsParser.prototype.string = function(key, keyOptions) {\n      return this.parse(e.attr, key, keyOptions);\n    };\n\n    OptionsParser.prototype.boolean = function(key, keyOptions) {\n      return this.parse(e.booleanAttr, key, keyOptions);\n    };\n\n    OptionsParser.prototype.number = function(key, keyOptions) {\n      return this.parse(e.numberAttr, key, keyOptions);\n    };\n\n    OptionsParser.prototype.booleanOrString = function(key, keyOptions) {\n      return this.parse(e.booleanOrStringAttr, key, keyOptions);\n    };\n\n    OptionsParser.prototype.json = function(key, keyOptions) {\n      return this.parse(e.jsonAttr, key, keyOptions);\n    };\n\n    OptionsParser.prototype.parse = function(attrValueFn, key, keyOptions) {\n      var attrName, attrNames, failAttrNames, failKey, failKeyOptions, i, len, normalizeFn, ref, value;\n      if (keyOptions == null) {\n        keyOptions = {};\n      }\n      attrNames = u.wrapList((ref = keyOptions.attr) != null ? ref : this.attrNameForKey(key));\n      value = this.options[key];\n      if (this.element) {\n        for (i = 0, len = attrNames.length; i < len; i++) {\n          attrName = attrNames[i];\n          if (value == null) {\n            value = attrValueFn(this.element, attrName);\n          }\n        }\n      }\n      if (value == null) {\n        value = keyOptions[\"default\"];\n      }\n      if (normalizeFn = keyOptions.normalize) {\n        value = normalizeFn(value);\n      }\n      if (u.isDefined(value)) {\n        this.options[key] = value;\n      }\n      if ((keyOptions.fail || this.fail) && (failKey = up.fragment.failKey(key))) {\n        failAttrNames = u.compact(u.map(attrNames, this.deriveFailAttrName));\n        failKeyOptions = u.merge(keyOptions, {\n          attr: failAttrNames,\n          fail: false\n        });\n        return this.parse(attrValueFn, failKey, failKeyOptions);\n      }\n    };\n\n    OptionsParser.prototype.deriveFailAttrName = function(attr) {\n      if (attr.indexOf('up-') === 0) {\n        return \"up-fail-\" + (attr.slice(3));\n      }\n    };\n\n    OptionsParser.prototype.attrNameForKey = function(option) {\n      return \"up-\" + (u.camelToKebabCase(option));\n    };\n\n    return OptionsParser;\n\n  })();\n\n}).call(this);\n(function() {\n  var e, u;\n\n  e = up.element;\n\n  u = up.util;\n\n  up.OverlayFocus = (function() {\n    function OverlayFocus(layer) {\n      this.layer = layer;\n      this.focusElement = this.layer.getFocusElement();\n    }\n\n    OverlayFocus.prototype.moveToFront = function() {\n      if (this.enabled) {\n        return;\n      }\n      this.enabled = true;\n      this.untrapFocus = up.on('focusin', (function(_this) {\n        return function(event) {\n          return _this.onFocus(event);\n        };\n      })(this));\n      this.unsetAttrs = e.setTemporaryAttrs(this.focusElement, {\n        'tabindex': '0',\n        'role': 'dialog',\n        'aria-modal': 'true'\n      });\n      this.focusTrapBefore = e.affix(this.focusElement, 'beforebegin', 'up-focus-trap[tabindex=0]');\n      return this.focusTrapAfter = e.affix(this.focusElement, 'afterend', 'up-focus-trap[tabindex=0]');\n    };\n\n    OverlayFocus.prototype.moveToBack = function() {\n      return this.teardown();\n    };\n\n    OverlayFocus.prototype.teardown = function() {\n      if (!this.enabled) {\n        return;\n      }\n      this.enabled = false;\n      this.untrapFocus();\n      this.unsetAttrs();\n      e.remove(this.focusTrapBefore);\n      return e.remove(this.focusTrapAfter);\n    };\n\n    OverlayFocus.prototype.onFocus = function(event) {\n      var target;\n      target = event.target;\n      if (this.processingFocusEvent) {\n        return;\n      }\n      this.processingFocusEvent = true;\n      if (target === this.focusTrapBefore) {\n        this.focusEnd();\n      } else if (target === this.focusTrapAfter || !this.layer.contains(target)) {\n        this.focusStart();\n      }\n      return this.processingFocusEvent = false;\n    };\n\n    OverlayFocus.prototype.focusStart = function(focusOptions) {\n      return up.focus(this.focusElement, focusOptions);\n    };\n\n    OverlayFocus.prototype.focusEnd = function() {\n      return this.focusLastDescendant(this.layer.getBoxElement()) || this.focusStart();\n    };\n\n    OverlayFocus.prototype.focusLastDescendant = function(element) {\n      var child, i, len, ref;\n      ref = u.reverse(element.children);\n      for (i = 0, len = ref.length; i < len; i++) {\n        child = ref[i];\n        if (up.viewport.tryFocus(child) || this.focusLastDescendant(child)) {\n          return true;\n        }\n      }\n    };\n\n    return OverlayFocus;\n\n  })();\n\n}).call(this);\n(function() {\n  var e, u,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  u = up.util;\n\n  e = up.element;\n\n\n  /***\n  The `up.Params` class offers a consistent API to read and manipulate request parameters\n  independent of their type.\n  \n  Request parameters are used in [form submissions](/up.Params.prototype.fromForm) and\n  [URLs](/up.Params.prototype.fromURL). Methods like `up.submit()` or `up.replace()` accept\n  request parameters as a `{ params }` option.\n  \n  \\#\\#\\# Supported parameter types\n  \n  The following types of parameter representation are supported:\n  \n  1. An object like `{ email: 'foo@bar.com' }`\n  2. A query string like `'email=foo%40bar.com'`\n  3. An array of `{ name, value }` objects like `[{ name: 'email', value: 'foo@bar.com' }]`\n  4. A [FormData](https://developer.mozilla.org/en-US/docs/Web/API/FormData) object.\n     On IE 11 and Edge, `FormData` payloads require a [polyfill for `FormData#entries()`](https://github.com/jimmywarting/FormData).\n  \n  @class up.Params\n   */\n\n  up.Params = (function(superClass) {\n    extend(Params, superClass);\n\n\n    /***\n    Constructs a new `up.Params` instance.\n    \n    @constructor up.Params\n    @param {Object|Array|string|up.Params} [params]\n      An existing list of params with which to initialize the new `up.Params` object.\n    \n      The given params value may be of any [supported type](/up.Params).\n    @return {up.Params}\n    @experimental\n     */\n\n    function Params(raw) {\n      this.arrayEntryToQuery = bind(this.arrayEntryToQuery, this);\n      this.clear();\n      this.addAll(raw);\n    }\n\n\n    /***\n    Removes all params from this object.\n    \n    @function up.Params#clear\n    @experimental\n     */\n\n    Params.prototype.clear = function() {\n      return this.entries = [];\n    };\n\n    Params.prototype[\"\" + u.copy.key] = function() {\n      return new up.Params(this);\n    };\n\n\n    /***\n    Returns an object representation of this `up.Params` instance.\n    \n    The returned value is a simple JavaScript object with properties\n    that correspond to the key/values in the given `params`.\n    \n    \\#\\#\\# Example\n    \n        var params = new up.Params('foo=bar&baz=bam')\n        var object = params.toObject()\n    \n        // object is now: {\n        //   foo: 'bar',\n        //   baz: 'bam'\n        // ]\n    \n    @function up.Params#toObject\n    @return {Object}\n    @experimental\n     */\n\n    Params.prototype.toObject = function() {\n      var entry, i, len, name, obj, ref, value;\n      obj = {};\n      ref = this.entries;\n      for (i = 0, len = ref.length; i < len; i++) {\n        entry = ref[i];\n        name = entry.name, value = entry.value;\n        if (!u.isBasicObjectProperty(name)) {\n          if (this.isArrayKey(name)) {\n            obj[name] || (obj[name] = []);\n            obj[name].push(value);\n          } else {\n            obj[name] = value;\n          }\n        }\n      }\n      return obj;\n    };\n\n\n    /***\n    Returns an array representation of this `up.Params` instance.\n    \n    The returned value is a JavaScript array with elements that are objects with\n    `{ key }` and `{ value }` properties.\n    \n    \\#\\#\\# Example\n    \n        var params = new up.Params('foo=bar&baz=bam')\n        var array = params.toArray()\n    \n        // array is now: [\n        //   { name: 'foo', value: 'bar' },\n        //   { name: 'baz', value: 'bam' }\n        // ]\n    \n    @function up.Params#toArray\n    @return {Array}\n    @experimental\n     */\n\n    Params.prototype.toArray = function() {\n      return this.entries;\n    };\n\n\n    /***\n    Returns a [`FormData`](https://developer.mozilla.org/en-US/docs/Web/API/FormData) representation\n    of this `up.Params` instance.\n    \n    \\#\\#\\# Example\n    \n        var params = new up.Params('foo=bar&baz=bam')\n        var formData = params.toFormData()\n    \n        formData.get('foo') // 'bar'\n        formData.get('baz') // 'bam'\n    \n    @function up.Params#toFormData\n    @return {FormData}\n    @experimental\n     */\n\n    Params.prototype.toFormData = function() {\n      var entry, formData, i, len, ref;\n      formData = new FormData();\n      ref = this.entries;\n      for (i = 0, len = ref.length; i < len; i++) {\n        entry = ref[i];\n        formData.append(entry.name, entry.value);\n      }\n      if (!formData.entries) {\n        formData.originalArray = this.entries;\n      }\n      return formData;\n    };\n\n\n    /***\n    Returns an [query string](https://en.wikipedia.org/wiki/Query_string) for this `up.Params` instance.\n    \n    The keys and values in the returned query string will be [percent-encoded](https://developer.mozilla.org/en-US/docs/Glossary/percent-encoding).\n    Non-primitive values (like [`File`](https://developer.mozilla.org/en-US/docs/Web/API/File) will be omitted from\n    the retuned query string.\n    \n    \\#\\#\\# Example\n    \n        var params = new up.Params({ foo: 'bar', baz: 'bam' })\n        var query = params.toQuery()\n    \n        // query is now: 'foo=bar&baz=bam'\n    \n    @function up.Params#toQuery\n    @param {Object|FormData|string|Array|undefined} params\n      the params to convert\n    @return {string}\n      a query string built from the given params\n    @experimental\n     */\n\n    Params.prototype.toQuery = function() {\n      var parts;\n      parts = u.map(this.entries, this.arrayEntryToQuery);\n      parts = u.compact(parts);\n      return parts.join('&');\n    };\n\n    Params.prototype.arrayEntryToQuery = function(entry) {\n      var query, value;\n      value = entry.value;\n      if (this.isBinaryValue(value)) {\n        return void 0;\n      }\n      query = encodeURIComponent(entry.name);\n      if (u.isGiven(value)) {\n        query += \"=\";\n        query += encodeURIComponent(value);\n      }\n      return query;\n    };\n\n\n    /***\n    Returns whether the given value cannot be encoded into a query string.\n    \n    We will have `File` values in our params when we serialize a form with a file input.\n    These entries will be filtered out when converting to a query string.\n    \n    @function up.Params#isBinaryValue\n    @internal\n     */\n\n    Params.prototype.isBinaryValue = function(value) {\n      return value instanceof Blob;\n    };\n\n    Params.prototype.hasBinaryValues = function() {\n      var values;\n      values = u.map(this.entries, 'value');\n      return u.some(values, this.isBinaryValue);\n    };\n\n\n    /***\n    Builds an URL string from the given base URL and\n    this `up.Params` instance as a [query string](/up.Params.toString).\n    \n    The base URL may or may not already contain a query string. The\n    additional query string will be joined with an `&` or `?` character accordingly.\n    \n    @function up.Params#toURL\n    @param {string} base\n      The base URL that will be prepended to this `up.Params` object as a [query string](/up.Params.toString).\n    @return {string}\n      The built URL.\n    @experimental\n     */\n\n    Params.prototype.toURL = function(base) {\n      var parts, separator;\n      parts = [base, this.toQuery()];\n      parts = u.filter(parts, u.isPresent);\n      separator = u.contains(base, '?') ? '&' : '?';\n      return parts.join(separator);\n    };\n\n\n    /***\n    Adds a new entry with the given `name` and `value`.\n    \n    An `up.Params` instance can hold multiple entries with the same name.\n    To overwrite all existing entries with the given `name`, use `up.Params#set()` instead.\n    \n    \\#\\#\\# Example\n    \n        var params = new up.Params()\n        params.add('foo', 'fooValue')\n    \n        var foo = params.get('foo')\n        // foo is now 'fooValue'\n    \n    @function up.Params#add\n    @param {string} name\n      The name of the new entry.\n    @param {any} value\n      The value of the new entry.\n    @experimental\n     */\n\n    Params.prototype.add = function(name, value) {\n      return this.entries.push({\n        name: name,\n        value: value\n      });\n    };\n\n\n    /***\n    Adds all entries from the given list of params.\n    \n    The given params value may be of any [supported type](/up.Params).\n    \n    @function up.Params#addAll\n    @param {Object|Array|string|up.Params|undefined} params\n    @experimental\n     */\n\n    Params.prototype.addAll = function(raw) {\n      var ref, ref1;\n      if (u.isMissing(raw)) {\n\n      } else if (raw instanceof this.constructor) {\n        return (ref = this.entries).push.apply(ref, raw.entries);\n      } else if (u.isArray(raw)) {\n        return (ref1 = this.entries).push.apply(ref1, raw);\n      } else if (u.isString(raw)) {\n        return this.addAllFromQuery(raw);\n      } else if (u.isFormData(raw)) {\n        return this.addAllFromFormData(raw);\n      } else if (u.isObject(raw)) {\n        return this.addAllFromObject(raw);\n      } else {\n        return up.fail(\"Unsupport params type: %o\", raw);\n      }\n    };\n\n    Params.prototype.addAllFromObject = function(object) {\n      var key, results, value, valueElement, valueElements;\n      results = [];\n      for (key in object) {\n        value = object[key];\n        valueElements = u.isArray(value) ? value : [value];\n        results.push((function() {\n          var i, len, results1;\n          results1 = [];\n          for (i = 0, len = valueElements.length; i < len; i++) {\n            valueElement = valueElements[i];\n            results1.push(this.add(key, valueElement));\n          }\n          return results1;\n        }).call(this));\n      }\n      return results;\n    };\n\n    Params.prototype.addAllFromQuery = function(query) {\n      var i, len, name, part, ref, ref1, results, value;\n      ref = query.split('&');\n      results = [];\n      for (i = 0, len = ref.length; i < len; i++) {\n        part = ref[i];\n        if (part) {\n          ref1 = part.split('='), name = ref1[0], value = ref1[1];\n          name = decodeURIComponent(name);\n          if (u.isGiven(value)) {\n            value = decodeURIComponent(value);\n          } else {\n            value = null;\n          }\n          results.push(this.add(name, value));\n        } else {\n          results.push(void 0);\n        }\n      }\n      return results;\n    };\n\n    Params.prototype.addAllFromFormData = function(formData) {\n      return u.eachIterator(formData.entries(), (function(_this) {\n        return function(value) {\n          return _this.add.apply(_this, value);\n        };\n      })(this));\n    };\n\n\n    /***\n    Sets the `value` for the entry with given `name`.\n    \n    An `up.Params` instance can hold multiple entries with the same name.\n    All existing entries with the given `name` are [deleted](/up.Params.prototype.delete) before the\n    new entry is set. To add a new entry even if the `name` is taken, use `up.Params#add()`.\n    \n    @function up.Params#set\n    @param {string} name\n      The name of the entry to set.\n    @param {any} value\n      The new value of the entry.\n    @experimental\n     */\n\n    Params.prototype.set = function(name, value) {\n      this[\"delete\"](name);\n      return this.add(name, value);\n    };\n\n\n    /***\n    Deletes all entries with the given `name`.\n    \n    @function up.Params#delete\n    @param {string} name\n    @experimental\n     */\n\n    Params.prototype[\"delete\"] = function(name) {\n      return this.entries = u.reject(this.entries, this.matchEntryFn(name));\n    };\n\n    Params.prototype.matchEntryFn = function(name) {\n      return function(entry) {\n        return entry.name === name;\n      };\n    };\n\n\n    /***\n    Returns the first param value with the given `name` from the given `params`.\n    \n    Returns `undefined` if no param value with that name is set.\n    \n    If the `name` denotes an array field (e.g. `foo[]`), *all* param values with the given `name`\n    are returned as an array. If no param value with that array name is set, an empty\n    array is returned.\n    \n    To always return a single value use `up.Params#getFirst()` instead.\n    To always return an array of values use `up.Params#getAll()` instead.\n    \n    \\#\\#\\# Example\n    \n        var params = new up.Params({ foo: 'fooValue', bar: 'barValue' })\n        var params = new up.Params([\n          { name: 'foo', value: 'fooValue' }\n          { name: 'bar[]', value: 'barValue1' }\n          { name: 'bar[]', value: 'barValue2' })\n        ]})\n    \n        var foo = params.get('foo')\n        // foo is now 'fooValue'\n    \n        var bar = params.get('bar')\n        // bar is now ['barValue1', 'barValue2']\n    \n    @function up.Params#get\n    @param {string} name\n    @experimental\n     */\n\n    Params.prototype.get = function(name) {\n      if (this.isArrayKey(name)) {\n        return this.getAll(name);\n      } else {\n        return this.getFirst(name);\n      }\n    };\n\n\n    /***\n    Returns the first param value with the given `name`.\n    \n    Returns `undefined` if no param value with that name is set.\n    \n    @function up.Params#getFirst\n    @param {string} name\n    @return {any}\n      The value of the param with the given name.\n    @internal\n     */\n\n    Params.prototype.getFirst = function(name) {\n      var entry;\n      entry = u.find(this.entries, this.matchEntryFn(name));\n      return entry != null ? entry.value : void 0;\n    };\n\n\n    /***\n    Returns an array of all param values with the given `name`.\n    \n    Returns an empty array if no param value with that name is set.\n    \n    @function up.Params#getAll\n    @param {string} name\n    @return {Array}\n      An array of all values with the given name.\n    @internal\n     */\n\n    Params.prototype.getAll = function(name) {\n      var entries;\n      if (this.isArrayKey(name)) {\n        return this.getAll(name);\n      } else {\n        entries = u.map(this.entries, this.matchEntryFn(name));\n        return u.map(entries, 'value');\n      }\n    };\n\n    Params.prototype.isArrayKey = function(key) {\n      return u.endsWith(key, '[]');\n    };\n\n    Params.prototype[\"\" + u.isBlank.key] = function() {\n      return this.entries.length === 0;\n    };\n\n\n    /***\n    Constructs a new `up.Params` instance from the given `<form>`.\n    \n    The returned params may be passed as `{ params }` option to\n    `up.request()` or `up.replace()`.\n    \n    The constructed `up.Params` will include exactly those form values that would be\n    included in a regular form submission. In particular:\n    \n    - All `<input>` types are suppported\n    - Field values are usually strings, but an `<input type=\"file\">` will produce\n      [`File`](https://developer.mozilla.org/en-US/docs/Web/API/File) values.\n    - An `<input type=\"radio\">` or `<input type=\"checkbox\">` will only be added if they are `[checked]`.\n    - An `<select>` will only be added if at least one value is `[checked]`.\n    - If passed a `<select multiple>` or `<input type=\"file\" multiple>`, all selected values are added.\n      If passed a `<select multiple>`, all selected values are added.\n    - Fields that are `[disabled]` are ignored\n    - Fields without a `[name]` attribute are ignored.\n    \n    \\#\\#\\# Example\n    \n    Given this HTML form:\n    \n        <form>\n          <input type=\"text\" name=\"email\" value=\"foo@bar.com\">\n          <input type=\"password\" name=\"pass\" value=\"secret\">\n        </form>\n    \n    This would serialize the form into an array representation:\n    \n        var params = up.Params.fromForm('input[name=email]')\n        var email = params.get('email') // email is now 'foo@bar.com'\n        var pass = params.get('pass') // pass is now 'secret'\n    \n    @function up.Params.fromForm\n    @param {Element|jQuery|string} form\n      A `<form>` element or a selector that matches a `<form>` element.\n    @return {up.Params}\n      A new `up.Params` instance with values from the given form.\n    @experimental\n     */\n\n    Params.fromForm = function(form) {\n      form = up.fragment.get(form);\n      return this.fromFields(up.form.fields(form));\n    };\n\n\n    /***\n    Constructs a new `up.Params` instance from one or more\n    [HTML form field](https://www.w3schools.com/html/html_form_elements.asp).\n    \n    The constructed `up.Params` will include exactly those form values that would be\n    included for the given fields in a regular form submission. If a given field wouldn't\n    submit a value (like an unchecked `<input type=\"checkbox\">`, nothing will be added.\n    \n    See `up.Params.fromForm()` for more details and examples.\n    \n    @function up.Params.fromFields\n    @param {Element|List<Element>|jQuery} fields\n    @return {up.Params}\n    @experimental\n     */\n\n    Params.fromFields = function(fields) {\n      var field, i, len, params, ref;\n      params = new this();\n      ref = u.wrapList(fields);\n      for (i = 0, len = ref.length; i < len; i++) {\n        field = ref[i];\n        params.addField(field);\n      }\n      return params;\n    };\n\n\n    /***\n    Adds params from the given [HTML form field](https://www.w3schools.com/html/html_form_elements.asp).\n    \n    The added params will include exactly those form values that would be\n    included for the given field in a regular form submission. If the given field wouldn't\n      submit a value (like an unchecked `<input type=\"checkbox\">`, nothing will be added.\n    \n    See `up.Params.fromForm()` for more details and examples.\n    \n    @function up.Params#addField\n    @param {Element|jQuery} field\n    @experimental\n     */\n\n    Params.prototype.addField = function(field) {\n      var file, i, j, len, len1, name, option, params, ref, ref1, results, results1, tagName, type;\n      params = new this.constructor();\n      field = e.get(field);\n      if ((name = field.name) && (!field.disabled)) {\n        tagName = field.tagName;\n        type = field.type;\n        if (tagName === 'SELECT') {\n          ref = field.querySelectorAll('option');\n          results = [];\n          for (i = 0, len = ref.length; i < len; i++) {\n            option = ref[i];\n            if (option.selected) {\n              results.push(this.add(name, option.value));\n            } else {\n              results.push(void 0);\n            }\n          }\n          return results;\n        } else if (type === 'checkbox' || type === 'radio') {\n          if (field.checked) {\n            return this.add(name, field.value);\n          }\n        } else if (type === 'file') {\n          ref1 = field.files;\n          results1 = [];\n          for (j = 0, len1 = ref1.length; j < len1; j++) {\n            file = ref1[j];\n            results1.push(this.add(name, file));\n          }\n          return results1;\n        } else {\n          return this.add(name, field.value);\n        }\n      }\n    };\n\n    Params.prototype[\"\" + u.isEqual.key] = function(other) {\n      return other && (this.constructor === other.constructor) && u.isEqual(this.entries, other.entries);\n    };\n\n\n    /***\n    Constructs a new `up.Params` instance from the given URL's\n    [query string](https://en.wikipedia.org/wiki/Query_string).\n    \n    Constructs an empty `up.Params` instance if the given URL has no query string.\n    \n    \\#\\#\\# Example\n    \n        var params = up.Params.fromURL('http://foo.com?foo=fooValue&bar=barValue')\n        var foo = params.get('foo')\n        // foo is now: 'fooValue'\n    \n    @function up.Params.fromURL\n    @param {string} url\n      The URL from which to extract the query string.\n    @return {string|undefined}\n      The given URL's query string, or `undefined` if the URL has no query component.\n    @experimental\n     */\n\n    Params.fromURL = function(url) {\n      var params, query, urlParts;\n      params = new this();\n      urlParts = u.parseURL(url);\n      if (query = urlParts.search) {\n        query = query.replace(/^\\?/, '');\n        params.addAll(query);\n      }\n      return params;\n    };\n\n\n    /***\n    Returns the given URL without its [query string](https://en.wikipedia.org/wiki/Query_string).\n    \n    \\#\\#\\# Example\n    \n        var url = up.Params.stripURL('http://foo.com?key=value')\n        // url is now: 'http://foo.com'\n    \n    @function up.Params.stripURL\n    @param {string} url\n      A URL (with or without a query string).\n    @return {string}\n      The given URL without its query string.\n    @experimental\n     */\n\n    Params.stripURL = function(url) {\n      return u.normalizeURL(url, {\n        search: false\n      });\n    };\n\n\n    /***\n    If passed an `up.Params` instance, it is returned unchanged.\n    Otherwise constructs an `up.Params` instance from the given value.\n    \n    The given params value may be of any [supported type](/up.Params)\n    The return value is always an `up.Params` instance.\n    \n    @function up.Params.wrap\n    @param {Object|Array|string|up.Params|undefined} params\n    @return {up.Params}\n    @experimental\n     */\n\n    return Params;\n\n  })(up.Class);\n\n}).call(this);\n(function() {\n  var u,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  u = up.util;\n\n  up.Rect = (function(superClass) {\n    extend(Rect, superClass);\n\n    function Rect() {\n      return Rect.__super__.constructor.apply(this, arguments);\n    }\n\n    Rect.prototype.keys = function() {\n      return ['left', 'top', 'width', 'height'];\n    };\n\n    Rect.getter('bottom', function() {\n      return this.top + this.height;\n    });\n\n    Rect.getter('right', function() {\n      return this.left + this.width;\n    });\n\n    Rect.fromElement = function(element) {\n      return new this(element.getBoundingClientRect());\n    };\n\n    return Rect;\n\n  })(up.Record);\n\n}).call(this);\n(function() {\n  var u;\n\n  u = up.util;\n\n  up.RenderOptions = (function() {\n    var CONTENT_KEYS, GLOBAL_DEFAULTS, PREFLIGHT_KEYS, PRELOAD_OVERRIDES, SHARED_KEYS, assertContentGiven, deriveFailOptions, failOverrides, navigateDefaults, preloadOverrides, preprocess;\n    GLOBAL_DEFAULTS = {\n      hungry: true,\n      keep: true,\n      source: true,\n      saveScroll: true,\n      fail: 'auto'\n    };\n    PRELOAD_OVERRIDES = {\n      solo: false,\n      confirm: false,\n      feedback: false\n    };\n    PREFLIGHT_KEYS = ['url', 'method', 'origin', 'headers', 'params', 'cache', 'solo', 'confirm', 'feedback', 'origin', 'baseLayer', 'fail'];\n    SHARED_KEYS = PREFLIGHT_KEYS.concat(['keep', 'hungry', 'history', 'source', 'saveScroll', 'fallback', 'navigate']);\n    CONTENT_KEYS = ['url', 'content', 'fragment', 'document'];\n    navigateDefaults = function(options) {\n      if (options.navigate) {\n        return up.fragment.config.navigateOptions;\n      }\n    };\n    preloadOverrides = function(options) {\n      if (options.preload) {\n        return PRELOAD_OVERRIDES;\n      }\n    };\n    preprocess = function(options) {\n      var base, result;\n      if (typeof (base = up.migrate).handleRenderOptions === \"function\") {\n        base.handleRenderOptions(options);\n      }\n      result = u.merge(GLOBAL_DEFAULTS, navigateDefaults(options), options, preloadOverrides(options));\n      return result;\n    };\n    assertContentGiven = function(options) {\n      if (!u.some(CONTENT_KEYS, function(contentKey) {\n        return u.isGiven(options[contentKey]);\n      })) {\n        if (options.defaultToEmptyContent) {\n          return options.content = '';\n        } else {\n          return up.fail('up.render() needs either { ' + CONTENT_KEYS.join(', ') + ' } option');\n        }\n      }\n    };\n    failOverrides = function(options) {\n      var key, overrides, unprefixed, value;\n      overrides = {};\n      for (key in options) {\n        value = options[key];\n        if (unprefixed = up.fragment.successKey(key)) {\n          overrides[unprefixed] = value;\n        }\n      }\n      return overrides;\n    };\n    deriveFailOptions = function(preprocessedOptions) {\n      var result;\n      result = u.merge(u.pick(preprocessedOptions, SHARED_KEYS), failOverrides(preprocessedOptions));\n      return preprocess(result);\n    };\n    return {\n      preprocess: preprocess,\n      assertContentGiven: assertContentGiven,\n      deriveFailOptions: deriveFailOptions\n    };\n  })();\n\n}).call(this);\n(function() {\n  var e, u,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  u = up.util;\n\n  e = up.element;\n\n\n  /***\n  Instances of `up.RenderResult` describe the effects of [rendering](/up.render).\n  \n  It is returned by functions like `up.render()` or `up.navigate()`:\n  \n  ```js\n  let result = await up.render('.target', content: 'foo')\n  console.log(result.fragments) // => [<div class=\"target\">...</div>]\n  console.log(result.layer)     // => up.Layer.Root\n  ```\n  \n  @class up.RenderResult\n   */\n\n  up.RenderResult = (function(superClass) {\n    extend(RenderResult, superClass);\n\n    function RenderResult() {\n      return RenderResult.__super__.constructor.apply(this, arguments);\n    }\n\n\n    /***\n    An array of fragments that were inserted.\n    \n    @property up.RenderResult#fragments\n    @param {Array<Element>} fragments\n    @stable\n     */\n\n\n    /***\n    The updated [layer](/up.layer).\n    \n    @property up.RenderResult#layer\n    @param {up.Layer} layer\n    @stable\n     */\n\n    RenderResult.prototype.keys = function() {\n      return ['fragments', 'layer'];\n    };\n\n    return RenderResult;\n\n  })(up.Record);\n\n}).call(this);\n(function() {\n  var e, u,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    slice = [].slice;\n\n  u = up.util;\n\n  e = up.element;\n\n\n  /***\n  A normalized description of an [HTTP request](`up.request()`).\n  \n  You can queue a request using the `up.request()` method:\n  \n  ```js\n  let request = up.request('/foo')\n  console.log(request.url)\n  \n  // A request object is also a promise for its response\n  let response = await request\n  console.log(response.text)\n  ```\n  \n  @class up.Request\n   */\n\n  up.Request = (function(superClass) {\n    extend(Request, superClass);\n\n\n    /***\n    The HTTP method for the request.\n    \n    @property up.Request#method\n    @param {string} method\n    @stable\n     */\n\n\n    /***\n    The URL for the request.\n    \n    @property up.Request#url\n    @param {string} url\n    @stable\n     */\n\n\n    /***\n    The [hash component](https://en.wikipedia.org/wiki/URI_fragment) of this request's URL.\n    \n    The `{ hash }` property is automatically extracted from the given URL:\n    \n    ```js\n    let request = up.request({ url: '/path#section' })\n    request.url // => '/path'\n    request.hash // => '#section'\n    ```\n    \n    @property up.Request#hash\n    @param {string} hash\n    @stable\n     */\n\n\n    /***\n    [Parameters](/up.Params) that should be sent as the request's payload.\n    \n    @property up.Request#params\n    @param {Object|FormData|string|Array} params\n    @stable\n     */\n\n\n    /***\n    The CSS selector targeted by this request.\n    \n    The selector will be sent as an `X-Up-Target` header.\n    \n    @property up.Request#target\n    @param {string} target\n    @stable\n     */\n\n\n    /***\n    The CSS selector targeted by this request in case the server responds\n    with an [error code](/server-errors).\n    \n    The selector will be sent as an `X-Up-Fail-Target` header.\n    \n    @property up.Request#failTarget\n    @param {string} failTarget\n    @stable\n     */\n\n\n    /***\n    An object of additional HTTP headers.\n    \n    Unpoly will by default send a number of custom request headers.\n    See `up.protocol` and `up.network.config.metaKeys` for details.\n    \n    @property up.Request#headers\n    @param {Object} headers\n    @stable\n     */\n\n\n    /***\n    A timeout in milliseconds.\n    \n    If `up.network.config.maxRequests` is set,\n    the timeout will not include the time spent waiting in the queue.\n    \n    @property up.Request#timeout\n    @param {Object|undefined} timeout\n    @stable\n     */\n\n\n    /***\n    Whether to wrap non-standard HTTP methods in a POST request.\n    \n    If this is set, methods other than GET and POST will be converted to a `POST` request\n    and carry their original method as a `_method` parameter. This is to [prevent unexpected redirect behavior](https://makandracards.com/makandra/38347).\n    \n    Defaults to [`up.network.config`](/up.network.config#config.wrapMethod).\n    \n    @property up.Request#wrapMethod\n    @param {boolean} wrapMethod\n    @stable\n     */\n\n\n    /***\n    The [context](/contact) of the layer targeted by this request.\n    \n    The context object will be sent as an `X-Up-Context` header.\n    \n    @property up.Request#context\n    @param {Object} context\n    @experimental\n     */\n\n\n    /***\n    The [context](/contact) of the layer targeted by this request in case the server responds with an [error code](/server-errors).\n    \n    The context object will be sent as an `X-Up-Fail-Context` header.\n    \n    @property up.Request#failContext\n    @param {Object} failContext\n    @experimental\n     */\n\n\n    /***\n    The [layer](/up.layer) targeted by this request.\n    \n    Setting the `{ layer }` property will automatically derive `{ context }` and `{ mode }` properties.\n    \n    To prevent memory leaks, this property is removed shortly after the response is received.\n    \n    @property up.Request#layer\n    @param {up.Layer} layer\n    @experimental\n     */\n\n\n    /***\n    The [layer](/up.layer) targeted by this request in case the server responds with an [error code](/server-errors).\n    \n    Setting the `{ failLayer }` property will automatically derive `{ failContext }` and `{ failMode }` properties.\n    \n    To prevent memory leaks, this property is removed shortly after the response is received.\n    \n    @property up.Request#failLayer\n    @param {up.Layer} layer\n    @experimental\n     */\n\n\n    /***\n    The element that triggered the request.\n    \n    For example, when this request was triggered by a click on a link, the lonk\n    element is set as the `{ origin }`.\n    \n    To prevent memory leaks, this property is removed shortly after the response is received.\n    \n    @property up.Request#origin\n    @param {Element} origin\n    @experimental\n     */\n\n\n    /***\n    The [mode](/up.Layer.prototype.mode) of the layer targeted by this request.\n    \n    The value will be sent as an `X-Up-Mode` header.\n    \n    @property up.Request#mode\n    @param {string} mode\n    @stable\n     */\n\n\n    /***\n    The [mode](/up.Layer.prototype.mode) of the layer targeted by this request in case the server responds with an [error code](/server-errors).\n    \n    The value will be sent as an `X-Up-Fail-Mode` header.\n    \n    @property up.Request#failMode\n    @param {string} failMode\n    @stable\n     */\n\n\n    /***\n    The format in which the [request params](/up.Layer.prototype.params) will be encoded.\n    \n    @property up.Request#contentType\n    @param {string} contentType\n    @stable\n     */\n\n\n    /***\n    The payload that the request will encode into its body.\n    \n    By default Unpoly will build a payload from the given `{ params }` option.\n    \n    @property up.Request#payload\n    @param {string} payload\n    @stable\n     */\n\n\n    /***\n    @property up.Request#preload\n    @param {boolean} preload\n    @experimental\n     */\n\n    Request.prototype.keys = function() {\n      return ['method', 'url', 'hash', 'params', 'target', 'failTarget', 'headers', 'timeout', 'preload', 'cache', 'clearCache', 'layer', 'mode', 'context', 'failLayer', 'failMode', 'failContext', 'origin', 'solo', 'queueTime', 'wrapMethod', 'contentType', 'payload', 'onQueued'];\n    };\n\n\n    /***\n    Creates a new `up.Request` object.\n    \n    This will not actually send the request over the network. For that use `up.request()`.\n    \n    @constructor up.Request\n    @param {string} attrs.url\n    @param {string} [attrs.method='get']\n    @param {up.Params|string|Object|Array} [attrs.params]\n    @param {string} [attrs.target]\n    @param {string} [attrs.failTarget]\n    @param {Object<string, string>} [attrs.headers]\n    @param {number} [attrs.timeout]\n    @internal\n     */\n\n    function Request(options) {\n      Request.__super__.constructor.call(this, options);\n      this.params = new up.Params(this.params);\n      this.headers || (this.headers = {});\n      if (this.preload) {\n        this.cache = true;\n      }\n      if (this.wrapMethod == null) {\n        this.wrapMethod = up.network.config.wrapMethod;\n      }\n      this.normalizeForCaching();\n      if (!options.basic) {\n        this.layer = up.layer.get(this.layer);\n        this.failLayer = up.layer.get(this.failLayer || this.layer);\n        this.context || (this.context = this.layer.context || {});\n        this.failContext || (this.failContext = this.failLayer.context || {});\n        this.mode || (this.mode = this.layer.mode);\n        this.failMode || (this.failMode = this.failLayer.mode);\n        this.deferred = u.newDeferred();\n        this.state = 'new';\n      }\n    }\n\n    Request.delegate(['then', 'catch', 'finally'], 'deferred');\n\n    Request.prototype.followState = function(sourceRequest) {\n      return u.delegate(this, ['deferred', 'state', 'preload'], function() {\n        return sourceRequest;\n      });\n    };\n\n    Request.prototype.normalizeForCaching = function() {\n      this.method = u.normalizeMethod(this.method);\n      this.extractHashFromURL();\n      this.transferParamsToURL();\n      return this.url = u.normalizeURL(this.url);\n    };\n\n    Request.prototype.evictExpensiveAttrs = function() {\n      return u.task((function(_this) {\n        return function() {\n          _this.layer = void 0;\n          _this.failLayer = void 0;\n          return _this.origin = void 0;\n        };\n      })(this));\n    };\n\n    Request.prototype.extractHashFromURL = function() {\n      var match, ref;\n      if (match = (ref = this.url) != null ? ref.match(/^([^#]*)(#.+)$/) : void 0) {\n        this.url = match[1];\n        return this.hash = match[2];\n      }\n    };\n\n    Request.prototype.transferParamsToURL = function() {\n      if (!this.url || this.allowsPayload() || u.isBlank(this.params)) {\n        return;\n      }\n      this.url = this.params.toURL(this.url);\n      return this.params.clear();\n    };\n\n    Request.prototype.isSafe = function() {\n      return up.network.isSafeMethod(this.method);\n    };\n\n    Request.prototype.allowsPayload = function() {\n      return u.methodAllowsPayload(this.method);\n    };\n\n    Request.prototype.will302RedirectWithGET = function() {\n      return this.isSafe() || this.method === 'POST';\n    };\n\n    Request.prototype.willCache = function() {\n      if (this.cache === 'auto') {\n        return up.network.config.autoCache(this);\n      } else {\n        return this.cache;\n      }\n    };\n\n    Request.prototype.runQueuedCallbacks = function() {\n      u.always(this, (function(_this) {\n        return function() {\n          return _this.evictExpensiveAttrs();\n        };\n      })(this));\n      return typeof this.onQueued === \"function\" ? this.onQueued(this) : void 0;\n    };\n\n    Request.prototype.load = function() {\n      if (this.state !== 'new') {\n        return;\n      }\n      this.state = 'loading';\n      return this.xhr = new up.Request.XHRRenderer(this).buildAndSend({\n        onload: (function(_this) {\n          return function() {\n            return _this.onXHRLoad();\n          };\n        })(this),\n        onerror: (function(_this) {\n          return function() {\n            return _this.onXHRError();\n          };\n        })(this),\n        ontimeout: (function(_this) {\n          return function() {\n            return _this.onXHRTimeout();\n          };\n        })(this),\n        onabort: (function(_this) {\n          return function() {\n            return _this.onXHRAbort();\n          };\n        })(this)\n      });\n    };\n\n\n    /***\n    Loads this request object as a full-page request, replacing the entire browser environment\n    with a new page from the server response.\n    \n    The full-page request will be loaded with the [URL](/up.Request.prototype.url),\n    [method](/up.Request.prototype.method) and [params](/up.Request.prototype.params)\n    from this request object.\n    Properties that are not possible in a full-page request (such as custom HTTP headers)\n    will be ignored.\n    \n    \\#\\#\\# Example\n    \n    ```javascript\n    let request = await up.request('/path')\n    \n    try {\n      let response = await request('/path')\n    } catch (result) {\n      if (result.name === 'AbortError') {\n        console.log('Request was aborted.')\n      }\n    }\n    \n    request.abort()\n    ```\n    \n    @function up.Request#loadPage\n    @experimental\n     */\n\n    Request.prototype.loadPage = function() {\n      up.network.abort();\n      return new up.Request.FormRenderer(this).buildAndSubmit();\n    };\n\n    Request.prototype.onXHRLoad = function() {\n      var log, response;\n      response = this.extractResponseFromXHR();\n      log = ['Server responded HTTP %d to %s %s (%d characters)', response.status, this.method, this.url, response.text.length];\n      this.emit('up:request:loaded', {\n        request: response.request,\n        response: response,\n        log: log\n      });\n      return this.respondWith(response);\n    };\n\n    Request.prototype.onXHRError = function() {\n      var log;\n      log = 'Fatal error during request';\n      this.deferred.reject(up.error.failed(log));\n      return this.emit('up:request:fatal', {\n        log: log\n      });\n    };\n\n    Request.prototype.onXHRTimeout = function() {\n      return this.setAbortedState('Requested timed out');\n    };\n\n    Request.prototype.onXHRAbort = function() {\n      return this.setAbortedState();\n    };\n\n\n    /***\n    Aborts this request.\n    \n    The request's promise will reject with an error object that has `{ name: 'AbortError' }`.\n    \n    \\#\\#\\# Example\n    \n    ```javascript\n    let request = await up.request('/path')\n    \n    try {\n      let response = await request('/path')\n    } catch (result) {\n      if (result.name === 'AbortError') {\n        console.log('Request was aborted.')\n      }\n    }\n    \n    request.abort()\n    ```\n    \n    @function up.Request#abort\n    @experimental\n     */\n\n    Request.prototype.abort = function() {\n      if (this.setAbortedState() && this.xhr) {\n        return this.xhr.abort();\n      }\n    };\n\n    Request.prototype.setAbortedState = function(reason) {\n      if (reason == null) {\n        reason = [\"Request to %s %s was aborted\", this.method, this.url];\n      }\n      if (!(this.state === 'new' || this.state === 'loading')) {\n        return;\n      }\n      this.state = 'aborted';\n      this.emit('up:request:aborted', {\n        log: reason\n      });\n      this.deferred.reject(up.error.aborted(reason));\n      return true;\n    };\n\n    Request.prototype.respondWith = function(response) {\n      if (this.state !== 'loading') {\n        return;\n      }\n      this.state = 'loaded';\n      if (response.ok) {\n        return this.deferred.resolve(response);\n      } else {\n        return this.deferred.reject(response);\n      }\n    };\n\n    Request.prototype.csrfHeader = function() {\n      return up.protocol.csrfHeader();\n    };\n\n    Request.prototype.csrfParam = function() {\n      return up.protocol.csrfParam();\n    };\n\n    Request.prototype.csrfToken = function() {\n      if (!this.isSafe() && !this.isCrossOrigin()) {\n        return up.protocol.csrfToken();\n      }\n    };\n\n    Request.prototype.isCrossOrigin = function() {\n      return u.isCrossOrigin(this.url);\n    };\n\n    Request.prototype.extractResponseFromXHR = function() {\n      var methodFromResponse, responseAttrs, urlFromResponse;\n      responseAttrs = {\n        method: this.method,\n        url: this.url,\n        request: this,\n        xhr: this.xhr,\n        text: this.xhr.responseText,\n        status: this.xhr.status,\n        title: up.protocol.titleFromXHR(this.xhr),\n        target: up.protocol.targetFromXHR(this.xhr),\n        acceptLayer: up.protocol.acceptLayerFromXHR(this.xhr),\n        dismissLayer: up.protocol.dismissLayerFromXHR(this.xhr),\n        eventPlans: up.protocol.eventPlansFromXHR(this.xhr),\n        context: up.protocol.contextFromXHR(this.xhr),\n        clearCache: up.protocol.clearCacheFromXHR(this.xhr)\n      };\n      methodFromResponse = up.protocol.methodFromXHR(this.xhr);\n      if (urlFromResponse = up.protocol.locationFromXHR(this.xhr)) {\n        if (!methodFromResponse && !u.matchURLs(responseAttrs.url, urlFromResponse)) {\n          methodFromResponse = 'GET';\n        }\n        responseAttrs.url = urlFromResponse;\n      }\n      if (methodFromResponse) {\n        responseAttrs.method = methodFromResponse;\n      }\n      return new up.Response(responseAttrs);\n    };\n\n    Request.prototype.cacheKey = function() {\n      return JSON.stringify([this.method, this.url, this.params.toQuery(), this.metaProps()]);\n    };\n\n    Request.prototype.metaProps = function() {\n      var i, key, len, props, ref, value;\n      props = {};\n      ref = u.evalOption(up.network.config.requestMetaKeys, this);\n      for (i = 0, len = ref.length; i < len; i++) {\n        key = ref[i];\n        value = this[key];\n        if (u.isGiven(value)) {\n          props[key] = value;\n        }\n      }\n      return props;\n    };\n\n    Request.prototype.buildEventEmitter = function(args) {\n      return up.EventEmitter.fromEmitArgs(args, {\n        request: this,\n        layer: this.layer\n      });\n    };\n\n    Request.prototype.emit = function() {\n      var args;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      return this.buildEventEmitter(args).emit();\n    };\n\n    Request.prototype.assertEmitted = function() {\n      var args;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      return this.buildEventEmitter(args).assertEmitted();\n    };\n\n    Request.getter('description', function() {\n      return this.method + ' ' + this.url;\n    });\n\n    return Request;\n\n  })(up.Record);\n\n}).call(this);\n(function() {\n  var u,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  u = up.util;\n\n  up.Request.Cache = (function(superClass) {\n    extend(Cache, superClass);\n\n    function Cache() {\n      return Cache.__super__.constructor.apply(this, arguments);\n    }\n\n    Cache.prototype.maxSize = function() {\n      return up.network.config.cacheSize;\n    };\n\n    Cache.prototype.expiryMillis = function() {\n      return up.network.config.cacheExpiry;\n    };\n\n    Cache.prototype.normalizeStoreKey = function(request) {\n      return up.Request.wrap(request).cacheKey();\n    };\n\n    Cache.prototype.clear = function(pattern) {\n      if (pattern && pattern !== '*' && pattern !== true) {\n        pattern = new up.URLPattern(pattern);\n        return this.each((function(_this) {\n          return function(key, request) {\n            if (pattern.test(request.url)) {\n              return _this.store.remove(key);\n            }\n          };\n        })(this));\n      } else {\n        return Cache.__super__.clear.call(this);\n      }\n    };\n\n    return Cache;\n\n  })(up.Cache);\n\n}).call(this);\n(function() {\n  var HTML_FORM_METHODS, e, u;\n\n  u = up.util;\n\n  e = up.element;\n\n  HTML_FORM_METHODS = ['GET', 'POST'];\n\n  up.Request.FormRenderer = (function() {\n    function FormRenderer(request) {\n      this.request = request;\n    }\n\n    FormRenderer.prototype.buildAndSubmit = function() {\n      var action, contentType, csrfParam, csrfToken, method, paramsFromQuery;\n      this.params = u.copy(this.request.params);\n      action = this.request.url;\n      method = this.request.method;\n      paramsFromQuery = up.Params.fromURL(action);\n      this.params.addAll(paramsFromQuery);\n      action = up.Params.stripURL(action);\n      if (!u.contains(HTML_FORM_METHODS, method)) {\n        method = up.protocol.wrapMethod(method, this.params);\n      }\n      this.form = e.affix(document.body, 'form.up-request-loader', {\n        method: method,\n        action: action\n      });\n      if (contentType = this.request.contentType) {\n        this.form.setAttribute('enctype', contentType);\n      }\n      if ((csrfParam = this.request.csrfParam()) && (csrfToken = this.request.csrfToken())) {\n        this.params.add(csrfParam, csrfToken);\n      }\n      u.each(this.params.toArray(), this.addField.bind(this));\n      return up.browser.submitForm(this.form);\n    };\n\n    FormRenderer.prototype.addField = function(attrs) {\n      return e.affix(this.form, 'input[type=hidden]', attrs);\n    };\n\n    return FormRenderer;\n\n  })();\n\n}).call(this);\n(function() {\n  var u,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  u = up.util;\n\n  up.Request.Queue = (function(superClass) {\n    extend(Queue, superClass);\n\n    function Queue(options) {\n      var ref, ref1;\n      if (options == null) {\n        options = {};\n      }\n      this.concurrency = (ref = options.concurrency) != null ? ref : function() {\n        return up.network.config.concurrency;\n      };\n      this.badResponseTime = (ref1 = options.badResponseTime) != null ? ref1 : function() {\n        return up.network.config.badResponseTime;\n      };\n      this.reset();\n    }\n\n    Queue.prototype.reset = function() {\n      this.queuedRequests = [];\n      this.currentRequests = [];\n      clearTimeout(this.checkSlowTimout);\n      return this.emittedSlow = false;\n    };\n\n    Queue.getter('allRequests', function() {\n      return this.currentRequests.concat(this.queuedRequests);\n    });\n\n    Queue.prototype.asap = function(request) {\n      request.runQueuedCallbacks();\n      u.always(request, (function(_this) {\n        return function(responseOrError) {\n          return _this.onRequestSettled(request, responseOrError);\n        };\n      })(this));\n      request.queueTime = new Date();\n      this.setSlowTimer();\n      if (this.hasConcurrencyLeft()) {\n        return this.sendRequestNow(request);\n      } else {\n        return this.queueRequest(request);\n      }\n    };\n\n    Queue.prototype.promoteToForeground = function(request) {\n      if (request.preload) {\n        request.preload = false;\n        return this.setSlowTimer();\n      }\n    };\n\n    Queue.prototype.setSlowTimer = function() {\n      var badResponseTime;\n      badResponseTime = u.evalOption(this.badResponseTime);\n      return this.checkSlowTimout = u.timer(badResponseTime, (function(_this) {\n        return function() {\n          return _this.checkSlow();\n        };\n      })(this));\n    };\n\n    Queue.prototype.hasConcurrencyLeft = function() {\n      var maxConcurrency;\n      maxConcurrency = u.evalOption(this.concurrency);\n      return maxConcurrency === -1 || this.currentRequests.length < maxConcurrency;\n    };\n\n    Queue.prototype.isBusy = function() {\n      return this.currentRequests.length > 0;\n    };\n\n    Queue.prototype.queueRequest = function(request) {\n      return this.queuedRequests.push(request);\n    };\n\n    Queue.prototype.pluckNextRequest = function() {\n      var request;\n      request = u.find(this.queuedRequests, function(request) {\n        return !request.preload;\n      });\n      request || (request = this.queuedRequests[0]);\n      return u.remove(this.queuedRequests, request);\n    };\n\n    Queue.prototype.sendRequestNow = function(request) {\n      if (request.emit('up:request:load', {\n        log: ['Loading %s %s', request.method, request.url]\n      }).defaultPrevented) {\n        return request.abort('Prevented by event listener');\n      } else {\n        request.normalizeForCaching();\n        this.currentRequests.push(request);\n        return request.load();\n      }\n    };\n\n    Queue.prototype.onRequestSettled = function(request, responseOrError) {\n      u.remove(this.currentRequests, request);\n      if ((responseOrError instanceof up.Response) && responseOrError.ok) {\n        up.network.registerAliasForRedirect(request, responseOrError);\n      }\n      this.checkSlow();\n      return u.microtask((function(_this) {\n        return function() {\n          return _this.poke();\n        };\n      })(this));\n    };\n\n    Queue.prototype.poke = function() {\n      var request;\n      if (this.hasConcurrencyLeft() && (request = this.pluckNextRequest())) {\n        return this.sendRequestNow(request);\n      }\n    };\n\n    Queue.prototype.abort = function(conditions) {\n      var i, len, list, matches, ref;\n      if (conditions == null) {\n        conditions = true;\n      }\n      ref = [this.currentRequests, this.queuedRequests];\n      for (i = 0, len = ref.length; i < len; i++) {\n        list = ref[i];\n        matches = u.filter(list, (function(_this) {\n          return function(request) {\n            return _this.requestMatches(request, conditions);\n          };\n        })(this));\n        matches.forEach(function(match) {\n          match.abort();\n          return u.remove(list, match);\n        });\n        return;\n      }\n    };\n\n    Queue.prototype.abortExcept = function(excusedRequest, additionalConditions) {\n      var excusedCacheKey;\n      if (additionalConditions == null) {\n        additionalConditions = true;\n      }\n      excusedCacheKey = excusedRequest.cacheKey();\n      return this.abort(function(queuedRequest) {\n        return queuedRequest.cacheKey() !== excusedCacheKey && u.evalOption(additionalConditions, queuedRequest);\n      });\n    };\n\n    Queue.prototype.requestMatches = function(request, conditions) {\n      return request === conditions || u.evalOption(conditions, request);\n    };\n\n    Queue.prototype.checkSlow = function() {\n      var currentSlow;\n      currentSlow = this.isSlow();\n      if (this.emittedSlow !== currentSlow) {\n        this.emittedSlow = currentSlow;\n        if (currentSlow) {\n          return up.emit('up:request:late', {\n            log: 'Server is slow to respond'\n          });\n        } else {\n          return up.emit('up:request:recover', {\n            log: 'Slow requests were loaded'\n          });\n        }\n      }\n    };\n\n    Queue.prototype.isSlow = function() {\n      var allForegroundRequests, delay, now, timerTolerance;\n      now = new Date();\n      delay = u.evalOption(this.badResponseTime);\n      allForegroundRequests = u.reject(this.allRequests, 'preload');\n      timerTolerance = 1;\n      return u.some(allForegroundRequests, function(request) {\n        return (now - request.queueTime) >= (delay - timerTolerance);\n      });\n    };\n\n    return Queue;\n\n  })(up.Class);\n\n}).call(this);\n(function() {\n  var CONTENT_TYPE_FORM_DATA, CONTENT_TYPE_URL_ENCODED, u;\n\n  CONTENT_TYPE_URL_ENCODED = 'application/x-www-form-urlencoded';\n\n  CONTENT_TYPE_FORM_DATA = 'multipart/form-data';\n\n  u = up.util;\n\n  up.Request.XHRRenderer = (function() {\n    function XHRRenderer(request) {\n      this.request = request;\n    }\n\n    XHRRenderer.prototype.buildAndSend = function(handlers) {\n      var contentType, csrfHeader, csrfToken, header, key, ref, ref1, value;\n      this.xhr = new XMLHttpRequest();\n      this.params = u.copy(this.request.params);\n      if (this.request.timeout) {\n        this.xhr.timeout = this.request.timeout;\n      }\n      this.xhr.open(this.getMethod(), this.request.url);\n      ref = this.request.metaProps();\n      for (key in ref) {\n        value = ref[key];\n        header = up.protocol.headerize(key);\n        this.addHeader(header, value);\n      }\n      ref1 = this.request.headers;\n      for (header in ref1) {\n        value = ref1[header];\n        this.addHeader(header, value);\n      }\n      if ((csrfHeader = this.request.csrfHeader()) && (csrfToken = this.request.csrfToken())) {\n        this.addHeader(csrfHeader, csrfToken);\n      }\n      this.addHeader(up.protocol.headerize('version'), up.version);\n      if (contentType = this.getContentType()) {\n        this.addHeader('Content-Type', contentType);\n      }\n      u.assign(this.xhr, handlers);\n      this.xhr.send(this.getPayload());\n      return this.xhr;\n    };\n\n    XHRRenderer.prototype.getMethod = function() {\n      if (!this.method) {\n        this.method = this.request.method;\n        if (this.request.wrapMethod && !this.request.will302RedirectWithGET()) {\n          this.method = up.protocol.wrapMethod(this.method, this.params);\n        }\n      }\n      return this.method;\n    };\n\n    XHRRenderer.prototype.getContentType = function() {\n      this.finalizePayload();\n      return this.contentType;\n    };\n\n    XHRRenderer.prototype.getPayload = function() {\n      this.finalizePayload();\n      return this.payload;\n    };\n\n    XHRRenderer.prototype.addHeader = function(header, value) {\n      if (u.isOptions(value) || u.isArray(value)) {\n        value = JSON.stringify(value);\n      }\n      return this.xhr.setRequestHeader(header, value);\n    };\n\n    XHRRenderer.prototype.finalizePayload = function() {\n      if (this.payloadFinalized) {\n        return;\n      }\n      this.payloadFinalized = true;\n      this.payload = this.request.payload;\n      this.contentType = this.request.contentType;\n      if (!this.payload && this.request.allowsPayload()) {\n        if (!this.contentType) {\n          this.contentType = this.params.hasBinaryValues() ? CONTENT_TYPE_FORM_DATA : CONTENT_TYPE_URL_ENCODED;\n        }\n        if (this.contentType === CONTENT_TYPE_FORM_DATA) {\n          this.contentType = null;\n          return this.payload = this.params.toFormData();\n        } else {\n          return this.payload = this.params.toQuery().replace(/%20/g, '+');\n        }\n      }\n    };\n\n    return XHRRenderer;\n\n  })();\n\n}).call(this);\n(function() {\n  var u,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  u = up.util;\n\n\n  /***\n  A response to an [HTTP request](`up.request()`).\n  \n  \\#\\#\\# Example\n  \n      up.request('/foo').then(function(response) {\n        console.log(response.status) // 200\n        console.log(response.text)   // \"<html><body>...\"\n      })\n  \n  @class up.Response\n   */\n\n  up.Response = (function(superClass) {\n    extend(Response, superClass);\n\n    function Response() {\n      return Response.__super__.constructor.apply(this, arguments);\n    }\n\n\n    /***\n    The HTTP method used for the request that produced this response.\n    \n    This is usually the HTTP method used by the initial request, but if the server\n    redirected multiple requests may have been involved. In this case this property reflects\n    the method used by the last request.\n    \n    If the response's URL changed from the request's URL,\n    Unpoly will assume a redirect and set the method to `GET`.\n    Also see the `X-Up-Method` header.\n    \n    @property up.Response#method\n    @param {string} method\n    @stable\n     */\n\n\n    /***\n    The URL used for the response.\n    \n    This is usually the requested URL, or the final URL after the server redirected.\n    \n    On Internet Explorer 11 this property is only set when the server sends an `X-Up-Location` header.\n    \n    @property up.Response#url\n    @param {string} url\n    @stable\n     */\n\n\n    /***\n    The response body as a `string`.\n    \n    @property up.Response#text\n    @param {string} text\n    @stable\n     */\n\n\n    /***\n    The response's\n    [HTTP status code](https://en.wikipedia.org/wiki/List_of_HTTP_status_codes)\n    as a `number`.\n    \n    A successful response will usually have a `200` or `201' status code.\n    \n    @property up.Response#status\n    @param {number} status\n    @stable\n     */\n\n\n    /***\n    The original [request](/up.Request) that triggered this response.\n    \n    @property up.Response#request\n    @param {up.Request} request\n    @experimental\n     */\n\n\n    /***\n    The [`XMLHttpRequest`](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest)\n    object that was used to create this response.\n    \n    @property up.Response#xhr\n    @param {XMLHttpRequest} xhr\n    @experimental\n     */\n\n\n    /***\n    A [document title pushed by the server](/X-Up-Title).\n    \n    If the server pushed no title via HTTP header, this will be `undefined`.\n    \n    @property up.Response#title\n    @param {string} [title]\n    @experimental\n     */\n\n\n    /***\n    A [render target pushed by the server](/X-Up-Target).\n    \n    If the server pushed no title via HTTP header, this will be `undefined`.\n    \n    @property up.Response#target\n    @param {string} [target]\n    @experimental\n     */\n\n\n    /***\n    Changes to the current [context](/context) as [set by the server](/X-Up-Context).\n    \n    @property up.Response#context\n    @experimental\n     */\n\n    Response.prototype.keys = function() {\n      return ['method', 'url', 'text', 'status', 'request', 'xhr', 'target', 'title', 'acceptLayer', 'dismissLayer', 'eventPlans', 'context', 'clearCache', 'headers'];\n    };\n\n    Response.prototype.defaults = function() {\n      return {\n        headers: {}\n      };\n    };\n\n\n    /***\n    Returns whether the server responded with a 2xx HTTP status.\n    \n    @property up.Response#ok\n    @param {boolean} ok\n    @stable\n     */\n\n    Response.getter('ok', function() {\n      return this.status && (this.status >= 200 && this.status <= 299);\n    });\n\n\n    /***\n    Returns the HTTP header value with the given name.\n    \n    The search for the header name is case-insensitive.\n    \n    Returns `undefined` if the given header name was not included in the response.\n    \n    @function up.Response#getHeader\n    @param {string} name\n    @return {string|undefined} value\n    @experimental\n     */\n\n    Response.prototype.getHeader = function(name) {\n      var ref;\n      return this.headers[name] || ((ref = this.xhr) != null ? ref.getResponseHeader(name) : void 0);\n    };\n\n\n    /***\n    The response's [content-type](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type).\n    \n    @property up.Response#contentType\n    @param {string} contentType\n    @experimental\n     */\n\n    Response.getter('contentType', function() {\n      return this.getHeader('Content-Type');\n    });\n\n\n    /***\n    The response body parsed as a JSON string.\n    \n    The parsed JSON object is cached with the response object,\n    so multiple accesses will call `JSON.parse()` only once.\n    \n    \\#\\#\\# Example\n    \n        response = await up.request('/profile.json')\n        console.log(\"User name is \" + response.json.name)\n    \n    @property up.Response#json\n    @param {Object} json\n    @stable\n     */\n\n    Response.getter('json', function() {\n      return this.parsedJSON || (this.parsedJSON = JSON.parse(this.text));\n    });\n\n    return Response;\n\n  })(up.Record);\n\n}).call(this);\n(function() {\n  var e, u;\n\n  u = up.util;\n\n  e = up.element;\n\n  up.ResponseDoc = (function() {\n    function ResponseDoc(options) {\n      this.noscriptWrapper = new up.HTMLWrapper('noscript');\n      this.scriptWrapper = new up.HTMLWrapper('script');\n      this.root = this.parseDocument(options) || this.parseFragment(options) || this.parseContent(options);\n    }\n\n    ResponseDoc.prototype.parseDocument = function(options) {\n      return this.parse(options.document, e.createDocumentFromHTML);\n    };\n\n    ResponseDoc.prototype.parseContent = function(options) {\n      var content, matchingElement, target;\n      content = options.content || '';\n      target = options.target || up.fail(\"must pass a { target } when passing { content }\");\n      matchingElement = e.createFromSelector(target);\n      if (u.isString(content)) {\n        content = this.wrapHTML(content);\n        matchingElement.innerHTML = content;\n      } else {\n        matchingElement.appendChild(content);\n      }\n      return matchingElement;\n    };\n\n    ResponseDoc.prototype.parseFragment = function(options) {\n      return this.parse(options.fragment);\n    };\n\n    ResponseDoc.prototype.parse = function(value, parseFn) {\n      if (parseFn == null) {\n        parseFn = e.createFromHTML;\n      }\n      if (u.isString(value)) {\n        value = this.wrapHTML(value);\n        value = parseFn(value);\n      }\n      return value;\n    };\n\n    ResponseDoc.prototype.rootSelector = function() {\n      return up.fragment.toTarget(this.root);\n    };\n\n    ResponseDoc.prototype.wrapHTML = function(html) {\n      html = this.noscriptWrapper.wrap(html);\n      if (up.fragment.config.runScripts) {\n        html = this.scriptWrapper.wrap(html);\n      } else {\n        html = this.scriptWrapper.strip(html);\n      }\n      return html;\n    };\n\n    ResponseDoc.prototype.getTitle = function() {\n      var ref;\n      if (!this.titleParsed) {\n        this.title = (ref = this.root.querySelector(\"head title\")) != null ? ref.textContent : void 0;\n        this.titleParsed = true;\n      }\n      return this.title;\n    };\n\n    ResponseDoc.prototype.select = function(selector) {\n      return up.fragment.subtree(this.root, selector, {\n        layer: 'any'\n      })[0];\n    };\n\n    ResponseDoc.prototype.finalizeElement = function(element) {\n      this.noscriptWrapper.unwrap(element);\n      return this.scriptWrapper.unwrap(element);\n    };\n\n    return ResponseDoc;\n\n  })();\n\n}).call(this);\n(function() {\n  var e, u;\n\n  e = up.element;\n\n  u = up.util;\n\n  up.RevealMotion = (function() {\n    function RevealMotion(element, options) {\n      var ref, ref1, ref2, ref3, ref4, ref5, ref6, ref7, viewportConfig;\n      this.element = element;\n      this.options = options != null ? options : {};\n      viewportConfig = up.viewport.config;\n      this.viewport = e.get(this.options.viewport) || up.viewport.get(this.element);\n      this.obstructionsLayer = up.layer.get(this.viewport);\n      this.snap = (ref = (ref1 = this.options.snap) != null ? ref1 : this.options.revealSnap) != null ? ref : viewportConfig.revealSnap;\n      this.padding = (ref2 = (ref3 = this.options.padding) != null ? ref3 : this.options.revealPadding) != null ? ref2 : viewportConfig.revealPadding;\n      this.top = (ref4 = (ref5 = this.options.top) != null ? ref5 : this.options.revealTop) != null ? ref4 : viewportConfig.revealTop;\n      this.max = (ref6 = (ref7 = this.options.max) != null ? ref7 : this.options.revealMax) != null ? ref6 : viewportConfig.revealMax;\n      this.topObstructions = viewportConfig.fixedTop;\n      this.bottomObstructions = viewportConfig.fixedBottom;\n    }\n\n    RevealMotion.prototype.start = function() {\n      var diff, elementRect, maxPixels, newScrollTop, originalScrollTop, viewportRect;\n      viewportRect = this.getViewportRect(this.viewport);\n      elementRect = up.Rect.fromElement(this.element);\n      if (this.max) {\n        maxPixels = u.evalOption(this.max, this.element);\n        elementRect.height = Math.min(elementRect.height, maxPixels);\n      }\n      this.addPadding(elementRect);\n      this.substractObstructions(viewportRect);\n      if (viewportRect.height < 0) {\n        return up.error.failed.async('Viewport has no visible area');\n      }\n      originalScrollTop = this.viewport.scrollTop;\n      newScrollTop = originalScrollTop;\n      if (this.top || elementRect.height > viewportRect.height) {\n        diff = elementRect.top - viewportRect.top;\n        newScrollTop += diff;\n      } else if (elementRect.top < viewportRect.top) {\n        newScrollTop -= viewportRect.top - elementRect.top;\n      } else if (elementRect.bottom > viewportRect.bottom) {\n        newScrollTop += elementRect.bottom - viewportRect.bottom;\n      } else {\n\n      }\n      if (u.isNumber(this.snap) && newScrollTop < this.snap && elementRect.top < (0.5 * viewportRect.height)) {\n        newScrollTop = 0;\n      }\n      if (newScrollTop !== originalScrollTop) {\n        return this.scrollTo(newScrollTop);\n      } else {\n        return Promise.resolve();\n      }\n    };\n\n    RevealMotion.prototype.scrollTo = function(newScrollTop) {\n      this.scrollMotion = new up.ScrollMotion(this.viewport, newScrollTop, this.options);\n      return this.scrollMotion.start();\n    };\n\n    RevealMotion.prototype.getViewportRect = function() {\n      if (up.viewport.isRoot(this.viewport)) {\n        return new up.Rect({\n          left: 0,\n          top: 0,\n          width: up.viewport.rootWidth(),\n          height: up.viewport.rootHeight()\n        });\n      } else {\n        return up.Rect.fromElement(this.viewport);\n      }\n    };\n\n    RevealMotion.prototype.addPadding = function(elementRect) {\n      elementRect.top -= this.padding;\n      return elementRect.height += 2 * this.padding;\n    };\n\n    RevealMotion.prototype.selectObstructions = function(selectors) {\n      return up.fragment.all(selectors.join(','), {\n        layer: this.obstructionsLayer\n      });\n    };\n\n    RevealMotion.prototype.substractObstructions = function(viewportRect) {\n      var diff, i, j, len, len1, obstruction, obstructionRect, ref, ref1, results;\n      ref = this.selectObstructions(this.topObstructions);\n      for (i = 0, len = ref.length; i < len; i++) {\n        obstruction = ref[i];\n        obstructionRect = up.Rect.fromElement(obstruction);\n        diff = obstructionRect.bottom - viewportRect.top;\n        if (diff > 0) {\n          viewportRect.top += diff;\n          viewportRect.height -= diff;\n        }\n      }\n      ref1 = this.selectObstructions(this.bottomObstructions);\n      results = [];\n      for (j = 0, len1 = ref1.length; j < len1; j++) {\n        obstruction = ref1[j];\n        obstructionRect = up.Rect.fromElement(obstruction);\n        diff = viewportRect.bottom - obstructionRect.top;\n        if (diff > 0) {\n          results.push(viewportRect.height -= diff);\n        } else {\n          results.push(void 0);\n        }\n      }\n      return results;\n    };\n\n    RevealMotion.prototype.finish = function() {\n      var ref;\n      return (ref = this.scrollMotion) != null ? ref.finish() : void 0;\n    };\n\n    return RevealMotion;\n\n  })();\n\n}).call(this);\n(function() {\n  var u,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  u = up.util;\n\n  up.ScrollMotion = (function() {\n    var SPEED_CALIBRATION;\n\n    SPEED_CALIBRATION = 0.065;\n\n    function ScrollMotion(scrollable, targetTop, options) {\n      var ref, ref1, ref2, ref3;\n      this.scrollable = scrollable;\n      this.targetTop = targetTop;\n      if (options == null) {\n        options = {};\n      }\n      this.abort = bind(this.abort, this);\n      this.behavior = (ref = (ref1 = options.behavior) != null ? ref1 : options.scrollBehavior) != null ? ref : 'auto';\n      this.speed = ((ref2 = (ref3 = options.speed) != null ? ref3 : options.scrollSpeed) != null ? ref2 : up.viewport.config.scrollSpeed) * SPEED_CALIBRATION;\n    }\n\n    ScrollMotion.prototype.start = function() {\n      return new Promise((function(_this) {\n        return function(resolve, reject) {\n          _this.resolve = resolve;\n          _this.reject = reject;\n          if (_this.behavior === 'smooth' && up.motion.isEnabled()) {\n            return _this.startAnimation();\n          } else {\n            return _this.finish();\n          }\n        };\n      })(this));\n    };\n\n    ScrollMotion.prototype.startAnimation = function() {\n      this.startTime = Date.now();\n      this.startTop = this.scrollable.scrollTop;\n      this.topDiff = this.targetTop - this.startTop;\n      this.duration = Math.sqrt(Math.abs(this.topDiff)) / this.speed;\n      return requestAnimationFrame((function(_this) {\n        return function() {\n          return _this.animationFrame();\n        };\n      })(this));\n    };\n\n    ScrollMotion.prototype.animationFrame = function() {\n      var currentTime, timeElapsed, timeFraction;\n      if (this.settled) {\n        return;\n      }\n      if (this.frameTop && Math.abs(this.frameTop - this.scrollable.scrollTop) > 1.5) {\n        this.abort('Animation aborted due to user intervention');\n      }\n      currentTime = Date.now();\n      timeElapsed = currentTime - this.startTime;\n      timeFraction = Math.min(timeElapsed / this.duration, 1);\n      this.frameTop = this.startTop + (u.simpleEase(timeFraction) * this.topDiff);\n      if (Math.abs(this.targetTop - this.frameTop) < 0.3) {\n        return this.finish();\n      } else {\n        this.scrollable.scrollTop = this.frameTop;\n        return requestAnimationFrame((function(_this) {\n          return function() {\n            return _this.animationFrame();\n          };\n        })(this));\n      }\n    };\n\n    ScrollMotion.prototype.abort = function(reason) {\n      this.settled = true;\n      return this.reject(up.error.aborted(reason));\n    };\n\n    ScrollMotion.prototype.finish = function() {\n      this.settled = true;\n      this.scrollable.scrollTop = this.targetTop;\n      return this.resolve();\n    };\n\n    return ScrollMotion;\n\n  })();\n\n}).call(this);\n(function() {\n  var e, u;\n\n  e = up.element;\n\n  u = up.util;\n\n  up.Selector = (function() {\n    function Selector(selectors, filters) {\n      this.selectors = selectors;\n      this.filters = filters != null ? filters : [];\n      this.unionSelector = this.selectors.join(',') || 'match-none';\n    }\n\n    Selector.prototype.matches = function(element) {\n      return e.matches(element, this.unionSelector) && this.passesFilter(element);\n    };\n\n    Selector.prototype.closest = function(element) {\n      var parentElement;\n      if (this.matches(element)) {\n        return element;\n      } else if ((parentElement = element.parentElement)) {\n        return this.closest(parentElement);\n      }\n    };\n\n    Selector.prototype.passesFilter = function(element) {\n      return u.every(this.filters, function(filter) {\n        return filter(element);\n      });\n    };\n\n    Selector.prototype.descendants = function(root) {\n      var results;\n      results = u.flatMap(this.selectors, function(selector) {\n        return e.all(root, selector);\n      });\n      return u.filter(results, (function(_this) {\n        return function(element) {\n          return _this.passesFilter(element);\n        };\n      })(this));\n    };\n\n    Selector.prototype.subtree = function(root) {\n      var results;\n      results = [];\n      if (this.matches(root)) {\n        results.push(root);\n      }\n      results.push.apply(results, this.descendants(root));\n      return results;\n    };\n\n    return Selector;\n\n  })();\n\n}).call(this);\n(function() {\n  var u;\n\n  up.store || (up.store = {});\n\n  u = up.util;\n\n  up.store.Memory = (function() {\n    function Memory() {\n      this.clear();\n    }\n\n    Memory.prototype.clear = function() {\n      return this.data = {};\n    };\n\n    Memory.prototype.get = function(key) {\n      return this.data[key];\n    };\n\n    Memory.prototype.set = function(key, value) {\n      return this.data[key] = value;\n    };\n\n    Memory.prototype.remove = function(key) {\n      return delete this.data[key];\n    };\n\n    Memory.prototype.keys = function() {\n      return Object.keys(this.data);\n    };\n\n    Memory.prototype.size = function() {\n      return this.keys().length;\n    };\n\n    Memory.prototype.values = function() {\n      return u.values(this.data);\n    };\n\n    return Memory;\n\n  })();\n\n}).call(this);\n(function() {\n  var u,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  u = up.util;\n\n  up.store.Session = (function(superClass) {\n    extend(Session, superClass);\n\n    function Session(rootKey) {\n      this.remove = bind(this.remove, this);\n      this.set = bind(this.set, this);\n      this.rootKey = rootKey;\n      this.loadFromSessionStorage();\n    }\n\n    Session.prototype.clear = function() {\n      Session.__super__.clear.call(this);\n      return this.saveToSessionStorage();\n    };\n\n    Session.prototype.set = function(key, value) {\n      Session.__super__.set.call(this, key, value);\n      return this.saveToSessionStorage();\n    };\n\n    Session.prototype.remove = function(key) {\n      Session.__super__.remove.call(this, key);\n      return this.saveToSessionStorage();\n    };\n\n    Session.prototype.loadFromSessionStorage = function() {\n      var raw;\n      try {\n        if (raw = typeof sessionStorage !== \"undefined\" && sessionStorage !== null ? sessionStorage.getItem(this.rootKey) : void 0) {\n          this.data = JSON.parse(raw);\n        }\n      } catch (error) {\n\n      }\n      return this.data || (this.data = {});\n    };\n\n    Session.prototype.saveToSessionStorage = function() {\n      var json;\n      json = JSON.stringify(this.data);\n      try {\n        return typeof sessionStorage !== \"undefined\" && sessionStorage !== null ? sessionStorage.setItem(this.rootKey, json) : void 0;\n      } catch (error) {\n\n      }\n    };\n\n    return Session;\n\n  })(up.store.Memory);\n\n}).call(this);\n(function() {\n  var e, u,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  u = up.util;\n\n  e = up.element;\n\n  up.Tether = (function() {\n    function Tether(options) {\n      this.sync = bind(this.sync, this);\n      this.scheduleSync = bind(this.scheduleSync, this);\n      var base;\n      if (typeof (base = up.migrate).handleTetherOptions === \"function\") {\n        base.handleTetherOptions(options);\n      }\n      this.anchor = options.anchor;\n      this.align = options.align;\n      this.position = options.position;\n      this.alignAxis = this.position === 'top' || this.position === 'bottom' ? 'horizontal' : 'vertical';\n      this.viewport = up.viewport.get(this.anchor);\n      this.parent = this.viewport === e.root ? document.body : this.viewport;\n      this.syncOnScroll = !this.viewport.contains(this.anchor.offsetParent);\n    }\n\n    Tether.prototype.start = function(element) {\n      this.element = element;\n      this.element.style.position = 'absolute';\n      this.setOffset(0, 0);\n      this.sync();\n      return this.changeEventSubscription('on');\n    };\n\n    Tether.prototype.stop = function() {\n      return this.changeEventSubscription('off');\n    };\n\n    Tether.prototype.changeEventSubscription = function(fn) {\n      up[fn](window, 'resize', this.scheduleSync);\n      if (this.syncOnScroll) {\n        return up[fn](this.viewport, 'scroll', this.scheduleSync);\n      }\n    };\n\n    Tether.prototype.scheduleSync = function() {\n      clearTimeout(this.syncTimer);\n      return this.syncTimer = u.task(this.sync);\n    };\n\n    Tether.prototype.isDetached = function() {\n      return e.isDetached(this.parent) || e.isDetached(this.anchor);\n    };\n\n    Tether.prototype.sync = function() {\n      var anchorBox, elementBox, left, top;\n      elementBox = this.element.getBoundingClientRect();\n      anchorBox = this.anchor.getBoundingClientRect();\n      left = void 0;\n      top = void 0;\n      switch (this.alignAxis) {\n        case 'horizontal':\n          top = (function() {\n            switch (this.position) {\n              case 'top':\n                return anchorBox.top - elementBox.height;\n              case 'bottom':\n                return anchorBox.top + anchorBox.height;\n            }\n          }).call(this);\n          left = (function() {\n            switch (this.align) {\n              case 'left':\n                return anchorBox.left;\n              case 'center':\n                return anchorBox.left + 0.5 * (anchorBox.width - elementBox.width);\n              case 'right':\n                return anchorBox.left + anchorBox.width - elementBox.width;\n            }\n          }).call(this);\n          break;\n        case 'vertical':\n          top = (function() {\n            switch (this.align) {\n              case 'top':\n                return anchorBox.top;\n              case 'center':\n                return anchorBox.top + 0.5 * (anchorBox.height - elementBox.height);\n              case 'bottom':\n                return anchorBox.top + anchorBox.height - elementBox.height;\n            }\n          }).call(this);\n          left = (function() {\n            switch (this.position) {\n              case 'left':\n                return anchorBox.left - elementBox.width;\n              case 'right':\n                return anchorBox.left + anchorBox.width;\n            }\n          }).call(this);\n      }\n      if (u.isDefined(left) || u.isDefined(top)) {\n        return this.moveTo(left, top);\n      } else {\n        return up.fail('Invalid tether constraints: %o', this.describeConstraints());\n      }\n    };\n\n    Tether.prototype.describeConstraints = function() {\n      return {\n        position: this.position,\n        align: this.align\n      };\n    };\n\n    Tether.prototype.moveTo = function(targetLeft, targetTop) {\n      var elementBox;\n      elementBox = this.element.getBoundingClientRect();\n      return this.setOffset(targetLeft - elementBox.left + this.offsetLeft, targetTop - elementBox.top + this.offsetTop);\n    };\n\n    Tether.prototype.setOffset = function(left, top) {\n      this.offsetLeft = left;\n      this.offsetTop = top;\n      return e.setStyle(this.element, {\n        left: left,\n        top: top\n      });\n    };\n\n    return Tether;\n\n  })();\n\n}).call(this);\n(function() {\n  var u;\n\n  u = up.util;\n\n  up.URLPattern = (function() {\n    function URLPattern(fullPattern, normalizeURL) {\n      var negativeList, positiveList;\n      this.normalizeURL = normalizeURL != null ? normalizeURL : u.normalizeURL;\n      this.groups = [];\n      positiveList = [];\n      negativeList = [];\n      u.splitValues(fullPattern).forEach(function(pattern) {\n        if (pattern[0] === '-') {\n          return negativeList.push(pattern.substring(1));\n        } else {\n          return positiveList.push(pattern);\n        }\n      });\n      this.positiveRegexp = this.buildRegexp(positiveList, true);\n      this.negativeRegexp = this.buildRegexp(negativeList, false);\n    }\n\n    URLPattern.prototype.buildRegexp = function(list, capture) {\n      var reCode;\n      if (!list.length) {\n        return;\n      }\n      reCode = list.map(this.normalizeURL).map(u.escapeRegExp).join('|');\n      reCode = reCode.replace(/\\\\\\*/g, '.*?');\n      reCode = reCode.replace(/(\\:|\\\\\\$)([a-z][\\w-]*)/ig, (function(_this) {\n        return function(match, type, name) {\n          if (type === '\\\\$') {\n            if (capture) {\n              _this.groups.push({\n                name: name,\n                cast: Number\n              });\n            }\n            return '(\\\\d+)';\n          } else {\n            if (capture) {\n              _this.groups.push({\n                name: name,\n                cast: String\n              });\n            }\n            return '([^/?#]+)';\n          }\n        };\n      })(this));\n      return new RegExp('^' + reCode + '$');\n    };\n\n    URLPattern.prototype.test = function(url, doNormalize) {\n      if (doNormalize == null) {\n        doNormalize = true;\n      }\n      if (doNormalize) {\n        url = this.normalizeURL(url);\n      }\n      return this.positiveRegexp.test(url) && !this.isExcluded(url);\n    };\n\n    URLPattern.prototype.recognize = function(url, doNormalize) {\n      var match, resolution;\n      if (doNormalize == null) {\n        doNormalize = true;\n      }\n      if (doNormalize) {\n        url = this.normalizeURL(url);\n      }\n      if ((match = this.positiveRegexp.exec(url)) && !this.isExcluded(url)) {\n        resolution = {};\n        this.groups.forEach((function(_this) {\n          return function(group, groupIndex) {\n            var value;\n            if (value = match[groupIndex + 1]) {\n              return resolution[group.name] = group.cast(value);\n            }\n          };\n        })(this));\n        return resolution;\n      }\n    };\n\n    URLPattern.prototype.isExcluded = function(url) {\n      var ref;\n      return (ref = this.negativeRegexp) != null ? ref.test(url) : void 0;\n    };\n\n    return URLPattern;\n\n  })();\n\n}).call(this);\n\n/***\n@module up.framework\n */\n\n(function() {\n  up.framework = (function() {\n    var boot, booting, emitReset, startExtension, stopExtension, u;\n    u = up.util;\n    booting = true;\n\n    /***\n    Resets Unpoly to the state when it was booted.\n    All custom event handlers, animations, etc. that have been registered\n    will be discarded.\n    \n    Emits event [`up:framework:reset`](/up:framework:reset).\n    \n    @function up.framework.reset\n    @internal\n     */\n    emitReset = function() {\n      return up.emit('up:framework:reset', {\n        log: false\n      });\n    };\n\n    /***\n    This event is [emitted](/up.emit) when Unpoly is [reset](/up.framework.reset) during unit tests.\n    \n    @event up:framework:reset\n    @internal\n     */\n\n    /***\n    Boots the Unpoly framework.\n    \n    **This is called automatically** by including the Unpoly JavaScript files.\n    \n    Unpoly will not boot if the current browser is [not supported](/up.browser.isSupported).\n    This leaves you with a classic server-side application on legacy browsers.\n    \n    @function up.boot\n    @internal\n     */\n    boot = function() {\n      if (up.browser.isSupported()) {\n        up.emit('up:framework:boot', {\n          log: false\n        });\n        booting = false;\n        return up.event.onReady(function() {\n          return up.emit('up:app:boot', {\n            log: 'Booting user application'\n          });\n        });\n      } else {\n        return typeof console.log === \"function\" ? console.log(\"Unpoly doesn't support this browser. Framework was not booted.\") : void 0;\n      }\n    };\n    startExtension = function() {\n      return booting = true;\n    };\n    stopExtension = function() {\n      return booting = false;\n    };\n    return u.literal({\n      boot: boot,\n      startExtension: startExtension,\n      stopExtension: stopExtension,\n      reset: emitReset,\n      get_booting: function() {\n        return booting;\n      }\n    });\n  })();\n\n}).call(this);\n\n/***\nEvents\n======\n\nThis module contains functions to [emit](/up.emit) and [observe](/up.on) DOM events.\n\nWhile the browser also has built-in functions to work with events,\nyou will find Unpoly's functions to be very concise and feature-rich.\n\n## Events emitted by Unpoly\n\nMost Unpoly features emit events that are prefixed with `up:`.\n\nUnpoly's own events are documented in their respective modules, for example:\n\n| Event                 | Module             |\n|-----------------------|--------------------|\n| `up:link:follow`      | `up.link`          |\n| `up:form:submit`      | `up.form`          |\n| `up:layer:open`       | `up.layer`         |\n| `up:request:late`     | `up.network`       |\n\n@see up.on\n@see up.emit\n\n@module up.event\n */\n\n(function() {\n  var slice = [].slice;\n\n  up.event = (function() {\n    var $bind, assertEmitted, bind, bindNow, build, buildEmitter, e, emit, executeEmitAttr, fork, halt, isUnmodified, keyModifiers, onEscape, onReady, reset, u, unbind, wasEscapePressed;\n    u = up.util;\n    e = up.element;\n    reset = function() {\n      var element, i, len, ref, results;\n      ref = [window, document, e.root, document.body];\n      results = [];\n      for (i = 0, len = ref.length; i < len; i++) {\n        element = ref[i];\n        results.push(up.EventListener.unbindNonDefault(element));\n      }\n      return results;\n    };\n\n    /***\n    Listens to a [DOM event](https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model/Events)\n    on `document` or a given element.\n    \n    `up.on()` has some quality of life improvements over\n    [`Element#addEventListener()`](https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener):\n    \n    - You may pass a selector for [event delegation](https://davidwalsh.name/event-delegate).\n    - The event target is automatically passed as a second argument.\n    - You may register a listener to multiple events by passing a space-separated list of event name (e.g. `\"click mousedown\"`)\n    - You may register a listener to multiple elements in a single `up.on()` call, by passing a [list](/up.util.isList) of elements.\n    - You use an [`[up-data]`](/up-data) attribute to [attach structured data](/up.on#attaching-structured-data)\n      to observed elements. If an `[up-data]` attribute is set, its value will automatically be\n      parsed as JSON and passed as a third argument.\n    \n    \\#\\#\\# Basic example\n    \n    The code below will call the listener when a `<a>` is clicked\n    anywhere in the `document`:\n    \n        up.on('click', 'a', function(event, element) {\n          console.log(\"Click on a link %o\", element)\n        })\n    \n    You may also bind the listener to a given element instead of `document`:\n    \n        var form = document.querySelector('form')\n        up.on(form, 'click', function(event, form) {\n          console.log(\"Click within %o\", form)\n        })\n    \n    \\#\\#\\# Event delegation\n    \n    You may pass both an element and a selector\n    for [event delegation](https://davidwalsh.name/event-delegate).\n    \n    The example below registers a single event listener to the given `form`,\n    but only calls the listener when the clicked element is a `select` element:\n    \n        var form = document.querySelector('form')\n        up.on(form, 'click', 'select', function(event, select) {\n          console.log(\"Click on select %o within %o\", select, form)\n        })\n    \n    \\#\\#\\# Attaching structured data\n    \n    In case you want to attach structured data to the event you're observing,\n    you can serialize the data to JSON and put it into an `[up-data]` attribute:\n    \n        <span class='person' up-data='{ \"age\": 18, \"name\": \"Bob\" }'>Bob</span>\n        <span class='person' up-data='{ \"age\": 22, \"name\": \"Jim\" }'>Jim</span>\n    \n    The JSON will be parsed and handed to your event handler as a third argument:\n    \n        up.on('click', '.person', function(event, element, data) {\n          console.log(\"This is %o who is %o years old\", data.name, data.age)\n        })\n    \n    \\#\\#\\# Unbinding an event listener\n    \n    `up.on()` returns a function that unbinds the event listeners when called:\n    \n        // Define the listener\n        var listener =  function(event) { ... }\n    \n        // Binding the listener returns an unbind function\n        var unbind = up.on('click', listener)\n    \n        // Unbind the listener\n        unbind()\n    \n    There is also a function [`up.off()`](/up.off) which you can use for the same purpose:\n    \n        // Define the listener\n        var listener =  function(event) { ... }\n    \n        // Bind the listener\n        up.on('click', listener)\n    \n        // Unbind the listener\n        up.off('click', listener)\n    \n    \\#\\#\\# Binding to multiple elements\n    \n    You may register a listener to multiple elements in a single `up.on()` call, by passing a [list](/up.util.isList) of elements:\n    \n    ```javascript\n    let allForms = document.querySelectorAll('form')\n    up.on(allForms, 'submit', function(event, form) {\n      console.log('Submitting form %o', form)\n    })\n    ```\n    \n    \\#\\#\\# Binding to multiple event types\n    \n    You may register a listener to multiple event types by passing a space-separated list of event types:\n    \n    ```javascript\n    let element = document.querySelector(...)\n    up.on(element, 'mouseenter mouseleave', function(event) {\n      console.log('Mouse entered or left')\n    })\n    ```\n    \n    @function up.on\n    \n    @param {Element|jQuery} [element=document]\n      The element on which to register the event listener.\n    \n      If no element is given, the listener is registered on the `document`.\n    \n    @param {string|Array<string>} types\n      The event types to bind to.\n    \n      Multiple event types may be passed as either a space-separated string\n      or as an array of types.\n    \n    @param {string|Function():string} [selector]\n      The selector of an element on which the event must be triggered.\n    \n      Omit the selector to listen to all events of the given type, regardless\n      of the event target.\n    \n      If the selector is not known in advance you may also pass a function\n      that returns the selector. The function is evaluated every time\n      an event with the given type is observed.\n    \n    @param {boolean} [options.passive=false]\n      Whether to register a [passive event listener](https://developers.google.com/web/updates/2016/06/passive-event-listeners).\n    \n      A passive event listener may not call `event.preventDefault()`.\n      This in particular may improve the frame rate when registering\n      `touchstart` and `touchmove` events.\n    \n    @param {boolean} [options.once=true]\n      Whether the listener should run at most once.\n    \n      If `true` the listener will automatically be unbound\n      after the first invocation.\n    \n    @param {Function(event, [element], [data])} listener\n      The listener function that should be called.\n    \n      The function takes the affected element as a second argument.\n      If the element has an [`up-data`](/up-data) attribute, its value is parsed as JSON\n      and passed as a third argument.\n    \n    @return {Function()}\n      A function that unbinds the event listeners when called.\n    \n    @stable\n     */\n    bind = function() {\n      var args;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      return bindNow(args);\n    };\n\n    /***\n    Listens to an event on `document` or a given element.\n    The event handler is called with the event target as a\n    [jQuery collection](https://learn.jquery.com/using-jquery-core/jquery-object/).\n    \n    If you're not using jQuery, use `up.on()` instead, which calls\n    event handlers with a native element.\n    \n    \\#\\#\\# Example\n    \n    ```\n    up.$on('click', 'a', function(event, $link) {\n      console.log(\"Click on a link with destination %s\", $element.attr('href'))\n    })\n    ```\n    \n    @function up.$on\n    @param {Element|jQuery} [element=document]\n      The element on which to register the event listener.\n    \n      If no element is given, the listener is registered on the `document`.\n    @param {string} events\n      A space-separated list of event names to bind to.\n    @param {string} [selector]\n      The selector of an element on which the event must be triggered.\n      Omit the selector to listen to all events with that name, regardless\n      of the event target.\n    @param {boolean} [options.passive=false]\n      Whether to register a [passive event listener](https://developers.google.com/web/updates/2016/06/passive-event-listeners).\n    \n      A passive event listener may not call `event.preventDefault()`.\n      This in particular may improve the frame rate when registering\n      `touchstart` and `touchmove` events.\n    @param {Function(event, [element], [data])} listener\n      The listener function that should be called.\n    \n      The function takes the affected element as the first argument).\n      If the element has an [`up-data`](/up-data) attribute, its value is parsed as JSON\n      and passed as a second argument.\n    @return {Function()}\n      A function that unbinds the event listeners when called.\n    @stable\n     */\n    $bind = function() {\n      var args;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      return bindNow(args, {\n        jQuery: true\n      });\n    };\n    bindNow = function(args, options) {\n      return up.EventListenerGroup.fromBindArgs(args, options).bind();\n    };\n\n    /***\n    Unbinds an event listener previously bound with `up.on()`.\n    \n    \\#\\#\\# Example\n    \n    Let's say you are listing to clicks on `.button` elements:\n    \n        var listener = function() { ... }\n        up.on('click', '.button', listener)\n    \n    You can stop listening to these events like this:\n    \n        up.off('click', '.button', listener)\n    \n    @function up.off\n    @param {Element|jQuery} [element=document]\n    @param {string|Function(): string} events\n    @param {string} [selector]\n    @param {Function(event, [element], [data])} listener\n      The listener function to unbind.\n    \n      Note that you must pass a reference to the same function reference\n      that was passed to `up.on()` earlier.\n    @stable\n     */\n    unbind = function() {\n      var args;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      return up.EventListenerGroup.fromBindArgs(args).unbind();\n    };\n    buildEmitter = function(args) {\n      return up.EventEmitter.fromEmitArgs(args);\n    };\n\n    /***\n    Emits a event with the given name and properties.\n    \n    The event will be triggered as an event on `document` or on the given element.\n    \n    Other code can subscribe to events with that name using\n    [`Element#addEventListener()`](https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener)\n    or [`up.on()`](/up.on).\n    \n    \\#\\#\\# Example\n    \n        up.on('my:event', function(event) {\n          console.log(event.foo)\n        })\n    \n        up.emit('my:event', { foo: 'bar' })\n        // Prints \"bar\" to the console\n    \n    @function up.emit\n    @param {Element|jQuery} [target=document]\n      The element on which the event is triggered.\n    \n      If omitted, the event will be emitted on the `document`.\n    @param {string} eventType\n      The event type, e.g. `my:event`.\n    @param {Object} [props={}]\n      A list of properties to become part of the event object that will be passed to listeners.\n    @param {up.Layer|string|number} [props.layer]\n      The [layer](/up.layer) on which to emit this event.\n    \n      If this property is set, the event will be emitted on the [layer's outmost element](/up.Layer.prototype.element).\n      Also [up.layer.current](/up.layer.current) will be set to the given layer while event listeners\n      are running.\n    @param {string|Array} [props.log]\n      A message to print to the [log](/up.log) when the event is emitted.\n    \n      Pass `false` to not log this event emission.\n    @param {Element|jQuery} [props.target=document]\n      The element on which the event is triggered.\n    \n      Alternatively the target element may be passed as the first argument.\n    @stable\n     */\n    emit = function() {\n      var args;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      return buildEmitter(args).emit();\n    };\n\n    /***\n    Builds an event with the given type and properties.\n    \n    The returned event is not [emitted](/up.emit).\n    \n    \\#\\#\\# Example\n    \n        let event = up.event.build('my:event', { foo: 'bar' })\n        console.log(event.type)              // logs \"my:event\"\n        console.log(event.foo)               // logs \"bar\"\n        console.log(event.defaultPrevented)  // logs \"false\"\n        up.emit(event)                       // emits the event\n    \n    @function up.event.build\n    @param {string} [type]\n      The event type.\n    \n      May also be passed as a property `{ type }`.\n    @param {Object} [props={}]\n      An object with event properties.\n    @param {string} [props.type]\n      The event type.\n    \n      May also be passed as a first string argument.\n    @return {Event}\n    @experimental\n     */\n    build = function() {\n      var args, event, originalPreventDefault, props, type;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      props = u.extractOptions(args);\n      type = args[0] || props.type || up.fail('Expected event type to be passed as string argument or { type } property');\n      event = document.createEvent('Event');\n      event.initEvent(type, true, true);\n      u.assign(event, u.omit(props, ['type', 'target']));\n      if (up.browser.isIE11()) {\n        originalPreventDefault = event.preventDefault;\n        event.preventDefault = function() {\n          originalPreventDefault.call(event);\n          return u.getter(event, 'defaultPrevented', function() {\n            return true;\n          });\n        };\n      }\n      return event;\n    };\n\n    /***\n    [Emits](/up.emit) the given event and throws an `AbortError` if it was prevented.\n    \n    @function up.event.assertEmitted\n    @param {string} eventType\n    @param {Object} eventProps\n    @param {string|Array} [eventProps.message]\n    @internal\n     */\n    assertEmitted = function() {\n      var args;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      return buildEmitter(args).assertEmitted();\n    };\n\n    /***\n    Registers an event listener to be called when the user\n    presses the `Escape` key.\n    \n    \\#\\#\\# Example\n    \n    ```javascript\n    up.event.onEscape(function(event) {\n      console.log('Escape pressed!')\n    })\n    ```\n    \n    @function up.event.onEscape\n    @param {Function(Event)} listener\n      The listener function that will be called when `Escape` is pressed.\n    @experimental\n     */\n    onEscape = function(listener) {\n      return bind('keydown', function(event) {\n        if (wasEscapePressed(event)) {\n          return listener(event);\n        }\n      });\n    };\n\n    /***\n    Returns whether the given keyboard event involved the ESC key.\n    \n    @function up.util.wasEscapePressed\n    @param {Event} event\n    @internal\n     */\n    wasEscapePressed = function(event) {\n      var key;\n      key = event.key;\n      return key === 'Escape' || key === 'Esc';\n    };\n\n    /***\n    Prevents the event from being processed further.\n    \n    In detail:\n    \n    - It prevents the event from bubbling up the DOM tree.\n    - It prevents other event handlers bound on the same element.\n    - It prevents the event's default action.\n    \n    \\#\\#\\# Example\n    \n        up.on('click', 'link.disabled', function(event) {\n          up.event.halt(event)\n        })\n    \n    @function up.event.halt\n    @param {Event} event\n    @stable\n     */\n    halt = function(event) {\n      event.stopImmediatePropagation();\n      return event.preventDefault();\n    };\n\n    /***\n    Runs the given callback when the the initial HTML document has been completely loaded.\n    \n    The callback is guaranteed to see the fully parsed DOM tree.\n    This function does not wait for stylesheets, images or frames to finish loading.\n    \n    If `up.event.onReady()` is called after the initial document was loaded,\n    the given callback is run immediately.\n    \n    @function up.event.onReady\n    @param {Function} callback\n      The function to call then the DOM tree is acessible.\n    @experimental\n     */\n    onReady = function(callback) {\n      if (document.readyState !== 'loading') {\n        return callback();\n      } else {\n        return document.addEventListener('DOMContentLoaded', callback);\n      }\n    };\n    keyModifiers = ['metaKey', 'shiftKey', 'ctrlKey', 'altKey'];\n\n    /***\n    @function up.event.isUnmodified\n    @internal\n     */\n    isUnmodified = function(event) {\n      return (u.isUndefined(event.button) || event.button === 0) && !u.some(keyModifiers, function(modifier) {\n        return event[modifier];\n      });\n    };\n    fork = function(originalEvent, newType, copyKeys) {\n      var newEvent;\n      if (copyKeys == null) {\n        copyKeys = [];\n      }\n      newEvent = up.event.build(newType, u.pick(originalEvent, copyKeys));\n      newEvent.originalEvent = originalEvent;\n      ['stopPropagation', 'stopImmediatePropagation', 'preventDefault'].forEach(function(key) {\n        var originalMethod;\n        originalMethod = newEvent[key];\n        return newEvent[key] = function() {\n          originalEvent[key]();\n          return originalMethod.call(newEvent);\n        };\n      });\n      if (originalEvent.defaultPrevented) {\n        newEvent.preventDefault();\n      }\n      return newEvent;\n    };\n\n    /***\n    Emits the given event when this link is clicked.\n    \n    When the emitted event's default' is prevented, the original `click` event's default is also prevented.\n    \n    You may use this attribute to emit events when clicking on areas that are no hyperlinks,\n    by setting it on an `<a>` element without a `[href]` attribute.\n    \n    \\#\\#\\# Example\n    \n    This hyperlink will emit an `user:select` event when clicked:\n    \n    ```html\n    <a href='/users/5'\n      up-emit='user:select'\n      up-emit-props='{ \"id\": 5, \"firstName\": \"Alice\" }'>\n      Alice\n    </a>\n    \n    <script>\n      up.on('a', 'user:select', function(event) {\n        console.log(event.firstName) // logs \"Alice\"\n        event.preventDefault()       // will prevent the link from being followed\n      })\n    </script>\n    ```\n    \n    @selector a[up-emit]\n    @param up-emit\n      The type of the event to be emitted.\n    @param [up-emit-props='{}']\n      The event properties, serialized as JSON.\n    @stable\n     */\n    executeEmitAttr = function(event, element) {\n      var eventProps, eventType, forkedEvent;\n      if (!isUnmodified(event)) {\n        return;\n      }\n      eventType = e.attr(element, 'up-emit');\n      eventProps = e.jsonAttr(element, 'up-emit-props');\n      forkedEvent = fork(event, eventType);\n      u.assign(forkedEvent, eventProps);\n      return up.emit(element, forkedEvent);\n    };\n    bind('up:click', 'a[up-emit]', executeEmitAttr);\n    bind('up:framework:reset', reset);\n    return {\n      on: bind,\n      $on: $bind,\n      off: unbind,\n      build: build,\n      emit: emit,\n      assertEmitted: assertEmitted,\n      onEscape: onEscape,\n      halt: halt,\n      onReady: onReady,\n      isUnmodified: isUnmodified,\n      fork: fork,\n      keyModifiers: keyModifiers\n    };\n  })();\n\n  up.on = up.event.on;\n\n  up.$on = up.event.$on;\n\n  up.off = up.event.off;\n\n  up.$off = up.event.off;\n\n  up.emit = up.event.emit;\n\n}).call(this);\n\n/***\nServer protocol\n===============\n\nYou rarely need to change server-side code to use Unpoly. You don't need\nto provide a JSON API, or add extra routes for AJAX requests. The server simply renders\na series of full HTML pages, like it would without Unpoly.\n\nThere is an **optional** protocol your server may use to exchange additional information\nwhen Unpoly is [updating fragments](/up.link). The protocol mostly works by adding\nadditional HTTP headers (like `X-Up-Target`) to requests and responses.\n\nWhile the protocol can help you optimize performance and handle some edge cases,\nimplementing it is **entirely optional**. For instance, `unpoly.com` itself is a static site\nthat uses Unpoly on the frontend and doesn't even have an active server component.\n\n## Existing implementations\n\nYou should be able to implement the protocol in a very short time.\n\nThere are existing implementations for various web frameworks:\n\n- [Ruby on Rails](/install/rails)\n- [Roda](https://github.com/adam12/roda-unpoly)\n- [Rack](https://github.com/adam12/rack-unpoly) (Sinatra, Padrino, Hanami, Cuba, ...)\n- [Phoenix](https://elixirforum.com/t/unpoly-a-framework-like-turbolinks/3614/15) (Elixir)\n- [PHP](https://github.com/webstronauts/php-unpoly) (Symfony, Laravel, Stack)\n\n@module up.protocol\n */\n\n(function() {\n  up.protocol = (function() {\n    var acceptLayerFromXHR, clearCacheFromXHR, config, contextFromXHR, csrfHeader, csrfParam, csrfToken, dismissLayerFromXHR, e, eventPlansFromXHR, extractHeader, headerize, initialRequestMethod, locationFromXHR, methodFromXHR, reset, targetFromXHR, titleFromXHR, u, wrapMethod;\n    u = up.util;\n    e = up.element;\n    headerize = function(camel) {\n      var header;\n      header = camel.replace(/(^.|[A-Z])/g, function(char) {\n        return '-' + char.toUpperCase();\n      });\n      return 'X-Up' + header;\n    };\n    extractHeader = function(xhr, shortHeader, parseFn) {\n      var value;\n      if (parseFn == null) {\n        parseFn = u.identity;\n      }\n      if (value = xhr.getResponseHeader(headerize(shortHeader))) {\n        return parseFn(value);\n      }\n    };\n\n    /***\n    This request header contains the current Unpoly version to mark this request as a fragment update.\n    \n    Server-side code may check for the presence of an `X-Up-Version` header to\n    distinguish [fragment updates](/up.link) from full page loads.\n    \n    The `X-Up-Version` header is guaranteed to be set for all [requests made through Unpoly](/up.request).\n    \n    \\#\\#\\# Example\n    \n    ```http\n    X-Up-Version: 1.0.0\n    ```\n    \n    @header X-Up-Version\n    @stable\n     */\n\n    /***\n    This request header contains the CSS selector targeted for a successful fragment update.\n    \n    Server-side code is free to optimize its response by only rendering HTML\n    that matches the selector. For example, you might prefer to not render an\n    expensive sidebar if the sidebar is not targeted.\n    \n    Unpoly will usually update a different selector in case the request fails.\n    This selector is sent as a second header, `X-Up-Fail-Target`.\n    \n    The user may choose to not send this header by configuring\n    `up.network.config.requestMetaKeys`.\n    \n    \\#\\#\\# Example\n    \n    ```http\n    X-Up-Target: .menu\n    X-Up-Fail-Target: body\n    ```\n    \n    \\#\\#\\# Changing the render target from the server\n    \n    The server may change the render target context by including a CSS selector as an `X-Up-Target` header\n    in its response.\n    \n    ```http\n    Content-Type: text/html\n    X-Up-Target: .selector-from-server\n    \n    <div class=\"selector-from-server\">\n      ...\n    </div>\n    ```\n    \n    The frontend will use the server-provided target for both successful (HTTP status `200 OK`)\n    and failed (status `4xx` or `5xx`) responses.\n    \n    The server may also set a target of `:none` to have the frontend render nothing.\n    In this case no response body is required:\n    \n    ```http\n    Content-Type: text/html\n    X-Up-Target: :none\n    ```\n    \n    @header X-Up-Target\n    @stable\n     */\n\n    /***\n    This request header contains the CSS selector targeted for a failed fragment update.\n    \n    A fragment update is considered *failed* if the server responds with a status code other than 2xx,\n    but still renders HTML.\n    \n    Server-side code is free to optimize its response to a failed request by only rendering HTML\n    that matches the provided selector. For example, you might prefer to not render an\n    expensive sidebar if the sidebar is not targeted.\n    \n    The user may choose to not send this header by configuring\n    `up.network.config.requestMetaKeys`.\n    \n    \\#\\#\\# Example\n    \n    ```http\n    X-Up-Target: .menu\n    X-Up-Fail-Target: body\n    ```\n    \n    \\#\\#\\# Signaling failed form submissions\n    \n    When [submitting a form via AJAX](/form-up-submit)\n    Unpoly needs to know whether the form submission has failed (to update the form with\n    validation errors) or succeeded (to update the `[up-target]` selector).\n    \n    For Unpoly to be able to detect a failed form submission, the response must be\n    return a non-2xx HTTP status code. We recommend to use either\n    400 (bad request) or 422 (unprocessable entity).\n    \n    To do so in [Ruby on Rails](http://rubyonrails.org/), pass a [`:status` option to `render`](http://guides.rubyonrails.org/layouts_and_rendering.html#the-status-option):\n    \n    ```ruby\n    class UsersController < ApplicationController\n    \n      def create\n        user_params = params[:user].permit(:email, :password)\n        @user = User.new(user_params)\n        if @user.save?\n          sign_in @user\n        else\n          render 'form', status: :bad_request\n        end\n      end\n    \n    end\n    ```\n    \n    @header X-Up-Fail-Target\n    @stable\n     */\n\n    /***\n    This request header contains the targeted layer's [mode](/up.layer.mode).\n    \n    Server-side code is free to render different HTML for different modes.\n    For example, you might prefer to not render a site navigation for overlays.\n    \n    The user may choose to not send this header by configuring\n    `up.network.config.requestMetaKeys`.\n    \n    \\#\\#\\# Example\n    \n    ```http\n    X-Up-Mode: drawer\n    ```\n    \n    @header X-Up-Mode\n    @stable\n     */\n\n    /***\n    This request header contains the [mode](/up.layer.mode) of the layer\n    targeted for a failed fragment update.\n    \n    A fragment update is considered *failed* if the server responds with a\n    status code other than 2xx, but still renders HTML.\n    \n    Server-side code is free to render different HTML for different modes.\n    For example, you might prefer to not render a site navigation for overlays.\n    \n    The user may choose to not send this header by configuring\n    `up.network.config.requestMetaKeys`.\n    \n    \\#\\#\\# Example\n    \n    ```http\n    X-Up-Mode: drawer\n    X-Up-Fail-Mode: root\n    ```\n    \n    @header X-Up-Fail-Mode\n    @stable\n     */\n    clearCacheFromXHR = function(xhr) {\n      var parseValue;\n      parseValue = function(value) {\n        switch (value) {\n          case 'true':\n            return true;\n          case 'false':\n            return false;\n          default:\n            return value;\n        }\n      };\n      return extractHeader(xhr, 'clearCache', parseValue);\n    };\n\n    /***\n    The server may send this optional response header with the value `clear` to [clear the cache](/up.cache.clear).\n    \n    \\#\\#\\# Example\n    \n    ```http\n    X-Up-Cache: clear\n    ```\n    \n    @header X-Up-Cache\n    @param value\n      The string `\"clear\"`.\n     */\n\n    /***\n    This request header contains a timestamp of an existing fragment that is being [reloaded](/up.reload).\n    \n    The timestamp must be explicitely set by the user as an `[up-time]` attribute on the fragment.\n    It should indicate the time when the fragment's underlying data was last changed.\n    \n    See `[up-time]` for a detailed example.\n    \n    \\#\\#\\# Format\n    \n    The time is encoded is the number of seconds elapsed since the [Unix epoch](https://en.wikipedia.org/wiki/Unix_time).\n    \n    For instance, a modification date of December 23th, 1:40:18 PM UTC would produce the following header:\n    \n    ```http\n    X-Up-Target: .unread-count\n    X-Up-Reload-From-Time: 1608730818\n    ```\n    \n    If no timestamp is known, Unpoly will send a value of zero (`X-Up-Reload-From-Time: 0`).\n    \n    @header X-Up-Reload-From-Time\n    @stable\n     */\n    contextFromXHR = function(xhr) {\n      return extractHeader(xhr, 'context', JSON.parse);\n    };\n\n    /***\n    This request header contains the targeted layer's [context](/context), serialized as JSON.\n    \n    The user may choose to not send this header by configuring\n    `up.network.config.requestMetaKeys`.\n    \n    \\#\\#\\# Example\n    \n    ```http\n    X-Up-Context: { \"lives\": 3 }\n    ```\n    \n    \\#\\#\\# Updating context from the server\n    \n    The server may update the layer context by sending a `X-Up-Context` response header with\n    changed key/value pairs:\n    \n    ```http\n    Content-Type: text/html\n    X-Up-Context: { \"lives\": 2 }\n    \n    <html>\n      ...\n    </html>\n    ```\n    \n    Upon seeing the response header, Unpoly will assign the server-provided context object to\n    the layer's context object, adding or replacing keys as needed.\n    \n    Client-side context keys not mentioned in the response will remain unchanged.\n    There is no explicit protocol to *remove* keys from the context, but the server may send a key\n    with a `null` value to effectively remove a key.\n    \n    The frontend will use the server-provided context upates for both successful (HTTP status `200 OK`)\n    and failed (status `4xx` or `5xx`) responses.  If no `X-Up-Context` response header is set,\n    the updating layer's context will not be changed.\n    \n    It is recommended that the server only places changed key/value pairs into the `X-Up-Context`\n    response header, and not echo the entire context object. Otherwise any client-side changes made while\n    the request was in flight will get overridden by the server-provided context.\n    \n    @header X-Up-Context\n    @experimental\n     */\n\n    /***\n    This request header contains the [context](/context) of the layer\n    targeted for a failed fragment update, serialized as JSON.\n    \n    A fragment update is considered *failed* if the server responds with a\n    status code other than 2xx, but still renders HTML.\n    \n    Server-side code is free to render different HTML for different contexts.\n    For example, you might prefer to not render a site navigation for overlays.\n    \n    The user may choose to not send this header by configuring\n    `up.network.config.requestMetaKeys`.\n    \n    \\#\\#\\# Example\n    \n    ```http\n    X-Up-Fail-Context: { \"context\": \"Choose a company contact\" }\n    ```\n    \n    @header X-Up-Fail-Context\n    @experimental\n     */\n\n    /***\n    @function up.protocol.methodFromXHR\n    @internal\n     */\n    methodFromXHR = function(xhr) {\n      return extractHeader(xhr, 'method', u.normalizeMethod);\n    };\n\n    /***\n    The server may set this optional response header to change the browser location after a fragment update.\n    \n    Without this header Unpoly will set the browser location to the response URL, which is usually sufficient.\n    \n    When setting `X-Up-Location` it is recommended to also set `X-Up-Method`. If no `X-Up-Method` header is given\n    and the response's URL changed from the request's URL, Unpoly will assume a redirect and set the\n    method to `GET`.\n    \n    \\#\\#\\# Internet Explorer 11\n    \n    There is an edge case on Internet Explorer 11, where Unpoly cannot detect the final URL after a redirect.\n    You can fix this edge case by delivering `X-Up-Location` and `X-Up-Method` headers with the *last* response\n    in a series of redirects.\n    \n    The **simplest implementation** is to set these headers for every request.\n    \n    \\#\\#\\# Example\n    \n    ```http\n    X-Up-Location: /current-url\n    X-Up-Method: GET\n    ```\n    \n    @header X-Up-Location\n    @stable\n     */\n\n    /***\n    The server may set this optional response header to change the HTTP method after a fragment update.\n    \n    Without this header Unpoly will assume a `GET` method if the response's URL changed from the request's URL,\n    \n    \\#\\#\\# Example\n    \n    ```http\n    X-Up-Location: /current-url\n    X-Up-Method: GET\n    ```\n    \n    @header X-Up-Method\n    @stable\n     */\n\n    /***\n    The server may set this optional response header to change the document title after a fragment update.\n    \n    Without this header Unpoly will extract the `<title>` from the server response.\n    \n    This header is useful when you [optimize your response](X-Up-Target) to not render\n    the application layout unless targeted. Since your optimized response\n    no longer includes a `<title>`, you can instead use this HTTP header to pass the document title.\n    \n    \\#\\#\\# Example\n    \n    ```http\n    X-Up-Title: Playlist browser\n    ```\n    \n    @header X-Up-Title\n    @stable\n     */\n\n    /***\n    This request header contains the `[name]` of a [form field being validated](/input-up-validate).\n    \n    When seeing this header, the server is expected to validate (but not save)\n    the form submission and render a new copy of the form with validation errors.\n    See the documentation for [`input[up-validate]`](/input-up-validate) for more information\n    on how server-side validation works in Unpoly.\n    \n    \\#\\#\\# Example\n    \n    Assume we have an auto-validating form field:\n    \n    ```html\n    <fieldset>\n      <input name=\"email\" up-validate>\n    </fieldset>\n    ```\n    \n    When the input is changed, Unpoly will submit the form with an additional header:\n    \n    ```html\n    X-Up-Validate: email\n    ```\n    \n    @header X-Up-Validate\n    @stable\n     */\n    eventPlansFromXHR = function(xhr) {\n      return extractHeader(xhr, 'events', JSON.parse);\n    };\n\n    /***\n    The server may set this response header to [emit events](/up.emit) with the\n    requested [fragment update](a-up-target).\n    \n    The header value is a [JSON](https://en.wikipedia.org/wiki/JSON) array.\n    Each element in the array is a JSON object representing an event to be emitted\n    on the `document`.\n    \n    The object property `{ \"type\" }` defines the event's [type](https://developer.mozilla.org/en-US/docs/Web/API/Event/type). Other properties become properties of the emitted\n    event object.\n    \n    \\#\\#\\# Example\n    \n    ```http\n    Content-Type: text/html\n    X-Up-Events: [{ \"type\": \"user:created\", \"id\": 5012 }, { \"type\": \"signup:completed\" }]\n    ...\n    \n    <html>\n      ...\n    </html>\n    ```\n    \n    \\#\\#\\# Emitting an event on a layer\n    \n    Instead of emitting an event on the `document`, the server may also choose to\n    [emit the event on the layer being updated](/up.layer.emit). To do so, add a property\n    `{ \"layer\": \"current\" }` to the JSON object of an event:\n    \n    ```http\n    Content-Type: text/html\n    X-Up-Events: [{ \"type\": \"user:created\", \"name:\" \"foobar\", \"layer\": \"current\" }]\n    ...\n    \n    <html>\n      ...\n    </html>\n    ```\n    \n    @header X-Up-Events\n    @stable\n     */\n    acceptLayerFromXHR = function(xhr) {\n      return extractHeader(xhr, 'acceptLayer', JSON.parse);\n    };\n\n    /***\n    The server may set this response header to [accept](/up.layer.accept) the targeted overlay\n    in response to a fragment update.\n    \n    Upon seeing the header, Unpoly will cancel the fragment update and accept the layer instead.\n    If the root layer is targeted, the header is ignored and the fragment is updated with\n    the response's HTML content.\n    \n    The header value is the acceptance value serialized as a JSON object.\n    To accept an overlay without value, set the header value to the string `null`.\n    \n    \\#\\#\\# Example\n    \n    The response below will accept the targeted overlay with the value `{user_id: 1012 }`:\n    \n    ```http\n    Content-Type: text/html\n    X-Up-Accept-Layer: {\"user_id\": 1012}\n    \n    <html>\n      ...\n    </html>\n    ```\n    \n    \\#\\#\\# Rendering content\n    \n    The response may contain `text/html` content. If the root layer is targeted,\n    the `X-Up-Accept-Layer` header is ignored and the fragment is updated with\n    the response's HTML content.\n    \n    If you know that an overlay will be closed don't want to render HTML,\n    have the server change the render target to `:none`:\n    \n    ```http\n    Content-Type: text/html\n    X-Up-Accept-Layer: {\"user_id\": 1012}\n    X-Up-Target: :none\n    ```\n    \n    @header X-Up-Accept-Layer\n    @stable\n     */\n    dismissLayerFromXHR = function(xhr) {\n      return extractHeader(xhr, 'dismissLayer', JSON.parse);\n    };\n\n    /***\n    The server may set this response header to [dismiss](/up.layer.dismiss) the targeted overlay\n    in response to a fragment update.\n    \n    Upon seeing the header, Unpoly will cancel the fragment update and dismiss the layer instead.\n    If the root layer is targeted, the header is ignored and the fragment is updated with\n    the response's HTML content.\n    \n    The header value is the dismissal value serialized as a JSON object.\n    To accept an overlay without value, set the header value to the string `null`.\n    \n    \\#\\#\\# Example\n    \n    The response below will dismiss the targeted overlay without a dismissal value:\n    \n    ```http\n    HTTP/1.1 200 OK\n    Content-Type: text/html\n    X-Up-Dismiss-Layer: null\n    \n    <html>\n      ...\n    </html>\n    ```\n    \n    \\#\\#\\# Rendering content\n    \n    The response may contain `text/html` content. If the root layer is targeted,\n    the `X-Up-Accept-Layer` header is ignored and the fragment is updated with\n    the response's HTML content.\n    \n    If you know that an overlay will be closed don't want to render HTML,\n    have the server change the render target to `:none`:\n    \n    ```http\n    HTTP/1.1 200 OK\n    Content-Type: text/html\n    X-Up-Accept-Layer: {\"user_id\": 1012}\n    X-Up-Target: :none\n    ```\n    \n    @header X-Up-Dismiss-Layer\n    @stable\n     */\n\n    /***\n    Server-side companion libraries like unpoly-rails set this cookie so we\n    have a way to detect the request method of the initial page load.\n    There is no JavaScript API for this.\n    \n    @function up.protocol.initialRequestMethod\n    @internal\n     */\n    initialRequestMethod = u.memoize(function() {\n      return u.normalizeMethod(up.browser.popCookie('_up_method'));\n    });\n\n    /***\n    The server may set this optional cookie to echo the HTTP method of the initial request.\n    \n    If the initial page was loaded with a non-`GET` HTTP method, Unpoly prefers to make a full\n    page load when you try to update a fragment. Once the next page was loaded with a `GET` method,\n    Unpoly will again update fragments.\n    \n    This fixes two edge cases you might or might not care about:\n    \n    1. Unpoly replaces the initial page state so it can later restore it when the user\n       goes back to that initial URL. However, if the initial request was a POST,\n       Unpoly will wrongly assume that it can restore the state by reloading with GET.\n    2. Some browsers have a bug where the initial request method is used for all\n       subsequently pushed states. That means if the user reloads the page on a later\n       GET state, the browser will wrongly attempt a POST request.\n       This issue affects Safari 9-12 (last tested in 2019-03).\n       Modern Firefoxes, Chromes and IE10+ don't have this behavior.\n    \n    In order to allow Unpoly to detect the HTTP method of the initial page load,\n    the server must set a cookie:\n    \n    ```http\n    Set-Cookie: _up_method=POST\n    ```\n    \n    When Unpoly boots it will look for this cookie and configure itself accordingly.\n    The cookie is then deleted in order to not affect following requests.\n    \n    The **simplest implementation** is to set this cookie for every request that is neither\n    `GET` nor an [Unpoly request](/X-Up-Version). For all other requests\n    an existing `_up_method` cookie should be deleted.\n    \n    @cookie _up_method\n    @stable\n     */\n\n    /***\n    @function up.protocol.locationFromXHR\n    @internal\n     */\n    locationFromXHR = function(xhr) {\n      return extractHeader(xhr, 'location') || xhr.responseURL;\n    };\n\n    /***\n    @function up.protocol.titleFromXHR\n    @internal\n     */\n    titleFromXHR = function(xhr) {\n      return extractHeader(xhr, 'title');\n    };\n\n    /***\n    @function up.protocol.targetFromXHR\n    @internal\n     */\n    targetFromXHR = function(xhr) {\n      return extractHeader(xhr, 'target');\n    };\n\n    /***\n    Configures strings used in the optional [server protocol](/up.protocol).\n    \n    @property up.protocol.config\n    \n    @param {string} [config.csrfHeader='X-CSRF-Token']\n      The name of the HTTP header that will include the\n      [CSRF token](https://en.wikipedia.org/wiki/Cross-site_request_forgery#Synchronizer_token_pattern)\n      for AJAX requests.\n    \n    @param {string|Function(): string} [config.csrfParam]\n      The `name` of the hidden `<input>` used for sending a\n      [CSRF token](https://en.wikipedia.org/wiki/Cross-site_request_forgery#Synchronizer_token_pattern) when\n      submitting a default, non-AJAX form. For AJAX request the token is sent as an\n      [HTTP header](/up.protocol.config#config.csrfHeader instead.\n    \n      The parameter name can be configured as a string or as function that returns the parameter name.\n      If no name is set, no token will be sent.\n    \n      Defaults to the `content` attribute of a `<meta>` tag named `csrf-param`:\n    \n      ```html\n      <meta name=\"csrf-param\" content=\"authenticity_token\" />\n      ```\n    \n    @param {string|Function(): string} [config.csrfToken]\n      The [CSRF token](https://en.wikipedia.org/wiki/Cross-site_request_forgery#Synchronizer_token_pattern)\n      to send for unsafe requests. The token will be sent as either a HTTP header (for AJAX requests)\n      or hidden form `<input>` (for default, non-AJAX form submissions).\n    \n      The token can either be configured as a string or as function that returns the token.\n      If no token is set, no token will be sent.\n    \n      Defaults to the `content` attribute of a `<meta>` tag named `csrf-token`:\n    \n      ```\n      <meta name='csrf-token' content='secret12345'>\n      ```\n    \n    @param {string} [config.methodParam='_method']\n      The name of request parameter containing the original request method when Unpoly needs to wrap\n      the method.\n    \n      Methods must be wrapped when making a [full page request](/up.browser.loadPage) with a methods other\n      than GET or POST. In this case Unpoly will make a POST request with the original request method\n      in a form parameter named `_method`:\n    \n      ```http\n      POST /test HTTP/1.1\n      Host: example.com\n      Content-Type: application/x-www-form-urlencoded\n      Content-Length: 11\n    \n      _method=PUT\n      ```\n    @stable\n     */\n    config = new up.Config(function() {\n      return {\n        methodParam: '_method',\n        csrfParam: function() {\n          return e.metaContent('csrf-param');\n        },\n        csrfToken: function() {\n          return e.metaContent('csrf-token');\n        },\n        csrfHeader: 'X-CSRF-Token'\n      };\n    });\n    csrfHeader = function() {\n      return u.evalOption(config.csrfHeader);\n    };\n    csrfParam = function() {\n      return u.evalOption(config.csrfParam);\n    };\n    csrfToken = function() {\n      return u.evalOption(config.csrfToken);\n    };\n\n    /***\n    @internal\n     */\n    wrapMethod = function(method, params) {\n      params.add(config.methodParam, method);\n      return 'POST';\n    };\n    reset = function() {\n      return config.reset();\n    };\n    up.on('up:framework:reset', reset);\n    return {\n      config: config,\n      reset: reset,\n      locationFromXHR: locationFromXHR,\n      titleFromXHR: titleFromXHR,\n      targetFromXHR: targetFromXHR,\n      methodFromXHR: methodFromXHR,\n      acceptLayerFromXHR: acceptLayerFromXHR,\n      contextFromXHR: contextFromXHR,\n      dismissLayerFromXHR: dismissLayerFromXHR,\n      eventPlansFromXHR: eventPlansFromXHR,\n      clearCacheFromXHR: clearCacheFromXHR,\n      csrfHeader: csrfHeader,\n      csrfParam: csrfParam,\n      csrfToken: csrfToken,\n      initialRequestMethod: initialRequestMethod,\n      headerize: headerize,\n      wrapMethod: wrapMethod\n    };\n  })();\n\n}).call(this);\n\n/***\nLogging\n=======\n\nUnpoly can print debugging information to the [browser console](https://developer.chrome.com/docs/devtools/console/), e.g.:\n\n- Which [events](/up.event) are called\n- When we're [making requests to the network](/up.request)\n- Which [compilers](/up.syntax) are applied to which elements\n\n@see up.log.enable\n@see up.log.disable\n\n@module up.log\n */\n\n(function() {\n  var slice = [].slice;\n\n  up.log = (function() {\n    var config, disable, enable, fail, muteUncriticalRejection, printBanner, printToError, printToStandard, printToStream, printToWarn, reset, sessionStore, setEnabled, u;\n    u = up.util;\n    sessionStore = new up.store.Session('up.log');\n\n    /***\n    Configures the logging output on the developer console.\n    \n    @property up.log.config\n    @param {boolean} [options.enabled=false]\n      Whether Unpoly will print debugging information to the developer console.\n    \n      Debugging information includes which elements are being [compiled](/up.syntax)\n      and which [events](/up.event) are being emitted.\n      Note that errors will always be printed, regardless of this setting.\n    @param {boolean} [options.banner=true]\n      Print the Unpoly banner to the developer console.\n    @stable\n     */\n    config = new up.Config(function() {\n      return {\n        enabled: sessionStore.get('enabled'),\n        banner: true\n      };\n    });\n    reset = function() {\n      return config.reset();\n    };\n\n    /***\n    Prints a logging message to the browser console.\n    \n    @function up.puts\n    @param {string} message\n    @param {Array} ...args\n    @internal\n     */\n    printToStandard = function() {\n      var args;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      if (config.enabled) {\n        return printToStream.apply(null, ['log'].concat(slice.call(args)));\n      }\n    };\n\n    /***\n    @function up.warn\n    @internal\n     */\n    printToWarn = function() {\n      var args;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      return printToStream.apply(null, ['warn'].concat(slice.call(args)));\n    };\n\n    /***\n    @function up.log.error\n    @internal\n     */\n    printToError = function() {\n      var args;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      return printToStream.apply(null, ['error'].concat(slice.call(args)));\n    };\n    printToStream = function() {\n      var args, message, stream, trace;\n      stream = arguments[0], trace = arguments[1], message = arguments[2], args = 4 <= arguments.length ? slice.call(arguments, 3) : [];\n      if (message) {\n        if (up.browser.canFormatLog()) {\n          args.unshift('');\n          args.unshift('color: #666666; padding: 1px 3px; border: 1px solid #bbbbbb; border-radius: 2px; font-size: 90%; display: inline-block');\n          message = \"%c\" + trace + \"%c \" + message;\n        } else {\n          message = \"[\" + trace + \"] \" + message;\n        }\n        return console[stream].apply(console, [message].concat(slice.call(args)));\n      }\n    };\n    printBanner = function() {\n      var color, logo, text;\n      if (!config.banner) {\n        return;\n      }\n      logo = \" __ _____  ___  ___  / /_ __\\n\" + (\"/ // / _ \\\\/ _ \\\\/ _ \\\\/ / // /  \" + up.version + \"\\n\") + \"\\\\___/_//_/ .__/\\\\___/_/\\\\_. / \\n\" + \"        / /            / /\\n\\n\";\n      text = \"\";\n      if (!up.migrate.loaded) {\n        text += \"Load unpoly-migrate.js to enable deprecated APIs.\\n\\n\";\n      }\n      if (config.enabled) {\n        text += \"Call `up.log.disable()` to disable logging for this session.\";\n      } else {\n        text += \"Call `up.log.enable()` to enable logging for this session.\";\n      }\n      color = 'color: #777777';\n      if (up.browser.canFormatLog()) {\n        return console.log('%c' + logo + '%c' + text, 'font-family: monospace;' + color, color);\n      } else {\n        return console.log(logo + text);\n      }\n    };\n    up.on('up:app:boot', printBanner);\n    up.on('up:framework:reset', reset);\n    setEnabled = function(value) {\n      sessionStore.set('enabled', value);\n      return config.enabled = value;\n    };\n\n    /***\n    Starts printing debugging information to the developer console.\n    \n    Debugging information includes which elements are being [compiled](/up.syntax)\n    and which [events](/up.event) are being emitted.\n    \n    Errors will always be printed, regardless of this setting.\n    \n    @function up.log.enable\n    @stable\n     */\n    enable = function() {\n      return setEnabled(true);\n    };\n\n    /***\n    Stops printing debugging information to the developer console.\n    \n    Errors will still be printed, even with logging disabled.\n    \n    @function up.log.disable\n    @stable\n     */\n    disable = function() {\n      return setEnabled(false);\n    };\n\n    /***\n    Throws a [JavaScript error](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error)\n    with the given message.\n    \n    The message will also be printed to the [error log](/up.log.error). Also a notification will be shown at the bottom of the screen.\n    \n    The message may contain [substitution marks](https://developer.mozilla.org/en-US/docs/Web/API/console#Using_string_substitutions).\n    \n    \\#\\#\\# Examples\n    \n        up.fail('Division by zero')\n        up.fail('Unexpected result %o', result)\n    \n    @function up.fail\n    @param {string} message\n      A message with details about the error.\n    \n      The message can contain [substitution marks](https://developer.mozilla.org/en-US/docs/Web/API/console#Using_string_substitutions)\n      like `%s` or `%o`.\n    @param {Array<string>} vars...\n      A list of variables to replace any substitution marks in the error message.\n    @experimental\n     */\n    fail = function() {\n      var args;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      printToError.apply(null, ['error'].concat(slice.call(args)));\n      throw up.error.failed(args);\n    };\n\n    /***\n    Registers an empty rejection handler in case the given promise\n    rejects with an AbortError or a failed up.Response.\n    \n    This prevents browsers from printing \"Uncaught (in promise)\" to the error\n    console when the promise is rejected.\n    \n    This is helpful for event handlers where it is clear that no rejection\n    handler will be registered:\n    \n    ```js\n    up.on('submit', 'form[up-target]', (event, form) => {\n      promise = up.submit(form)\n      up.util.muteRejection(promise)\n    })\n    ```\n    \n    @function up.log.muteUncriticalRejection\n    @param {Promise} promise\n    @return {Promise}\n    @internal\n     */\n    muteUncriticalRejection = function(promise) {\n      return promise[\"catch\"](function(error) {\n        if (!((typeof error === 'object') && (error.name === 'AbortError' || error instanceof up.RenderResult || error instanceof up.Response))) {\n          throw error;\n        }\n      });\n    };\n    return {\n      puts: printToStandard,\n      error: printToError,\n      warn: printToWarn,\n      config: config,\n      enable: enable,\n      disable: disable,\n      fail: fail,\n      muteUncriticalRejection: muteUncriticalRejection,\n      isEnabled: function() {\n        return config.enabled;\n      }\n    };\n  })();\n\n  up.puts = up.log.puts;\n\n  up.warn = up.log.warn;\n\n  up.fail = up.log.fail;\n\n}).call(this);\n\n/***\nCustom JavaScript\n=================\n\nThe `up.syntax` package lets you pair HTML elements with JavaScript behavior.\n\n@see up.compiler\n@see [up-data]\n@see up.macro\n\n@module up.syntax\n */\n\n(function() {\n  var slice = [].slice;\n\n  up.syntax = (function() {\n    var SYSTEM_MACRO_PRIORITIES, buildCompiler, clean, compile, compilers, detectSystemMacroPriority, e, insertCompiler, macros, parseCompilerArgs, readData, registerCompiler, registerDestructor, registerJQueryCompiler, registerJQueryMacro, registerMacro, reset, u;\n    u = up.util;\n    e = up.element;\n    SYSTEM_MACRO_PRIORITIES = {\n      '[up-back]': -100,\n      '[up-content]': -200,\n      '[up-drawer]': -200,\n      '[up-modal]': -200,\n      '[up-cover]': -200,\n      '[up-popup]': -200,\n      '[up-tooltip]': -200,\n      '[up-dash]': -200,\n      '[up-expand]': -300,\n      '[data-method]': -400,\n      '[data-confirm]': -400\n    };\n    compilers = [];\n    macros = [];\n\n    /***\n    Registers a function to be called when an element with\n    the given selector is inserted into the DOM.\n    \n    Use compilers to activate your custom Javascript behavior on matching\n    elements.\n    \n    You should migrate your [`DOMContentLoaded`](https://developer.mozilla.org/en-US/docs/Web/API/Window/DOMContentLoaded_event)\n    callbacks to compilers. This will make sure they run both at page load and\n    when a new fragment is inserted later.\n    See [Making JavaScripts work with fragment updates](/legacy-scripts) for advice\n    on migrating legacy scripts.\n    \n    It will also organize your JavaScript snippets by selector.\n    \n    \\#\\#\\# Example\n    \n    This compiler will insert the current time into a\n    `<div class='current-time'></div>`:\n    \n    ```js\n    up.compiler('.current-time', function(element) {\n      var now = new Date()\n      element.textContent = now.toString()\n    })\n    ```\n    \n    The compiler function will be called once for each matching element when\n    the page loads, or when a matching fragment is [inserted](/up.replace) later.\n    \n    \\#\\#\\# Integrating JavaScript libraries\n    \n    `up.compiler()` is a great way to integrate JavaScript libraries.\n    Let's say your JavaScript plugin wants you to call `lightboxify()`\n    on links that should open a lightbox. You decide to\n    do this for all links with an `lightbox` class:\n    \n    ```html\n    <a href=\"river.png\" class=\"lightbox\">River</a>\n    <a href=\"ocean.png\" class=\"lightbox\">Ocean</a>\n    ```\n    \n    This JavaScript will do exactly that:\n    \n    ```js\n    up.compiler('a.lightbox', function(element) {\n      lightboxify(element)\n    })\n    ```\n    \n    \\#\\#\\# Cleaning up after yourself\n    \n    If your compiler returns a function, Unpoly will use this as a *destructor* to\n    clean up if the element leaves the DOM. Note that in Unpoly the same DOM and JavaScript environment\n    will persist through many page loads, so it's important to not create\n    [memory leaks](https://makandracards.com/makandra/31325-how-to-create-memory-leaks-in-jquery).\n    \n    You should clean up after yourself whenever your compilers have global\n    side effects, like a [`setInterval`](https://developer.mozilla.org/en-US/docs/Web/API/WindowTimers/setInterval)\n    or [event handlers bound to the document root](/up.on).\n    \n    Here is a version of `.current-time` that updates\n    the time every second, and cleans up once it's done. Note how it returns\n    a function that calls `clearInterval`:\n    \n    ```js\n    up.compiler('.current-time', function(element) {\n      let update = () => element.textContent = new Date().toString()\n      setInterval(update, 1000)\n      return () => clearInterval(update)\n    })\n    \n    If we didn't clean up after ourselves, we would have many ticking intervals\n    operating on detached DOM elements after we have created and removed a couple\n    of `<clock>` elements.\n    \n    An alternative way to register a destructor function is `up.destructor()`.\n    \n    \\#\\#\\# Passing parameters to a compiler\n    \n    Use the `[up-data]` attribute to attach structured data to a DOM element.\n    The data will be parsed and passed to your compiler function.\n    \n    Alternatively your compiler may access attributes for the compiled element\n    via the standard [`Element#getAttribute()`](https://developer.mozilla.org/en-US/docs/Web/API/Element/getAttribute)\n    method.\n    \n    Unpoly also provides utility functions to read an element attribute and\n    cast it to a given type:\n    \n    - `up.element.booleanAttr(element, attr)`\n    - `up.element.numberAttr(element, attr)`\n    - `up.element.jsonAttr(element, attr)`\n    \n    @function up.compiler\n    @param {string} selector\n      The selector to match.\n    @param {number} [options.priority=0]\n      The priority of this compiler.\n    \n      Compilers with a higher priority are run first.\n      Two compilers with the same priority are run in the order they were registered.\n    @param {boolean} [options.batch=false]\n      If set to `true` and a fragment insertion contains multiple\n      elements matching `selector`, the `compiler` function is only called once\n      with all these elements.\n    @param {Function(element, data)} compiler\n      The function to call when a matching element is inserted.\n    \n      The function takes the new element as the first argument.\n      If the element has an [`up-data`](/up-data) attribute, its value is parsed as JSON\n      and passed as a second argument.\n    \n      The function may return a destructor function that cleans the compiled\n      object before it is removed from the DOM. The destructor is supposed to\n      [clear global state](/up.compiler#cleaning-up-after-yourself)\n      such as timeouts and event handlers bound to the document.\n      The destructor is *not* expected to remove the element from the DOM, which\n      is already handled by [`up.destroy()`](/up.destroy).\n    @stable\n     */\n    registerCompiler = function() {\n      var args, compiler;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      compiler = buildCompiler(args);\n      return insertCompiler(compilers, compiler);\n    };\n\n    /***\n    Registers a function to be called when an element with\n    the given selector is inserted into the DOM. The function is called\n    with each matching element as a\n    [jQuery object](https://learn.jquery.com/using-jquery-core/jquery-object/).\n    \n    If you're not using jQuery, use `up.compiler()` instead, which calls\n    the compiler function with a native element.\n    \n    \\#\\#\\# Example\n    \n    This jQuery compiler will insert the current time into a\n    `<div class='current-time'></div>`:\n    \n    ```js\n    up.$compiler('.current-time', function($element) {\n      var now = new Date()\n      $element.text(now.toString())\n    })\n    ```\n    \n    @function up.$compiler\n    @param {string} selector\n      The selector to match.\n    @param {Object} [options]\n      See [`options` argument for `up.compiler()`](/up.compiler#parameters).\n    @param {Function($element, data)} compiler\n      The function to call when a matching element is inserted.\n    \n      See [`compiler` argument for `up.compiler()`](/up.compiler#parameters).\n      @stable\n     */\n    registerJQueryCompiler = function() {\n      var args, compiler;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      compiler = registerCompiler.apply(null, args);\n      compiler.jQuery = true;\n      return compiler;\n    };\n\n    /***\n    Registers a [compiler](/up.compiler) that is run before all other compilers.\n    \n    A macro lets you set UJS attributes that will be compiled afterwards.\n    \n    If you want default attributes for *every* link and form, consider customizing your\n    [navigation options](/navigation).\n    \n    \\#\\#\\# Example\n    \n    You will sometimes find yourself setting the same combination of UJS attributes again and again:\n    \n    ```html\n    <a href=\"/page1\" up-layer=\"new modal\" up-class=\"warning\" up-animation=\"shake\">Page 1</a>\n    <a href=\"/page1\" up-layer=\"new modal\" up-class=\"warning\" up-animation=\"shake\">Page 1</a>\n    <a href=\"/page1\" up-layer=\"new modal\" up-class=\"warning\" up-animation=\"shake\">Page 1</a>\n    ```\n    \n    We would much rather define a new `[smooth-link]` attribute that let's us\n    write the same links like this:\n    \n    ```html\n    <a href=\"/page1\" smooth-link>Page 1</a>\n    <a href=\"/page2\" smooth-link>Page 2</a>\n    <a href=\"/page3\" smooth-link>Page 3</a>\n    ```\n    \n    We can define the `[content-link]` attribute by registering a macro that\n    sets the `[up-target]`, `[up-transition]` and `[up-duration]` attributes for us:\n    \n    ```\n    up.macro('[smooth-link]', function(link) {\n      link.setAttribute('up-target', '.content')\n      link.setAttribute('up-transition', 'cross-fade')\n      link.setAttribute('up-duration', '300')\n    })\n    ```\n    \n    @function up.macro\n    @param {string} selector\n      The selector to match.\n    @param {Object} options\n      See options for [`up.compiler()`](/up.compiler).\n    @param {Function(element, data)} macro\n      The function to call when a matching element is inserted.\n    \n      See [`up.compiler()`](/up.compiler#parameters) for details.\n    @stable\n     */\n    registerMacro = function() {\n      var args, macro;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      macro = buildCompiler(args);\n      if (up.framework.booting) {\n        macro.priority = detectSystemMacroPriority(macro.selector) || up.fail('Unregistered priority for system macro %o', macro.selector);\n      }\n      return insertCompiler(macros, macro);\n    };\n\n    /***\n    Registers a [compiler](/up.compiler) that is run before all other compilers.\n    The compiler function is called with each matching element as a\n    [jQuery object](https://learn.jquery.com/using-jquery-core/jquery-object/).\n    \n    If you're not using jQuery, use `up.macro()` instead, which calls\n    the macro function with a native element.\n    \n    \\#\\#\\# Example\n    \n    ```js\n    up.$macro('[content-link]', function($link) {\n      $link.attr(\n        'up-target': '.content',\n        'up-transition': 'cross-fade',\n        'up-duration':'300'\n      )\n    })\n    ```\n    \n    @function up.$macro\n    @param {string} selector\n      The selector to match.\n    @param {Object} options\n      See [`options` argument for `up.compiler()`](/up.compiler#parameters).\n    @param {Function(element, data)} macro\n      The function to call when a matching element is inserted.\n    \n      See [`compiler` argument for `up.compiler()`](/up.compiler#parameters).\n    @stable\n     */\n    registerJQueryMacro = function() {\n      var args, macro;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      macro = registerMacro.apply(null, args);\n      macro.jQuery = true;\n      return macro;\n    };\n    detectSystemMacroPriority = function(macroSelector) {\n      var priority, substr;\n      macroSelector = u.evalOption(macroSelector);\n      for (substr in SYSTEM_MACRO_PRIORITIES) {\n        priority = SYSTEM_MACRO_PRIORITIES[substr];\n        if (macroSelector.indexOf(substr) >= 0) {\n          return priority;\n        }\n      }\n    };\n    parseCompilerArgs = function(args) {\n      var callback, options, selector;\n      selector = args.shift();\n      callback = args.pop();\n      options = u.extractOptions(args);\n      return [selector, options, callback];\n    };\n    buildCompiler = function(args) {\n      var callback, options, ref, selector;\n      ref = parseCompilerArgs(args), selector = ref[0], options = ref[1], callback = ref[2];\n      options = u.options(options, {\n        selector: selector,\n        isDefault: up.framework.booting,\n        priority: 0,\n        batch: false,\n        keep: false,\n        jQuery: false\n      });\n      return u.assign(callback, options);\n    };\n    insertCompiler = function(queue, newCompiler) {\n      var existingCompiler, index;\n      index = 0;\n      while ((existingCompiler = queue[index]) && (existingCompiler.priority >= newCompiler.priority)) {\n        index += 1;\n      }\n      queue.splice(index, 0, newCompiler);\n      return newCompiler;\n    };\n\n    /***\n    Applies all compilers on the given element and its descendants.\n    \n    Unlike [`up.hello()`](/up.hello), this doesn't emit any events.\n    \n    @function up.syntax.compile\n    @param {Array<Element>} [options.skip]\n      A list of elements whose subtrees should not be compiled.\n    @internal\n     */\n    compile = function(fragment, options) {\n      var orderedCompilers, pass;\n      orderedCompilers = macros.concat(compilers);\n      pass = new up.CompilerPass(fragment, orderedCompilers, options);\n      return pass.run();\n    };\n\n    /***\n    Registers a function to be called when the given element\n    is [destroyed](/up.destroy).\n    \n    \\#\\#\\# Example\n    \n    ```js\n    up.compiler('.current-time', function(element) {\n      let update = () => element.textContent = new Date().toString()\n      setInterval(update, 1000)\n      up.destructor(element, () => clearInterval(update))\n    })\n    ```\n    \n    An alternative way to register a destructor function is to\n    [`return` it from your compiler function](/up.compiler#cleaning-up-after-yourself).\n    \n    @function up.destructor\n    @param {Element} element\n    @param {Function|Array<Function>} destructor\n      One or more destructor functions.\n    @stable\n     */\n    registerDestructor = function(element, destructor) {\n      var destructors;\n      if (!(destructors = element.upDestructors)) {\n        destructors = [];\n        element.upDestructors = destructors;\n        element.classList.add('up-can-clean');\n      }\n      if (u.isArray(destructor)) {\n        return destructors.push.apply(destructors, destructor);\n      } else {\n        return destructors.push(destructor);\n      }\n    };\n\n    /***\n    Runs any destructor on the given fragment and its descendants in the same layer.\n    \n    Unlike [`up.destroy()`](/up.destroy), this does not emit any events\n    and does not remove the element from the DOM.\n    \n    @function up.syntax.clean\n    @param {Element} fragment\n    @param {up.Layer} options.layer\n    @internal\n     */\n    clean = function(fragment, options) {\n      var pass;\n      if (options == null) {\n        options = {};\n      }\n      pass = new up.DestructorPass(fragment, options);\n      return pass.run();\n    };\n\n    /***\n    Returns the given element's `[up-data]`, parsed as a JavaScript object.\n    \n    Returns `undefined` if the element has no `[up-data]` attribute.\n    \n    \\#\\#\\# Example\n    \n    You have an element with JSON data serialized into an `up-data` attribute:\n    \n    ```html\n    <span class='person' up-data='{ \"age\": 18, \"name\": \"Bob\" }'>Bob</span>\n    ```\n    \n    Calling `up.syntax.data()` will deserialize the JSON string into a JavaScript object:\n    \n    ```js\n    up.syntax.data('.person') // returns { age: 18, name: 'Bob' }\n    ```\n    \n    @function up.data\n    @param {string|Element|jQuery} element\n      The element for which to return data.\n    @return\n      The JSON-decoded value of the `up-data` attribute.\n    \n      Returns `undefined` if the element has no (or an empty) `up-data` attribute.\n    @stable\n     */\n\n    /***\n    Attaches structured data to an element, to be consumed by a compiler.\n    \n    If an element with an `[up-data]` attribute enters the DOM,\n    Unpoly will parse the JSON and pass the resulting object to any matching\n    [`up.compiler()`](/up.compiler) functions.\n    \n    \\#\\#\\# Example\n    \n    For instance, a container for a [Google Map](https://developers.google.com/maps/documentation/javascript/tutorial)\n    might attach the location and names of its marker pins:\n    \n    ```html\n    <div class='google-map' up-data='[\n      { \"lat\": 48.36, \"lng\": 10.99, \"title\": \"Friedberg\" },\n      { \"lat\": 48.75, \"lng\": 11.45, \"title\": \"Ingolstadt\" }\n    ]'></div>\n    ```\n    \n    The JSON will be parsed and handed to your compiler as a second argument:\n    \n    ```js\n    up.compiler('.google-map', function(element, pins) {\n      var map = new google.maps.Map(element)\n      pins.forEach(function(pin) {\n        var position = new google.maps.LatLng(pin.lat, pin.lng)\n        new google.maps.Marker({\n          position: position,\n          map: map,\n          title: pin.title\n        })\n      })\n    })\n    ```\n    \n    Similarly, when an event is triggered on an element annotated with\n    [`up-data`], the parsed object will be passed to any matching\n    [`up.on()`](/up.on) handlers.\n    \n    ```js\n    up.on('click', '.google-map', function(event, element, pins) {\n      console.log(\"There are %d pins on the clicked map\", pins.length)\n    })\n    ```\n    \n    @selector [up-data]\n    @param up-data\n      A serialized JSON string\n    @stable\n     */\n    readData = function(element) {\n      element = up.fragment.get(element);\n      return e.jsonAttr(element, 'up-data') || {};\n    };\n\n    /***\n    Resets the list of registered compiler directives to the\n    moment when the framework was booted.\n    \n    @internal\n     */\n    reset = function() {\n      compilers = u.filter(compilers, 'isDefault');\n      return macros = u.filter(macros, 'isDefault');\n    };\n    up.on('up:framework:reset', reset);\n    return {\n      compiler: registerCompiler,\n      macro: registerMacro,\n      $compiler: registerJQueryCompiler,\n      $macro: registerJQueryMacro,\n      destructor: registerDestructor,\n      compile: compile,\n      clean: clean,\n      data: readData\n    };\n  })();\n\n  up.compiler = up.syntax.compiler;\n\n  up.$compiler = up.syntax.$compiler;\n\n  up.destructor = up.syntax.destructor;\n\n  up.macro = up.syntax.macro;\n\n  up.$macro = up.syntax.$macro;\n\n  up.data = up.syntax.data;\n\n}).call(this);\n\n/***\nHistory\n========\n\nThe `up.history` module helps you work with the browser history.\n\n@see up.history.location\n@see up:location:changed\n\n@module up.history\n */\n\n(function() {\n  var slice = [].slice;\n\n  up.history = (function() {\n    var buildState, config, currentLocation, e, emit, isCurrentLocation, manipulate, nextPreviousLocation, normalizeURL, pop, previousLocation, push, replace, reset, restoreStateOnPop, trackCurrentLocation, u;\n    u = up.util;\n    e = up.element;\n\n    /***\n    Configures behavior when the user goes back or forward in browser history.\n    \n    @property up.history.config\n    @param {Array} [config.restoreTargets=[]]\n      A list of possible CSS selectors to [replace](/up.render) when the user goes back in history.\n    \n      By default the [root layer's main target](/up.fragment.config.mainTargets).\n    @param {boolean} [config.enabled=true]\n      Defines whether [fragment updates](/up.render) will update the browser's current URL.\n    \n      If set to `false` Unpoly will never change the browser URL.\n    @param {boolean} [config.enabled=true]\n      Whether to restore the known scroll positions\n      when the user goes back or forward in history.\n    @stable\n     */\n    config = new up.Config(function() {\n      return {\n        enabled: true,\n        restoreTargets: [':main']\n      };\n    });\n\n    /***\n    Returns a normalized URL for the previous history entry.\n    \n    Only history entries pushed by Unpoly will be considered.\n    \n    @property up.history.previousLocation\n    @param {string} previousLocation\n    @experimental\n     */\n    previousLocation = void 0;\n    nextPreviousLocation = void 0;\n    reset = function() {\n      config.reset();\n      previousLocation = void 0;\n      nextPreviousLocation = void 0;\n      return trackCurrentLocation();\n    };\n    normalizeURL = function(url, normalizeOptions) {\n      if (normalizeOptions == null) {\n        normalizeOptions = {};\n      }\n      normalizeOptions.hash = true;\n      return u.normalizeURL(url, normalizeOptions);\n    };\n\n    /***\n    Returns a normalized URL for the current browser location.\n    \n    Note that if the current [layer](/up.layer) does not have [visible history](/up.Layer.prototype.historyVisible),\n    the browser's address bar will show the location of an ancestor layer.\n    To get the location of the current layer, use `up.layer.location`.\n    \n    @property up.history.location\n    @param {string} location\n    @experimental\n     */\n    currentLocation = function(normalizeOptions) {\n      return normalizeURL(location.href, normalizeOptions);\n    };\n\n    /***\n    Remembers the current URL so we can use previousURL on pop.\n    \n    @function observeNewURL\n    @internal\n     */\n    trackCurrentLocation = function() {\n      var url;\n      url = currentLocation();\n      if (nextPreviousLocation !== url) {\n        previousLocation = nextPreviousLocation;\n        return nextPreviousLocation = url;\n      }\n    };\n    trackCurrentLocation();\n    isCurrentLocation = function(url) {\n      var normalizeOptions;\n      normalizeOptions = {\n        stripTrailingSlash: true\n      };\n      return normalizeURL(url, normalizeOptions) === currentLocation(normalizeOptions);\n    };\n\n    /***\n    Replaces the current history entry and updates the\n    browser's location bar with the given URL.\n    \n    When the user navigates to the replaced history entry at a later time,\n    Unpoly will [`replace`](/up.replace) the document body with\n    the body from that URL.\n    \n    Note that functions like [`up.replace()`](/up.replace) or\n    [`up.submit()`](/up.submit) will automatically update the\n    browser's location bar for you.\n    \n    @function up.history.replace\n    @param {string} url\n    @internal\n     */\n    replace = function(url, options) {\n      if (options == null) {\n        options = {};\n      }\n      if (manipulate('replaceState', url) && options.event !== false) {\n        return emit('up:location:changed', {\n          url: url,\n          reason: 'replace',\n          log: \"Replaced state for \" + (u.urlWithoutHost(url))\n        });\n      }\n    };\n\n    /***\n    Adds a new history entry and updates the browser's\n    address bar with the given URL.\n    \n    When the user restores the new history entry later,\n    Unpoly will replace a selector from `up.history.config.restoreTargets` with the body from that URL.\n    \n    Note that [fragment navigation](/navigation) will automatically update the\n    browser's location bar for you.\n    \n    Emits event `up:location:changed`.\n    \n    @function up.history.push\n    @param {string} url\n      The URL for the history entry to be added.\n    @experimental\n     */\n    push = function(url) {\n      url = normalizeURL(url);\n      if (!isCurrentLocation(url) && manipulate('pushState', url)) {\n        return up.emit('up:location:changed', {\n          url: url,\n          reason: 'push',\n          log: \"Advanced to location \" + (u.urlWithoutHost(url))\n        });\n      }\n    };\n\n    /***\n    This event is [emitted](/up.emit) after the browser's address bar was updated with a new URL.\n    \n    There may be several reasons why the browser location was changed:\n    \n    - A fragment update changes history through [navigation](/navigation) or rendering with `{ history: true }`.\n    - The user uses the back or forward buttons in their browser UI.\n    - Programmatic calls to `up.history.push()`.\n    \n    When a [layer](/up.layer) has no [visible history](/up.Layer.prototype.historyVisible), following a link\n    will not cause the browser's address bar to be updated. In this case no `up:location:changed` event will be emitted.\n    However, a `up:layer:location:changed` will be emitted even if the address bar did not change.\n    \n    @event up:location:changed\n    @param {string} event.url\n      The URL for the history entry after the change.\n    @param {string} event.reason\n      The action that caused this change in [history state](https://developer.mozilla.org/en-US/docs/Web/API/History/state).\n    \n      The value of this property is either `'push'`, `'pop'` or `'replace'`.\n    @stable\n     */\n    manipulate = function(method, url) {\n      var state;\n      if (config.enabled) {\n        state = buildState();\n        window.history[method](state, '', url);\n        trackCurrentLocation();\n        return state;\n      }\n    };\n    buildState = function() {\n      return {\n        up: {}\n      };\n    };\n    restoreStateOnPop = function(state) {\n      var replaced, url;\n      if (state != null ? state.up : void 0) {\n        url = currentLocation();\n        replaced = up.render({\n          url: url,\n          history: true,\n          location: url,\n          peel: true,\n          layer: 'root',\n          target: config.restoreTargets,\n          cache: true,\n          keep: false,\n          scroll: 'restore',\n          saveScroll: false\n        });\n        return replaced.then(function() {\n          url = currentLocation();\n          return emit('up:location:changed', {\n            url: url,\n            reason: 'pop',\n            log: \"Restored location \" + url\n          });\n        });\n      } else {\n        return up.puts('pop', 'Ignoring a state not pushed by Unpoly (%o)', state);\n      }\n    };\n    pop = function(event) {\n      var state;\n      trackCurrentLocation();\n      up.viewport.saveScroll({\n        location: previousLocation\n      });\n      state = event.state;\n      return restoreStateOnPop(state);\n    };\n    emit = function() {\n      var args, historyLayer;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      historyLayer = u.find(up.layer.stack.reversed(), 'historyVisible');\n      return historyLayer.emit.apply(historyLayer, args);\n    };\n    up.on('up:app:boot', function() {\n      var register;\n      register = function() {\n        window.history.scrollRestoration = 'manual';\n        window.addEventListener('popstate', pop);\n        if (up.protocol.initialRequestMethod() === 'GET') {\n          return replace(currentLocation(), {\n            event: false\n          });\n        }\n      };\n      if (typeof jasmine !== \"undefined\" && jasmine !== null) {\n        return register();\n      } else {\n        return setTimeout(register, 100);\n      }\n    });\n\n    /***\n    Changes the link's destination so it points to the previous URL.\n    \n    Note that this will *not* call `location.back()`, but will set\n    the link's `[up-href]` attribute to the actual, previous URL.\n    \n    If no previous URL is known, the link will not be changed.\n    \n    \\#\\#\\# Example\n    \n    This link ...\n    \n    ```html\n    <a href=\"/default\" up-back>\n      Go back\n    </a>\n    ```\n    \n    ... will be transformed to:\n    \n    ```html\n    <a href=\"/default\" up-href=\"/previous-page\" up-scroll=\"restore\" up-follow>\n      Go back\n    </a>\n    ```\n    \n    @selector a[up-back]\n    @stable\n     */\n    up.macro('a[up-back], [up-href][up-back]', function(link) {\n      if (previousLocation) {\n        e.setMissingAttrs(link, {\n          'up-href': previousLocation,\n          'up-scroll': 'restore'\n        });\n        link.removeAttribute('up-back');\n        return up.link.makeFollowable(link);\n      }\n    });\n    up.on('up:framework:reset', reset);\n    return u.literal({\n      config: config,\n      push: push,\n      replace: replace,\n      get_location: currentLocation,\n      get_previousLocation: function() {\n        return previousLocation;\n      },\n      isLocation: isCurrentLocation,\n      normalizeURL: normalizeURL\n    });\n  })();\n\n}).call(this);\n(function() {\n  var e, u,\n    slice = [].slice;\n\n  u = up.util;\n\n  e = up.element;\n\n\n  /***\n  Fragment API\n  ===========\n  \n  The `up.fragment` module offers a high-level JavaScript API to work with DOM elements.\n  \n  A fragment is an element with some additional properties that are useful in the context of\n  a server-rendered web application:\n  \n  - Fragments are [identified by a CSS selector](/up.fragment.toTarget), like a `.class` or `#id`.\n  - Fragments are usually updated by a [link](/a-up-follow) for [form](/form-up-submits) that targets their selector.\n    When the server renders HTML with a matching element, the fragment is swapped with a new version.\n  - As fragments enter the page they are automatically [compiled](/up.compiler) to activate JavaScript behavior.\n  - Fragment changes may be [animated](/up.motion).\n  - Fragments are placed on a [layer](/up.layer) that is isolated from other layers.\n    Unpoly features will only see or change fragments from the [current layer](/up.layer.current)\n    unless you [explicitly target another layer](/layer-option).\n  - Fragments [know the URL from where they were loaded](/up.source).\n    They can be [reloaded](/up.reload) or [polled periodically](/up-polled).\n  \n  For low-level DOM utilities that complement the browser's native API, see `up.element`.\n  \n  @see up.render\n  @see up.navigate\n  @see up.destroy\n  @see up.reload\n  @see up.fragment.get\n  @see up.hello\n  \n  @module up.fragment\n   */\n\n  up.fragment = (function() {\n\n    /***\n    Configures defaults for fragment updates.\n    \n    @property up.fragment.config\n    \n    @param {Array<string>} [config.mainTargets=['[up-main]', 'main', ':layer']]\n      An array of CSS selectors matching default render targets.\n    \n      When no other render target is given, Unpoly will try to find and replace a main target.\n    \n      When [navigating](/navigation) to a main target, Unpoly will automatically\n      [reset scroll positions](/scroll-option) and\n      [update the browser history](/up.render#options.history).\n    \n      This property is aliased as [`up.layer.config.any.mainTargets`](up.layer.config#config.any.mainTargets).\n    \n    @param {Array<string|RegExp>} [config.badTargetClasses]\n      An array of class names that should be ignored when\n      [deriving a target selector from a fragment](/up.fragment.toTarget).\n    \n      The class names may also be passed as a regular expression.\n    \n    @param {Object} [config.navigateOptions]\n      An object of default options to apply when [navigating](/navigation).\n    \n    @param {boolean} [config.matchAroundOrigin]\n      Whether to match an existing fragment around the triggered link.\n    \n      If set to `false` Unpoly will replace the first fragment\n      matching the given target selector in the link's [layer](/up.layer).\n    \n    @param {Array<string>} [config.autoHistoryTargets]\n      When an updated fragments contain an element matching one of the given CSS selectors, history will be updated with `{ history: 'auto' }`.\n    \n      By default Unpoly will auto-update history when updating a [main target](#config.mainTargets).\n    \n    @param {boolean|string|Function(Element)} [config.autoScroll]\n      How to scroll after updating a fragment with `{ scroll: 'auto' }`.\n    \n      See [scroll option](/scroll-option) for a list of allowed values.\n    \n      The default configuration tries, in this order:\n    \n      - If the URL has a `#hash`, scroll to the hash.\n      - If updating a [main target](/up-main), reset scroll positions.\n    \n    @param {boolean|string|Function(Element)} [config.autoFocus]\n      How to focus when updating a fragment with `{ focus: 'auto' }`.\n    \n      See [focus option](/focus-option) for a list of allowed values.\n    \n      The default configuration tries, in this order:\n    \n      - Focus a `#hash` in the URL.\n      - Focus an `[autofocus]` element in the new fragment.\n      - If focus was lost with the old fragment, focus the new fragment.\n      - If updating a [main target](/up-main), focus the new fragment.\n    \n    @param {boolean} [config.runScripts=false]\n      Whether to execute `<script>` tags in updated fragments.\n    \n      Scripts will load asynchronously, with no guarantee of execution order.\n    \n      If you set this to `true`, mind that the `<body>` element is a default\n      [main target](/up-main). If you are including your global application scripts\n      at the end of your `<body>`\n      for performance reasons, swapping the `<body>` will re-execute these scripts.\n      In that case you must configure a different main target that does not include\n      your application scripts.\n    \n    @stable\n     */\n    var CSS_HAS_SUFFIX_PATTERN, closest, config, contains, destroy, emitFragmentDestroyed, emitFragmentInserted, emitFragmentKeep, emitFragmentKept, emitFromKeepPlan, expandTargets, failKey, getAll, getDumb, getSmart, getSubtree, hasAutoHistory, hello, isDestroying, isGoodClassForTarget, isNotDestroying, markFragmentAsDestroying, matches, navigate, parseSelector, parseTargetAndOptions, reload, render, renderLocalContent, renderRemoteContent, reset, resolveOriginReference, sourceOf, successKey, timeOf, toTarget, visit;\n    config = new up.Config(function() {\n      return {\n        badTargetClasses: [/^up-/],\n        navigateOptions: {\n          focus: 'auto',\n          scroll: 'auto',\n          solo: true,\n          feedback: true,\n          fallback: true,\n          history: 'auto',\n          peel: true,\n          cache: 'auto'\n        },\n        matchAroundOrigin: true,\n        runScripts: false,\n        autoHistoryTargets: [':main'],\n        autoFocus: ['hash', 'autofocus', 'main-if-main', 'target-if-lost'],\n        autoScroll: ['hash', 'layer-if-main']\n      };\n    });\n    u.delegate(config, 'mainTargets', function() {\n      return up.layer.config.any;\n    });\n    reset = function() {\n      return config.reset();\n    };\n\n    /***\n    Returns the URL the given element was retrieved from.\n    \n    If the given element was never directly updated, but part of a larger fragment update,\n    the closest known source of an ancestor element is returned.\n    \n    \\#\\#\\# Example\n    \n    In the HTML below, the element `#one` was loaded from the URL `/foo`:\n    \n    ```html\n    <div id=\"one\" up-source\"/foo\">\n      <div id=\"two\">...</div>\n    </div>\n    ```\n    \n    We can now ask for the source of an element:\n    \n    ```javascript\n    up.fragment.source('#two') // returns '/foo'\n    ```\n    \n    @function up.fragment.source\n    @param {Element|string} element\n      The element or CSS selector for which to look up the source URL.\n    @return {string|undefined}\n    @stable\n     */\n    sourceOf = function(element, options) {\n      if (options == null) {\n        options = {};\n      }\n      element = getSmart(element, options);\n      return e.closestAttr(element, 'up-source');\n    };\n\n    /***\n    Returns a timestamp for the last modification of the content in the given element.\n    \n    @function up.fragment.time\n    @param {Element} element\n    @return {string}\n    @internal\n     */\n    timeOf = function(element) {\n      return e.closestAttr(element, 'up-time') || '0';\n    };\n\n    /***\n    Sets the time when the fragment's underlying data was last changed.\n    \n    This can be used to avoid rendering unchanged HTML when [reloading](/up.reload)\n    a fragment. This saves <b>CPU time</b> and reduces the <b>bandwidth cost</b> for a\n    request/response exchange to **~1 KB**.\n    \n    \\#\\# Example\n    \n    Let's say we display a list of recent messages.\n    We use the `[up-poll]` attribute to reload the `.messages` fragment every 30 seconds:\n    \n    ```html\n    <div class=\"messages\" up-poll>\n      ...\n    </div>\n    ```\n    \n    The list is now always up to date. But most of the time there will not be new messages,\n    and we waste resources sending the same unchanged HTML from the server.\n    \n    We can improve this by setting an `[up-time]` attribute and the message list.\n    The attribute value is the time of the most recent message.\n    \n    The time is encoded as the number of seconds since [Unix epoch](https://en.wikipedia.org/wiki/Unix_time).\n    When, for instance, the last message in a list was received from December 24th, 1:51:46 PM UTC,\n    we use the following HTML:\n    \n    ```html\n    <div class=\"messages\" up-time=\"1608730818\" up-poll>\n      ...\n    </div>\n    ```\n    \n    When reloading Unpoly will echo the `[up-time]` timestamp in an `X-Up-Reload-From-Time` header:\n    \n    ```http\n    X-Up-Reload-From-Time: 1608730818\n    ```\n    \n    The server can compare the time from the request with the time of the last data update.\n    If no more recent data is available, the server can render nothing and respond with\n    an [`X-Up-Target: :none`](/X-Up-Target) header.\n    \n    Here is an example with [unpoly-rails](https://unpoly.com/install/rails):\n    \n    ```ruby\n    class MessagesController < ApplicationController\n    \n      def index\n        if up.reload_from_time == current_user.last_message_at\n          up.render_nothing\n        else\n          @messages = current_user.messages.order(time: :desc).to_a\n          render 'index'\n        end\n      end\n    \n    end\n    ```\n    \n    @selector [up-time]\n    @param {string} up-time\n      The number of seconds between the [Unix epoch](https://en.wikipedia.org/wiki/Unix_time).\n      and the time when the element's underlying data was last changed.\n    @experimental\n     */\n\n    /***\n    Sets this element's source URL for [reloading](/up.reload) and [polling](/up-poll)\n    \n    When an element is reloaded, Unpoly will make a request from the URL\n    that originally brought the element into the DOM. You may use `[up-source]` to\n    use another URL instead.\n    \n    \\#\\#\\# Example\n    \n    Assume an application layout with an unread message counter.\n    You use `[up-poll]` to refresh the counter every 30 seconds.\n    \n    By default this would make a request to the URL that originally brought the\n    counter element into the DOM. To save the server from rendering a lot of\n    unused HTML, you may poll from a different URL like so:\n    \n        <div class=\"unread-count\" up-poll up-source=\"/unread-count\">\n          2 new messages\n        </div>\n    \n    @selector [up-source]\n    @param {string} up-source\n      The URL from which to reload this element.\n    @stable\n     */\n\n    /***\n    Replaces elements on the current page with matching elements from a server response or HTML string.\n    \n    The current and new elements must both match the same CSS selector.\n    The selector is either given as `{ target }` option,\n    or a [main target](/up-main) is used as default.\n    \n    See the [fragment placement](/fragment-placement) selector for many examples for how you can target content.\n    \n    This function has many options to enable scrolling, focus, request cancelation and other side\n    effects. These options are all disabled by default and must be opted into one-by-one. To enable\n    defaults that a user would expects for navigation (like clicking a link),\n    pass [`{ navigate: true }`](#options.navigate) or use `up.navigate()` instead.\n    \n    \\#\\#\\# Passing the new fragment\n    \n    The new fragment content can be passed as one of the following options:\n    \n    - [`{ url }`](#options.url) fetches and renders content from the server\n    - [`{ document }`](#options.document) renders content from a given HTML document string or partial document\n    - [`{ fragment }`](#options.fragment) renders content from a given HTML string that only contains the new fragment\n    - [`{ content }`](#options-content) replaces the targeted fragment's inner HTML with the given HTML string\n    \n    \\#\\#\\# Example\n    \n    Let's say your current HTML looks like this:\n    \n    ```html\n    <div class=\"one\">old one</div>\n    <div class=\"two\">old two</div>\n    ```\n    \n    We now replace the second `<div>` by targeting its CSS class:\n    \n    ```js\n    up.render({ target: '.two', url: '/new' })\n    ```\n    \n    The server renders a response for `/new`:\n    \n    ```html\n    <div class=\"one\">new one</div>\n    <div class=\"two\">new two</div>\n    ```\n    \n    Unpoly looks for the selector `.two` in the response and [implants](/up.extract) it into\n    the current page. The current page now looks like this:\n    \n    ```html\n    <div class=\"one\">old one</div>\n    <div class=\"two\">new two</div>\n    ```\n    \n    Note how only `.two` has changed. The update for `.one` was\n    discarded, since it didn't match the selector.\n    \n    \\#\\#\\# Events\n    \n    Unpoly will emit events at various stages of the rendering process:\n    \n    - `up:fragment:destroyed`\n    - `up:fragment:loaded`\n    - `up:fragment:inserted`\n    \n    @function up.render\n    \n    @param {string|Element|jQuery|Array<string>} [target]\n      The CSS selector to update.\n    \n      If omitted a [main target](/up-main) will be rendered.\n    \n      You may also pass a DOM element or jQuery element here, in which case a selector\n      will be [inferred from the element attributes](/up.fragment.toTarget). The given element\n      will also be used as [`{ origin }`](#options.origin) for the fragment update.\n    \n      You may also pass an array of selector alternatives. The first selector\n      matching in both old and new content will be used.\n    \n      Instead of passing the target as the first argument, you may also pass it as\n      a [´{ target }`](#options.target) option..\n    \n    @param {string|Element|jQuery|Array<string>} [options.target]\n      The CSS selector to update.\n    \n      See documentation for the [`target`](#target) parameter.\n    \n    @param {string|boolean} [options.fallback=false]\n      Specifies behavior if the [target selector](/up.render#options.target) is missing from the current page or the server response.\n    \n      If set to a CSS selector string, Unpoly will attempt to replace that selector instead.\n    \n      If set to `true` Unpoly will attempt to replace a [main target](/up-main) instead.\n    \n      If set to `false` Unpoly will immediately reject the render promise.\n    \n    @param {boolean} [options.navigate=false]\n      Whether this fragment update is considered [navigation](/navigation).\n    \n    @param {string} [options.url]\n      The URL to fetch from the server.\n    \n      Instead of making a server request, you may also pass an existing HTML string as\n      [`{ document }`](#options.document), [`{ fragment }`](#options.fragment) or\n      [`{ content }`](#options.content) option.\n    \n    @param {string} [options.method='get']\n      The HTTP method to use for the request.\n    \n      Common values are `'get'`, `'post'`, `'put'`, `'patch'` and `'delete`'.\n      The value is case insensitive.\n    \n    @param {Object|FormData|string|Array} [options.params]\n      Additional [parameters](/up.Params) that should be sent as the request's\n      [query string](https://en.wikipedia.org/wiki/Query_string) or payload.\n    \n      When making a `GET` request to a URL with a query string, the given `{ params }` will be added\n      to the query parameters.\n    \n    @param {Object} [options.headers={}]\n      An object with additional request headers.\n    \n      Note that Unpoly will by default send a number of custom request headers.\n      E.g. the `X-Up-Target` header includes the targeted CSS selector.\n      See `up.protocol` and `up.network.config.metaKeys` for details.\n    \n    @param {string|Element} [options.fragment]\n      A string of HTML comprising *only* the new fragment.\n    \n      The `{ target }` selector will be derived from the root element in the given\n      HTML:\n    \n      ```js\n      // This will update .foo\n      up.render({ fragment: '<div class=\".foo\">inner</div>' })\n      ```\n    \n      If your HTML string contains other fragments that will not be rendered, use\n      the [`{ document }`](#options.document) option instead.\n    \n      If your HTML string comprises only the new fragment's [inner HTML](https://developer.mozilla.org/en-US/docs/Web/API/Element/innerHTML),\n      consider the [`{ content }`](#options.content) option.\n    \n    @param {string|Element|Document} [options.document]\n      A string of HTML containing the new fragment.\n    \n      The string may contain other HTML, but only the element matching the\n      `{ target }` selector will be extracted and placed into the page.\n      Other elements will be discarded.\n    \n      If your HTML string comprises only the new fragment, consider the [`{ fragment }`](#options.fragment)\n      option instead. With `{ fragment }` you don't need to pass a `{ target }`, since\n      Unpoly can derive it from the root element in the given HTML.\n    \n      If your HTML string comprises only the new fragment's [inner HTML](https://developer.mozilla.org/en-US/docs/Web/API/Element/innerHTML),\n      consider the [`{ content }`](#options.content) option.\n    \n    @param {string} [options.fail='auto']\n      How to render a server response with an error code.\n    \n      Any HTTP status code other than 2xx is considered an error code.\n    \n      See [handling server errors](/server-errors) for details.\n    \n    @param {boolean|string} [options.history]\n      Whether the browser URL and window title will be updated.\n    \n      If set to `true`, the history will always be updated, using the title and URL from\n      the server response, or from given `{ title }` and `{ location }` options.\n    \n      If set to `'auto'` history will be updated if the `{ target }` matches\n      a selector in `up.fragment.config.autoHistoryTargets`. By default this contains all\n      [main targets](/up-main).\n    \n      If set to `false`, the history will remain unchanged.\n    \n      [Overlays](/up.layer) will only change the browser URL and window title if the overlay\n      has [visible history](/up.layer.historyVisible), even when `{ history: true }` is passed.\n    \n    @param {string} [options.title]\n      An explicit document title to use after rendering.\n    \n      By default the title is extracted from the response's `<title>` tag.\n      You may also pass `{ title: false }` to explicitly prevent the title from being updated.\n    \n      Note that the browser's window title will only be updated it you also\n      pass a [`{ history }`](#options.history) option.\n    \n    @param {string} [options.location]\n      An explicit URL to use after rendering.\n    \n      By default Unpoly will use the `{ url }` or the final URL after the server redirected.\n      You may also pass `{ location: false }` to explicitly prevent the URL from being updated.\n    \n      Note that the browser's URL will only be updated it you also\n      pass a [`{ history }`](#options.history) option.\n    \n    @param {string} [options.transition]\n      The name of an [transition](/up.motion) to morph between the old and few fragment.\n    \n      If you are [prepending or appending content](/fragment-placement#appending-or-prepending-content),\n      use the `{ animation }` option instead.\n    \n    @param {string} [options.animation]\n      The name of an [animation](/up.motion) to reveal a new fragment when\n      [prepending or appending content](/fragment-placement#appending-or-prepending-content).\n    \n      If you are replacing content (the default), use the `{ transition }` option instead.\n    \n    @param {number} [options.duration]\n      The duration of the transition or animation (in millisconds).\n    \n    @param {string} [options.easing]\n      The timing function that accelerates the transition or animation.\n    \n      See [W3C documentation](http://www.w3.org/TR/css3-transitions/#transition-timing-function)\n      for a list of available timing functions.\n    \n    @param {boolean} [options.cache]\n      Whether to read from and write to the [cache](/up.cache).\n    \n      With `{ cache: true }` Unpoly will try to re-use a cached response before connecting\n      to the network. If no cached response exists, Unpoly will make a request and cache\n      the server response.\n    \n      Also see [`up.request({ cache })`](/up.request#options.cache).\n    \n    @param {boolean|string} [options.clearCache]\n      Whether existing [cache](/up.cache) entries will be [cleared](/up.cache.clear) with this request.\n    \n      You may also pass a [URL pattern](/url-patterns) to only clear matching requests.\n    \n      By default a non-GET request will clear the entire cache.\n    \n      Also see [`up.request({ clearCache })`](/up.request#options.clearCache) and `up.network.config.clearCache`.\n    \n    @param {Element|jQuery} [options.origin]\n      The element that triggered the change.\n    \n      When multiple elements in the current page match the `{ target }`,\n      Unpoly will replace an element in the [origin's vicinity](/fragment-placement).\n    \n      The origin's selector will be substituted for `:origin` in a target selector.\n    \n    @param {string|up.Layer|Element} [options.layer='origin current']\n      The [layer](/up.layer) in which to match and render the fragment.\n    \n      See [layer option](/layer-option) for a list of allowed values.\n    \n      To [open the fragment in a new overlay](/opening-overlays), pass `{ layer: 'new' }`.\n      In this case options for `up.layer.open()` may also be used.\n    \n    @param {boolean} [options.peel]\n      Whether to close overlays obstructing the updated layer when the fragment is updated.\n    \n      This is only relevant when updating a layer that is not the [frontmost layer](/up.layer.front).\n    \n    @param {Object} [options.context]\n      An object that will be merged into the [context](/context) of the current layer once the fragment is rendered.\n    \n    @param {boolean} [options.keep=true]\n      Whether [`[up-keep]`](/up-keep) elements will be preserved in the updated fragment.\n    \n    @param {boolean} [options.hungry=true]\n      Whether [`[up-hungry]`](/up-hungry) elements outside the updated fragment will also be updated.\n    \n    @param {boolean|string|Element|Function} [options.scroll]\n      How to scroll after the new fragment was rendered.\n    \n      See [scroll option](/scroll-option) for a list of allowed values.\n    \n    @param {boolean} [options.saveScroll=true]\n      Whether to save scroll positions before updating the fragment.\n    \n      Saved scroll positions can later be restored with [`{ scroll: 'restore' }`](/scroll-option#restoring-scroll-options).\n    \n    @param {boolean|string|Element|Function} [options.focus]\n      What to focus after the new fragment was rendered.\n    \n      See [focus option](/focus-option) for a list of allowed values.\n    \n    @param {string} [options.confirm]\n      A message the user needs to confirm before fragments are updated.\n    \n      The message will be shown as a [native browser prompt](https://developer.mozilla.org/en-US/docs/Web/API/Window/prompt).\n    \n      If the user does not confirm the render promise will reject and no fragments will be updated.\n    \n    @param {boolean|Element} [options.feedback]\n      Whether to give the [`{ origin }`](#options.origin) element an `.up-active` class\n      while loading and rendering content.\n    \n      May also pass an element which should receive the `.up-active` class.\n    \n    @param {Function(Event)} [options.onLoaded]\n      A callback that will be run when when the server responds with new HTML,\n      but before the HTML is rendered.\n    \n      The callback argument is a preventable `up:fragment:loaded` event.\n    \n    @param {Function()} [options.onFinished]\n      A callback that will be run when all animations have concluded and\n      elements were removed from the DOM tree.\n    \n    @return {Promise<up.RenderResult>}\n      A promise that fulfills when the page has been updated.\n    \n      If the update is animated, the promise will be resolved *before* the existing element was\n      removed from the DOM tree. The old element will be marked with the `.up-destroying` class\n      and removed once the animation finishes. To run code after the old element was removed,\n      pass an `{ onFinished }` callback.\n    \n      The promise will fulfill with an `up.RenderResult` that contains\n      references to the updated fragments and layer.\n    \n    @stable\n     */\n    render = up.mockable(function() {\n      var args;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      return u.asyncify(function() {\n        var guardEvent, options;\n        options = parseTargetAndOptions(args);\n        options = up.RenderOptions.preprocess(options);\n        up.browser.assertConfirmed(options);\n        if (guardEvent = u.pluckKey(options, 'guardEvent')) {\n          guardEvent.renderOptions = options;\n          up.event.assertEmitted(guardEvent, {\n            target: options.origin\n          });\n        }\n        up.RenderOptions.assertContentGiven(options);\n        if (options.url) {\n          return renderRemoteContent(options);\n        } else {\n          return renderLocalContent(options);\n        }\n      });\n    });\n    renderRemoteContent = function(options) {\n      return up.feedback.aroundForOptions(options, function() {\n        return new up.Change.FromURL(options).execute();\n      });\n    };\n    renderLocalContent = function(options) {\n      up.network.mimicLocalRequest(options);\n      return new up.Change.FromContent(options).execute();\n    };\n\n    /***\n    [Navigates](/navigation) to the given URL by updating a major fragment in the current page.\n    \n    `up.navigate()` will mimic a click on a vanilla `<a href>` link to satisfy user expectations\n    regarding scrolling, focus, request cancelation and [many other side effects](/navigation).\n    \n    Instead of calling `up.navigate()` you may also call `up.render({ navigate: true }`) option\n    for the same effect.\n    \n    @function up.navigate\n    @param {string|Element|jQuery} [target]\n      The CSS selector to update.\n    \n      If omitted a [main target](/up-main) will be rendered.\n    \n      You can also pass a DOM element or jQuery element here, in which case a selector\n      will be [inferred from the element attributes](/up.fragment.target). The given element\n      will also be set as the `{ origin }` option.\n    \n      Instead of passing the target as the first argument, you may also pass it as\n      [´{ target }` option](/up.fragment.render#options.target).\n    @param {Object} [options]\n      See options for `up.render()`.\n    @stable\n     */\n    navigate = up.mockable(function() {\n      var args, options;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      options = parseTargetAndOptions(args);\n      return render(u.merge(options, {\n        navigate: true\n      }));\n    });\n\n    /***\n    This event is [emitted](/up.emit) when the server responds with the HTML, before\n    the HTML is used to [change a fragment](/up.render).\n    \n    Event listeners may call `event.preventDefault()` on an `up:fragment:loaded` event\n    to prevent any changes to the DOM and browser history. This is useful to detect\n    an entirely different page layout (like a maintenance page or fatal server error)\n    which should be open with a full page load:\n    \n    ```js\n    up.on('up:fragment:loaded', (event) => {\n      let isMaintenancePage = event.response.getHeader('X-Maintenance')\n    \n      if (isMaintenancePage) {\n        // Prevent the fragment update and don't update browser history\n        event.preventDefault()\n    \n        // Make a full page load for the same request.\n        event.request.loadPage()\n      }\n    })\n    ```\n    \n    Instead of preventing the update, listeners may also access the `event.renderOptions` object\n    to mutate options to the `up.render()` call that will process the server response.\n    \n    @event up:fragment:loaded\n    @param event.preventDefault()\n      Event listeners may call this method to prevent the fragment change.\n    @param {up.Request} event.request\n      The original request to the server.\n    @param {up.Response} event.response\n      The server response.\n    @param {Object} event.renderOptions\n      Options for the `up.render()` call that will process the server response.\n    @stable\n     */\n\n    /***\n    Elements with an `up-keep` attribute will be persisted during\n    [fragment updates](/up.fragment).\n    \n    The element you're keeping should have an umambiguous class name, ID or `[up-id]`\n    attribute so Unpoly can find its new position within the page update.\n    \n    Emits events [`up:fragment:keep`](/up:fragment:keep) and [`up:fragment:kept`](/up:fragment:kept).\n    \n    \\#\\#\\# Example\n    \n    The following `<audio>` element will be persisted through fragment\n    updates as long as the responses contain an element matching `#player`:\n    \n    \n    ```html\n    <audio id=\"player\" up-keep src=\"song.mp3\"></audio>\n    ```\n    \n    \\#\\#\\# Controlling if an element will be kept\n    \n    Unpoly will **only** keep an existing element if:\n    \n    - The existing element has an `up-keep` attribute\n    - The response contains an element matching the CSS selector of the existing element\n    - The matching element *also* has an `up-keep` attribute\n    - The [`up:fragment:keep`](/up:fragment:keep) event that is [emitted](/up.emit) on the existing element\n      is not prevented by a event listener.\n    \n    Let's say we want only keep an `<audio>` element as long as it plays\n    the same song (as identified by the tag's `src` attribute).\n    \n    On the client we can achieve this by listening to an `up:keep:fragment` event\n    and preventing it if the `src` attribute of the old and new element differ:\n    \n        up.compiler('audio', function(element) {\n          element.addEventListener('up:fragment:keep', function(event) {\n            if element.getAttribute('src') !== event.newElement.getAttribute('src') {\n              event.preventDefault()\n            }\n          })\n        })\n    \n    If we don't want to solve this on the client, we can achieve the same effect\n    on the server. By setting the value of the `up-keep` attribute we can\n    define the CSS selector used for matching elements.\n    \n        <audio up-keep=\"audio[src='song.mp3']\" src=\"song.mp3\"></audio>\n    \n    Now, if a response no longer contains an `<audio src=\"song.mp3\">` tag, the existing\n    element will be destroyed and replaced by a fragment from the response.\n    \n    @selector [up-keep]\n    @param up-on-keep\n      Code to run before an existing element is kept during a page update.\n    \n      The code may use the variables `event` (see `up:fragment:keep`),\n      `this` (the old fragment), `newFragment` and `newData`.\n    @stable\n     */\n\n    /***\n    This event is [emitted](/up.emit) before an existing element is [kept](/up-keep) during\n    a page update.\n    \n    Event listeners can call `event.preventDefault()` on an `up:fragment:keep` event\n    to prevent the element from being persisted. If the event is prevented, the element\n    will be replaced by a fragment from the response.\n    \n    @event up:fragment:keep\n    @param event.preventDefault()\n      Event listeners may call this method to prevent the element from being preserved.\n    @param {Element} event.target\n      The fragment that will be kept.\n    @param {Element} event.newFragment\n      The discarded element.\n    @param {Object} event.newData\n      The value of the [`up-data`](/up-data) attribute of the discarded element,\n      parsed as a JSON object.\n    @stable\n     */\n\n    /***\n    This event is [emitted](/up.emit) when an existing element has been [kept](/up-keep)\n    during a page update.\n    \n    Event listeners can inspect the discarded update through `event.newElement`\n    and `event.newData` and then modify the preserved element when necessary.\n    \n    @event up:fragment:kept\n    @param {Element} event.target\n      The fragment that has been kept.\n    @param {Element} event.newFragment\n      The discarded fragment.\n    @param {Object} event.newData\n      The value of the [`up-data`](/up-data) attribute of the discarded fragment,\n      parsed as a JSON object.\n    @stable\n     */\n\n    /***\n    Compiles a page fragment that has been inserted into the DOM\n    by external code.\n    \n    **As long as you manipulate the DOM using Unpoly, you will never\n    need to call this method.** You only need to use `up.hello()` if the\n    DOM is manipulated without Unpoly' involvement, e.g. by setting\n    the `innerHTML` property or calling jQuery methods like\n    `html`, `insertAfter` or `appendTo`:\n    \n    ```html\n    element = document.createElement('div')\n    element.innerHTML = '... HTML that needs to be activated ...'\n    up.hello(element)\n    ```\n    \n    This function emits the [`up:fragment:inserted`](/up:fragment:inserted)\n    event.\n    \n    @function up.hello\n    @param {Element|jQuery} target\n    @param {Element|jQuery} [options.origin]\n    @return {Element}\n      The compiled element\n    @stable\n     */\n    hello = function(element, options) {\n      var keepPlans, skip;\n      if (options == null) {\n        options = {};\n      }\n      element = getSmart(element);\n      keepPlans = options.keepPlans || [];\n      skip = keepPlans.map(function(plan) {\n        emitFragmentKept(plan);\n        return plan.oldElement;\n      });\n      up.syntax.compile(element, {\n        skip: skip,\n        layer: options.layer\n      });\n      emitFragmentInserted(element, options);\n      return element;\n    };\n\n    /***\n    When any page fragment has been [inserted or updated](/up.replace),\n    this event is [emitted](/up.emit) on the fragment.\n    \n    If you're looking to run code when a new fragment matches\n    a selector, use `up.compiler()` instead.\n    \n    \\#\\#\\# Example\n    \n        up.on('up:fragment:inserted', function(event, fragment) {\n          console.log(\"Looks like we have a new %o!\", fragment)\n        })\n    \n    @event up:fragment:inserted\n    @param {Element} event.target\n      The fragment that has been inserted or updated.\n    @stable\n     */\n    emitFragmentInserted = function(element, options) {\n      return up.emit(element, 'up:fragment:inserted', {\n        log: ['Inserted fragment %o', element],\n        origin: options.origin\n      });\n    };\n    emitFragmentKeep = function(keepPlan) {\n      var callback, log;\n      log = ['Keeping fragment %o', keepPlan.oldElement];\n      callback = e.callbackAttr(keepPlan.oldElement, 'up-on-keep', ['newFragment', 'newData']);\n      return emitFromKeepPlan(keepPlan, 'up:fragment:keep', {\n        log: log,\n        callback: callback\n      });\n    };\n    emitFragmentKept = function(keepPlan) {\n      var log;\n      log = ['Kept fragment %o', keepPlan.oldElement];\n      return emitFromKeepPlan(keepPlan, 'up:fragment:kept', {\n        log: log\n      });\n    };\n    emitFromKeepPlan = function(keepPlan, eventType, emitDetails) {\n      var event, keepable;\n      keepable = keepPlan.oldElement;\n      event = up.event.build(eventType, {\n        newFragment: keepPlan.newElement,\n        newData: keepPlan.newData\n      });\n      return up.emit(keepable, event, emitDetails);\n    };\n    emitFragmentDestroyed = function(fragment, options) {\n      var log, parent, ref;\n      log = (ref = options.log) != null ? ref : ['Destroyed fragment %o', fragment];\n      parent = options.parent || document;\n      return up.emit(parent, 'up:fragment:destroyed', {\n        fragment: fragment,\n        parent: parent,\n        log: log\n      });\n    };\n    isDestroying = function(element) {\n      return !!e.closest(element, '.up-destroying');\n    };\n    isNotDestroying = function(element) {\n      return !isDestroying(element);\n    };\n\n    /***\n    Returns the first fragment matching the given selector.\n    \n    This function differs from `document.querySelector()` and `up.element.get()`:\n    \n    - This function only selects elements in the [current layer](/up.layer.current).\n      Pass a `{ layer }`option to match elements in other layers.\n    - This function ignores elements that are being [destroyed](/up.destroy) or that are being\n      removed by a [transition](/up.morph).\n    - This function prefers to match elements in the vicinity of a given `{ origin }` element (optional).\n    - This function supports non-standard CSS selectors like `:main` and `:has()`.\n    \n    If no element matches these conditions, `undefined` is returned.\n    \n    \\#\\#\\# Example: Matching a selector in a layer\n    \n    To select the first element with the selector `.foo` on the [current layer](/up.layer.current):\n    \n        let foo = up.fragment.get('.foo')\n    \n    You may also pass a `{ layer }` option to match elements within another layer:\n    \n        let foo = up.fragment.get('.foo', { layer: 'any' })\n    \n    \\#\\#\\# Example: Matching the descendant of an element\n    \n    To only select in the descendants of an element, pass a root element as the first argument:\n    \n        let container = up.fragment.get('.container')\n        let fooInContainer = up.fragment.get(container, '.foo')\n    \n    \\#\\#\\# Example: Matching around an origin element\n    \n    When processing a user interaction, it is often helpful to match elements around the link\n    that's being clicked or the form field that's being changed. In this case you may pass\n    the triggering element as `{ origin }` element.\n    \n    Assume the following HTML:\n    \n    ```html\n    <div class=\"element\"></div>\n    <div class=\"element\">\n      <a href=\"...\"></a>\n    </div>\n    ```\n    \n    When processing an event for the `<a href\"...\">` you can pass the link element\n    as `{ origin }` to match the closest element in the link's ancestry:\n    \n    ```javascript\n    let link = event.target\n    up.fragment.get('.element') // returns the first .element\n    up.fragment.get('.element', { origin: link }) // returns the second .element\n    ```\n    \n    When the link's does not have an ancestor matching `.element`,\n    Unpoly will search the entire layer for `.element`.\n    \n    \\#\\#\\# Example: Matching an origin sibling\n    \n    When processing a user interaction, it is often helpful to match elements\n    within the same container as the the link that's being clicked or the form field that's\n    being changed.\n    \n    Assume the following HTML:\n    \n    ```html\n    <div class=\"element\" id=\"one\">\n      <div class=\"inner\"></div>\n    </div>\n    <div class=\"element\" id=\"two\">\n      <a href=\"...\"></a>\n      <div class=\"inner\"></div>\n    </div>\n    ```\n    \n    When processing an event for the `<a href\"...\">` you can pass the link element\n    as `{ origin }` to match within the link's container:\n    \n    ```javascript\n    let link = event.target\n    up.fragment.get('.element .inner') // returns the first .inner\n    up.fragment.get('.element .inner', { origin: link }) // returns the second .inner\n    ```\n    \n    Note that when the link's `.element` container does not have a child `.inner`,\n    Unpoly will search the entire layer for `.element .inner`.\n    \n    \\#\\#\\# Similar features\n    \n    - The [`.up-destroying`](/up-destroying) class is assigned to elements during their removal animation.\n    - The [`up.element.get()`](/up.element.get) function simply returns the first element matching a selector\n      without filtering by layer or destruction state.\n    \n    @function up.fragment.get\n    @param {Element|jQuery} [root=document]\n      The root element for the search. Only the root's children will be matched.\n    \n      May be omitted to search through all elements in the `document`.\n    @param {string} selector\n      The selector to match.\n    @param {string} [options.layer='current']\n      The layer in which to select elements.\n    \n      See `up.layer.get()` for a list of supported layer values.\n    \n      If a root element was passed as first argument, this option is ignored and the\n      root element's layer is searched.\n    @param {string|Element|jQuery} [options.origin]\n      An second element or selector that can be referenced as `&` in the first selector.\n    @return {Element|undefined}\n      The first matching element, or `undefined` if no such element matched.\n    @stable\n     */\n    getSmart = function() {\n      var args, finder, options, root, selector;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      options = u.extractOptions(args);\n      selector = args.pop();\n      root = args[0];\n      if (u.isElementish(selector)) {\n        return e.get(selector);\n      }\n      if (root) {\n        return getDumb(root, selector, options);\n      }\n      finder = new up.FragmentFinder({\n        selector: selector,\n        origin: options.origin,\n        layer: options.layer\n      });\n      return finder.find();\n    };\n    getDumb = function() {\n      var args;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      return getAll.apply(null, args)[0];\n    };\n    CSS_HAS_SUFFIX_PATTERN = /\\:has\\(([^\\)]+)\\)$/;\n\n    /***\n    Returns all elements matching the given selector, but\n    ignores elements that are being [destroyed](/up.destroy) or that are being\n    removed by a [transition](/up.morph).\n    \n    By default this function only selects elements in the [current layer](/up.layer.current).\n    Pass a `{ layer }`option to match elements in other layers. See `up.layer.get()` for a list\n    of supported layer values.\n    \n    Returns an empty list if no element matches these conditions.\n    \n    \\#\\#\\# Example\n    \n    To select all elements with the selector `.foo` on the [current layer](/up.layer.current):\n    \n        let foos = up.fragment.all('.foo')\n    \n    You may also pass a `{ layer }` option to match elements within another layer:\n    \n        let foos = up.fragment.all('.foo', { layer: 'any' })\n    \n    To select in the descendants of an element, pass a root element as the first argument:\n    \n        var container = up.fragment.get('.container')\n        var foosInContainer = up.fragment.all(container, '.foo')\n    \n    \\#\\#\\# Similar features\n    \n    - The [`.up-destroying`](/up-destroying) class is assigned to elements during their removal animation.\n    - The [`up.element.all()`](/up.element.get) function simply returns the all elements matching a selector\n      without further filtering.\n    \n    @function up.fragment.all\n    \n    @param {Element|jQuery} [root=document]\n      The root element for the search. Only the root's children will be matched.\n    \n      May be omitted to search through all elements in the given [layer](#options.layer).\n    \n    @param {string} selector\n      The selector to match.\n    \n    @param {string} [options.layer='current']\n      The layer in which to select elements.\n    \n      See `up.layer.get()` for a list of supported layer values.\n    \n      If a root element was passed as first argument, this option is ignored and the\n      root element's layer is searched.\n    \n    @param {string|Element|jQuery} [options.origin]\n      An second element or selector that can be referenced as `&` in the first selector:\n    \n          var input = document.querySelector('input.email')\n          up.fragment.get('fieldset:has(&)', { origin: input }) // returns the <fieldset> containing input\n    \n    @return {Element|undefined}\n      The first matching element, or `undefined` if no such element matched.\n    @stable\n     */\n    getAll = function() {\n      var args, options, root, selector;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      options = u.extractOptions(args);\n      selector = args.pop();\n      root = args[0];\n      selector = parseSelector(selector, root, options);\n      return selector.descendants(root || document);\n    };\n\n    /***\n    Your target selectors may use this pseudo-selector\n    to replace an element with an descendant matching the given selector.\n    \n    \\#\\#\\# Example\n    \n    `up.render('div:has(span)', { url: '...' })`  replaces the first `<div>` elements with at least one `<span>` among its descendants:\n    \n    ```html\n    <div>\n      <span>Will be replaced</span>\n    </div>\n    <div>\n      Will NOT be replaced\n    </div>\n    ```\n    \n    \\#\\#\\# Compatibility\n    \n    `:has()` is supported by target selectors like `a[up-target]` and `up.render({ target })`.\n    \n    As a [level 4 CSS selector](https://drafts.csswg.org/selectors-4/#relational),\n    `:has()` [has yet to be implemented](https://caniuse.com/#feat=css-has)\n    in native browser functions like [`document.querySelectorAll()`](https://developer.mozilla.org/en-US/docs/Web/API/Element/querySelectorAll).\n    \n    You can also use [`:has()` in jQuery](https://api.jquery.com/has-selector/).\n    \n    @selector :has()\n    @stable\n     */\n\n    /***\n    Returns a list of the given parent's descendants matching the given selector.\n    The list will also include the parent element if it matches the selector itself.\n    \n    @function up.fragment.subtree\n    @param {Element} parent\n      The parent element for the search.\n    @param {string} selector\n      The CSS selector to match.\n    @param {up.Layer|string|Element}\n      [options.layer]\n    @return {NodeList<Element>|Array<Element>}\n      A list of all matching elements.\n    @experimental\n     */\n    getSubtree = function(element, selector, options) {\n      if (options == null) {\n        options = {};\n      }\n      selector = parseSelector(selector, element, options);\n      return selector.subtree(element);\n    };\n    contains = function(element, selector) {\n      return getSubtree(element, selector).length > 0;\n    };\n\n    /***\n    Returns the first element that matches the selector by testing the element itself\n    and traversing up through ancestors in element's layers.\n    \n    `up.fragment.closest()` will only match elements in the same [layer](/up.layer) as\n    the given element. To match ancestors regardless of layers, use `up.element.closest()`.\n    \n    @function up.fragment.closest\n    @param {Element} element\n      The element on which to start the search.\n    @param {string} selector\n      The CSS selector to match.\n    @return {Element|null|undefined} element\n      The matching element.\n    \n      Returns `null` or `undefined` if no element matches in the same layer.\n    @experimental\n     */\n    closest = function(element, selector, options) {\n      element = e.get(element);\n      selector = parseSelector(selector, element, options);\n      return selector.closest(element);\n    };\n\n    /***\n    Destroys the given element or selector.\n    \n    All [`up.compiler()`](/up.compiler) destructors, if any, are called.\n    The element is then removed from the DOM.\n    \n    Emits events [`up:fragment:destroyed`](/up:fragment:destroyed).\n    \n    \\#\\#\\# Animating the removal\n    \n    You may animate the element's removal by passing an option like `{ animate: 'fade-out' }`.\n    Unpoly ships with a number of [predefined animations](/up.animate#named-animations) and\n    you may so define [custom animations](/up.animation).\n    \n    If the element's removal is animated, the element will remain in the DOM until after the animation\n    has completed. While the animation is running the element will be given the `.up-destroying` class.\n    The element will also be given the `[aria-hidden]` attribute to remove it from\n    the accessibility tree.\n    \n    Elements that are about to be destroyed (but still animating) are ignored by all\n    functions for fragment lookup:\n    \n    - `up.fragment.all()`\n    - `up.fragment.get()`\n    - `up.fragment.closest()`\n    \n    @function up.destroy\n    @param {string|Element|jQuery} target\n    @param {string|Function(element, options): Promise} [options.animation='none']\n      The animation to use before the element is removed from the DOM.\n    @param {number} [options.duration]\n      The duration of the animation. See [`up.animate()`](/up.animate).\n    @param {string} [options.easing]\n      The timing function that controls the animation's acceleration. See [`up.animate()`](/up.animate).\n    @param {Function} [options.onFinished]\n      A callback that is run when any animations are finished and the element was removed from the DOM.\n    @return undefined\n    @stable\n     */\n    destroy = function() {\n      var args, base, options;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      options = parseTargetAndOptions(args);\n      if (options.element = getSmart(options.target, options)) {\n        new up.Change.DestroyFragment(options).execute();\n      }\n      return typeof (base = up.migrate).formerlyAsync === \"function\" ? base.formerlyAsync('up.destroy()') : void 0;\n    };\n    parseTargetAndOptions = function(args) {\n      var options;\n      options = u.parseArgIntoOptions(args, 'target');\n      if (u.isElement(options.target)) {\n        options.origin || (options.origin = options.target);\n      }\n      return options;\n    };\n\n    /***\n    Elements are assigned the `.up-destroying` class before they are [destroyed](/up.destroy)\n    or while they are being removed by a [transition](/up.morph).\n    \n    If the removal is [animated](/up.destroy#animating-the-removal),\n    the class is assigned before the animation starts.\n    \n    Elements that are about to be destroyed (but still animating) are ignored by all\n    functions for fragment lookup:\n    \n    - `up.fragment.all()`\n    - `up.fragment.get()`\n    - `up.fragment.closest()`\n    \n    @selector .up-destroying\n    @stable\n     */\n    markFragmentAsDestroying = function(element) {\n      element.classList.add('up-destroying');\n      return element.setAttribute('aria-hidden', 'true');\n    };\n\n    /***\n    This event is [emitted](/up.emit) after a page fragment was [destroyed](/up.destroy) and removed from the DOM.\n    \n    If the destruction is animated, this event is emitted after the animation has ended.\n    \n    The event is emitted on the parent element of the fragment that was removed.\n    \n    @event up:fragment:destroyed\n    @param {Element} event.fragment\n      The detached element that has been removed from the DOM.\n    @param {Element} event.parent\n      The former parent element of the fragment that has now been detached from the DOM.\n    @param {Element} event.target\n      The former parent element of the fragment that has now been detached from the DOM.\n    @stable\n     */\n\n    /***\n    Replaces the given element with a fresh copy fetched from the server.\n    \n    By default, reloading is not considered a [user navigation](/navigation) and e.g. will not update\n    the browser location. You may change this with `{ navigate: true }`.\n    \n    \\#\\#\\# Example\n    \n        up.on('new-mail', function() { up.reload('.inbox') })\n    \n    \\#\\#\\# Controlling the URL that is reloaded\n    \n    Unpoly remembers [the URL from which a fragment was loaded](/up.fragment.source),\n    so you don't usually need to pass a URL when reloading.\n    \n    To reload from another URL, pass a `{ url }` option or set an `[up-source]` attribute\n    on the element or its ancestors.\n    \n    \\#\\#\\# Skipping updates when nothing changed\n    \n    You may use the `[up-time]` attribute to avoid rendering unchanged HTML when reloading\n    a fragment. See `[up-time]` for a detailed example.\n    \n    @function up.reload\n    @param {string|Element|jQuery} [target]\n      The element that should be reloaded.\n    \n      If omitted, an element matching a selector in `up.fragment.config.mainTargets`\n      will be reloaded.\n    @param {Object} [options]\n      See options for `up.render()`.\n    @param {string} [options.url]\n      The URL from which to reload the fragment.\n      This defaults to the URL from which the fragment was originally loaded.\n    @param {string} [options.navigate=false]\n      Whether the reloading constitutes a [user navigation](/navigation).\n    @stable\n     */\n    reload = function() {\n      var args, element, options;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      options = parseTargetAndOptions(args);\n      options.target || (options.target = ':main');\n      element = getSmart(options.target, options);\n      if (options.url == null) {\n        options.url = sourceOf(element);\n      }\n      options.headers || (options.headers = {});\n      options.headers[up.protocol.headerize('reloadFromTime')] = timeOf(element);\n      return render(options);\n    };\n\n    /***\n    Fetches this given URL with JavaScript and [replaces](/up.replace) the\n    [current layer](/up.layer.current)'s [main element](/up.fragment.config#config.mainSelectors)\n    with a matching fragment from the server response.\n    \n    \\#\\#\\# Example\n    \n    This would replace the current page with the response for `/users`:\n    \n        up.visit('/users')\n    \n    @function up.visit\n    @param {string} url\n      The URL to visit.\n    @param {Object} [options]\n      See options for `up.render()`.\n    @param {up.Layer|string|number} [options.layer='current']\n    @stable\n     */\n    visit = function(url, options) {\n      return navigate(u.merge({\n        url: url\n      }, options));\n    };\n    successKey = function(key) {\n      return u.unprefixCamelCase(key, 'fail');\n    };\n    failKey = function(key) {\n      if (!key.match(/^fail[A-Z]/)) {\n        return u.prefixCamelCase(key, 'fail');\n      }\n    };\n\n    /***\n    Returns a CSS selector that matches the given element as good as possible.\n    \n    To build the selector, the following element properties are used in decreasing\n    order of priority:\n    \n    - The element's `[up-id]` attribute\n    - The element's `[id]` attribute\n    - The element's `[name]` attribute\n    - The element's `[class]` names, ignoring `up.fragment.config.badTargetClasses`.\n    - The element's tag name\n    \n    \\#\\#\\# Example\n    \n    ```js\n    element = up.element.createFromHTML('<span class=\"klass\">...</span>')\n    selector = up.fragment.toTarget(element) // returns '.klass'\n    ```\n    \n    @function up.fragment.toTarget\n    @param {string|Element|jQuery}\n      The element for which to create a selector.\n    @stable\n     */\n    toTarget = function(element) {\n      var goodClasses, i, id, klass, len, name, selector, upId;\n      if (u.isString(element)) {\n        return element;\n      }\n      element = e.get(element);\n      if (e.isSingleton(element)) {\n        return e.elementTagName(element);\n      } else if (upId = element.getAttribute(\"up-id\")) {\n        return e.attributeSelector('up-id', upId);\n      } else if (id = element.getAttribute(\"id\")) {\n        return e.idSelector(id);\n      } else if (name = element.getAttribute(\"name\")) {\n        return e.elementTagName(element) + e.attributeSelector('name', name);\n      } else if (goodClasses = u.presence(u.filter(element.classList, isGoodClassForTarget))) {\n        selector = '';\n        for (i = 0, len = goodClasses.length; i < len; i++) {\n          klass = goodClasses[i];\n          selector += e.classSelector(klass);\n        }\n        return selector;\n      } else {\n        return e.elementTagName(element);\n      }\n    };\n\n    /***\n    Sets an unique identifier for this element.\n    \n    This identifier is used by `up.fragment.toSelector()`\n    to create a CSS selector that matches this element precisely.\n    \n    If the element already has other attributes that make a good identifier,\n    like a good `[id]` or `[class]` attribute, it is not necessary to\n    also set `[up-id]`.\n    \n    \\#\\#\\# Example\n    \n    Take this element:\n    \n        <a href=\"/\">Homepage</a>\n    \n    Unpoly cannot generate a good CSS selector for this element:\n    \n        up.fragment.toTarget(element)\n        // returns 'a'\n    \n    We can improve this by assigning an `[up-id]`:\n    \n        <a href=\"/\" up-id=\"link-to-home\">Open user 4</a>\n    \n    The attribute value is used to create a better selector:\n    \n        up.fragment.toTarget(element)\n        // returns '[up-id=\"link-to-home\"]'\n    \n    @selector [up-id]\n    @param up-id\n      A string that uniquely identifies this element.\n    @stable\n     */\n    isGoodClassForTarget = function(klass) {\n      var matchesPattern;\n      matchesPattern = function(pattern) {\n        if (u.isRegExp(pattern)) {\n          return pattern.test(klass);\n        } else {\n          return pattern === klass;\n        }\n      };\n      return !u.some(config.badTargetClasses, matchesPattern);\n    };\n    resolveOriginReference = function(target, options) {\n      var origin;\n      if (options == null) {\n        options = {};\n      }\n      origin = options.origin;\n      return target.replace(/&|:origin\\b/, function(match) {\n        if (origin) {\n          return toTarget(origin);\n        } else {\n          return up.fail('Missing { origin } element to resolve \"%s\" reference (found in %s)', match, target);\n        }\n      });\n    };\n\n    /***\n    @internal\n     */\n    expandTargets = function(targets, options) {\n      var expanded, layer, mode, target;\n      if (options == null) {\n        options = {};\n      }\n      layer = options.layer;\n      if (!(layer === 'new' || (layer instanceof up.Layer))) {\n        up.fail('Must pass an up.Layer as { layer } option, but got %o', layer);\n      }\n      targets = u.copy(u.wrapList(targets));\n      expanded = [];\n      while (targets.length) {\n        target = targets.shift();\n        if (target === ':main' || target === true) {\n          mode = layer === 'new' ? options.mode : layer.mode;\n          targets.unshift.apply(targets, up.layer.mainTargets(mode));\n        } else if (target === ':layer') {\n          if (!(layer === 'new' || layer.opening)) {\n            targets.unshift(layer.getFirstSwappableElement());\n          }\n        } else if (u.isElementish(target)) {\n          expanded.push(toTarget(target));\n        } else if (u.isString(target)) {\n          expanded.push(resolveOriginReference(target, options));\n        } else {\n\n        }\n      }\n      return u.uniq(expanded);\n    };\n    parseSelector = function(selector, element, options) {\n      var expandedTargets, filters, layers;\n      if (options == null) {\n        options = {};\n      }\n      filters = [];\n      if (!options.destroying) {\n        filters.push(isNotDestroying);\n      }\n      options.layer || (options.layer = element);\n      layers = up.layer.getAll(options);\n      if (options.layer !== 'any' && !(element && e.isDetached(element))) {\n        filters.push(function(match) {\n          return u.some(layers, function(layer) {\n            return layer.contains(match);\n          });\n        });\n      }\n      expandedTargets = up.fragment.expandTargets(selector, u.merge(options, {\n        layer: layers[0]\n      }));\n      expandedTargets = expandedTargets.map(function(target) {\n        target = target.replace(CSS_HAS_SUFFIX_PATTERN, function(match, descendantSelector) {\n          filters.push(function(element) {\n            return element.querySelector(descendantSelector);\n          });\n          return '';\n        });\n        return target || '*';\n      });\n      return new up.Selector(expandedTargets, filters);\n    };\n    hasAutoHistory = function(fragment) {\n      if (contains(fragment, config.autoHistoryTargets)) {\n        return true;\n      } else {\n        up.puts('up.render()', \"Will not auto-update history because fragment doesn't contain a selector from up.fragment.config.autoHistoryTargets\");\n        return false;\n      }\n    };\n\n    /***\n    A pseudo-selector that matches the layer's main target.\n    \n    Main targets are default render targets.\n    When no other render target is given, Unpoly will try to find and replace a main target.\n    \n    In most app layouts the main target should match the primary content area.\n    The default main targets are:\n    \n    - any element with an `[up-main]` attribute\n    - the HTML5 [`<main>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/main) element\n    - the current layer's [topmost swappable element](/layer)\n    \n    You may configure main target selectors in `up.fragment.config.mainTargets`.\n    \n    \\#\\#\\# Example\n    \n    ```js\n    up.render(':main', { url: '/page2' })\n    ```\n    \n    @selector :main\n    @experimental\n     */\n\n    /***\n    Updates this element when no other render target is given.\n    \n    \\#\\#\\# Example\n    \n    Many links simply replace the main content element in your application layout.\n    \n    Unpoly lets you mark this elements as a default target using the `[up-main]` attribute:\n    \n    ```html\n    <body>\n      <div class=\"layout\">\n        <div class=\"layout--side\">\n          ...\n        </div>\n        <div class=\"layout--content\" up-main>\n          ...\n        </div>\n      </div>\n    </body>\n    ```\n    \n    Once a main target is configured, you no longer need `[up-target]` in a link.\\\n    Use `[up-follow]` and the `[up-main]` element will be replaced:\n    \n    ```html\n    <a href=\"/foo\" up-follow>...</a>\n    ```\n    \n    If you want to update something more specific, you can still use `[up-target]`:\n    \n    ```html\n    <a href=\"/foo\" up-target=\".profile\">...</a>\n    ```\n    \n    Instead of assigning `[up-main]` you may also configure an existing selector in `up.fragment.config.mainTargets`:\n    \n    ```js\n    up.fragment.config.mainTargets.push('.layout--content')\n    ```\n    \n    Overlays can use different main targets\n    ---------------------------------------\n    \n    Overlays often use a different default selector, e.g. to exclude a navigation bar.\n    \n    To define a different main target for an overlay, set the [layer mode](/layer-terminology) as the\n    value of the `[up-main]` attribute:\n    \n    ```html\n    <body>\n      <div class=\"layout\" up-main=\"root\">\n        <div class=\"layout--side\">\n          ...\n        </div>\n        <div class=\"layout--content\" up-main=\"modal\">\n          ...\n        </div>\n      </div>\n    </body>\n    ```\n    \n    Instead of assigning `[up-main]` you may also configure layer-specific targets in `up.layer.config`:\n    \n    ```js\n    up.layer.config.popup.mainTargets.push('.menu')              // for popup overlays\n    up.layer.config.drawer.mainTargets.push('.menu')             // for drawer overlays\n    up.layer.config.overlay.mainTargets.push('.layout--content') // for all overlay modes\n    ```\n    \n    @selector [up-main]\n    @param [up-main]\n      A space-separated list of [layer modes](/layer-terminology) for which to use this main target.\n    \n      Omit the attribute value to define a main target for *all* layer modes.\n    \n      To use a different main target for all overlays (but not the root layer), set `[up-main=overlay]`.\n    @stable\n     */\n\n    /***\n    To make a server request without changing a fragment, use the `:none` selector.\n    \n    \\#\\#\\# Example\n    \n    ```html\n    <a href=\"/ping\" up-target=\":none\">Ping server</a>\n    ```\n    \n    @selector :none\n    @experimental\n     */\n\n    /***\n    Your target selectors may use this pseudo-selector\n    to reference the element that triggered the change.\n    \n    The origin element is automatically set to a link that is being [followed](/a-up-follow)\n    or form that is being [submitted](/form-up-submit). When updating fragments\n    programmatically through `up.render()` you may pass an origin element as an `{ origin }` option.\n    \n    Even without using an `:origin` reference, the\n    [origin is considered](/fragment-placement#interaction-origin-is-considered)\n    when matching fragments in the current page.\n    \n    \\#\\#\\# Shorthand\n    \n    Instead of `:origin` you may also use the ampersand character (`&`).\n    \n    You may be familiar with the ampersand from the [Sass](https://sass-lang.com/documentation/file.SASS_REFERENCE.html#parent-selector)\n    CSS preprocessor.\n    \n    @selector :origin\n    @experimental\n     */\n\n    /***\n    Your target selectors may use this pseudo-selector\n    to replace the layer's topmost swappable element.\n    \n    The topmost swappable element is the first child of the layer's container element.\n    For the [root layer](/up.layer.root) it is the `<body>` element. For an overlay\n    it is the target with which the overlay was opened with.\n    \n    In canonical usage the topmost swappable element is often a [main element](/up-main).\n    \n    \\#\\#\\# Example\n    \n    The following will replace the `<body>` element in the root layer,\n    and the topmost swappable element in an overlay:\n    \n    ```js\n    up.render(':layer', { url: '/page2' })\n    ```\n    \n    @selector :layer\n    @experimental\n     */\n\n    /***\n    Returns whether the given element matches the given CSS selector.\n    \n    Other than `up.element.matches()` this function supports non-standard selectors\n    like `:main` or `:layer`.\n    \n    @function up.fragment.matches\n    @param {Element} fragment\n    @param {string|Array<string>} selectorOrSelectors\n    @param {string|up.Layer} options.layer\n      The layer for which to match.\n    \n      Pseudo-selectors like `:main` may expand to different selectors\n      in different layers.\n    @param {string|up.Layer} options.mode\n      Required if `{ layer: 'new' }` is passed.\n    @return {boolean}\n    @experimental\n     */\n    matches = function(element, selector, options) {\n      if (options == null) {\n        options = {};\n      }\n      element = e.get(element);\n      selector = parseSelector(selector, element, options);\n      return selector.matches(element);\n    };\n    up.on('up:app:boot', function() {\n      var body;\n      body = document.body;\n      body.setAttribute('up-source', up.history.location);\n      hello(body);\n      if (!up.browser.canPushState()) {\n        return up.warn('Cannot push history changes. Next fragment update will load in a new page.');\n      }\n    });\n    up.on('up:framework:reset', reset);\n    return u.literal({\n      config: config,\n      reload: reload,\n      destroy: destroy,\n      render: render,\n      navigate: navigate,\n      get: getSmart,\n      getDumb: getDumb,\n      all: getAll,\n      subtree: getSubtree,\n      contains: contains,\n      closest: closest,\n      source: sourceOf,\n      hello: hello,\n      visit: visit,\n      markAsDestroying: markFragmentAsDestroying,\n      emitInserted: emitFragmentInserted,\n      emitDestroyed: emitFragmentDestroyed,\n      emitKeep: emitFragmentKeep,\n      emitKept: emitFragmentKept,\n      successKey: successKey,\n      failKey: failKey,\n      expandTargets: expandTargets,\n      toTarget: toTarget,\n      matches: matches,\n      hasAutoHistory: hasAutoHistory\n    });\n  })();\n\n  up.replace = up.fragment.replace;\n\n  up.extract = up.fragment.extract;\n\n  up.reload = up.fragment.reload;\n\n  up.destroy = up.fragment.destroy;\n\n  up.render = up.fragment.render;\n\n  up.navigate = up.fragment.navigate;\n\n  up.hello = up.fragment.hello;\n\n  up.visit = up.fragment.visit;\n\n\n  /***\n  Returns the current [context](/context).\n  \n  This is aliased as `up.layer.context`.\n  \n  @property up.context\n  @param {Object} context\n    The context object.\n  \n    If no context has been set an empty object is returned.\n  @experimental\n   */\n\n  u.delegate(up, 'context', function() {\n    return up.layer.current;\n  });\n\n}).call(this);\n\n/***\nScrolling viewports\n===================\n\nThe `up.viewport` module controls the scroll position and focus within scrollable containers (\"viewports\").\n\nThe default viewport for any web application is the main document. An application may\ndefine additional viewports by giving the CSS property `{ overflow-y: scroll }` to any `<div>`.\n\nAlso see documentation for the [scroll option](/scroll-option) and [focus option](focus-option).\n\n@see up.reveal\n@see [up-fixed=top]\n\n@module up.viewport\n */\n\n(function() {\n  var slice = [].slice;\n\n  up.viewport = (function() {\n    var absolutize, allSelector, anchoredRight, closest, config, doFocus, e, f, firstHashTarget, fixedElements, getAll, getAround, getRoot, getScrollTops, getSubtree, isNativelyFocusable, isRoot, makeFocusable, parseOptions, pureHash, reset, resetScroll, restoreScroll, reveal, revealHash, rootHasReducedWidthFromScrollbar, rootHeight, rootOverflowElement, rootSelector, rootWidth, saveScroll, scroll, scrollTopKey, scrollTops, scrollbarWidth, scrollingController, setScrollTops, tryFocus, u, userScrolled, wasChosenAsOverflowingElement;\n    u = up.util;\n    e = up.element;\n    f = up.fragment;\n\n    /***\n    Configures defaults for scrolling.\n    \n    @property up.viewport.config\n    @param {Array} [config.viewportSelectors]\n      An array of CSS selectors that match viewports.\n    @param {Array} [config.fixedTop]\n      An array of CSS selectors that find elements fixed to the\n      top edge of the screen (using `position: fixed`).\n    \n      See [`[up-fixed=\"top\"]`](/up-fixed-top) for details.\n    @param {Array} [config.fixedBottom]\n      An array of CSS selectors that match elements fixed to the\n      bottom edge of the screen (using `position: fixed`).\n    \n      See [`[up-fixed=\"bottom\"]`](/up-fixed-bottom) for details.\n    @param {Array} [config.anchoredRight]\n      An array of CSS selectors that find elements anchored to the\n      right edge of the screen (using `right:0` with `position: fixed` or `position: absolute`).\n    \n      See [`[up-anchored=\"right\"]`](/up-anchored-right) for details.\n    @param {number} [config.revealSnap]\n      When [revealing](/up.reveal) elements, Unpoly will scroll an viewport\n      to the top when the revealed element is closer to the viewport's top edge\n      than `config.revealSnap`.\n    \n      Set to `0` to disable snapping.\n    @param {number} [config.revealPadding]\n      The desired padding between a [revealed](/up.reveal) element and the\n      closest [viewport](/up.viewport) edge (in pixels).\n    @param {number} [config.revealMax]\n      A number indicating how many top pixel rows of a high element to [reveal](/up.reveal).\n    \n      Defaults to 50% of the available window height.\n    \n      You may set this to `false` to always reveal as much of the element as the viewport allows.\n    \n      You may also pass a function that receives an argument `{ viewportRect, elementRect }` and returns\n      a maximum height in pixel. Each given rectangle has properties `{ top, right, buttom, left, width, height }`.\n    @param {number} [config.revealTop=false]\n      Whether to always scroll a [revealing](/up.reveal) element to the top.\n    \n      By default Unpoly will scroll as little as possible to make the element visible.\n    @param {number} [config.scrollSpeed=1]\n      The speed of the scrolling motion when [scrolling](/up.scroll) with `{ behavior: 'smooth' }`.\n    \n      The default value (`1`) roughly corresponds to the speed of Chrome's\n      [native smooth scrolling](https://developer.mozilla.org/en-US/docs/Web/API/ScrollToOptions/behavior).\n    @stable\n     */\n    config = new up.Config(function() {\n      return {\n        viewportSelectors: ['[up-viewport]', '[up-fixed]'],\n        fixedTop: ['[up-fixed~=top]'],\n        fixedBottom: ['[up-fixed~=bottom]'],\n        anchoredRight: ['[up-anchored~=right]', '[up-fixed~=top]', '[up-fixed~=bottom]', '[up-fixed~=right]'],\n        revealSnap: 200,\n        revealPadding: 0,\n        revealTop: false,\n        revealMax: function() {\n          return 0.5 * window.innerHeight;\n        },\n        scrollSpeed: 1\n      };\n    });\n    scrollingController = new up.MotionController('scrolling');\n    reset = function() {\n      config.reset();\n      return scrollingController.reset();\n    };\n\n    /***\n    Scrolls the given viewport to the given Y-position.\n    \n    A \"viewport\" is an element that has scrollbars, e.g. `<body>` or\n    a container with `overflow-x: scroll`.\n    \n    \\#\\#\\# Example\n    \n    This will scroll a `<div class=\"main\">...</div>` to a Y-position of 100 pixels:\n    \n        up.scroll('.main', 100)\n    \n    \\#\\#\\# Animating the scrolling motion\n    \n    The scrolling can (optionally) be animated.\n    \n        up.scroll('.main', 100, { behavior: 'smooth' })\n    \n    If the given viewport is already in a scroll animation when `up.scroll()`\n    is called a second time, the previous animation will instantly jump to the\n    last frame before the next animation is started.\n    \n    @function up.scroll\n    @param {string|Element|jQuery} viewport\n      The container element to scroll.\n    @param {number} scrollPos\n      The absolute number of pixels to set the scroll position to.\n    @param {string}[options.behavior='auto']\n      When set to `'auto'`, this will immediately scroll to the new position.\n    \n      When set to `'smooth'`, this will scroll smoothly to the new position.\n    @param {number}[options.speed]\n      The speed of the scrolling motion when scrolling with `{ behavior: 'smooth' }`.\n    \n      Defaults to `up.viewport.config.scrollSpeed`.\n    @return {Promise}\n      A promise that will be fulfilled when the scrolling ends.\n    @internal\n     */\n    scroll = function(viewport, scrollTop, options) {\n      var motion;\n      if (options == null) {\n        options = {};\n      }\n      viewport = f.get(viewport, options);\n      motion = new up.ScrollMotion(viewport, scrollTop, options);\n      return scrollingController.startMotion(viewport, motion, options);\n    };\n\n    /***\n    @function up.viewport.anchoredRight\n    @internal\n     */\n    anchoredRight = function() {\n      var selector;\n      selector = config.anchoredRight.join(',');\n      return f.all(selector, {\n        layer: 'root'\n      });\n    };\n\n    /***\n    Scrolls the given element's viewport so the first rows of the\n    element are visible for the user.\n    \n    \\#\\#\\# Fixed elements obstructing the viewport\n    \n    Many applications have a navigation bar fixed to the top or bottom,\n    obstructing the view on an element.\n    \n    You can make `up.reveal()` aware of these fixed elements\n    so it can scroll the viewport far enough so the revealed element is fully visible.\n    To make `up.reveal()` aware of fixed elements you can either:\n    \n    - give the element an attribute [`up-fixed=\"top\"`](/up-fixed-top) or [`up-fixed=\"bottom\"`](up-fixed-bottom)\n    - [configure default options](/up.viewport.config) for `fixedTop` or `fixedBottom`\n    \n    @function up.reveal\n    \n    @param {string|Element|jQuery} element\n      The element to reveal.\n    \n    @param {number} [options.scrollSpeed=1]\n      The speed of the scrolling motion when scrolling with `{ behavior: 'smooth' }`.\n    \n      The default value (`1`) roughly corresponds to the speed of Chrome's\n      [native smooth scrolling](https://developer.mozilla.org/en-US/docs/Web/API/ScrollToOptions/behavior).\n    \n      Defaults to `up.viewport.config.scrollSpeed`.\n    \n    @param {string} [options.revealSnap]\n      When the the revealed element would be closer to the viewport's top edge\n      than this value, Unpoly will scroll the viewport to the top.\n    \n      Set to `0` to disable snapping.\n    \n      Defaults to `up.viewport.config.revealSnap`.\n    \n    @param {string|Element|jQuery} [options.viewport]\n      The scrolling element to scroll.\n    \n      Defaults to the [given element's viewport](/up.viewport.closest).\n    \n    @param {boolean} [options.top]\n      Whether to scroll the viewport so that the first element row aligns\n      with the top edge of the viewport.\n    \n      Defaults to `up.viewport.config.revealTop`.\n    \n    @param {string}[options.behavior='auto']\n      When set to `'auto'`, this will immediately scroll to the new position.\n    \n      When set to `'smooth'`, this will scroll smoothly to the new position.\n    \n    @param {number}[options.speed]\n      The speed of the scrolling motion when scrolling with `{ behavior: 'smooth' }`.\n    \n      Defaults to `up.viewport.config.scrollSpeed`.\n    \n    @param {number} [options.padding]\n      The desired padding between the revealed element and the\n      closest [viewport](/up.viewport) edge (in pixels).\n    \n      Defaults to `up.viewport.config.revealPadding`.\n    \n    @param {number|boolean} [options.snap]\n      Whether to snap to the top of the viewport if the new scroll position\n      after revealing the element is close to the top edge.\n    \n      Defaults to `up.viewport.config.revealSnap`.\n    \n    @return {Promise}\n      A promise that fulfills when the element is revealed.\n    \n      When the scrolling is animated with `{ behavior: 'smooth' }`, the promise\n      fulfills when the animation is finished.\n    \n      When the scrolling is not animated, the promise will fulfill\n      in the next [microtask](https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/).\n    \n    @stable\n     */\n    reveal = function(element, options) {\n      var motion;\n      options = u.options(options);\n      element = f.get(element, options);\n      if (!(options.layer = up.layer.get(element))) {\n        return up.error.failed.async('Cannot reveal a detached element');\n      }\n      if (options.peel) {\n        options.layer.peel();\n      }\n      motion = new up.RevealMotion(element, options);\n      return scrollingController.startMotion(element, motion, options);\n    };\n\n    /***\n    Focuses the given element.\n    \n    Focusing an element will also [reveal](/up.reveal) it, unless `{ preventScroll: true }` is passed.\n    \n    @function up.focus\n    \n    @param {string|Element|jQuery} element\n      The element to focus.\n    \n    @param {[options.preventScroll=false]}\n      Whether to prevent changes to the acroll position.\n    \n    @experimental\n     */\n    doFocus = function(element, options) {\n      var oldScrollTop, viewport;\n      if (options == null) {\n        options = {};\n      }\n      if (up.browser.isIE11()) {\n        viewport = closest(element);\n        oldScrollTop = viewport.scrollTop;\n        element.focus();\n        viewport.scrollTop = oldScrollTop;\n      } else {\n        element.focus({\n          preventScroll: true\n        });\n      }\n      if (!options.preventScroll) {\n        return reveal(element);\n      }\n    };\n    tryFocus = function(element, options) {\n      doFocus(element, options);\n      return element === document.activeElement;\n    };\n    isNativelyFocusable = function(element) {\n      return e.matches(element, 'a[href], button, textarea, input, select');\n    };\n    makeFocusable = function(element) {\n      if (!(element.hasAttribute('tabindex') || isNativelyFocusable(element))) {\n        element.setAttribute('tabindex', '-1');\n        return element.classList.add('up-focusable-content');\n      }\n    };\n\n    /***\n    [Reveals](/up.reveal) an element matching the given `#hash` anchor.\n    \n    Other than the default behavior found in browsers, `up.revealHash` works with\n    [multiple viewports](/up-viewport) and honors [fixed elements](/up-fixed-top) obstructing the user's\n    view of the viewport.\n    \n    When the page loads initially, this function is automatically called with the hash from\n    the current URL.\n    \n    If no element matches the given `#hash` anchor, a resolved promise is returned.\n    \n    \\#\\#\\# Example\n    \n        up.revealHash('#chapter2')\n    \n    @function up.viewport.revealHash\n    @param {string} hash\n    @internal\n     */\n    revealHash = function(hash, options) {\n      var match;\n      if (hash == null) {\n        hash = location.hash;\n      }\n      if (match = firstHashTarget(hash, options)) {\n        return up.reveal(match, {\n          top: true\n        });\n      }\n    };\n    allSelector = function() {\n      return [rootSelector()].concat(slice.call(config.viewportSelectors)).join(',');\n    };\n\n    /***\n    Returns the scrolling container for the given element.\n    \n    Returns the [document's scrolling element](/up.viewport.root)\n    if no closer viewport exists.\n    \n    @function up.viewport.get\n    @param {string|Element|jQuery} target\n    @return {Element}\n    @experimental\n     */\n    closest = function(target, options) {\n      var element;\n      if (options == null) {\n        options = {};\n      }\n      element = f.get(target, options);\n      return e.closest(element, allSelector());\n    };\n\n    /***\n    Returns a list of all the viewports contained within the\n    given selector or element.\n    \n    If the given element is itself a viewport, the element is included\n    in the returned list.\n    \n    @function up.viewport.subtree\n    @param {string|Element|jQuery} target\n    @param {Object} options\n    @return List<Element>\n    @internal\n     */\n    getSubtree = function(element, options) {\n      if (options == null) {\n        options = {};\n      }\n      element = f.get(element, options);\n      return e.subtree(element, allSelector());\n    };\n\n    /***\n    Returns a list of all viewports that are either contained within\n    the given element or that are ancestors of the given element.\n    \n    This is relevant when updating a fragment with `{ scroll: 'restore' | 'reset' }`.\n    In tht case we restore / reset the scroll tops of all viewports around the fragment.\n    \n    @function up.viewport.around\n    @param {string|Element|jQuery} element\n    @param {Object} options\n    @return List<Element>\n    @internal\n     */\n    getAround = function(element, options) {\n      if (options == null) {\n        options = {};\n      }\n      element = f.get(element, options);\n      return e.around(element, allSelector());\n    };\n\n    /***\n    Returns a list of all the viewports on the current layer.\n    \n    @function up.viewport.all\n    @internal\n     */\n    getAll = function(options) {\n      if (options == null) {\n        options = {};\n      }\n      return f.all(allSelector(), options);\n    };\n    rootSelector = function() {\n      var element;\n      if (element = document.scrollingElement) {\n        return element.tagName;\n      } else {\n        return 'html';\n      }\n    };\n\n    /***\n    Return the [scrolling element](https://developer.mozilla.org/en-US/docs/Web/API/document/scrollingElement)\n    for the browser's main content area.\n    \n    @function up.viewport.root\n    @return {Element}\n    @experimental\n     */\n    getRoot = function() {\n      return document.querySelector(rootSelector());\n    };\n    rootWidth = function() {\n      return e.root.clientWidth;\n    };\n    rootHeight = function() {\n      return e.root.clientHeight;\n    };\n    isRoot = function(element) {\n      return e.matches(element, rootSelector());\n    };\n\n    /***\n    Returns whether the root viewport is currently showing a vertical scrollbar.\n    \n    Note that this returns `false` if the root viewport scrolls vertically but the browser\n    shows no visible scroll bar at rest, e.g. on mobile devices that only overlay a scroll\n    indicator while scrolling.\n    \n    @function up.viewport.rootHasReducedWidthFromScrollbar\n    @internal\n     */\n    rootHasReducedWidthFromScrollbar = function() {\n      return window.innerWidth > document.documentElement.offsetWidth;\n    };\n\n    /***\n    Returns the element that controls the `overflow-y` behavior for the\n    [document viewport](/up.viewport.root()).\n    \n    @function up.viewport.rootOverflowElement\n    @internal\n     */\n    rootOverflowElement = function() {\n      var body, element, html;\n      body = document.body;\n      html = document.documentElement;\n      element = u.find([html, body], wasChosenAsOverflowingElement);\n      return element || getRoot();\n    };\n\n    /***\n    Returns whether the given element was chosen as the overflowing\n    element by the developer.\n    \n    We have no control whether developers set the property on <body> or\n    <html>. The developer also won't know what is going to be the\n    [scrolling element](/up.viewport.root) on the user's browser.\n    \n    @function wasChosenAsOverflowingElement\n    @internal\n     */\n    wasChosenAsOverflowingElement = function(element) {\n      var overflowY;\n      overflowY = e.style(element, 'overflow-y');\n      return overflowY === 'auto' || overflowY === 'scroll';\n    };\n\n    /***\n    Returns the width of a scrollbar.\n    \n    This only runs once per page load.\n    \n    @function up.viewport.scrollbarWidth\n    @internal\n     */\n    scrollbarWidth = u.memoize(function() {\n      var outer, outerStyle, width;\n      outerStyle = {\n        position: 'absolute',\n        top: '0',\n        left: '0',\n        width: '100px',\n        height: '100px',\n        overflowY: 'scroll'\n      };\n      outer = up.element.affix(document.body, '[up-viewport]', {\n        style: outerStyle\n      });\n      width = outer.offsetWidth - outer.clientWidth;\n      up.element.remove(outer);\n      return width;\n    });\n    scrollTopKey = function(viewport) {\n      return up.fragment.toTarget(viewport);\n    };\n\n    /***\n    Returns a hash with scroll positions.\n    \n    Each key in the hash is a viewport selector. The corresponding\n    value is the viewport's top scroll position:\n    \n        up.viewport.scrollTops()\n        => { '.main': 0, '.sidebar': 73 }\n    \n    @function up.viewport.scrollTops\n    @return Object<string, number>\n    @internal\n     */\n    scrollTops = function(options) {\n      if (options == null) {\n        options = {};\n      }\n      return u.mapObject(getAll(options), function(viewport) {\n        return [scrollTopKey(viewport), viewport.scrollTop];\n      });\n    };\n\n    /***\n    @function up.viewport.fixedElements\n    @internal\n     */\n    fixedElements = function(root) {\n      var queryParts;\n      if (root == null) {\n        root = document;\n      }\n      queryParts = ['[up-fixed]'].concat(config.fixedTop).concat(config.fixedBottom);\n      return root.querySelectorAll(queryParts.join(','));\n    };\n\n    /***\n    Saves the top scroll positions of all viewports in the current layer.\n    \n    The scroll positions will be associated with the current URL.\n    They can later be restored by calling [`up.viewport.restoreScroll()`](/up.viewport.restoreScroll)\n    at the same URL, or by following a link with an [`[scroll=\"restore\"]`](/a-up-follow#up-restore-scroll)\n    attribute.\n    \n    Unpoly automatically saves scroll positions before [navigating](/navigation).\n    You will rarely need to call this function yourself.\n    \n    @function up.viewport.saveScroll\n    @param {string} [options.location]\n      The URL for which to save scroll positions.\n      If omitted, the current browser location is used.\n    @param {string} [options.layer]\n      The layer for which to save scroll positions.\n      If omitted, positions for the current layer will be saved.\n    @param {Object<string, number>} [options.tops]\n      An object mapping viewport selectors to vertical scroll positions in pixels.\n    @experimental\n     */\n    saveScroll = function() {\n      var args, options, ref, ref1, tops, url, viewports;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      ref = parseOptions(args), viewports = ref[0], options = ref[1];\n      if (url = options.location || options.layer.location) {\n        tops = (ref1 = options.tops) != null ? ref1 : getScrollTops(viewports);\n        return options.layer.lastScrollTops.set(url, tops);\n      }\n    };\n    getScrollTops = function(viewports) {\n      return u.mapObject(viewports, function(viewport) {\n        return [scrollTopKey(viewport), viewport.scrollTop];\n      });\n    };\n\n    /***\n    Restores [previously saved](/up.viewport.saveScroll) scroll positions of viewports\n    viewports configured in `up.viewport.config.viewportSelectors`.\n    \n    Unpoly automatically restores scroll positions when the user presses the back button.\n    You can disable this behavior by setting [`up.history.config.restoreScroll = false`](/up.history.config).\n    \n    @function up.viewport.restoreScroll\n    @param {Element} [viewport]\n    @param {up.Layer|string} [options.layer]\n      The layer on which to restore scroll positions.\n    @return {Promise}\n      A promise that will be fulfilled once scroll positions have been restored.\n    @experimental\n     */\n    restoreScroll = function() {\n      var args, options, ref, scrollTopsForURL, url, viewports;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      ref = parseOptions(args), viewports = ref[0], options = ref[1];\n      url = options.layer.location;\n      scrollTopsForURL = options.layer.lastScrollTops.get(url) || {};\n      up.puts('up.viewport.restoreScroll()', 'Restoring scroll positions for URL %s to %o', u.urlWithoutHost(url), scrollTopsForURL);\n      return setScrollTops(viewports, scrollTopsForURL);\n    };\n    parseOptions = function(args) {\n      var options, viewports;\n      options = u.copy(u.extractOptions(args));\n      options.layer = up.layer.get(options);\n      if (args[0]) {\n        viewports = [closest(args[0], options)];\n      } else if (options.around) {\n        viewports = getAround(options.around, options);\n      } else {\n        viewports = getAll(options);\n      }\n      return [viewports, options];\n    };\n    resetScroll = function() {\n      var args, options, ref, viewports;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      ref = parseOptions(args), viewports = ref[0], options = ref[1];\n      return setScrollTops(viewports, {});\n    };\n    setScrollTops = function(viewports, tops) {\n      var allScrollPromises;\n      allScrollPromises = u.map(viewports, function(viewport) {\n        var key, scrollTop;\n        key = scrollTopKey(viewport);\n        scrollTop = tops[key] || 0;\n        return scroll(viewport, scrollTop, {\n          duration: 0\n        });\n      });\n      return Promise.all(allScrollPromises);\n    };\n\n    /***\n    @internal\n     */\n    absolutize = function(element, options) {\n      var bounds, boundsRect, moveBounds, newElementRect, originalRect, viewport, viewportRect;\n      if (options == null) {\n        options = {};\n      }\n      viewport = closest(element);\n      viewportRect = viewport.getBoundingClientRect();\n      originalRect = element.getBoundingClientRect();\n      boundsRect = new up.Rect({\n        left: originalRect.left - viewportRect.left,\n        top: originalRect.top - viewportRect.top,\n        width: originalRect.width,\n        height: originalRect.height\n      });\n      if (typeof options.afterMeasure === \"function\") {\n        options.afterMeasure();\n      }\n      e.setStyle(element, {\n        position: element.style.position === 'static' ? 'static' : 'relative',\n        top: 'auto',\n        right: 'auto',\n        bottom: 'auto',\n        left: 'auto',\n        width: '100%',\n        height: '100%'\n      });\n      bounds = e.createFromSelector('up-bounds');\n      e.insertBefore(element, bounds);\n      bounds.appendChild(element);\n      moveBounds = function(diffX, diffY) {\n        boundsRect.left += diffX;\n        boundsRect.top += diffY;\n        return e.setStyle(bounds, boundsRect);\n      };\n      moveBounds(0, 0);\n      newElementRect = element.getBoundingClientRect();\n      moveBounds(originalRect.left - newElementRect.left, originalRect.top - newElementRect.top);\n      u.each(fixedElements(element), e.fixedToAbsolute);\n      return {\n        bounds: bounds,\n        moveBounds: moveBounds\n      };\n    };\n\n    /***\n    Marks this element as a scrolling container (\"viewport\").\n    \n    Apply this attribute if your app uses a custom panel layout with fixed positioning\n    instead of scrolling `<body>`. As an alternative you can also push a selector\n    matching your custom viewport to the `up.viewport.config.viewportSelectors` array.\n    \n    [`up.reveal()`](/up.reveal) will always try to scroll the viewport closest\n    to the element that is being revealed. By default this is the `<body>` element.\n    \n    \\#\\#\\# Example\n    \n    Here is an example for a layout for an e-mail client, showing a list of e-mails\n    on the left side and the e-mail text on the right side:\n    \n        .side {\n          position: fixed;\n          top: 0;\n          bottom: 0;\n          left: 0;\n          width: 100px;\n          overflow-y: scroll;\n        }\n    \n        .main {\n          position: fixed;\n          top: 0;\n          bottom: 0;\n          left: 100px;\n          right: 0;\n          overflow-y: scroll;\n        }\n    \n    This would be the HTML (notice the `up-viewport` attribute):\n    \n        <div class=\".side\" up-viewport>\n          <a href=\"/emails/5001\" up-target=\".main\">Re: Your invoice</a>\n          <a href=\"/emails/2023\" up-target=\".main\">Quote for services</a>\n          <a href=\"/emails/9002\" up-target=\".main\">Fwd: Room reservation</a>\n        </div>\n    \n        <div class=\"main\" up-viewport>\n          <h1>Re: Your Invoice</h1>\n          <p>\n            Lorem ipsum dolor sit amet, consetetur sadipscing elitr.\n            Stet clita kasd gubergren, no sea takimata sanctus est.\n          </p>\n        </div>\n    \n    @selector [up-viewport]\n    @stable\n     */\n\n    /***\n    Marks this element as being fixed to the top edge of the screen\n    using `position: fixed`.\n    \n    When [following a fragment link](/a-up-follow), the viewport is scrolled\n    so the targeted element becomes visible. By using this attribute you can make\n    Unpoly aware of fixed elements that are obstructing the viewport contents.\n    Unpoly will then scroll the viewport far enough that the revealed element is fully visible.\n    \n    Instead of using this attribute,\n    you can also configure a selector in `up.viewport.config.fixedTop`.\n    \n    \\#\\#\\# Example\n    \n        <div class=\"top-nav\" up-fixed=\"top\">...</div>\n    \n    @selector [up-fixed=top]\n    @stable\n     */\n\n    /***\n    Marks this element as being fixed to the bottom edge of the screen\n    using `position: fixed`.\n    \n    When [following a fragment link](/a-up-follow), the viewport is scrolled\n    so the targeted element becomes visible. By using this attribute you can make\n    Unpoly aware of fixed elements that are obstructing the viewport contents.\n    Unpoly will then scroll the viewport far enough that the revealed element is fully visible.\n    \n    Instead of using this attribute,\n    you can also configure a selector in `up.viewport.config.fixedBottom`.\n    \n    \\#\\#\\# Example\n    \n        <div class=\"bottom-nav\" up-fixed=\"bottom\">...</div>\n    \n    @selector [up-fixed=bottom]\n    @stable\n     */\n\n    /***\n    Marks this element as being anchored to the right edge of the screen,\n    typically fixed navigation bars.\n    \n    Since [modal dialogs](/up.modal) hide the document scroll bar,\n    elements anchored to the right appear to jump when the dialog opens or\n    closes. Applying this attribute to anchored elements will make Unpoly\n    aware of the issue and adjust the `right` property accordingly.\n    \n    You should give this attribute to layout elements\n    with a CSS of `right: 0` with `position: fixed` or `position:absolute`.\n    \n    Instead of giving this attribute to any affected element,\n    you can also configure a selector in `up.viewport.config.anchoredRight`.\n    \n    \\#\\#\\# Example\n    \n    Here is the CSS for a navigation bar that is anchored to the top edge of the screen:\n    \n        .top-nav {\n           position: fixed;\n           top: 0;\n           left: 0;\n           right: 0;\n         }\n    \n    By adding an `up-anchored=\"right\"` attribute to the element, we can prevent the\n    `right` edge from jumping when a [modal dialog](/up.modal) opens or closes:\n    \n        <div class=\"top-nav\" up-anchored=\"right\">...</div>\n    \n    @selector [up-anchored=right]\n    @stable\n     */\n\n    /***\n    @function up.viewport.firstHashTarget\n    @internal\n     */\n    firstHashTarget = function(hash, options) {\n      var selector;\n      if (options == null) {\n        options = {};\n      }\n      if (hash = pureHash(hash)) {\n        selector = [e.attributeSelector('id', hash), 'a' + e.attributeSelector('name', hash)].join(',');\n        return f.get(selector, options);\n      }\n    };\n\n    /***\n    Returns `'foo'` if the hash is `'#foo'`.\n    \n    @function pureHash\n    @internal\n     */\n    pureHash = function(value) {\n      return value != null ? value.replace(/^#/, '') : void 0;\n    };\n    userScrolled = false;\n    up.on('scroll', {\n      once: true\n    }, function() {\n      return userScrolled = true;\n    });\n    up.on('up:app:boot', function() {\n      return u.task(function() {\n        if (!userScrolled) {\n          return revealHash();\n        }\n      });\n    });\n    up.on(window, 'hashchange', function() {\n      return revealHash();\n    });\n    up.on('up:framework:reset', reset);\n    return u.literal({\n      reveal: reveal,\n      revealHash: revealHash,\n      firstHashTarget: firstHashTarget,\n      scroll: scroll,\n      config: config,\n      get: closest,\n      subtree: getSubtree,\n      around: getAround,\n      all: getAll,\n      rootSelector: rootSelector,\n      get_root: getRoot,\n      rootWidth: rootWidth,\n      rootHeight: rootHeight,\n      rootHasReducedWidthFromScrollbar: rootHasReducedWidthFromScrollbar,\n      rootOverflowElement: rootOverflowElement,\n      isRoot: isRoot,\n      scrollbarWidth: scrollbarWidth,\n      scrollTops: scrollTops,\n      saveScroll: saveScroll,\n      restoreScroll: restoreScroll,\n      resetScroll: resetScroll,\n      anchoredRight: anchoredRight,\n      fixedElements: fixedElements,\n      absolutize: absolutize,\n      focus: doFocus,\n      tryFocus: tryFocus,\n      makeFocusable: makeFocusable\n    });\n  })();\n\n  up.focus = up.viewport.focus;\n\n  up.scroll = up.viewport.scroll;\n\n  up.reveal = up.viewport.reveal;\n\n}).call(this);\n\n/***\nAnimation\n=========\n  \nWhen you [update a page fragment](/up.link) you can animate the change.\n\nYou can add an attribute [`[up-transition]`](/a-up-transition) to your\nlinks or forms to smoothly fade out the old element while fading in the new element:\n\n```html\n<a href=\"/users\"\n  up-target=\".list\"\n  up-transition=\"cross-fade\">\n  Show users\n</a>\n```\n\n\\#\\#\\# Transitions vs. animations\n\nWhen we morph between an old and a new element, we call it a *transition*.\nIn contrast, when we animate a new element without simultaneously removing an\nold element, we call it an *animation*.\n\nAn example for an animation is opening a new overlay. We can animate the appearance\nof the dialog by adding an [`[up-animation]`](/a-up-animation) attribute to the opening link:\n\n```html\n<a href=\"/users\"\n  up-target=\".list\"\n  up-layer=\"new\"\n  up-animation=\"move-from-top\">\n  Show users\n</a>\n```\n\n\\#\\#\\# Which animations are available?\n\nUnpoly ships with a number of [predefined transitions](/up.morph#named-transitions)\nand [predefined animations](/up.animate#named-animations).\n\nYou can define custom animations using `up.transition()` and\n`up.animation()`.\n\n@see a[up-transition]\n@see up.animation\n@see up.transition\n\n@module up.motion\n */\n\n(function() {\n  up.motion = (function() {\n    var animate, animateNow, applyConfig, composeTransitionFn, config, e, findAnimationFn, findNamedAnimation, findTransitionFn, finish, isEnabled, isNone, morph, motionController, namedAnimations, namedTransitions, pickDefault, registerAnimation, registerMoveAnimations, registerOpacityAnimation, registerTransition, reset, skipAnimate, swapElementsDirectly, translateCSS, u, untranslatedBox, warnIfDisabled, willAnimate;\n    u = up.util;\n    e = up.element;\n    namedAnimations = {};\n    namedTransitions = {};\n    motionController = new up.MotionController('motion');\n\n    /***\n    Sets default options for animations and transitions.\n    \n    @property up.motion.config\n    @param {number} [config.duration=175]\n      The default duration for all animations and transitions (in milliseconds).\n    @param {string} [config.easing='ease']\n      The default timing function that controls the acceleration of animations and transitions.\n    \n      See [W3C documentation](http://www.w3.org/TR/css3-transitions/#transition-timing-function)\n      for a list of pre-defined timing functions.\n    @param {boolean} [config.enabled]\n      Whether animation is enabled.\n    \n      By default animations are enabled, unless the user has configured their\n      system to [minimize non-essential motion](https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-reduced-motion).\n    \n      Set this to `false` to disable animation globally.\n      This can be useful in full-stack integration tests.\n    @stable\n     */\n    config = new up.Config(function() {\n      return {\n        duration: 175,\n        easing: 'ease',\n        enabled: !matchMedia('(prefers-reduced-motion: reduce)').matches\n      };\n    });\n    pickDefault = function(registry) {\n      return u.pickBy(registry, function(value) {\n        return value.isDefault;\n      });\n    };\n    reset = function() {\n      motionController.reset();\n      namedAnimations = pickDefault(namedAnimations);\n      namedTransitions = pickDefault(namedTransitions);\n      return config.reset();\n    };\n\n    /***\n    Returns whether Unpoly will perform animations.\n    \n    Set [`up.motion.config.enabled = false`](/up.motion.config#config.enabled) in order to disable animations globally.\n    \n    @function up.motion.isEnabled\n    @return {boolean}\n    @stable\n     */\n    isEnabled = function() {\n      return config.enabled;\n    };\n\n    /***\n    Applies the given animation to the given element.\n    \n    \\#\\#\\# Example\n    \n    ```js\n    up.animate('.warning', 'fade-in')\n    ```\n    \n    You can pass additional options:\n    \n    ```\n    up.animate('.warning', 'fade-in', {\n      delay: 1000,\n      duration: 250,\n      easing: 'linear'\n    })\n    ```\n    \n    \\#\\#\\# Named animations\n    \n    The following animations are pre-defined:\n    \n    | `fade-in`          | Changes the element's opacity from 0% to 100% |\n    | `fade-out`         | Changes the element's opacity from 100% to 0% |\n    | `move-to-top`      | Moves the element upwards until it exits the screen at the top edge |\n    | `move-from-top`    | Moves the element downwards from beyond the top edge of the screen until it reaches its current position |\n    | `move-to-bottom`   | Moves the element downwards until it exits the screen at the bottom edge |\n    | `move-from-bottom` | Moves the element upwards from beyond the bottom edge of the screen until it reaches its current position |\n    | `move-to-left`     | Moves the element leftwards until it exists the screen at the left edge  |\n    | `move-from-left`   | Moves the element rightwards from beyond the left edge of the screen until it reaches its current position |\n    | `move-to-right`    | Moves the element rightwards until it exists the screen at the right edge  |\n    | `move-from-right`  | Moves the element leftwards from beyond the right  edge of the screen until it reaches its current position |\n    | `none`             | An animation that has no visible effect. Sounds useless at first, but can save you a lot of `if` statements. |\n    \n    You can define additional named animations using [`up.animation()`](/up.animation).\n    \n    \\#\\#\\# Animating CSS properties directly\n    \n    By passing an object instead of an animation name, you can animate\n    the CSS properties of the given element:\n    \n    ```\n    var warning = document.querySelector('.warning')\n    warning.style.opacity = 0\n    up.animate(warning, { opacity: 1 })\n    ```\n    \n    CSS properties must be given in `kebab-case`, not `camelCase`.\n    \n    \\#\\#\\# Multiple animations on the same element\n    \n    Unpoly doesn't allow more than one concurrent animation on the same element.\n    \n    If you attempt to animate an element that is already being animated,\n    the previous animation will instantly jump to its last frame before\n    the new animation begins.\n    \n    @function up.animate\n    @param {Element|jQuery|string} element\n      The element to animate.\n    @param {string|Function(element, options): Promise|Object} animation\n      Can either be:\n    \n      - The animation's name\n      - A function performing the animation\n      - An object of CSS attributes describing the last frame of the animation (using kebeb-case property names)\n    @param {number} [options.duration=300]\n      The duration of the animation, in milliseconds.\n    @param {string} [options.easing='ease']\n      The timing function that controls the animation's acceleration.\n    \n      See [W3C documentation](http://www.w3.org/TR/css3-transitions/#transition-timing-function)\n      for a list of pre-defined timing functions.\n    @return {Promise}\n      A promise for the animation's end.\n    @stable\n     */\n    animate = function(element, animation, options) {\n      var animationFn, runNow, willRun;\n      element = up.fragment.get(element);\n      options = u.options(options);\n      animationFn = findAnimationFn(animation);\n      willRun = willAnimate(element, animation, options);\n      if (willRun) {\n        runNow = function() {\n          return animationFn(element, options);\n        };\n        return motionController.startFunction(element, runNow, options);\n      } else {\n        return skipAnimate(element, animation);\n      }\n    };\n    willAnimate = function(element, animationOrTransition, options) {\n      applyConfig(options);\n      return isEnabled() && !isNone(animationOrTransition) && options.duration > 0 && !e.isSingleton(element);\n    };\n    skipAnimate = function(element, animation) {\n      if (u.isOptions(animation)) {\n        e.setStyle(element, animation);\n      }\n      return Promise.resolve();\n    };\n\n    /***\n    Animates the given element's CSS properties using CSS transitions.\n    \n    Does not track the animation, nor does it finishes existing animations\n    (use `up.motion.animate()` for that). It does, however, listen to the motionController's\n    finish event.\n    \n    @function animateNow\n    @param {Element|jQuery|string} element\n      The element to animate.\n    @param {Object} lastFrame\n      The CSS properties that should be transitioned to.\n    @param {number} [options.duration=300]\n      The duration of the animation, in milliseconds.\n    @param {string} [options.easing='ease']\n      The timing function that controls the animation's acceleration.\n      See [W3C documentation](http://www.w3.org/TR/css3-transitions/#transition-timing-function)\n      for a list of pre-defined timing functions.\n    @return {Promise}\n      A promise that fulfills when the animation ends.\n    @internal\n     */\n    animateNow = function(element, lastFrame, options) {\n      var cssTransition;\n      options = u.merge(options, {\n        finishEvent: motionController.finishEvent\n      });\n      cssTransition = new up.CSSTransition(element, lastFrame, options);\n      return cssTransition.start();\n    };\n    applyConfig = function(options) {\n      options.easing || (options.easing = config.easing);\n      return options.duration || (options.duration = config.duration);\n    };\n    findNamedAnimation = function(name) {\n      return namedAnimations[name] || up.fail(\"Unknown animation %o\", name);\n    };\n\n    /***\n    Completes [animations](/up.animate) and [transitions](/up.morph).\n    \n    If called without arguments, all animations on the screen are completed.\n    If given an element (or selector), animations on that element and its children\n    are completed.\n    \n    Animations are completed by jumping to the last animation frame instantly.\n    Promises returned by animation and transition functions instantly settle.\n    \n    Emits the `up:motion:finish` event that is handled by `up.animate()`.\n    \n    Does nothing if there are no animation to complete.\n    \n    @function up.motion.finish\n    @param {Element|jQuery|string} [element]\n      The element around which to finish all animations.\n    @return {Promise}\n      A promise that fulfills when animations and transitions have finished.\n    @stable\n     */\n    finish = function(element) {\n      return motionController.finish(element);\n    };\n\n    /***\n    This event is emitted on an [animating](/up.animating) element by `up.motion.finish()` to\n    request the animation to instantly finish and skip to the last frame.\n    \n    Promises returned by now-finished animation functions are expected to settle.\n    \n    Animations started by `up.animate()` already handle this event.\n    \n    @event up:motion:finish\n    @param {Element} event.target\n      The animating element.\n    @stable\n     */\n\n    /***\n    Performs an animated transition between the `source` and `target` elements.\n    \n    Transitions are implement by performing two animations in parallel,\n    causing `source` to disappear and the `target` to appear.\n    \n    - `target` is [inserted before](https://developer.mozilla.org/en-US/docs/Web/API/Node/insertBefore) `source`\n    - `source` is removed from the [document flow](https://developer.mozilla.org/en-US/docs/Learn/CSS/CSS_layout/Positioning) with `position: absolute`.\n       It will be positioned over its original place in the flow that is now occupied by `target`.\n    - Both `source` and `target` are animated in parallel\n    - `source` is removed from the DOM\n    \n    \\#\\#\\# Named transitions\n    \n    The following transitions are pre-defined:\n    \n    | `cross-fade` | Fades out the first element. Simultaneously fades in the second element. |\n    | `move-up`    | Moves the first element upwards until it exits the screen at the top edge. Simultaneously moves the second element upwards from beyond the bottom edge of the screen until it reaches its current position. |\n    | `move-down`  | Moves the first element downwards until it exits the screen at the bottom edge. Simultaneously moves the second element downwards from beyond the top edge of the screen until it reaches its current position. |\n    | `move-left`  | Moves the first element leftwards until it exists the screen at the left edge. Simultaneously moves the second element leftwards from beyond the right  edge of the screen until it reaches its current position. |\n    | `move-right` | Moves the first element rightwards until it exists the screen at the right edge. Simultaneously moves the second element rightwards from beyond the left edge of the screen until it reaches its current position. |\n    | `none`       | A transition that has no visible effect. Sounds useless at first, but can save you a lot of `if` statements. |\n    \n    You can define additional named transitions using [`up.transition()`](/up.transition).\n    \n    You can also compose a transition from two [named animations](/named-animations).\n    separated by a slash character (`/`):\n    \n    - `move-to-bottom/fade-in`\n    - `move-to-left/move-from-top`\n    \n    \\#\\#\\# Implementation details\n    \n    During a transition both the old and new element occupy\n    the same position on the screen.\n    \n    Since the CSS layout flow will usually not allow two elements to\n    overlay the same space, Unpoly:\n    \n    - The old and new elements are cloned\n    - The old element is removed from the layout flow using `display: hidden`\n    - The new element is hidden, but still leaves space in the layout flow by setting `visibility: hidden`\n    - The clones are [absolutely positioned](https://developer.mozilla.org/en-US/docs/Web/CSS/position#Absolute_positioning)\n      over the original elements.\n    - The transition is applied to the cloned elements.\n      At no point will the hidden, original elements be animated.\n    - When the transition has finished, the clones are removed from the DOM and the new element is shown.\n      The old element remains hidden in the DOM.\n    \n    @function up.morph\n    @param {Element|jQuery|string} source\n    @param {Element|jQuery|string} target\n    @param {Function(oldElement, newElement)|string} transition\n    @param {number} [options.duration=300]\n      The duration of the animation, in milliseconds.\n    @param {string} [options.easing='ease']\n      The timing function that controls the transition's acceleration.\n    \n      See [W3C documentation](http://www.w3.org/TR/css3-transitions/#transition-timing-function)\n      for a list of pre-defined timing functions.\n    @param {boolean} [options.reveal=false]\n      Whether to reveal the new element by scrolling its parent viewport.\n    @return {Promise}\n      A promise that fulfills when the transition ends.\n    @stable\n     */\n    morph = function(oldElement, newElement, transitionObject, options) {\n      var afterDetach, afterInsert, beforeDetach, beforeStart, oldRemote, promise, scrollNew, scrollTopBeforeReveal, trackable, transitionFn, viewport, willMorph;\n      options = u.options(options);\n      applyConfig(options);\n      oldElement = up.fragment.get(oldElement);\n      newElement = up.fragment.get(newElement);\n      transitionFn = findTransitionFn(transitionObject);\n      willMorph = willAnimate(oldElement, transitionFn, options);\n      beforeStart = u.pluckKey(options, 'beforeStart') || u.noop;\n      afterInsert = u.pluckKey(options, 'afterInsert') || u.noop;\n      beforeDetach = u.pluckKey(options, 'beforeDetach') || u.noop;\n      afterDetach = u.pluckKey(options, 'afterDetach') || u.noop;\n      scrollNew = u.pluckKey(options, 'scrollNew') || u.asyncNoop;\n      beforeStart();\n      if (willMorph) {\n        if (motionController.isActive(oldElement) && options.trackMotion === false) {\n          return transitionFn(oldElement, newElement, options);\n        }\n        up.puts('up.morph()', 'Morphing %o to %o with transition %O', oldElement, newElement, transitionObject);\n        viewport = up.viewport.get(oldElement);\n        scrollTopBeforeReveal = viewport.scrollTop;\n        oldRemote = up.viewport.absolutize(oldElement, {\n          afterMeasure: function() {\n            e.insertBefore(oldElement, newElement);\n            return afterInsert();\n          }\n        });\n        trackable = function() {\n          var promise;\n          promise = scrollNew();\n          promise = promise.then(function() {\n            var scrollTopAfterReveal;\n            scrollTopAfterReveal = viewport.scrollTop;\n            oldRemote.moveBounds(0, scrollTopAfterReveal - scrollTopBeforeReveal);\n            return transitionFn(oldElement, newElement, options);\n          });\n          promise = promise.then(function() {\n            beforeDetach();\n            e.remove(oldRemote.bounds);\n            return afterDetach();\n          });\n          return promise;\n        };\n        return motionController.startFunction([oldElement, newElement], trackable, options);\n      } else {\n        beforeDetach();\n        swapElementsDirectly(oldElement, newElement);\n        afterInsert();\n        afterDetach();\n        promise = scrollNew();\n        return promise;\n      }\n    };\n    findTransitionFn = function(object) {\n      var namedTransition;\n      if (isNone(object)) {\n        return void 0;\n      } else if (u.isFunction(object)) {\n        return object;\n      } else if (u.isArray(object)) {\n        return composeTransitionFn.apply(null, object);\n      } else if (u.isString(object)) {\n        if (object.indexOf('/') >= 0) {\n          return composeTransitionFn.apply(null, object.split('/'));\n        } else if (namedTransition = namedTransitions[object]) {\n          return findTransitionFn(namedTransition);\n        }\n      } else {\n        return up.fail(\"Unknown transition %o\", object);\n      }\n    };\n    composeTransitionFn = function(oldAnimation, newAnimation) {\n      var newAnimationFn, oldAnimationFn;\n      if (isNone(oldAnimation) && isNone(oldAnimation)) {\n        return void 0;\n      } else {\n        oldAnimationFn = findAnimationFn(oldAnimation) || u.asyncNoop;\n        newAnimationFn = findAnimationFn(newAnimation) || u.asyncNoop;\n        return function(oldElement, newElement, options) {\n          return Promise.all([oldAnimationFn(oldElement, options), newAnimationFn(newElement, options)]);\n        };\n      }\n    };\n    findAnimationFn = function(object) {\n      if (isNone(object)) {\n        return void 0;\n      } else if (u.isFunction(object)) {\n        return object;\n      } else if (u.isString(object)) {\n        return findNamedAnimation(object);\n      } else if (u.isOptions(object)) {\n        return function(element, options) {\n          return animateNow(element, object, options);\n        };\n      } else {\n        return up.fail('Unknown animation %o', object);\n      }\n    };\n    swapElementsDirectly = up.mockable(function(oldElement, newElement) {\n      return e.replace(oldElement, newElement);\n    });\n\n    /***\n    Defines a named transition that [morphs](/up.morph) from one element to another.\n    \n    \\#\\#\\# Example\n    \n    Here is the definition of the pre-defined `cross-fade` animation:\n    \n    ```js\n    up.transition('cross-fade', (oldElement, newElement, options) ->\n      Promise.all([\n        up.animate(oldElement, 'fade-out', options),\n        up.animate(newElement, 'fade-in', options)\n      ])\n    )\n    ```\n    \n    It is recommended that your transitions use [`up.animate()`](/up.animate),\n    passing along the `options` that were passed to you.\n    \n    If you choose to *not* use `up.animate()` and roll your own\n    logic instead, your code must honor the following contract:\n    \n    1. It must honor the options `{ duration, easing }` if given.\n    2. It must *not* remove any of the given elements from the DOM.\n    3. It returns a promise that is fulfilled when the transition has ended.\n    4. If during the animation an event `up:motion:finish` is emitted on\n       either element, the transition instantly jumps to the last frame\n       and resolves the returned promise.\n    \n    Calling [`up.animate()`](/up.animate) with an object argument\n    will take care of all these points.\n    \n    @function up.transition\n    @param {string} name\n    @param {Function(oldElement, newElement, options): Promise|Array} transition\n    @stable\n     */\n    registerTransition = function(name, transition) {\n      var fn;\n      fn = findTransitionFn(transition);\n      fn.isDefault = up.framework.booting;\n      return namedTransitions[name] = fn;\n    };\n\n    /***\n    Defines a named animation.\n    \n    Here is the definition of the pre-defined `fade-in` animation:\n    \n    ```js\n    up.animation('fade-in', function(element, options) {\n      element.style.opacity = 0\n      up.animate(element, { opacity: 1 }, options)\n    })\n    ```\n    \n    It is recommended that your definitions always end by calling\n    calling [`up.animate()`](/up.animate) with an object argument, passing along\n    the `options` that were passed to you.\n    \n    If you choose to *not* use `up.animate()` and roll your own\n    animation code instead, your code must honor the following contract:\n    \n    1. It must honor the options `{ duration, easing }`, if given.\n    2. It must *not* remove any of the given elements from the DOM.\n    3. It returns a promise that is fulfilled when the transition has ended\n    4. If during the animation an event `up:motion:finish` is emitted on\n       the given element, the transition instantly jumps to the last frame\n       and resolves the returned promise.\n    \n    Calling [`up.animate()`](/up.animate) with an object argument\n    will take care of all these points.\n    \n    @function up.animation\n    @param {string} name\n    @param {Function(element, options): Promise} animation\n    @stable\n     */\n    registerAnimation = function(name, animation) {\n      var fn;\n      fn = findAnimationFn(animation);\n      fn.isDefault = up.framework.booting;\n      return namedAnimations[name] = fn;\n    };\n    warnIfDisabled = function() {\n      if (!isEnabled()) {\n        return up.puts('up.motion', 'Animations are disabled');\n      }\n    };\n\n    /***\n    Returns whether the given animation option will cause the animation\n    to be skipped.\n    \n    @function up.motion.isNone\n    @internal\n     */\n    isNone = function(animationOrTransition) {\n      return !animationOrTransition || animationOrTransition === 'none';\n    };\n    registerOpacityAnimation = function(name, from, to) {\n      return registerAnimation(name, function(element, options) {\n        element.style.opacity = 0;\n        e.setStyle(element, {\n          opacity: from\n        });\n        return animateNow(element, {\n          opacity: to\n        }, options);\n      });\n    };\n    registerOpacityAnimation('fade-in', 0, 1);\n    registerOpacityAnimation('fade-out', 1, 0);\n    translateCSS = function(dx, dy) {\n      return {\n        transform: \"translate(\" + dx + \"px, \" + dy + \"px)\"\n      };\n    };\n    untranslatedBox = function(element) {\n      e.setStyle(element, translateCSS(0, 0));\n      return element.getBoundingClientRect();\n    };\n    registerMoveAnimations = function(direction, boxToTransform) {\n      var animationFromName, animationToName;\n      animationToName = \"move-to-\" + direction;\n      animationFromName = \"move-from-\" + direction;\n      registerAnimation(animationToName, function(element, options) {\n        var box, transform;\n        box = untranslatedBox(element);\n        transform = boxToTransform(box);\n        return animateNow(element, transform, options);\n      });\n      return registerAnimation(animationFromName, function(element, options) {\n        var box, transform;\n        box = untranslatedBox(element);\n        transform = boxToTransform(box);\n        e.setStyle(element, transform);\n        return animateNow(element, translateCSS(0, 0), options);\n      });\n    };\n    registerMoveAnimations('top', function(box) {\n      var travelDistance;\n      travelDistance = box.top + box.height;\n      return translateCSS(0, -travelDistance);\n    });\n    registerMoveAnimations('bottom', function(box) {\n      var travelDistance;\n      travelDistance = up.viewport.rootHeight() - box.top;\n      return translateCSS(0, travelDistance);\n    });\n    registerMoveAnimations('left', function(box) {\n      var travelDistance;\n      travelDistance = box.left + box.width;\n      return translateCSS(-travelDistance, 0);\n    });\n    registerMoveAnimations('right', function(box) {\n      var travelDistance;\n      travelDistance = up.viewport.rootWidth() - box.left;\n      return translateCSS(travelDistance, 0);\n    });\n    registerTransition('cross-fade', ['fade-out', 'fade-in']);\n    registerTransition('move-left', ['move-to-left', 'move-from-right']);\n    registerTransition('move-right', ['move-to-right', 'move-from-left']);\n    registerTransition('move-up', ['move-to-top', 'move-from-bottom']);\n    registerTransition('move-down', ['move-to-bottom', 'move-from-top']);\n\n    /***\n    [Follows](/a-up-follow) this link and swaps in the new fragment\n    with an animated transition.\n    \n    Note that transitions are not possible when replacing the `body`\n    element.\n    \n    \\#\\#\\# Example\n    \n    ```html\n    <a href=\"/page2\"\n      up-target=\".story\"\n      up-transition=\"move-left\">\n      Next page\n    </a>\n    ```\n    \n    @selector a[up-transition]\n    @params-note\n      All attributes for `a[up-follow]` may also be used.\n    @param [up-transition]\n      The name of a [predefined transition](/up.morph#named-transitions).\n    @param [up-fail-transition]\n      The transition to use when the server responds with an error code.\n    \n      @see server-errors\n    @stable\n     */\n\n    /***\n    [Submits](/form-up-submit) this form and swaps in the new fragment\n    with an animated transition.\n    \n    \\#\\#\\# Example\n    \n    ```html\n    <form action=\"/tasks\"\n      up-target=\".content\"\n      up-transition=\"cross-fade\">\n      ...\n    </form>\n    ```\n    \n    @selector form[up-transition]\n    @params-note\n      All attributes for `form[up-submit]` may also be used.\n    @param [up-transition]\n      The name of a [predefined transition](/up.morph#named-transitions).\n    @param [up-fail-transition]\n      The transition to use when the server responds with an error code.\n    \n      @see server-errors\n    @stable\n     */\n    up.on('up:framework:boot', warnIfDisabled);\n    up.on('up:framework:reset', reset);\n    return {\n      morph: morph,\n      animate: animate,\n      finish: finish,\n      finishCount: function() {\n        return motionController.finishCount;\n      },\n      transition: registerTransition,\n      animation: registerAnimation,\n      config: config,\n      isEnabled: isEnabled,\n      isNone: isNone,\n      willAnimate: willAnimate,\n      swapElementsDirectly: swapElementsDirectly\n    };\n  })();\n\n  up.transition = up.motion.transition;\n\n  up.animation = up.motion.animation;\n\n  up.morph = up.motion.morph;\n\n  up.animate = up.motion.animate;\n\n}).call(this);\n(function() {\n  var u,\n    slice = [].slice;\n\n  u = up.util;\n\n\n  /***\n  Network requests\n  ================\n  \n  Unpoly ships with an optimized HTTP client for fast and effective\n  communication with your server-side app.\n  \n  While you can use the browser's native `fetch()` function,\n  Unpoly's `up.request()` has a number of convenience features:\n  \n  - Requests may be [cached](/up.request#options.cache) to reuse responses and enable [preloading](/a-up-preload).\n  - Requests send [additional HTTP headers](/up.protocol) that the server may use to optimize its response.\n    For example, when updating a [fragment](/up.fragment), the fragment's selector is automatically sent\n    as an `X-Up-Target` header. The server may choose to only render the targeted fragment.\n  - Useful events like `up:request:loaded` or `up:request:late` are emitted throughout the request/response\n    lifecycle.\n  - When too many requests are sent concurrently, excessive requests are [queued](/up.network.config#config.concurrency).\n    This prevents exhausting the user's bandwidth and limits race conditions in end-to-end tests.\n  - A very concise API requiring zero boilerplate code.\n  \n  @see up.request\n  @see up.Response\n  @see up:request:late\n  \n  @module up.network\n   */\n\n  up.network = (function() {\n\n    /***\n    TODO: Docs for up.network.config.clearCache\n    \n    @property up.network.config\n    \n    @param {number} [config.concurrency=4]\n      The maximum number of concurrently loading requests.\n    \n      Additional requests are queued. [Preload](/a-up-preload) requests are\n      always queued behind non-preload requests.\n    \n      You might find it useful to set the request concurrency `1` in end-to-end tests\n      to prevent race conditions.\n    \n      Note that your browser might [impose its own request limit](http://www.browserscope.org/?category=network)\n      regardless of what you configure here.\n    \n    @param {boolean} [config.wrapMethod]\n      Whether to wrap non-standard HTTP methods in a POST request.\n    \n      If this is set, methods other than GET and POST will be converted to a `POST` request\n      and carry their original method as a `_method` parameter. This is to [prevent unexpected redirect behavior](https://makandracards.com/makandra/38347).\n    \n      If you disable method wrapping, make sure that your server always redirects with\n      with a 303 status code (rather than 302).\n    \n    @param {number} [config.cacheSize=70]\n      The maximum number of responses to cache.\n    \n      If the size is exceeded, the oldest responses will be dropped from the cache.\n    \n    @param {number} [config.cacheExpiry=300000]\n      The number of milliseconds until a cached response expires.\n    \n      Defaults to 5 minutes.\n    \n    @param {number} [config.badDownlink=0.6]\n      The connection's minimum effective bandwidth estimate required\n      to prevent Unpoly from [reducing requests](/up.network.shouldReduceRequests).\n    \n      The value is given in megabits per second. Higher is better.\n    \n    @param {number} [config.badRTT=0.6]\n      The connection's maximum effective round-trip time required\n      to prevent Unpoly from [reducing requests](/up.network.shouldReduceRequests).\n    \n      The value is given in milliseconds. Lower is better.\n    \n    @param {number} [config.badResponseTime=400]\n      How long the proxy waits until emitting the [`up:request:late` event](/up:request:late).\n    \n      This metric is *not* considered for the decision to\n      [reduce requests](/up.network.shouldReduceRequests).\n    \n      The value is given in milliseconds.\n    \n    @param {Function(up.Request): boolean} config.autoCache\n      Whether to cache the given request with `{ cache: 'auto' }`.\n    \n      By default Unpoly will auto-cache requests with safe HTTP methods.\n    \n    @param {Function(up.Request, up.Response)} config.clearCache\n      Whether to [clear the cache](/up.cache.clear) after the given request and response.\n    \n      By default Unpoly will clear the entire cache after a request with an unsafe HTTP method.\n    \n    @param {Array<string>|Function(up.Request): Array<string>} [config.requestMetaKeys]\n      An array of request property names\n      that are sent to the server as [HTTP headers](/up.protocol).\n    \n      The server may return an optimized response based on these properties,\n      e.g. by omitting a navigation bar that is not targeted.\n    \n      \\#\\#\\# Cacheability considerations\n    \n      Two requests with different `requestMetaKeys` are considered cache misses when [caching](/up.request) and\n      [preloading](a-up-preload). To **improve cacheability**, you may set\n      `up.network.config.requestMetaKeys` to a shorter list of property keys.\n    \n      \\#\\#\\# Available fields\n    \n      The default configuration is `['target', 'failTarget', 'mode', 'failMode', 'context', 'failContext']`.\n      This means the following properties are sent to the server:\n    \n      | Request property         | Request header      |\n      |--------------------------|---------------------|\n      | `up.Request#target`      | `X-Up-Target`       |\n      | `up.Request#failTarget`  | `X-Up-Fail-Target`  |\n      | `up.Request#context`     | `X-Up-Context`      |\n      | `up.Request#failContext` | `X-Up-Fail-Context` |\n      | `up.Request#mode`        | `X-Up-Mode`         |\n      | `up.Request#failMode`    | `X-Up-Fail-Mode`    |\n    \n      \\#\\#\\# Per-route configuration\n    \n      You may also configure a function that accepts an [`up.Request`](/up.Request) and returns\n      an array of request property names that are sent to the server.\n    \n      With this you may send different request properties for different URLs:\n    \n      ```javascript\n      up.network.config.requestMetaKeys = function(request) {\n        if (request.url == '/search') {\n          // The server optimizes responses on the /search route.\n          return ['target', 'failTarget']\n        } else {\n          // The server doesn't optimize any other route,\n          // so configure maximum cacheability.\n          return []\n        }\n      }\n    \n    @stable\n     */\n    var abortRequests, cache, config, handleCaching, isBusy, isIdle, isSafeMethod, makeRequest, mimicLocalRequest, parseRequestOptions, queue, queueRequest, registerAliasForRedirect, reset, shouldReduceRequests, useCachedRequest;\n    config = new up.Config(function() {\n      return {\n        concurrency: 4,\n        wrapMethod: true,\n        cacheSize: 70,\n        cacheExpiry: 1000 * 60 * 5,\n        badDownlink: 0.6,\n        badRTT: 750,\n        badResponseTime: 400,\n        autoCache: function(request) {\n          return request.isSafe();\n        },\n        clearCache: function(request, _response) {\n          return !request.isSafe();\n        },\n        requestMetaKeys: ['target', 'failTarget', 'mode', 'failMode', 'context', 'failContext']\n      };\n    });\n    queue = new up.Request.Queue();\n    cache = new up.Request.Cache();\n\n    /***\n    Returns an earlier request [matching](/up.network.config#config.requestMetaKeys) the given request options.\n    \n    Returns `undefined` if the given request is not currently cached.\n    \n    Note that `up.request()` will only write to the cache with `{ cache: true }`.\n    \n    \\#\\#\\# Example\n    \n    ```\n    let request = up.cache.get({ url: '/foo' })\n    \n    if (request) {\n      let response = await request\n      console.log(\"Response is %o\", response)\n    } else {\n      console.log(\"The path /foo has not been requested before!\")\n    }\n    ```\n    \n    @function up.cache.get\n    @param {Object} requestOptions\n      The request options to match against the cache.\n    \n      See `options` for `up.request()` for documentation.\n    \n      The user may configure `up.network.config.requestMetaKeys` to define\n      which request options are relevant for cache matching.\n    @return {up.Request|undefined}\n      The cached request.\n    @experimental\n     */\n\n    /***\n    Removes all [cache](/up.cache.get) entries.\n    \n    To only remove some cache entries, pass a [URL pattern](/url-patterns):\n    \n    ```js\n    up.cache.clear('/users/*')\n    ```\n    \n    \\#\\#\\# Other reasons the cache may clear\n    \n    By default Unpoly automatically clears the entire cache whenever it processes\n    a request with an non-GET HTTP method. To customize this rule, use `up.network.config.clearCache`.\n    \n    The server may also clear the cache by sending an [`X-Up-Cache: clear`](/X-Up-Cache) header.\n    \n    @function up.cache.clear\n    @param {string} [pattern]\n      A [URL pattern](/url-patterns) matching cache entries that should be cleared.\n    \n      If omitted, the entire cache is cleared.\n    @stable\n     */\n\n    /***\n    Makes the cache assume that `newRequest` has the same response as the\n    already cached `oldRequest`.\n    \n    Unpoly uses this internally when the user redirects from `/old` to `/new`.\n    In that case, both `/old` and `/new` will cache the same response from `/new`.\n    \n    @function up.cache.alias\n    @param {Object} oldRequest\n      The earlier [request options](/up.request).\n    @param {Object} newRequest\n      The new [request options](/up.request).\n    @experimental\n     */\n\n    /***\n    Manually stores a request in the cache.\n    \n    Future calls to `up.request()` will try to re-use this request before\n    making a new request.\n    \n    @function up.cache.set\n    @param {string} request.url\n    @param {string} [request.method='GET']\n    @param {string} [request.target='body']\n    @param {up.Request} request\n      The request to cache. The cache is also a promise for the response.\n    @internal\n     */\n\n    /***\n    Manually removes the given request from the cache.\n    \n    You can also [configure](/up.network.config) when\n    cache entries expire automatically.\n    \n    @function up.cache.remove\n    @param {Object} requestOptions\n      The request options for which to remove cached requests.\n    \n      See `options` for `up.request()` for documentation.\n    @experimental\n     */\n    reset = function() {\n      abortRequests();\n      queue.reset();\n      config.reset();\n      return cache.clear();\n    };\n\n    /***\n    Makes an AJAX request to the given URL.\n    \n    Returns an `up.Request` object which contains information about the request.\n    This request object is also a promise for an `up.Response` that contains\n    the response text, headers, etc.\n    \n    \\#\\#\\# Example\n    \n    ```js\n    let request = up.request('/search', { params: { query: 'sunshine' } })\n    console.log('We made a request to', request.url)\n    \n    let response = await request\n    console.log('The response text is', response.text)\n    ```\n    \n    \\#\\#\\# Error handling\n    \n    The returned promise will fulfill with an `up.Response` when the server\n    responds with an HTTP status of 2xx (like `200`).\n    \n    When the server responds with an HTTP error code (like `422` or `500`), the promise\n    will *reject* with `up.Response`.\n    \n    When the request fails from a fatal error (like a timeout or loss of connectivity),\n    the promise will reject with an [`Error`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error) object.\n    \n    Here is an example for a complete control flow that handles both HTTP error codes\n    and fatal errors:\n    \n    ```js\n    try {\n      let response = await up.request('/search', { params: { query: 'sunshine' } })\n      console.log('Successful response with text:', response.text)\n    } catch (e) {\n      if (e instanceof up.Response) {\n        console.log('Server responded with HTTP status %s and text %s', e.status, e.text)\n      } else {\n        console.log('Fatal error during request:', e.message)\n      }\n    }\n    ```\n    \n    \\#\\#\\# Caching\n    \n    You may cache responses by passing a `{ cache }` option. Responses for a cached\n    request will resolve instantly.\n    \n    By default the cache cleared after making a request with an unsafe HTTP method.\n    \n    You can configure caching with the [`up.network.config`](/up.network.config) property.\n    \n    @function up.request\n    \n    @param {string} [url]\n      The URL for the request.\n    \n      Instead of passing the URL as a string argument, you can also pass it as an `{ url }` option.\n    \n    @param {string} [options.url]\n      The URL for the request.\n    \n    @param {string} [options.method='GET']\n      The HTTP method for the request.\n    \n    @param {Object|up.Params|string|Array} [options.params={}]\n      [Parameters](/up.Params) that should be sent as the request's\n      [query string](https://en.wikipedia.org/wiki/Query_string) or payload.\n    \n      When making a `GET` request to a URL with a query string, the given `{ params }` will be added\n      to the query parameters.\n    \n    @param {boolean} [options.cache=false]\n      Whether to read from and write to the [cache](/up.cache).\n    \n      With `{ cache: true }` Unpoly will try to re-use a cached response before connecting\n      to the network. If no cached response exists, Unpoly will make a request and cache\n      the server response.\n    \n      With `{ cache: 'auto' }` Unpoly will use the cache only if `up.network.config.autoCache`\n      returns `true` for this request.\n    \n      With `{ cache: false }` (the default) Unpoly will always make a network request.\n    \n    @param {boolean|string} [options.clearCache]\n      Whether to [clear](/up.cache.clear) the [cache](/up.cache.get) after this request.\n    \n      You may also pass a [URL pattern](/url-patterns) to only clear matching requests.\n    \n      Defaults to the result of `up.network.config.clearCache`, which\n      defaults to clearing the entire cache after a non-GET request.\n    \n    @param {Object} [options.headers={}]\n      An object of additional HTTP headers.\n    \n      Note that Unpoly will by default send a number of custom request headers.\n      See `up.protocol` and `up.network.config.metaKeys` for details.\n    \n    @param {boolean} [options.wrapMethod]\n      Whether to wrap non-standard HTTP methods in a POST request.\n    \n      If this is set, methods other than GET and POST will be converted to a `POST` request\n      and carry their original method as a `_method` parameter. This is to [prevent unexpected redirect behavior](https://makandracards.com/makandra/38347).\n    \n      Defaults to [`up.network.config`](/up.network.config#config.wrapMethod).\n    \n    @param {string} [options.timeout]\n      A timeout in milliseconds.\n    \n      If `up.network.config.maxRequests` is set, the timeout\n      will not include the time spent waiting in the queue.\n    \n    @param {string} [options.target='body']\n      The CSS selector that will be sent as an `X-Up-Target` header.\n    \n    @param {string} [options.failTarget='body']\n      The CSS selector that will be sent as an `X-Up-Fail-Target` header.\n    \n    @param {string} [options.layer='current']\n      The [layer](/up.layer) this request is associated with.\n    \n    @param {string} [options.failLayer='current']\n      The [layer](/up.layer) this request is associated with if the server [sends a HTTP status code](/server-errors).\n    \n    @param {Element} [options.origin]\n      The DOM element that caused this request to be sent, e.g. a hyperlink or form element.\n    \n    @param {Element} [options.contentType]\n      The format in which to encode the request params.\n    \n      Allowed values are `application/x-www-form-urlencoded` and `multipart/form-data`.\n      Only `multipart/form-data` can transport binary data.\n    \n      If this option is omitted Unpoly will prefer `application/x-www-form-urlencoded`,\n      unless request params contains binary data.\n    \n    @param {string} [options.payload]\n      A custom payload for this request.\n    \n      By default Unpoly will build a payload from the given `{ params }` option.\n      Therefore this option is not required when making a standard link or form request to a server\n      that renders HTML.\n    \n      A use case for this option is talking to a JSON API that expects requests with a `application/json` payload.\n    \n      If a `{ payload }` option is given you must also pass a `{ contentType }`.\n    \n    @return {up.Request}\n      An object with information about the request.\n    \n      The request object is also a promise for its `up.Response`.\n    \n    @stable\n     */\n    makeRequest = function() {\n      var args, request, solo;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      request = new up.Request(parseRequestOptions(args));\n      useCachedRequest(request) || queueRequest(request);\n      if (solo = request.solo) {\n        queue.abortExcept(request, solo);\n      }\n      return request;\n    };\n    mimicLocalRequest = function(options) {\n      var clearCache, solo;\n      if (solo = options.solo) {\n        abortRequests(solo);\n      }\n      if (clearCache = options.clearCache) {\n        return cache.clear(clearCache);\n      }\n    };\n    parseRequestOptions = function(args) {\n      var base, options;\n      options = u.extractOptions(args);\n      options.url || (options.url = args[0]);\n      if (typeof (base = up.migrate).handleRequestOptions === \"function\") {\n        base.handleRequestOptions(options);\n      }\n      return options;\n    };\n    useCachedRequest = function(request) {\n      var cachedRequest;\n      if (request.willCache() && (cachedRequest = cache.get(request))) {\n        up.puts('up.request()', 'Re-using previous request to %s %s', request.method, request.url);\n        if (!request.preload) {\n          queue.promoteToForeground(cachedRequest);\n        }\n        request.followState(cachedRequest);\n        return true;\n      }\n    };\n    queueRequest = function(request) {\n      if (request.preload && !request.isSafe()) {\n        up.fail('Will not preload request to %s', request.description);\n      }\n      handleCaching(request);\n      return queue.asap(request);\n    };\n    handleCaching = function(request) {\n      if (request.willCache()) {\n        cache.set(request, request);\n      }\n      return u.always(request, function(response) {\n        var clearCache, ref, ref1;\n        if (clearCache = (ref = (ref1 = response.clearCache) != null ? ref1 : request.clearCache) != null ? ref : config.clearCache(request, response)) {\n          cache.clear(clearCache);\n        }\n        if (request.willCache() || cache.get(request)) {\n          cache.set(request, request);\n        }\n        if (!response.ok) {\n          return cache.remove(request);\n        }\n      });\n    };\n\n    /***\n    Returns whether Unpoly is not currently waiting for a [request](/up.request) to finish.\n    \n    @function up.network.isIdle\n    @return {boolean}\n    @stable\n     */\n    isIdle = function() {\n      return !isBusy();\n    };\n\n    /***\n    Returns whether Unpoly is currently waiting for a [request](/up.request) to finish.\n    \n    @function up.network.isBusy\n    @return {boolean}\n    @stable\n     */\n    isBusy = function() {\n      return queue.isBusy();\n    };\n\n    /***\n    Returns whether optional requests should be avoided where possible.\n    \n    We assume the user wants to avoid requests if either of following applies:\n    \n    - The user has enabled data saving in their browser (\"Lite Mode\" in Chrome for Android).\n    - The connection's effective round-trip time is longer than `up.network.config.badRTT`.\n    - The connection's effective bandwidth estimate is less than `up.network.config.badDownlink`.\n    \n    By default Unpoly will disable [preloading](/up-preload) and [polling](/up-poll) if requests\n    should be avoided.\n    \n    @function up.network.shouldReduceRequests\n    @return {boolean}\n      Whether requests should be avoided where possible.\n    @experimental\n     */\n    shouldReduceRequests = function() {\n      var netInfo;\n      if (netInfo = navigator.connection) {\n        return netInfo.saveData || (netInfo.rtt && netInfo.rtt > config.badRTT) || (netInfo.downlink && netInfo.downlink < config.badDownlink);\n      }\n    };\n\n    /***\n    Aborts pending [requests](/up.request).\n    \n    The event `up:request:aborted` will be emitted.\n    \n    The promise returned by `up.request()` will be rejected with an exception named `AbortError`:\n    \n        try {\n          let response = await up.request('/path')\n          console.log(response.text)\n        } catch (err) {\n          if (err.name == 'AbortError') {\n            console.log('Request was aborted')\n          }\n        }\n    \n    \\#\\#\\# Examples\n    \n    Without arguments, this will abort all pending requests:\n    \n    ```js\n    up.network.abort()\n    ```\n    \n    To abort a given `up.Request` object, pass it as the first argument:\n    \n    ```js\n    let request = up.request('/path')\n    up.network.abort(request)\n    ```\n    \n    To abort all requests matching a condition, pass a function that takes a request\n    and returns a boolean value. Unpoly will abort all request for which the given\n    function returns `true`. E.g. to abort all requests with a HTTP method as `GET`:\n    \n    ```js\n    up.network.abort((request) => request.method == 'GET')\n    ```\n    \n    @function up.network.abort\n    @param {up.Request|boolean|Function(up.Request): boolean} [matcher=true]\n      If this argument is omitted, all pending requests are aborted.\n    @stable\n     */\n    abortRequests = function() {\n      var args;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      return queue.abort.apply(queue, args);\n    };\n\n    /***\n    This event is [emitted](/up.emit) when an [AJAX request](/up.request)\n    was [aborted](/up.network.abort()).\n    \n    The event is emitted on the layer that caused the request.\n    \n    @event up:request:aborted\n    @param {up.Request} event.request\n      The aborted request.\n    @param {up.Layer} [event.layer]\n      The [layer](/up.layer) that caused the request.\n    @param event.preventDefault()\n    @experimental\n     */\n\n    /***\n    This event is [emitted](/up.emit) when [AJAX requests](/up.request)\n    are taking long to finish.\n    \n    By default Unpoly will wait 800 ms for an AJAX request to finish\n    before emitting `up:request:late`. You can configure this time like this:\n    \n        up.network.config.badResponseTime = 400;\n    \n    Once all responses have been received, an [`up:request:recover`](/up:request:recover)\n    will be emitted.\n    \n    Note that if additional requests are made while Unpoly is already busy\n    waiting, **no** additional `up:request:late` events will be triggered.\n    \n    \\#\\#\\# Spinners\n    \n    You can [listen](/up.on) to the `up:request:late`\n    and [`up:request:recover`](/up:request:recover) events to implement a spinner\n    that appears during a long-running request,\n    and disappears once the response has been received:\n    \n        <div class=\"spinner\">Please wait!</div>\n    \n    Here is the JavaScript to make it alive:\n    \n        up.compiler('.spinner', function(element) {\n          show = () => { up.element.show(element) }\n          hide = () => { up.element.hide(element) }\n    \n          hide()\n    \n          return [\n            up.on('up:request:late', show),\n            up.on('up:request:recover', hide)\n          ]\n        })\n    \n    The `up:request:late` event will be emitted after a delay\n    to prevent the spinner from flickering on and off.\n    You can change (or remove) this delay like this:\n    \n        up.network.config.badResponseTime = 400;\n    \n    @event up:request:late\n    @stable\n     */\n\n    /***\n    This event is [emitted](/up.emit) when [AJAX requests](/up.request)\n    have [taken long to finish](/up:request:late), but have finished now.\n    \n    See [`up:request:late`](/up:request:late) for more documentation on\n    how to use this event for implementing a spinner that shows during\n    long-running requests.\n    \n    @event up:request:recover\n    @stable\n     */\n\n    /***\n    This event is [emitted](/up.emit) before an [AJAX request](/up.request)\n    is sent over the network.\n    \n    The event is emitted on the layer that caused the request.\n    \n    @event up:request:load\n    @param {up.Request} event.request\n      The request to be sent.\n    @param {up.Layer} [event.layer]\n      The [layer](/up.layer) that caused the request.\n    @param event.preventDefault()\n      Event listeners may call this method to prevent the request from being sent.\n    @stable\n     */\n    registerAliasForRedirect = function(request, response) {\n      var newRequest;\n      if (request.cache && response.url && request.url !== response.url) {\n        newRequest = request.variant({\n          method: response.method,\n          url: response.url\n        });\n        return cache.alias(request, newRequest);\n      }\n    };\n\n    /***\n    This event is [emitted](/up.emit) when the response to an [AJAX request](/up.request)\n    has been received.\n    \n    Note that this event will also be emitted when the server signals an\n    error with an HTTP status like `500`. Only if the request\n    encounters a fatal error (like a loss of network connectivity),\n    [`up:request:fatal`](/up:request:fatal) is emitted instead.\n    \n    The event is emitted on the layer that caused the request.\n    \n    @event up:request:loaded\n    @param {up.Request} event.request\n      The request.\n    @param {up.Response} event.response\n      The response that was received from the server.\n    @param {up.Layer} [event.layer]\n      The [layer](/up.layer) that caused the request.\n    @stable\n     */\n\n    /***\n    This event is [emitted](/up.emit) when an [AJAX request](/up.request)\n    encounters fatal error like a timeout or loss of network connectivity.\n    \n    Note that this event will *not* be emitted when the server produces an\n    error message with an HTTP status like `500`. When the server can produce\n    any response, [`up:request:loaded`](/up:request:loaded) is emitted instead.\n    \n    The event is emitted on the layer that caused the request.\n    \n    @event up:request:fatal\n    @param {up.Request} event.request\n      The request.\n    @param {up.Layer} [event.layer]\n      The [layer](/up.layer) that caused the request.\n    @stable\n     */\n\n    /***\n    @internal\n     */\n    isSafeMethod = function(method) {\n      return u.contains(['GET', 'OPTIONS', 'HEAD'], u.normalizeMethod(method));\n    };\n    up.on('up:framework:reset', reset);\n    return {\n      request: makeRequest,\n      cache: cache,\n      isIdle: isIdle,\n      isBusy: isBusy,\n      isSafeMethod: isSafeMethod,\n      config: config,\n      abort: abortRequests,\n      registerAliasForRedirect: registerAliasForRedirect,\n      queue: queue,\n      shouldReduceRequests: shouldReduceRequests,\n      mimicLocalRequest: mimicLocalRequest\n    };\n  })();\n\n  up.request = up.network.request;\n\n  up.cache = up.network.cache;\n\n}).call(this);\n(function() {\n  var e, u,\n    slice = [].slice;\n\n  u = up.util;\n\n  e = up.element;\n\n\n  /***\n  Layers\n  ======\n  \n  Unpoly allows you to [open page fragments in an overlay](/opening-overlays). Overlays may be stacked infinitely.\n  \n  A variety of [overlay modes](/layer-terminology) are supported,\n  such as modal dialogs, popup overlays or drawers. You may [customize their appearance and behavior](/customizing-overlays).\n  \n  Layers are isolated, meaning a screen in one layer will not accidentally see elements\n  or events from another layer. For instance, [fragment links](/up.link) will only update elements from the [current layer](/up.layer.current)\n  unless you [explicitly target another layer](/layer-option).\n  \n  Overlays allow you to break up a complex screen into [subinteractions](/subinteractions).\n  Subinteractions take place in overlays and may span one or many pages. The original screen remains open in the background.\n  Once the subinteraction is *done*, the overlay is closed and a result value is communicated back to the parent layer.\n  \n  @see a[up-layer=new]\n  @see up.layer.current\n  @see up.layer.on\n  @see up.layer.ask\n  \n  @module up.layer\n   */\n\n  up.layer = (function() {\n    var LAYER_CLASSES, OVERLAY_CLASSES, anySelector, api, ask, build, closeCallbackAttr, config, handlers, mainTargets, modeConfigs, normalizeOptions, open, openCallbackAttr, optionToString, reset, stack;\n    OVERLAY_CLASSES = [up.Layer.Modal, up.Layer.Popup, up.Layer.Drawer, up.Layer.Cover];\n    LAYER_CLASSES = [up.Layer.Root].concat(OVERLAY_CLASSES);\n\n    /***\n    Configures default attributes for new overlays.\n    \n    All options for `up.layer.open()` may be configured.\n    The configuration will also be used for `a[up-layer=new]` links.\n    \n    Defaults are configured separately for each [layer mode](/layer-terminology):\n    \n    | Object                    | Effect                       |\n    |---------------------------|------------------------------|\n    | `up.layer.config.root`    | Defaults for the root layer  |\n    | `up.layer.config.modal`   | Defaults for modal overlays  |\n    | `up.layer.config.drawer`  | Defaults for drawer overlays |\n    | `up.layer.config.popup`   | Defaults for popup overlays  |\n    | `up.layer.config.cover`   | Defaults for cover overlays  |\n    \n    For convenience you may configure options that affect all layer modes\n    or all overlay modes:\n    \n    | Object                    | Effect                       |\n    |---------------------------|------------------------------|\n    | `up.layer.config.any`     | Defaults for all layers      |\n    | `up.layer.config.overlay` | Defaults for all overlays    |\n    \n    Options configured in such a way are inherited.\n    E.g. when you open a new drawer overlay, defaults from `up.layer.config.drawer`,\n    `up.layer.config.overlay` and `up.layer.config.any` will be used (in decreasing priority).\n    \n    \\#\\#\\# Example\n    \n    To make all modal overlays move in from beyond the top edge of the screen:\n    \n    ```js\n    up.layer.config.modal.openAnimation = 'move-from-top'\n    ```\n    \n    To configure an additional [main target](/up-main)\n    for overlay of any mode:\n    \n    ```js\n    up.layer.config.overlay.mainTargets.unshift('.content')\n    ```\n    \n    \\#\\#\\# Configuration inheritance\n    \n    @property up.layer.config\n    \n    @param {string} config.mode='modal'\n      The default [mode](/layer-terminology) used when opening a new overlay.\n    \n    @param {object} config.any\n      Defaults for all layer modes.\n    \n    @param {Array<string>} config.any.mainTargets\n      An array of CSS selectors matching default render targets.\n    \n      This is an alias for `up.fragment.config.mainTargets`.\n    \n    @param {object} config.root\n      Defaults for the [root layer](/layer-terminology).\n    \n      Inherits from `up.layer.config.any`.\n    \n    @param {object} config.root.mainTargets\n    \n    @param {object} config.overlay\n      Defaults for all [overlays](/layer-terminology).\n    \n      In addition to the options documented here,\n      all options for `up.layer.open()` may also be configured.\n    \n      Inherits from `up.layer.config.any`.\n    \n    @param {string|Function} config.overlay.openAnimation\n      The opening animation.\n    \n    @param {number} config.overlay.openDuration\n      The duration of the opening animation.\n    \n    @param {string} config.overlay.openEasing\n      The easing function for the opening animation.\n    \n    @param {string|Function} config.overlay.closeAnimation\n      The closing animation.\n    \n    @param {number} config.overlay.closeDuration\n      The duration of the closing animation.\n    \n    @param {string} config.overlay.closeEasing\n      The easing function for the opening animation.\n    \n    @param {string} config.overlay.dismissLabel\n      The symbol for the dismiss icon in the top-right corner.\n    \n    @param {string} config.overlay.dismissAriaLabel\n      The accessibility label for the dismiss icon in the top-right corner.\n    \n    @param {string|boolean} config.overlay.historyVisible='auto'\n      Whether the layer's location or title will be visible in the browser's\n      address bar and window title.\n    \n      If set to `'auto'`, the overlay will render history if its initial fragment\n      is an [auto history target](/up.fragment.config.autoHistoryTargets).\n    \n      If set to `true`, the overlay will always render history.\n      If set to `false`, the overlay will never render history.\n    \n    @param {object} config.modal\n      Defaults for [modal overlays](/layer-terminology).\n    \n      Inherits from `up.layer.config.overlay` and `up.layer.config.any`.\n    \n    @param {object} config.cover\n      Defaults for [cover overlays](/layer-terminology).\n    \n      Inherits from `up.layer.config.overlay` and `up.layer.config.any`.\n    \n    @param {object} config.drawer\n      Defaults for [drawer overlays](/layer-terminology).\n    \n      Inherits from `up.layer.config.overlay` and `up.layer.config.any`.\n    \n    @param {object} config.popup\n      Defaults for [popup overlays](/layer-terminology).\n    \n      Inherits from `up.layer.config.overlay` and `up.layer.config.any`.\n    \n    @stable\n     */\n    config = new up.Config(function() {\n      var Class, i, len, newConfig;\n      newConfig = {\n        mode: 'modal',\n        any: {\n          mainTargets: [\"[up-main='']\", 'main', ':layer']\n        },\n        root: {\n          mainTargets: ['[up-main~=root]'],\n          historyVisible: true\n        },\n        overlay: {\n          mainTargets: ['[up-main~=overlay]'],\n          openAnimation: 'fade-in',\n          closeAnimation: 'fade-out',\n          dismissLabel: '×',\n          dismissAriaLabel: 'Dismiss dialog',\n          dismissable: true,\n          historyVisible: 'auto'\n        },\n        cover: {\n          mainTargets: ['[up-main~=cover]']\n        },\n        drawer: {\n          mainTargets: ['[up-main~=drawer]'],\n          backdrop: true,\n          position: 'left',\n          size: 'medium',\n          openAnimation: function(layer) {\n            switch (layer.position) {\n              case 'left':\n                return 'move-from-left';\n              case 'right':\n                return 'move-from-right';\n            }\n          },\n          closeAnimation: function(layer) {\n            switch (layer.position) {\n              case 'left':\n                return 'move-to-left';\n              case 'right':\n                return 'move-to-right';\n            }\n          }\n        },\n        modal: {\n          mainTargets: ['[up-main~=modal]'],\n          backdrop: true,\n          size: 'medium'\n        },\n        popup: {\n          mainTargets: ['[up-main~=popup]'],\n          position: 'bottom',\n          size: 'medium',\n          align: 'left',\n          dismissable: 'outside key'\n        }\n      };\n      for (i = 0, len = LAYER_CLASSES.length; i < len; i++) {\n        Class = LAYER_CLASSES[i];\n        newConfig[Class.mode].Class = Class;\n      }\n      return newConfig;\n    });\n\n    /***\n    A list of layers that are currently open.\n    \n    The first element in the list is the [root layer](/up.layer.root).\n    The last element is the [frontmost layer](/up.layer.front).\n    \n    @property up.layer.stack\n    @param {List<up.Layer>} stack\n    @stable\n     */\n    stack = null;\n    handlers = [];\n    mainTargets = function(mode) {\n      return u.flatMap(modeConfigs(mode), 'mainTargets');\n    };\n\n    /***\n    Returns an array of config objects that apply to the given mode name.\n    \n    The config objects are in descending order of specificity.\n     */\n    modeConfigs = function(mode) {\n      if (mode === 'root') {\n        return [config.root, config.any];\n      } else {\n        return [config[mode], config.overlay, config.any];\n      }\n    };\n    normalizeOptions = function(options) {\n      var base, match, openMethod, shorthandMode;\n      if (typeof (base = up.migrate).handleLayerOptions === \"function\") {\n        base.handleLayerOptions(options);\n      }\n      if (u.isGiven(options.layer)) {\n        if (match = String(options.layer).match(/^(new|shatter|swap)( (\\w+))?/)) {\n          options.layer = 'new';\n          openMethod = match[1];\n          shorthandMode = match[3];\n          options.mode || (options.mode = shorthandMode || config.mode);\n          if (openMethod === 'swap') {\n            if (up.layer.isOverlay()) {\n              options.baseLayer = 'parent';\n            }\n          } else if (openMethod === 'shatter') {\n            options.baseLayer = 'root';\n          }\n        }\n      } else {\n        if (options.mode) {\n          options.layer = 'new';\n        } else if (u.isElementish(options.target)) {\n          options.layer = stack.get(options.target, {\n            normalizeLayerOptions: false\n          });\n        } else if (options.origin) {\n          options.layer = 'origin';\n        } else {\n          options.layer = 'current';\n        }\n      }\n      options.context || (options.context = {});\n      return options.baseLayer = stack.get('current', u.merge(options, {\n        normalizeLayerOptions: false\n      }));\n    };\n    build = function(options) {\n      var Class, configs, handleDeprecatedConfig, mode;\n      mode = options.mode;\n      Class = config[mode].Class;\n      configs = u.reverse(modeConfigs(mode));\n      if (handleDeprecatedConfig = up.migrate.handleLayerConfig) {\n        configs.forEach(handleDeprecatedConfig);\n      }\n      options = u.mergeDefined.apply(u, slice.call(configs).concat([{\n        mode: mode,\n        stack: stack\n      }], [options]));\n      return new Class(options);\n    };\n    openCallbackAttr = function(link, attr) {\n      return e.callbackAttr(link, attr, ['layer']);\n    };\n    closeCallbackAttr = function(link, attr) {\n      return e.callbackAttr(link, attr, ['layer', 'value']);\n    };\n    reset = function() {\n      config.reset();\n      stack.reset();\n      return handlers = u.filter(handlers, 'isDefault');\n    };\n\n    /***\n    [Opens a new overlay](/opening-overlays).\n    \n    Opening a layer is considered [navigation](/navigation) by default.\n    \n    \\#\\#\\# Example\n    \n    ```js\n    let layer = await up.layer.open({ url: '/contacts' })\n    console.log(layer.mode) // logs \"modal\"\n    ```\n    \n    @function up.layer.open\n    \n    @param {Object} [options]\n      All [render options](/up.render) may be used.\n    \n      You may configure default layer attributes in `up.layer.config`.\n    \n    @param {string} [options.layer=\"new\"]\n      Whether to stack the new overlay or replace existing overlays.\n    \n      See [replacing existing overlays](/opening-layers#replacing-existing-overlays).\n    \n    @param {string} [options.mode]\n      The kind of overlay to open.\n    \n      See [available layer modes](/layer-terminology#available-modes).\n    \n    @param {string} [options.size]\n      The size of the overlay.\n    \n      Supported values are `'small'`, `'medium'`, `'large'` and `'grow'`:\n      See [overlay sizes](/customizing-overlays#overlay-sizes) for details.\n    \n    @param {string} [options.class]\n      An optional HTML class for the overlay's container element.\n    \n      See [overlay classes](/customizing-overlays#overlay-classes).\n    \n    @param {boolean|string|Array<string>} [options.dismissable=true]\n      How the overlay may be [dismissed](/closing-overlays) by the user.\n    \n      Supported values are `'key'`, `'outside'` and `'button'`.\n      See [customizing dismiss controls](/closing-overlays#customizing-dismiss-controls)\n      for details.\n    \n      You may enable multiple dismiss controls by passing an array or\n      a space-separated string.\n    \n      Passing `true` or `false` will enable or disable all dismiss controls.\n    \n    @param {boolean|string} [options.historyVisible]\n      Whether history of the overlay content is visible.\n    \n      If set to `true` the overlay location and title will be shown in browser UI.\n    \n      If set to `'auto'` history will be visible if the initial overlay\n      content matches a [main target](/up-main).\n    \n    @param {string|Function} [options.animation]\n      The opening animation.\n    \n    @param {Function(Event)} [options.onOpened]\n      A function that is called when the overlay was inserted into the DOM.\n    \n      The function argument is an `up:layer:opened` event.\n    \n      The overlay may still play an opening animation when this function is called.\n      To be called when the opening animation is done, pass an\n      [`{ onFinished }`](/up.render#options.onFinished) option.\n    \n    @param {Function(Event)} [options.onAccepted]\n      A function that is called when the overlay was [accepted](/closing-overlays).\n    \n      The function argument is an `up:layer:accepted` event.\n    \n    @param {Function(Event)} [options.onDismissed]\n      A function that is called when the overlay was [dismissed](/closing-overlays).\n    \n      The function argument is an `up:layer:dismissed` event.\n    \n    @param {string|Array<string>} [options.acceptEvent]\n      One or more event types that will cause this overlay to automatically be\n      [accepted](/closing-overlays) when a matching event occurs within the overlay.\n    \n      The [overlay result value](/closing-overlays#overlay-result-values)\n      is the event object that caused the overlay to close.\n    \n      See [Closing when an event is emitted](/closing-overlays#closing-when-an-event-is-emitted).\n    \n    @param {string|Array<string>} [options.dismissEvent]\n      One or more event types that will cause this overlay to automatically be\n      [dismissed](/closing-overlays) when a matching event occurs within the overlay.\n    \n      The [overlay result value](/closing-overlays#overlay-result-values)\n      is the event object that caused the overlay to close.\n    \n      See [Closing when an event is emitted](/closing-overlays#closing-when-an-event-is-emitted).\n    \n    @param {string|Array<string>} [options.acceptLocation]\n      One or more [URL patterns](/url-patterns) that will cause this overlay to automatically be\n      [accepted](/closing-overlays) when the overlay reaches a matching [location](/up.layer.location).\n    \n      The [overlay result value](/closing-overlays#overlay-result-values)\n      is an object of [named segments matches](/url-patterns#capturing-named-segments) captured\n      by the URL pattern.\n    \n      See [Closing when a location is reached](/closing-overlays#closing-when-a-location-is-reached).\n    \n    @param {string|Array<string>} [options.dismissLocation]\n      One or more [URL patterns](/url-patterns) that will cause this overlay to automatically be\n      [dismissed](/closing-overlays) when the overlay reaches a matching [location](/up.layer.location).\n    \n      The [overlay result value](/closing-overlays#overlay-result-values)\n      is an object of [named segments matches](/url-patterns#capturing-named-segments) captured\n      by the URL pattern.\n    \n      See [Closing when a location is reached](/closing-overlays#closing-when-a-location-is-reached).\n    \n    @param {Object} [options.context={}]\n      The initial [context](/up.layer.context) object for the new overlay.\n    \n    @param {string} [options.position]\n      The position of the popup relative to the `{ origin }` element that opened\n      the overlay.\n    \n      Supported values are `'top'`,  `'right'`,  `'bottom'` and  `'left'`.\n    \n      See [popup position](/customizing-overlays#popup-position).\n    \n    @param {string} [options.align]\n      The alignment of the popup within its `{ position }`.\n    \n      Supported values are `'top'`,  `'right'`, `'center'`, `'bottom'` and  `'left'`.\n    \n      See [popup position](/customizing-overlays#popup-position).\n    \n    @return {Promise<up.Layer>}\n      A promise for the `up.Layer` object that models the new overlay.\n    \n      The promise will be resolved once the overlay was placed into the DOM.\n    \n    @stable\n     */\n    open = function(options) {\n      options = u.options(options, {\n        layer: 'new',\n        defaultToEmptyContent: true,\n        navigate: true\n      });\n      return up.render(options).then(function(result) {\n        return result.layer;\n      });\n    };\n\n    /***\n    This event is emitted before an overlay is opened.\n    \n    The overlay is not yet part of the [layer stack](/up.layer.stack) and has not yet been placed\n    in the DOM. Listeners may prevent this event to prevent the overlay from opening.\n    \n    The event is emitted on the `document`.\n    \n    \\#\\#\\# Changing layer options\n    \n    Listeners may inspect and manipulate options for the overlay that is about to open.\n    \n    For example, to give overlays the CSS class `.warning` if the initial URL contains\n    the word `\"confirm\"`:\n    \n    ```js\n    up.on('up:layer:open', function(event) {\n      if (event.layerOptions.url.includes('confirm')) {\n        event.layerOptions.class = 'warning'\n      }\n    })\n    ```\n    \n    @event up:layer:open\n    @param {Object} event.layerOptions\n      Options for the overlay that is about to open.\n    \n      Listeners may inspect and change the options.\n      All options for `up.layer.open()` may be used.\n    @param {Element} event.origin\n      The link element that is opening the overlay.\n    @param event.preventDefault()\n      Event listeners may call this method to prevent the overlay from opening.\n    @stable\n     */\n\n    /***\n    This event is emitted after a new overlay has been placed into the DOM.\n    \n    The event is emitted right before the opening animation starts. Because the overlay\n    has not been rendered by the browser, this makes it a good occasion to\n    [customize overlay elements](/customizing-overlays#customizing-overlay-elements):\n    \n    ```js\n    up.on('up:layer:opened', function(event) {\n      if (isChristmas()) {\n        up.element.affix(event.layer.element, '.santa-hat', text: 'Merry Christmas!')\n      }\n    })\n    ```\n    \n    @event up:layer:opened\n    @param {Element} event.origin\n      The link element that is opening the overlay.\n    @param {up.Layer} event.layer\n      The [layer object](/up.Layer) that is opening.\n    @stable\n     */\n\n    /***\n    This event is emitted after a layer's [location property](/up.Layer.prototype.location)\n    has changed value.\n    \n    This event is also emitted when a layer [without visible history](/up.Layer.prototype.historyVisible)\n    has reached a new location.\n    \n    @param {string} event.location\n      The new location URL.\n    @event up:layer:location:changed\n    @experimental\n     */\n\n    /***\n    Opens an overlay and returns a promise for its [acceptance](/closing-overlays).\n    \n    It's useful to think of overlays as [promises](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)\n    which may either be **fulfilled (accepted)** or **rejected (dismissed)**.\n    \n    \\#\\#\\# Example\n    \n    Instead of using `up.layer.open()` and passing callbacks, you may use `up.layer.ask()`.\n    `up.layer.ask()` returns a promise for the acceptance value, which you can `await`:\n    \n    ```js\n    let user = await up.layer.ask({ url: '/users/new' })\n    console.log(\"New user is \" + user)\n    ```\n    \n    @see closing-overlays\n    \n    @function up.layer.ask\n    \n    @param {Object} options\n      See options for `up.layer.open()`.\n    \n    @return {Promise}\n      A promise that will settle when the overlay closes.\n    \n      When the overlay was accepted, the promise will fulfill with the overlay's acceptance value.\n    \n      When the overlay was dismissed, the promise will reject with the overlay's dismissal value.\n    \n    @stable\n     */\n    ask = function(options) {\n      return new Promise(function(resolve, reject) {\n        options = u.merge(options, {\n          onAccepted: function(event) {\n            return resolve(event.value);\n          },\n          onDismissed: function(event) {\n            return reject(event.value);\n          }\n        });\n        return open(options);\n      });\n    };\n    anySelector = function() {\n      return u.map(LAYER_CLASSES, function(Class) {\n        return Class.selector();\n      }).join(',');\n    };\n    optionToString = function(option) {\n      if (u.isString(option)) {\n        return \"layer \\\"\" + option + \"\\\"\";\n      } else {\n        return option.toString();\n      }\n    };\n\n    /***\n    [Follows](/a-up-follow) this link and opens the result in a new overlay.\n    \n    \\#\\#\\# Example\n    \n    ```html\n    <a href=\"/menu\" up-layer=\"new\">Open menu</a>\n    ```\n    \n    @selector a[up-layer=new]\n    \n    @params-note\n      All attributes for `a[up-follow]` may also be used.\n    \n      You may configure default layer attributes in `up.layer.config`.\n    \n    @param {string} [up-layer=\"new\"]\n      Whether to stack the new overlay onto the current layer or replace existing overlays.\n    \n      See [replacing existing overlays](/opening-layers#replacing-existing-overlays).\n    \n    @param [up-mode]\n      The kind of overlay to open.\n    \n      See [available layer modes](/layer-terminology#available-modes).\n    \n    @param [up-size]\n      The size of the overlay.\n    \n      See [overlay sizes](/customizing-overlays#overlay-sizes) for details.\n    \n    @param [up-class]\n      An optional HTML class for the overlay's container element.\n    \n      See [overlay classes](/customizing-overlays#overlay-classes).\n    \n    @param [up-history-visible]\n      Whether history of the overlay content is visible.\n    \n      If set to `true` the overlay location and title will be shown in browser UI.\n    \n      If set to `'auto'` history will be visible if the initial overlay\n      content matches a [main target](/up-main).\n    \n    @param [up-dismissable]\n      How the overlay may be [dismissed](/closing-overlays) by the user.\n    \n      See [customizing dismiss controls](/closing-overlays#customizing-dismiss-controls)\n      for details.\n    \n      You may enable multiple dismiss controls by passing a space-separated string.\n    \n      Passing `true` or `false` will enable or disable all dismiss controls.\n    \n    @param [up-animation]\n      The name of the opening animation.\n    \n    @param [up-on-opened]\n      A JavaScript snippet that is called when the overlay was inserted into the DOM.\n    \n      The snippet runs in the following scope:\n    \n      | Expression | Value                                    |\n      |------------|------------------------------------------|\n      | `this`     | The link that opened the overlay         |\n      | `layer`    | An `up.Layer` object for the new overlay |\n      | `event`    | An `up:layer:opened` event               |\n    \n    @param [up-on-accepted]\n      A JavaScript snippet that is called when the overlay was [accepted](/closing-overlays).\n    \n      The snippet runs in the following scope:\n    \n      | Expression | Value                                         |\n      |------------|-----------------------------------------------|\n      | `this`     | The link that originally opened the overlay   |\n      | `layer`    | An `up.Layer` object for the accepted overlay |\n      | `value`    | The overlay's [acceptance value](/closing-overlays#overlay-result-values) |\n      | `event`    | An `up:layer:accepted` event                  |\n    \n    @param [up-on-dismissed]\n      A JavaScript snippet that is called when the overlay was [dismissed](/closing-overlays).\n    \n      The snippet runs in the following scope:\n    \n      | Expression | Value                                          |\n      |------------|------------------------------------------------|\n      | `this`     | The link that originally opened the overlay    |\n      | `layer`    | An `up.Layer` object for the dismissed overlay |\n      | `value`    | The overlay's [dismissal value](/closing-overlays#overlay-result-values) |\n      | `event`    | An `up:layer:dismissed` event                   |\n    \n    @param [up-accept-event]\n      One or more event types that will cause this overlay to automatically be\n      [accepted](/closing-overlays) when a matching event occurs within the overlay.\n    \n      The [overlay result value](/closing-overlays#overlay-result-values)\n      is the event object that caused the overlay to close.\n    \n      See [Closing when an event is emitted](/closing-overlays#closing-when-an-event-is-emitted).\n    \n    @param [up-dismiss-event]\n      One or more event types that will cause this overlay to automatically be\n      [dismissed](/closing-overlays) when a matching event occurs within the overlay.\n    \n      The [overlay result value](/closing-overlays#overlay-result-values)\n      is the event object that caused the overlay to close.\n    \n      See [Closing when an event is emitted](/closing-overlays#closing-when-an-event-is-emitted).\n    \n    @param [up-accept-location]\n      One or more [URL patterns](/url-patterns) that will cause this overlay to automatically be\n      [accepted](/closing-overlays) when the overlay reaches a matching [location](/up.layer.location).\n    \n      The [overlay result value](/closing-overlays#overlay-result-values)\n      is an object of [named segments matches](/url-patterns#capturing-named-segments) captured\n      by the URL pattern.\n    \n      See [Closing when a location is reached](/closing-overlays#closing-when-a-location-is-reached).\n    \n    @param [up-dismiss-location]\n      One or more [URL patterns](/url-patterns) that will cause this overlay to automatically be\n      [dismissed](/closing-overlays) when the overlay reaches a matching [location](/up.layer.location).\n    \n      The [overlay result value](/closing-overlays#overlay-result-values)\n      is an object of [named segments matches](/url-patterns#capturing-named-segments) captured\n      by the URL pattern.\n    \n      See [Closing when a location is reached](/closing-overlays#closing-when-a-location-is-reached).\n    \n    @param [up-context]\n      The new overlay's [context](/up.layer.context) object, encoded as JSON.\n    \n    @param [up-position]\n      The position of the popup relative to the `{ origin }` element that opened\n      the overlay.\n    \n      Supported values are `top`,  `right`,  `bottom` and  `left`.\n    \n      See [popup position](/customizing-overlays#popup-position).\n    \n    @param [up-align]\n      The alignment of the popup within its `{ position }`.\n    \n      Supported values are `top`,  `right`, `center`, `bottom` and  `left`.\n    \n      See [popup position](/customizing-overlays#popup-position).\n    \n    @stable\n     */\n\n    /***\n    [Dismisses](/closing-overlays) the [current layer](/up.layer.current) when the link is clicked.\n    \n    The JSON value of the `[up-accept]` attribute becomes the overlay's\n    [dismissal value](/closing-overlays#overlay-result-values).\n    \n    \\#\\#\\# Example\n    \n    ```html\n    <a href='/dashboard' up-dismiss>Close</a>\n    ```\n    \n    \\#\\#\\# Fallback for the root layer\n    \n    The link's `[href]` will only be followed when this link is clicked in the [root layer](/up.layer).\n    In an overlay the `click` event's default action is prevented.\n    \n    You can also omit the `[href]` attribute to make a link that only works in overlays.\n    \n    @selector a[up-dismiss]\n    @param [up-dismiss]\n      The overlay's [dismissal value](/closing-overlays#overlay-result-values) as a JSON string.\n    @param [up-confirm]\n      A message the user needs to confirm before the layer is closed.\n    @param [up-animation]\n      The overlay's close animation.\n    \n      Defaults to overlay's [preconfigured close animation](/up.layer.config).\n    @param [up-duration]\n      The close animation's duration in milliseconds.\n    @param [up-easing]\n      The close animation's easing function.\n    @stable\n     */\n\n    /***\n    [Accepts](/closing-overlays) the [current layer](/up.layer.current) when the link is clicked.\n    \n    The JSON value of the `[up-accept]` attribute becomes the overlay's\n    [acceptance value](/closing-overlays#overlay-result-values).\n    \n    \\#\\#\\# Example\n    \n    ```html\n    <a href='/users/5' up-accept='{ \"id\": 5 }'>Choose user #5</a>\n    ```\n    \n    \\#\\#\\# Fallback for the root layer\n    \n    The link's `[href]` will only be followed when this link is clicked in the [root layer](/up.layer).\n    In an overlay the `click` event's default action is prevented.\n    \n    You can also omit the `[href]` attribute to make a link that only works in overlays.\n    \n    @selector a[up-accept]\n    @param [up-accept]\n      The overlay's [acceptance value](/closing-overlays#overlay-result-values) as a JSON string.\n    @param [up-confirm]\n      A message the user needs to confirm before the layer is closed.\n    @param [up-duration]\n      The close animation's duration in milliseconds.\n    @param [up-easing]\n      The close animation's easing function.\n    @stable\n     */\n    up.on('up:fragment:destroyed', function(event) {\n      return stack.sync();\n    });\n    up.on('up:framework:boot', function() {\n      return stack = new up.LayerStack();\n    });\n    up.on('up:framework:reset', reset);\n    api = u.literal({\n      config: config,\n      mainTargets: mainTargets,\n      open: open,\n      build: build,\n      ask: ask,\n      normalizeOptions: normalizeOptions,\n      openCallbackAttr: openCallbackAttr,\n      closeCallbackAttr: closeCallbackAttr,\n      anySelector: anySelector,\n      optionToString: optionToString,\n      get_stack: function() {\n        return stack;\n      }\n    });\n\n    /***\n    Returns the current layer in the [layer stack](/up.layer.stack).\n    \n    The *current* layer is usually the [frontmost layer](/up.layer.front).\n    There are however some cases where the current layer is a layer in the background:\n    \n    - While an element in a background layer is being [compiled](/up.compiler).\n    - While an Unpoly event like `up:request:loaded` is being triggered from a background layer.\n    - While an event listener bound to a background layer using `up.Layer#on()` is being called.\n    \n    To temporarily change the current layer from your own code, use `up.Layer#asCurrent()`.\n    \n    \\#\\#\\# Remembering the current layer\n    \n    Most functions in the `up.layer` package affect the current layer. E.g. `up.layer.dismiss()`\n    is shorthand for `up.layer.current.dismiss()`.\n    \n    As described above `up.layer.current` is set to the right layer in compilers and most events,\n    even if that layer is not the frontmost layer.\n    \n    If you have async code, the current layer may change when your callback is called.\n    To address this you may retrieve the current layer for later reference:\n    \n    ```js\n    function dismissCurrentLayerIn(seconds) {\n      let savedLayer = up.layer.current // returns an up.Layer object\n      let dismiss = () => savedLayer.dismiss()\n      setTimeout(dismiss, seconds * 1000)\n    }\n    \n    dismissCurrentLayerIn(10) //\n    ```\n    \n    @property up.layer.current\n    @param {up.Layer} current\n    @stable\n     */\n\n    /***\n    Returns the number of layers in the [layer stack](/up.layer.stack).\n    \n    The count includes the [root layer](/up.layer.root).\n    Hence a page with a single overlay would return a count of 2.\n    \n    @property up.layer.count\n    @param {number} count\n      The number of layers in the stack.\n    @stable\n     */\n\n    /***\n    Returns an `up.Layer` object for the given [layer option](/layer-option).\n    \n    @function up.layer.get\n    @param {string|up.Layer|number} [layer='current']\n      The [layer option](/layer-open) to look up.\n    @return {up.Layer|undefined}\n      The layer matching the given option.\n    \n      If no layer matches, `undefined` is returned.\n    @stable\n     */\n\n    /***\n    Returns an array of `up.Layer` objects matching the given [layer option](/layer-option).\n    \n    @function up.layer.getAll\n    @param {string|up.Layer|number} [layer='current']\n      The [layer option](/layer-open) to look up.\n    @return {Array<up.Layer>}\n    @experimental\n     */\n\n    /***\n    Returns the [root layer](/layer-terminology).\n    \n    The root layer represents the initial page before any overlay was [opened](/opening-overlays).\n    The root layer always exists and cannot be closed.\n    \n    @property up.layer.root\n    @param {up.Layer} root\n    @stable\n     */\n\n    /***\n    Returns an array of all [overlays](/layer-terminology).\n    \n    If no overlay is open, an empty array is returned.\n    \n    To get an array of *all* layers including the [root layer](/up.layer.root),\n    use `up.layer.stack`.\n    \n    @property up.layer.overlays\n    @param {Array<up.Layer>} overlays\n    @stable\n     */\n\n    /***\n    Returns the frontmost layer in the [layer stack](/up.layer.stack).\n    \n    The frontmost layer is the layer directly facing the user. If an overlay is\n    stacked on top of the frontmost layer, that overlay becomes the new frontmost layer.\n    \n    In most cases you don't want to refer to the frontmost layer,\n    but to the [current layer](/up.layer.current) instead.\n    \n    @property up.layer.front\n    @param {up.Layer} front\n    @stable\n     */\n\n    /***\n    [Dismisses](/up.layer.dismiss) all overlays.\n    \n    Afterwards the only remaining layer will be the [root layer](/up.layer.root).\n    \n    @function up.layer.dismissOverlays\n    @param {any} [value]\n      The dismissal value.\n    @param {Object} [options]\n      See options for `up.layer.dismiss()`.\n    @stable\n     */\n    u.delegate(api, ['get', 'getAll', 'root', 'overlays', 'current', 'front', 'sync', 'count', 'dismissOverlays'], function() {\n      return stack;\n    });\n\n    /***\n    [Accepts](/closing-overlays) the [current layer](up.layer.current).\n    \n    This is a shortcut for `up.layer.current.accept()`.\n    See `up.Layer#accept()` for more documentation.\n    \n    @function up.layer.accept\n    @param {any} [value]\n    @param {Object} [options]\n    @stable\n     */\n\n    /***\n    [Dismisses](/closing-overlays) the [current layer](up.layer.current).\n    \n    This is a shortcut for `up.layer.current.dismiss()`.\n    See `up.Layer#dismiss()` for more documentation.\n    \n    @function up.layer.dismiss\n    @param {any} [value]\n    @param {Object} [options]\n    @stable\n     */\n\n    /***\n    Returns whether the [current layer](/up.layer.current) is the [root layer](/up.layer.root).\n    \n    This is a shortcut for `up.layer.current.isRoot()`.\n    See `up.Layer#isRoot()` for more documentation..\n    \n    @function up.layer.isRoot\n    @return {boolean}\n    @stable\n     */\n\n    /***\n    Returns whether the [current layer](/up.layer.current) is *not* the [root layer](/up.layer.root).\n    \n    This is a shortcut for `up.layer.current.isOverlay()`.\n    See `up.Layer#isOverlay()` for more documentation.\n    \n    @function up.layer.isOverlay\n    @return {boolean}\n    @stable\n     */\n\n    /***\n    Returns whether the [current layer](/up.layer.current) is the [frontmost layer](/up.layer.front).\n    \n    This is a shortcut for `up.layer.current.isFront()`.\n    See `up.Layer#isFront()` for more documentation.\n    \n    @function up.layer.isFront\n    @return {boolean}\n    @stable\n     */\n\n    /***\n    Listens to a [DOM event](https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model/Events)\n    that originated on an element [contained](/up.Layer.prototype.contains) by the [current layer](/up.layer.current).\n    \n    This is a shortcut for `up.layer.current.on()`.\n    See `up.Layer#on()` for more documentation.\n    \n    @function up.layer.on\n    @param {string} types\n      A space-separated list of event types to bind to.\n    @param {string|Function(): string} [selector]\n      The selector of an element on which the event must be triggered.\n    @param {Object} [options]\n    @param {Function(event, [element], [data])} listener\n      The listener function that should be called.\n    @return {Function()}\n      A function that unbinds the event listeners when called.\n    @stable\n     */\n\n    /***\n    Unbinds an event listener previously bound to the [current layer](/up.layer.current).\n    \n    This is a shortcut for `up.layer.current.off()`.\n    See `up.Layer#off()` for more documentation.\n    \n    @function up.layer.off\n    @param {string} events\n    @param {string|Function(): string} [selector]\n    @param {Function(event, [element], [data])} listener\n      The listener function to unbind.\n    @stable\n     */\n\n    /***\n    [Emits](/up.emit) an event on the [current layer](/up.layer.current)'s [element](/up.layer.element).\n    \n    This is a shortcut for `up.layer.current.emit()`.\n    See `up.Layer#emit()` for more documentation.\n    \n    @function up.layer.emit\n    @param {string} eventType\n    @param {Object} [props={}]\n    @stable\n     */\n\n    /***\n    Returns the parent layer of the [current layer](/up.layer.current).\n    \n    This is a shortcut for `up.layer.current.parent`.\n    See `up.Layer#parent` for more documentation.\n    \n    @property up.layer.parent\n    @param {up.Layer} parent\n    @stable\n     */\n\n    /***\n    Whether fragment updates within the [current layer](/up.layer.current)\n    can affect browser history and window title.\n    \n    This is a shortcut for `up.layer.current.historyVisible`.\n    See `up.Layer#historyVisible` for more documentation.\n    \n    @property up.layer.historyVisible\n    @param {boolean} historyVisible\n    @stable\n     */\n\n    /***\n    The location URL of the [current layer](/up.layer.current).\n    \n    This is a shortcut for `up.layer.current.location`.\n    See `up.Layer#location` for more documentation.\n    \n    @property up.layer.location\n    @param {string} location\n    @stable\n     */\n\n    /***\n    The [current layer](/up.layer.current)'s [mode](/up.layer.mode)\n    which governs its appearance and behavior.\n    \n    @property up.layer.mode\n    @param {string} mode\n    @stable\n     */\n\n    /***\n    The [context](/context) of the [current layer](/up.layer.current).\n    \n    This is aliased as `up.context`.\n    \n    @property up.layer.context\n    @param {string} context\n      The context object.\n    \n      If no context has been set an empty object is returned.\n    @experimental\n     */\n    u.delegate(api, ['accept', 'dismiss', 'isRoot', 'isOverlay', 'isFront', 'on', 'off', 'emit', 'parent', 'historyVisible', 'location', 'mode', 'context', 'element', 'contains', 'size', 'affix'], function() {\n      return stack.current;\n    });\n    return api;\n  })();\n\n}).call(this);\n\n/***\nLinking to fragments\n====================\n\nThe `up.link` module lets you build links that update fragments instead of entire pages.\n\n\\#\\#\\# Motivation\n\nIn a traditional web application, the entire page is destroyed and re-created when the\nuser follows a link:\n\n![Traditional page flow](/images/tutorial/fragment_flow_vanilla.svg){:width=\"620\" class=\"picture has_border is_sepia has_padding\"}\n\nThis makes for an unfriendly experience:\n\n- State changes caused by AJAX updates get lost during the page transition.\n- Unsaved form changes get lost during the page transition.\n- The JavaScript VM is reset during the page transition.\n- If the page layout is composed from multiple scrollable containers\n  (e.g. a pane view), the scroll positions get lost during the page transition.\n- The user sees a \"flash\" as the browser loads and renders the new page,\n  even if large portions of the old and new page are the same (navigation, layout, etc.).\n\nUnpoly fixes this by letting you annotate links with an [`up-target`](/a-up-follow#up-target)\nattribute. The value of this attribute is a CSS selector that indicates which page\nfragment to update. The server **still renders full HTML pages**, but we only use\nthe targeted fragments and discard the rest:\n\n![Unpoly page flow](/images/tutorial/fragment_flow_unpoly.svg){:width=\"620\" class=\"picture has_border is_sepia has_padding\"}\n\nWith this model, following links feels smooth. All transient DOM changes outside the updated fragment are preserved.\nPages also load much faster since the DOM, CSS and Javascript environments do not need to be\ndestroyed and recreated for every request.\n\n\n\\#\\#\\# Example\n\nLet's say we are rendering three pages with a tabbed navigation to switch between screens:\n\nYour HTML could look like this:\n\n```\n<nav>\n  <a href=\"/pages/a\">A</a>\n  <a href=\"/pages/b\">B</a>\n  <a href=\"/pages/b\">C</a>\n</nav>\n\n<article>\n  Page A\n</article>\n```\n\nSince we only want to update the `<article>` tag, we annotate the links\nwith an `up-target` attribute:\n\n```\n<nav>\n  <a href=\"/pages/a\" up-target=\"article\">A</a>\n  <a href=\"/pages/b\" up-target=\"article\">B</a>\n  <a href=\"/pages/b\" up-target=\"article\">C</a>\n</nav>\n```\n\nNote that instead of `article` you can use any other CSS selector like `#main .article`.\n\nWith these [`up-target`](/a-up-follow#up-target) annotations Unpoly only updates the targeted part of the screen.\nThe JavaScript environment will persist and the user will not see a white flash while the\nnew page is loading.\n\n@see a[up-follow]\n@see a[up-instant]\n@see a[up-preload]\n@see up.follow\n\n@module up.link\n */\n\n(function() {\n  var slice = [].slice;\n\n  up.link = (function() {\n    var ATTRIBUTES_SUGGESTING_FOLLOW, LINKS_WITH_LOCAL_HTML, LINKS_WITH_REMOTE_HTML, combineFollowableSelectors, config, convertClicks, didUserDragAway, e, follow, followMethod, followOptions, followURL, forkEventAsUpClick, fullClickableSelector, fullFollowSelector, fullInstantSelector, fullPreloadSelector, isFollowDisabled, isFollowable, isInstant, isInstantDisabled, isPreloadDisabled, isSafe, lastMousedownTarget, linkPreloader, makeClickable, makeFollowable, parseRequestOptions, preload, reset, shouldFollowEvent, shouldPreload, u, willCache;\n    u = up.util;\n    e = up.element;\n    linkPreloader = new up.LinkPreloader();\n    lastMousedownTarget = null;\n    LINKS_WITH_LOCAL_HTML = ['a[up-content]', 'a[up-fragment]', 'a[up-document]'];\n    LINKS_WITH_REMOTE_HTML = ['a[href]', '[up-href]'];\n    ATTRIBUTES_SUGGESTING_FOLLOW = ['[up-follow]', '[up-target]', '[up-layer]', '[up-transition]', '[up-preload]'];\n    combineFollowableSelectors = function(elementSelectors, attributeSelectors) {\n      return u.flatMap(elementSelectors, function(elementSelector) {\n        return attributeSelectors.map(function(attributeSelector) {\n          return elementSelector + attributeSelector;\n        });\n      });\n    };\n\n    /***\n    Configures defaults for link handling.\n    \n    In particular you can configure Unpoly to handle [all links on the page](/handling-everything)\n    without requiring developers to set `[up-...]` attributes.\n    \n    @property up.link.config\n    \n    @param {Array<string>} config.followSelectors\n      An array of CSS selectors matching links that will be [followed through Unpoly](/a-up-follow).\n    \n      You can customize this property to automatically follow *all* links on a page without requiring an `[up-follow]` attribute.\n      See [Handling all links and forms](/handling-everything).\n    \n    @param {Array<string>} config.noFollowSelectors\n      Exceptions to `config.followSelectors`.\n    \n      Matching links will *not* be [followed through Unpoly](/a-up-follow), even if they match `config.followSelectors`.\n    \n      By default Unpoly excludes:\n    \n      - Links with an `[up-follow=false]` attribute.\n      - Links with a cross-origin `[href]`.\n      - Links with a `[target]` attribute (to target an iframe or open new browser tab).\n      - Links with a `[rel=download]` attribute.\n      - Links with an `[href]` attribute starting with `javascript:`.\n      - Links with an `[href=\"#\"]` attribute that don't also have local HTML\n        in an `[up-document]`, `[up-fragment]` or `[up-content]` attribute.\n    \n    @param {Array<string>} config.instantSelectors\n      An array of CSS selectors matching links that are [followed on `mousedown`](/a-up-instant)\n      instead of on `click`.\n    \n      You can customize this property to follow *all* links on `mousedown` without requiring an `[up-instant]` attribute.\n      See [Handling all links and forms](/handling-everything).\n    \n    @param {Array<string>} config.noInstantSelectors\n      Exceptions to `config.followSelectors`.\n    \n      Matching links will *not* be [followed through Unpoly](/a-up-follow), even if they match `config.followSelectors`.\n    \n      By default Unpoly excludes:\n    \n      - Links with an `[up-instant=false]` attribute.\n      - Links that are [not followable](#config.noFollowSelectors).\n    \n    @param {Array<string>} config.preloadSelectors\n      An array of CSS selectors matching links that are [preloaded on hover](/a-up-preload).\n    \n      You can customize this property to preload *all* links on `mousedown` without requiring an `[up-preload]` attribute.\n      See [Handling all links and forms](/handling-everything).\n    \n    @param {Array<string>} config.noPreloadSelectors\n      Exceptions to `config.preloadSelectors`.\n    \n      Matching links will *not* be [preloaded on hover](/a-up-preload), even if they match `config.preloadSelectors`.\n    \n      By default Unpoly excludes:\n    \n      - Links with an `[up-preload=false]` attribute.\n      - Links that are [not followable](#config.noFollowSelectors).\n      - When the link destination [cannot be cached](/up.network.config#config.autoCache).\n    \n    @param {number} [config.preloadDelay=75]\n      The number of milliseconds to wait before [`[up-preload]`](/a-up-preload)\n      starts preloading.\n    \n    @param {boolean|string} [config.preloadEnabled='auto']\n      Whether Unpoly will load [preload requests](/a-up-preload).\n    \n      With the default setting (`\"auto\"`) Unpoly will load preload requests\n      unless `up.network.shouldReduceRequests()` detects a poor connection.\n    \n      If set to `true`, Unpoly will always load preload links.\n    \n      If set to `false`, Unpoly will never preload links.\n    \n    @param {Array<string>} [config.clickableSelectors]\n      A list of CSS selectors matching elements that should behave like links or buttons.\n    \n      @see [up-clickable]\n    @stable\n     */\n    config = new up.Config(function() {\n      return {\n        followSelectors: combineFollowableSelectors(LINKS_WITH_REMOTE_HTML, ATTRIBUTES_SUGGESTING_FOLLOW).concat(LINKS_WITH_LOCAL_HTML),\n        noFollowSelectors: ['[up-follow=false]', 'a[download]', 'a[target]', 'a[href^=\"#\"]:not([up-content]):not([up-fragment]):not([up-document])', 'a[href^=\"javascript:\"]'],\n        instantSelectors: ['[up-instant]'],\n        noInstantSelectors: ['[up-instant=false]', '[onclick]'],\n        preloadSelectors: combineFollowableSelectors(LINKS_WITH_REMOTE_HTML, ['[up-preload]']),\n        noPreloadSelectors: ['[up-preload=false]'],\n        clickableSelectors: LINKS_WITH_LOCAL_HTML.concat(['[up-emit]', '[up-accept]', '[up-dismiss]', '[up-clickable]']),\n        preloadDelay: 90,\n        preloadEnabled: 'auto'\n      };\n    });\n    fullFollowSelector = function() {\n      return config.followSelectors.join(',');\n    };\n    fullPreloadSelector = function() {\n      return config.preloadSelectors.join(',');\n    };\n    fullInstantSelector = function() {\n      return config.instantSelectors.join(',');\n    };\n    fullClickableSelector = function() {\n      return config.clickableSelectors.join(',');\n    };\n\n    /***\n    Returns whether the link was explicitly marked up as not followable,\n    e.g. through `[up-follow=false]`.\n    \n    This differs from `config.followSelectors` in that we want users to configure\n    simple selectors, but let users make exceptions. We also have a few built-in\n    exceptions of our own, e.g. to never follow an `<a href=\"javascript:...\">` link.\n    \n    @function isFollowDisabled\n    @param {Element} link\n    @return {boolean}\n     */\n    isFollowDisabled = function(link) {\n      return e.matches(link, config.noFollowSelectors.join(',')) || u.isCrossOrigin(link);\n    };\n    isPreloadDisabled = function(link) {\n      return !up.browser.canPushState() || e.matches(link, config.noPreloadSelectors.join(',')) || isFollowDisabled(link) || !willCache(link);\n    };\n    willCache = function(link) {\n      var options, request;\n      options = parseRequestOptions(link);\n      if (options.url) {\n        if (options.cache == null) {\n          options.cache = 'auto';\n        }\n        options.basic = true;\n        request = new up.Request(options);\n        return request.willCache();\n      }\n    };\n    isInstantDisabled = function(link) {\n      return e.matches(link, config.noInstantSelectors.join(',')) || isFollowDisabled(link);\n    };\n    reset = function() {\n      lastMousedownTarget = null;\n      config.reset();\n      return linkPreloader.reset();\n    };\n\n    /***\n    Follows the given link with JavaScript and updates a fragment with the server response.\n    \n    By default the layer's [main element](/up-main)\n    will be replaced. Attributes like `a[up-target]`\n    or `a[up-layer]` will be honored.\n    \n    Following a link is considered [navigation](/navigation) by default.\n    \n    Emits the event `up:link:follow`.\n    \n    \\#\\#\\# Examples\n    \n    Assume we have a link with an `a[up-target]` attribute:\n    \n        <a href=\"/users\" up-target=\".main\">Users</a>\n    \n    Calling `up.follow()` with this link will replace the page's `.main` fragment\n    as if the user had clicked on the link:\n    \n        var link = document.querySelector('a')\n        up.follow(link)\n    \n    @function up.follow\n    \n    @param {Element|jQuery|string} link\n      The link to follow.\n    \n    @param {Object} [options]\n      [Render options](/up.render) that should be used for following the link.\n    \n      Unpoly will parse render options from the given link's attributes\n      like `[up-target]` or `[up-transition]`. See `a[up-follow]` for a list\n      of supported attributes.\n    \n      You may pass this additional `options` object to supplement or override\n      options parsed from the link attributes.\n    \n    @return {Promise<up.RenderResult>}\n      A promise that will be fulfilled when the link destination\n      has been loaded and rendered.\n    \n    @stable\n     */\n    follow = up.mockable(function(link, options) {\n      return up.render(followOptions(link, options));\n    });\n    parseRequestOptions = function(link, options) {\n      var parser;\n      options = u.options(options);\n      parser = new up.OptionsParser(options, link);\n      options.url = followURL(link, options);\n      options.method = followMethod(link, options);\n      parser.json('headers');\n      parser.json('params');\n      parser.booleanOrString('cache');\n      parser.booleanOrString('clearCache');\n      parser.boolean('solo');\n      parser.string('contentType', {\n        attr: ['enctype', 'up-content-type']\n      });\n      return options;\n    };\n\n    /***\n    Parses the [render](/up.render) options that would be used to\n    [`follow`](/up.follow) the given link, but does not render.\n    \n    \\#\\#\\# Example\n    \n    Given a link with some `[up-...]` attributes:\n    \n    ```html\n    <a href=\"/foo\" up-target=\".content\" up-layer=\"new\">...</a>\n    ```\n    \n    We can parse the link's render options like this:\n    \n    ```js\n    let link = document.querySelector('a[href=\"/foo\"]')\n    let options = up.link.followOptions(link)\n    // => { url: '/foo', method: 'GET', target: '.content', layer: 'new', ... }\n    ```\n    \n    @function up.link.followOptions\n    @param {Element|jQuery|string} link\n      The link to follow.\n    @return {Object}\n    @stable\n     */\n    followOptions = function(link, options) {\n      var base, base1, parser;\n      link = up.fragment.get(link);\n      options = parseRequestOptions(link, options);\n      parser = new up.OptionsParser(options, link, {\n        fail: true\n      });\n      parser.boolean('feedback');\n      parser.boolean('fail');\n      if ((base = parser.options).origin == null) {\n        base.origin = link;\n      }\n      parser.boolean('navigate', {\n        \"default\": true\n      });\n      parser.string('confirm');\n      parser.string('target');\n      parser.booleanOrString('fallback');\n      parser.parse((function(link, attrName) {\n        return e.callbackAttr(link, attrName, ['request', 'response', 'renderOptions']);\n      }), 'onLoaded');\n      parser.string('content');\n      parser.string('fragment');\n      parser.string('document');\n      parser.boolean('peel');\n      parser.string('layer');\n      parser.string('baseLayer');\n      parser.json('context');\n      parser.string('mode');\n      parser.string('align');\n      parser.string('position');\n      parser.string('class');\n      parser.string('size');\n      parser.booleanOrString('dismissable');\n      parser.parse(up.layer.openCallbackAttr, 'onOpened');\n      parser.parse(up.layer.closeCallbackAttr, 'onAccepted');\n      parser.parse(up.layer.closeCallbackAttr, 'onDismissed');\n      parser.string('acceptEvent');\n      parser.string('dismissEvent');\n      parser.string('acceptLocation');\n      parser.string('dismissLocation');\n      parser.booleanOrString('historyVisible');\n      parser.booleanOrString('focus');\n      parser.boolean('saveScroll');\n      parser.booleanOrString('scroll');\n      parser.boolean('revealTop');\n      parser.number('revealMax');\n      parser.number('revealPadding');\n      parser.number('revealSnap');\n      parser.string('scrollBehavior');\n      parser.booleanOrString('history');\n      parser.booleanOrString('location');\n      parser.booleanOrString('title');\n      parser.booleanOrString('animation');\n      parser.booleanOrString('transition');\n      parser.string('easing');\n      parser.number('duration');\n      if (typeof (base1 = up.migrate).parseFollowOptions === \"function\") {\n        base1.parseFollowOptions(parser);\n      }\n      options.guardEvent || (options.guardEvent = up.event.build('up:link:follow', {\n        log: 'Following link'\n      }));\n      return options;\n    };\n\n    /***\n    This event is [emitted](/up.emit) when a link is [followed](/up.follow) through Unpoly.\n    \n    The event is emitted on the `<a>` element that is being followed.\n    \n    \\#\\#\\# Changing render options\n    \n    Listeners may inspect and manipulate [render options](/up.render) for the coming fragment update.\n    \n    The code below will open all form-contained links in an overlay, as to not\n    lose the user's form data:\n    \n    ```js\n    up.on('up:link:follow', function(event, link) {\n      if (link.closest('form')) {\n        event.renderOptions.layer = 'new'\n      }\n    })\n    ```\n    \n    @event up:link:follow\n    @param {Element} event.target\n      The link element that will be followed.\n    @param {Object} event.renderOptions\n      An object with [render options](/up.render) for the coming fragment update.\n    \n      Listeners may inspect and modify these options.\n    @param event.preventDefault()\n      Event listeners may call this method to prevent the link from being followed.\n    @stable\n     */\n\n    /***\n    Preloads the given link.\n    \n    When the link is clicked later, the response will already be [cached](/up.cache),\n    making the interaction feel instant.\n    \n    @function up.link.preload\n    @param {string|Element|jQuery} link\n      The element or selector whose destination should be preloaded.\n    @param {Object} options\n      See options for `up.follow()`.\n    @return {Promise}\n      A promise that will be fulfilled when the request was loaded and cached.\n    \n      When preloading is [disabled](/up.link.config#config.preloadEnabled) the promise\n      rejects with an `AbortError`.\n    @stable\n     */\n    preload = function(link, options) {\n      var guardEvent;\n      link = up.fragment.get(link);\n      if (!shouldPreload()) {\n        return up.error.failed.async('Link preloading is disabled');\n      }\n      guardEvent = up.event.build('up:link:preload', {\n        log: ['Preloading link %o', link]\n      });\n      return follow(link, u.merge(options, {\n        preload: true\n      }, {\n        guardEvent: guardEvent\n      }));\n    };\n    shouldPreload = function() {\n      var setting;\n      setting = config.preloadEnabled;\n      if (setting === 'auto') {\n        return !up.network.shouldReduceRequests();\n      }\n      return setting;\n    };\n\n    /***\n    This event is [emitted](/up.emit) before a link is [preloaded](/up.preload).\n    \n    @event up:link:preload\n    @param {Element} event.target\n      The link element that will be preloaded.\n    @param event.preventDefault()\n      Event listeners may call this method to prevent the link from being preloaded.\n    @stable\n     */\n\n    /***\n    Returns the HTTP method that should be used when following the given link.\n    \n    Looks at the link's `up-method` or `data-method` attribute.\n    Defaults to `\"get\"`.\n    \n    @function up.link.followMethod\n    @param link\n    @param options.method {string}\n    @internal\n     */\n    followMethod = function(link, options) {\n      if (options == null) {\n        options = {};\n      }\n      return u.normalizeMethod(options.method || link.getAttribute('up-method') || link.getAttribute('data-method'));\n    };\n    followURL = function(link, options) {\n      var url;\n      if (options == null) {\n        options = {};\n      }\n      url = options.url || link.getAttribute('href') || link.getAttribute('up-href');\n      if (url !== '#') {\n        return url;\n      }\n    };\n\n    /***\n    Returns whether the given link will be [followed](/up.follow) by Unpoly\n    instead of making a full page load.\n    \n    By default Unpoly will follow links if the element has\n    one of the following attributes:\n    \n    - `[up-follow]`\n    - `[up-target]`\n    - `[up-layer]`\n    - `[up-mode]`\n    - `[up-transition]`\n    - `[up-content]`\n    - `[up-fragment]`\n    - `[up-document]`\n    \n    To make additional elements followable, see `up.link.config.followSelectors`.\n    \n    @function up.link.isFollowable\n    @param {Element|jQuery|string} link\n      The link to check.\n    @stable\n     */\n    isFollowable = function(link) {\n      link = up.fragment.get(link);\n      return e.matches(link, fullFollowSelector()) && !isFollowDisabled(link);\n    };\n\n    /***\n    Makes sure that the given link will be [followed](/up.follow)\n    by Unpoly instead of making a full page load.\n    \n    If the link is not already [followable](/up.link.isFollowable), the link\n    will receive an `a[up-follow]` attribute.\n    \n    @function up.link.makeFollowable\n    @param {Element|jQuery|string} link\n      The element or selector for the link to make followable.\n    @experimental\n     */\n    makeFollowable = function(link) {\n      if (!isFollowable(link)) {\n        return link.setAttribute('up-follow', '');\n      }\n    };\n    makeClickable = function(link) {\n      if (e.matches(link, 'a[href], button')) {\n        return;\n      }\n      e.setMissingAttrs(link, {\n        tabindex: '0',\n        role: 'link'\n      });\n      return link.addEventListener('keydown', function(event) {\n        if (event.key === 'Enter' || event.key === 'Space') {\n          return forkEventAsUpClick(event);\n        }\n      });\n    };\n\n    /***\n    Enables keyboard interaction for elements that should behave like links or buttons.\n    \n    The element will be focusable and screen readers will announce it as a link.\n    \n    Also see [`up.link.config.clickableSelectors`](/up.link.config#config.clickableSelectors).\n    \n    @selector [up-clickable]\n    @experimental\n     */\n    up.macro(fullClickableSelector, makeClickable);\n    shouldFollowEvent = function(event, link) {\n      var betterTarget, betterTargetSelector;\n      if (event.defaultPrevented || isFollowDisabled(link)) {\n        return false;\n      }\n      betterTargetSelector = \"a, [up-href], \" + (up.form.fieldSelector());\n      betterTarget = e.closest(event.target, betterTargetSelector);\n      return !betterTarget || betterTarget === link;\n    };\n    isInstant = function(linkOrDescendant) {\n      var element;\n      element = e.closest(linkOrDescendant, fullInstantSelector());\n      return element && !isInstantDisabled(element);\n    };\n\n    /***\n    Provide an `up:click` event that improves on standard click\n    in several ways:\n    \n    - It is emitted on mousedown for [up-instant] elements\n    - It is not emitted if the element has disappeared (or was overshadowed)\n      between mousedown and click. This can happen if mousedown creates a layer\n      over the element, or if a mousedown handler removes a handler.\n    \n    TODO Docs: Is not emitted for modified clicks\n    \n    Stopping an up:click event will also stop the underlying event.\n    \n    Also see docs for `up:click`.\n    \n    @function up.link.convertClicks\n    @param {up.Layer} layer\n    @internal\n     */\n    convertClicks = function(layer) {\n      layer.on('click', function(event, element) {\n        if (!up.event.isUnmodified(event)) {\n          return;\n        }\n        if (isInstant(element) && lastMousedownTarget) {\n          up.event.halt(event);\n        } else if (layer.wasHitByMouseEvent(event) && !didUserDragAway(event)) {\n          forkEventAsUpClick(event);\n        }\n        return lastMousedownTarget = null;\n      });\n      return layer.on('mousedown', function(event, element) {\n        if (!up.event.isUnmodified(event)) {\n          return;\n        }\n        lastMousedownTarget = event.target;\n        if (isInstant(element)) {\n          return forkEventAsUpClick(event);\n        }\n      });\n    };\n    didUserDragAway = function(clickEvent) {\n      return lastMousedownTarget && lastMousedownTarget !== clickEvent.target;\n    };\n    forkEventAsUpClick = function(originalEvent) {\n      var newEvent;\n      newEvent = up.event.fork(originalEvent, 'up:click', ['clientX', 'clientY', 'button'].concat(slice.call(up.event.keyModifiers)));\n      return up.emit(originalEvent.target, newEvent, {\n        log: false\n      });\n    };\n\n    /***\n    A `click` event that honors the [`[up-instant]`](/a-up-instant) attribute.\n    \n    This event is generally emitted when an element is clicked. However, for elements\n    with an [`[up-instant]`](/a-up-instant) attribute this event is emitted on `mousedown` instead.\n    \n    This is useful to listen to links being activated, without needing to know whether\n    a link is `[up-instant]`.\n    \n    \\#\\#\\# Example\n    \n    Assume we have two links, one of which is `[up-instant]`:\n    \n    ```html\n    <a href=\"/one\">Link 1</a>\n    <a href=\"/two\" up-instant>Link 2</a>\n    ```\n    \n    The following event listener will be called when *either* link is activated:\n    \n    ```js\n    document.addEventListener('up:click', function(event) {\n      ...\n    })\n    ```\n    \n    \\#\\#\\# Cancelation is forwarded\n    \n    If the user cancels an `up:click` event using `event.preventDefault()`,\n    the underlying `click` or `mousedown` event will also be canceled.\n    \n    \\#\\#\\# Accessibility\n    \n    If the user activates an element using their keyboard, the `up:click` event will be emitted\n    when the key is pressed even if the element has an `[up-instant]` attribute.\n    \n    \\#\\#\\# Only unmodified clicks are considered\n    \n    To prevent overriding native browser behavior, the `up:click` is only emitted for unmodified clicks.\n    \n    In particular, it is not emitted when the user holds `Shift`, `CTRL` or `Meta` while clicking.\n    Neither it is emitted when the user clicks with a secondary mouse button.\n    \n    @event up:click\n    @param {Element} event.target\n      The clicked element.\n    @param {Event} event.originalEvent\n      The underlying `click` or `mousedown` event.\n    @stable\n     */\n\n    /***\n    Returns whether the given link has a [safe](https://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.1.1)\n    HTTP method like `GET`.\n    \n    @function up.link.isSafe\n    @param {Element} link\n    @return {boolean}\n    @stable\n     */\n    isSafe = function(link) {\n      var method;\n      method = followMethod(link);\n      return up.network.isSafeMethod(method);\n    };\n\n    /***\n    [Follows](/up.follow) this link with JavaScript and updates a fragment with the server response.\n    \n    Following a link is considered [navigation](/navigation) by default.\n    \n    \\#\\#\\# Example\n    \n    This will update the fragment `<div class=\"content\">` with the same element\n    fetched from `/posts/5`:\n    \n    ```html\n    <a href=\"/posts/5\" up-follow up-target=\".content\">Read post</a>\n    ```\n    \n    If no `[up-target]` attribute is set, the [main target](/up-main) is updated.\n    \n    \\#\\#\\# Advanced fragment changes\n    \n    See [fragment placement](/fragment-placement) for advanced use cases\n    like updating multiple fragments or appending content to an existing element.\n    \n    \\#\\#\\# Short notation\n    \n    You may omit the `[up-follow]` attribute if the link has one of the following attributes:\n    \n    - `[up-target]`\n    - `[up-layer]`\n    - `[up-transition]`\n    - `[up-content]`\n    - `[up-fragment]`\n    - `[up-document]`\n    \n    Such a link will still be followed through Unpoly.\n    \n    \\#\\#\\# Following all links automatically\n    \n    You can configure Unpoly to follow *all* links on a page without requiring an `[up-follow]` attribute.\n    \n    See [Handling all links and forms](/handling-everything).\n    \n    @selector a[up-follow]\n    \n    @param [href]\n      The URL to fetch from the server.\n    \n      Instead of making a server request, you may also pass an existing HTML string as\n      `[up-document]` or `[up-content]` attribute.\n    \n    @param [up-target]\n      The CSS selector to update.\n    \n      If omitted a [main target](/up-main) will be rendered.\n    \n    @param [up-fallback]\n      Specifies behavior if the [target selector](/up.render#options.target) is missing from the current page or the server response.\n    \n      If set to a CSS selector, Unpoly will attempt to replace that selector instead.\n    \n      If set to `true` Unpoly will attempt to replace a [main target](/up-main) instead.\n    \n      If set to `false` Unpoly will immediately reject the render promise.\n    \n    @param [up-navigate='true']\n      Whether this fragment update is considered [navigation](/navigation).\n    \n    @param [up-method='get']\n      The HTTP method to use for the request.\n    \n      Common values are `get`, `post`, `put`, `patch` and `delete`.  `The value is case insensitive.\n    \n      The HTTP method may also be passed as an `[data-method]` attribute.\n    \n    @param [up-params]\n      A JSON object with additional [parameters](/up.Params) that should be sent as the request's\n      [query string](https://en.wikipedia.org/wiki/Query_string) or payload.\n    \n      When making a `GET` request to a URL with a query string, the given `{ params }` will be added\n      to the query parameters.\n    \n    @param [up-headers]\n      A JSON object with additional request headers.\n    \n      Note that Unpoly will by default send a number of custom request headers.\n      E.g. the `X-Up-Target` header includes the targeted CSS selector.\n      See `up.protocol` and `up.network.config.metaKeys` for details.\n    \n    @param [up-fragment]\n      A string of HTML comprising *only* the new fragment. No server request will be sent.\n    \n      The `[up-target]` selector will be derived from the root element in the given\n      HTML:\n    \n      ```html\n      <!-- This will update .foo -->\n      <a up-fragment='&lt;div class=\".foo\"&gt;inner&lt;/div&gt;'>Click me</a>\n      ```\n    \n      If your HTML string contains other fragments that will not be rendered, use\n      the `[up-document]` attribute instead.\n    \n      If your HTML string comprises only the new fragment's [inner HTML](https://developer.mozilla.org/en-US/docs/Web/API/Element/innerHTML),\n      consider the `[up-content]` attribute instead.\n    \n    @param [up-document]\n      A string of HTML containing the new fragment.\n    \n      The string may contain other HTML, but only the element matching the\n      `[up-target]` selector will be extracted and placed into the page.\n      Other elements will be discarded.\n    \n      If your HTML string comprises only the new fragment, consider the `[up-fragment]` attribute\n      instead. With `[up-fragment]` you don't need to pass a `[up-target]`, since\n      Unpoly can derive it from the root element in the given HTML.\n    \n      If your HTML string comprises only the new fragment's [inner HTML](https://developer.mozilla.org/en-US/docs/Web/API/Element/innerHTML),\n      consider the `[up-content]` attribute.\n    \n    @param [up-fail='auto']\n      How to render a server response with an error code.\n    \n      Any HTTP status code other than 2xx is considered an error code.\n    \n      See [handling server errors](/server-errors) for details.\n    \n    @param [up-history]\n      Whether the browser URL and window title will be updated.\n    \n      If set to `true`, the history will always be updated, using the title and URL from\n      the server response, or from given `[up-title]` and `[up-location]` attributes.\n    \n      If set to `auto` history will be updated if the `[up-target]` matches\n      a selector in `up.fragment.config.autoHistoryTargets`. By default this contains all\n      [main targets](/up-main).\n    \n      If set to `false`, the history will remain unchanged.\n    \n      [Overlays](/up.layer) will only change the browser URL and window title if the overlay\n      has [visible history](/up.layer.historyVisible), even when `[up-history=true]` is set.\n    \n    @param [up-title]\n      An explicit document title to use after rendering.\n    \n      By default the title is extracted from the response's `<title>` tag.\n      You may also set `[up-title=false]` to explicitly prevent the title from being updated.\n    \n      Note that the browser's window title will only be updated it you also\n      set an `[up-history]` attribute.\n    \n    @param [up-location]\n      An explicit URL to use after rendering.\n    \n      By default Unpoly will use the link's `[href]` or the final URL after the server redirected.\n      You may also set `[up-location=false]` to explicitly prevent the URL from being updated.\n    \n      Note that the browser's URL will only be updated it you also\n      set an `[up-history]` attribute.\n    \n    @param [up-transition]\n      The name of an [transition](/up.motion) to morph between the old and few fragment.\n    \n      If you are [prepending or appending content](/fragment-placement#appending-or-prepending-content),\n      use the `[up-animation]` attribute instead.\n    \n    @param [up-animation]\n      The name of an [animation](/up.motion) to reveal a new fragment when\n      [prepending or appending content](/fragment-placement#appending-or-prepending-content).\n    \n      If you are replacing content (the default), use the `[up-transition]` attribute instead.\n    \n    @param [up-duration]\n      The duration of the transition or animation (in millisconds).\n    \n    @param [up-easing]\n      The timing function that accelerates the transition or animation.\n    \n      See [W3C documentation](http://www.w3.org/TR/css3-transitions/#transition-timing-function)\n      for a list of available timing functions.\n    \n    @param [up-cache]\n      Whether to read from and write to the [cache](/up.cache).\n    \n      With `[up-cache=true]` Unpoly will try to re-use a cached response before connecting\n      to the network. If no cached response exists, Unpoly will make a request and cache\n      the server response.\n    \n      With `[up-cache=auto]` Unpoly will use the cache only if `up.network.config.autoCache`\n      returns `true` for the request.\n    \n      Also see [`up.request({ cache })`](/up.request#options.cache).\n    \n    @param [up-clear-cache]\n      Whether existing [cache](/up.cache) entries will be cleared with this request.\n    \n      By default a non-GET request will clear the entire cache.\n      You may also pass a [URL pattern](/url-patterns) to only clear matching requests.\n    \n      Also see [`up.request({ clearCache })`](/up.request#options.clearCache) and `up.network.config.clearCache`.\n    \n    @param [up-layer='origin current']\n      The [layer](/up.layer) in which to match and render the fragment.\n    \n      See [layer option](/layer-option) for a list of allowed values.\n    \n      To [open the fragment in a new overlay](/opening-overlays), pass `[up-layer=new]`.\n      In this case attributes for `a[up-layer=new]` may also be used.\n    \n    @param [up-peel]\n      Whether to close overlays obstructing the updated layer when the fragment is updated.\n    \n      This is only relevant when updating a layer that is not the [frontmost layer](/up.layer.front).\n    \n    @param [up-context]\n      A JSON object that will be merged into the [context](/context)\n      of the current layer once the fragment is rendered.\n    \n    @param [up-keep='true']\n      Whether [`[up-keep]`](/up-keep) elements will be preserved in the updated fragment.\n    \n    @param [up-hungry='true']\n      Whether [`[up-hungry]`](/up-hungry) elements outside the updated fragment will also be updated.\n    \n    @param [up-scroll]\n      How to scroll after the new fragment was rendered.\n    \n      See [scroll option](/scroll-option) for a list of allowed values.\n    \n    @param [up-save-scroll]\n      Whether to save scroll positions before updating the fragment.\n    \n      Saved scroll positions can later be restored with [`[up-scroll=restore]`](/scroll-option#restoring-scroll-options).\n    \n    @param [up-focus]\n      What to focus after the new fragment was rendered.\n    \n      See [focus option](/focus-option) for a list of allowed values.\n    \n    @param [up-confirm]\n      A message the user needs to confirm before fragments are updated.\n    \n      The message will be shown as a [native browser prompt](https://developer.mozilla.org/en-US/docs/Web/API/Window/prompt).\n    \n      If the user does not confirm the render promise will reject and no fragments will be updated.\n    \n    @param [up-feedback]\n      Whether to give the link an `.up-active` class\n      while loading and rendering content.\n    \n    @param [up-on-loaded]\n      A JavaScript snippet that is called when when the server responds with new HTML,\n      but before the HTML is rendered.\n    \n      The callback argument is a preventable `up:fragment:loaded` event.\n    \n    @param [up-on-finished]\n      A JavaScript snippet that is called when all animations have concluded and\n      elements were removed from the DOM tree.\n    \n    @stable\n     */\n    up.on('up:click', fullFollowSelector, function(event, link) {\n      if (shouldFollowEvent(event, link)) {\n        up.event.halt(event);\n        return up.log.muteUncriticalRejection(follow(link));\n      }\n    });\n\n    /***\n    Follows this link on `mousedown` instead of `click`.\n    \n    This will save precious milliseconds that otherwise spent\n    on waiting for the user to release the mouse button. Since an\n    AJAX request will be triggered right way, the interaction will\n    appear faster.\n    \n    Note that using `[up-instant]` will prevent a user from canceling a\n    click by moving the mouse away from the link. However, for\n    navigation actions this isn't needed. E.g. popular operation\n    systems switch tabs on `mousedown` instead of `click`.\n    \n    \\#\\#\\# Example\n    \n        <a href=\"/users\" up-follow up-instant>User list</a>\n    \n    \\#\\#\\# Accessibility\n    \n    If the user activates an element using their keyboard, the `up:click` event will be emitted\n    on `click`, even if the element has an `[up-instant]` attribute.\n    \n    @selector a[up-instant]\n    @stable\n     */\n\n    /***\n    Add an `[up-expand]` attribute to any element to enlarge the click area of a\n    descendant link.\n    \n    `[up-expand]` honors all the Unppoly attributes in expanded links, like\n    `a[up-target]`, `a[up-instant]` or `a[up-preload]`.\n    It also expands links that open [modals](/up.modal) or [popups](/up.popup).\n    \n    \\#\\#\\# Example\n    \n        <div class=\"notification\" up-expand>\n          Record was saved!\n          <a href=\"/records\">Close</a>\n        </div>\n    \n    In the example above, clicking anywhere within `.notification` element\n    would [follow](/up.follow) the *Close* link.\n    \n    \\#\\#\\# Elements with multiple contained links\n    \n    If a container contains more than one link, you can set the value of the\n    `up-expand` attribute to a CSS selector to define which link should be expanded:\n    \n        <div class=\"notification\" up-expand=\".close\">\n          Record was saved!\n          <a class=\"details\" href=\"/records/5\">Details</a>\n          <a class=\"close\" href=\"/records\">Close</a>\n        </div>\n    \n    \\#\\#\\# Limitations\n    \n    `[up-expand]` has some limitations for advanced browser users:\n    \n    - Users won't be able to right-click the expanded area to open a context menu\n    - Users won't be able to `CTRL`+click the expanded area to open a new tab\n    \n    To overcome these limitations, consider nesting the entire clickable area in an actual `<a>` tag.\n    [It's OK to put block elements inside an anchor tag](https://makandracards.com/makandra/43549-it-s-ok-to-put-block-elements-inside-an-a-tag).\n    \n    @selector [up-expand]\n    @param [up-expand]\n      A CSS selector that defines which containing link should be expanded.\n    \n      If omitted, the first link in this element will be expanded.\n    @stable\n     */\n    up.macro('[up-expand]', function(area) {\n      var areaAttrs, childLink, selector;\n      selector = area.getAttribute('up-expand') || 'a, [up-href]';\n      if (childLink = e.get(area, selector)) {\n        areaAttrs = e.upAttrs(childLink);\n        areaAttrs['up-href'] || (areaAttrs['up-href'] = childLink.getAttribute('href'));\n        e.setMissingAttrs(area, areaAttrs);\n        return makeFollowable(area);\n      }\n    });\n\n    /***\n    Preloads this link when the user hovers over it.\n    \n    When the link is clicked later the response will already be cached,\n    making the interaction feel instant.\n    \n    @selector a[up-preload]\n    @param [up-delay]\n      The number of milliseconds to wait between hovering\n      and preloading. Increasing this will lower the load in your server,\n      but will also make the interaction feel less instant.\n    \n      Defaults to `up.link.config.preloadDelay`.\n    @stable\n     */\n    up.compiler(fullPreloadSelector, function(link) {\n      if (!isPreloadDisabled(link)) {\n        return linkPreloader.observeLink(link);\n      }\n    });\n    up.on('up:framework:reset', reset);\n    return {\n      follow: follow,\n      followOptions: followOptions,\n      preload: preload,\n      makeFollowable: makeFollowable,\n      makeClickable: makeClickable,\n      isSafe: isSafe,\n      isFollowable: isFollowable,\n      shouldFollowEvent: shouldFollowEvent,\n      followMethod: followMethod,\n      convertClicks: convertClicks,\n      config: config,\n      combineFollowableSelectors: combineFollowableSelectors\n    };\n  })();\n\n  up.follow = up.link.follow;\n\n}).call(this);\n\n/***\nForms\n=====\n  \nThe `up.form` module helps you work with non-trivial forms.\n\n@see form[up-submit]\n@see form[up-validate]\n@see input[up-switch]\n@see form[up-autosubmit]\n\n@module up.form\n */\n\n(function() {\n  var slice = [].slice;\n\n  up.form = (function() {\n    var ATTRIBUTES_SUGGESTING_SUBMIT, abortScheduledValidate, autosubmit, config, e, fieldSelector, findFields, findSwitcherForTarget, findValidateTarget, findValidateTargetFromConfig, focusedField, fullSubmitSelector, getContainer, isSubmitDisabled, isSubmittable, observe, observeCallbackFromElement, reset, submit, submitButtonSelector, submitOptions, submittingButton, switchTarget, switchTargets, switcherValues, u, validate;\n    u = up.util;\n    e = up.element;\n    ATTRIBUTES_SUGGESTING_SUBMIT = ['[up-submit]', '[up-target]', '[up-layer]', '[up-transition]'];\n\n    /***\n    Sets default options for form submission and validation.\n    \n    @property up.form.config\n    \n    @param {number} [config.observeDelay=0]\n      The number of miliseconds to wait before [`up.observe()`](/up.observe) runs the callback\n      after the input value changes. Use this to limit how often the callback\n      will be invoked for a fast typist.\n    \n    @param {Array<string>} [config.submitSelectors]\n      An array of CSS selectors matching forms that will be [submitted through Unpoly](/form-up-follow).\n    \n      You can configure Unpoly to handle *all* forms on a page without requiring an `[up-submit]` attribute:\n    \n      ```js\n      up.form.config.submitSelectors.push('form']\n      ```\n    \n      Individual forms may opt out with an `[up-submit=follow]` attribute.\n      You may configure additional exceptions in `config.noSubmitSelectors`.\n    \n    @param {Array<string>} [config.noSubmitSelectors]\n      Exceptions to `config.submitSelectors`.\n    \n      Matching forms will *not* be [submitted through Unpoly](/form-up-submit), even if they match `config.submitSelectors`.\n    \n    @param {Array<string>} [config.validateTargets=['[up-fieldset]:has(&)', 'fieldset:has(&)', 'label:has(&)', 'form:has(&)']]\n      An array of CSS selectors that are searched around a form field\n      that wants to [validate](/up.validate).\n    \n      The first matching selector will be updated with the validation messages from the server.\n    \n      By default this looks for a `<fieldset>`, `<label>` or `<form>`\n      around the validating input field.\n    \n    @param {string} [config.fieldSelectors]\n      An array of CSS selectors that represent form fields, such as `input` or `select`.\n    \n    @param {string} [config.submitButtonSelectors]\n      An array of CSS selectors that represent submit buttons, such as `input[type=submit]`.\n    \n    @stable\n     */\n    config = new up.Config(function() {\n      return {\n        validateTargets: ['[up-fieldset]:has(:origin)', 'fieldset:has(:origin)', 'label:has(:origin)', 'form:has(:origin)'],\n        fieldSelectors: ['select', 'input:not([type=submit]):not([type=image])', 'button[type]:not([type=submit])', 'textarea'],\n        submitSelectors: up.link.combineFollowableSelectors(['form'], ATTRIBUTES_SUGGESTING_SUBMIT),\n        noSubmitSelectors: ['[up-submit=false]', '[target]'],\n        submitButtonSelectors: ['input[type=submit]', 'input[type=image]', 'button[type=submit]', 'button:not([type])'],\n        observeDelay: 0\n      };\n    });\n    fullSubmitSelector = function() {\n      return config.submitSelectors.join(',');\n    };\n    abortScheduledValidate = null;\n    reset = function() {\n      return config.reset();\n    };\n\n    /***\n    @function up.form.fieldSelector\n    @internal\n     */\n    fieldSelector = function(suffix) {\n      if (suffix == null) {\n        suffix = '';\n      }\n      return config.fieldSelectors.map(function(field) {\n        return field + suffix;\n      }).join(',');\n    };\n\n    /***\n    Returns a list of form fields within the given element.\n    \n    You can configure what Unpoly considers a form field by adding CSS selectors to the\n    `up.form.config.fieldSelectors` array.\n    \n    If the given element is itself a form field, a list of that given element is returned.\n    \n    @function up.form.fields\n    @param {Element|jQuery} root\n      The element to scan for contained form fields.\n    \n      If the element is itself a form field, a list of that element is returned.\n    @return {NodeList<Element>|Array<Element>}\n    @experimental\n     */\n    findFields = function(root) {\n      var fields, outsideFieldSelector, outsideFields;\n      root = e.get(root);\n      fields = e.subtree(root, fieldSelector());\n      if (e.matches(root, 'form[id]')) {\n        outsideFieldSelector = fieldSelector(e.attributeSelector('form', root.getAttribute('id')));\n        outsideFields = e.all(outsideFieldSelector);\n        fields.push.apply(fields, outsideFields);\n        fields = u.uniq(fields);\n      }\n      return fields;\n    };\n\n    /***\n    @function up.form.submittingButton\n    @param {Element} form\n    @internal\n     */\n    submittingButton = function(form) {\n      var focusedElement, selector;\n      selector = submitButtonSelector();\n      focusedElement = document.activeElement;\n      if (focusedElement && e.matches(focusedElement, selector) && form.contains(focusedElement)) {\n        return focusedElement;\n      } else {\n        return e.get(form, selector);\n      }\n    };\n\n    /***\n    @function up.form.submitButtonSelector\n    @internal\n     */\n    submitButtonSelector = function() {\n      return config.submitButtonSelectors.join(',');\n    };\n\n    /***\n    Submits a form via AJAX and updates a page fragment with the response.\n    \n        up.submit('form.new-user', { target: '.main' })\n    \n    Instead of loading a new page, the form is submitted via AJAX.\n    The response is parsed for a CSS selector and the matching elements will\n    replace corresponding elements on the current page.\n    \n    The unobtrusive variant of this is the `form[up-submit]` selector.\n    See its documentation to learn how form submissions work in Unpoly.\n    \n    Submitting a form is considered [navigation](/navigation).\n    \n    Emits the event [`up:form:submit`](/up:form:submit).\n    \n    @function up.submit\n    \n    @param {Element|jQuery|string} form\n      The form to submit.\n    \n      If the argument points to an element that is not a form,\n      Unpoly will search its ancestors for the [closest](/up.fragment.closest) form.\n    \n    @param {Object} [options]\n      [Render options](/up.render) that should be used for submitting the form.\n    \n      Unpoly will parse render options from the given form's attributes\n      like `[up-target]` or `[up-transition]`. See `form[up-submit]` for a list\n      of supported attributes.\n    \n      You may pass this additional `options` object to supplement or override\n      options parsed from the form attributes.\n    \n    @return {Promise<up.RenderResult>}\n      A promise that will be fulfilled when the server response was rendered.\n    \n    @stable\n     */\n    submit = up.mockable(function(form, options) {\n      return up.render(submitOptions(form, options));\n    });\n\n    /***\n    Parses the [render](/up.render) options that would be used to\n    [`submit`](/up.submit) the given form, but does not render.\n    \n    \\#\\#\\# Example\n    \n    Given a form element:\n    \n    ```html\n    <form action=\"/foo\" method=\"post\" up-target=\".content\">\n      ...\n    </form>\n    ```\n    \n    We can parse the link's render options like this:\n    \n    ```js\n    let form = document.querySelector('form')\n    let options = up.form.submitOptions(form)\n    // => { url: '/foo', method: 'POST', target: '.content', ... }\n    ```\n    \n    @param {Element|jQuery|string} form\n      The form to submit.\n    @param {Object} [options]\n      Additional options for the form submission.\n    \n      Will override any attribute values set on the given form element.\n    \n      See `up.render()` for detailed documentation of individual option properties.\n    @function up.form.submitOptions\n    @return {Object}\n    @stable\n     */\n    submitOptions = function(form, options) {\n      var params, parser, submitButton;\n      options = u.options(options);\n      form = up.fragment.get(form);\n      form = e.closest(form, 'form');\n      parser = new up.OptionsParser(options, form);\n      params = up.Params.fromForm(form);\n      if (submitButton = submittingButton(form)) {\n        params.addField(submitButton);\n        options.method || (options.method = submitButton.getAttribute('formmethod'));\n        options.url || (options.url = submitButton.getAttribute('formaction'));\n      }\n      params.addAll(options.params);\n      options.params = params;\n      parser.string('url', {\n        attr: 'action',\n        \"default\": up.fragment.source(form)\n      });\n      parser.string('method', {\n        attr: ['up-method', 'data-method', 'method'],\n        \"default\": 'GET',\n        normalize: u.normalizeMethod\n      });\n      if (options.method === 'GET') {\n        options.url = up.Params.stripURL(options.url);\n      }\n      parser.string('failTarget', {\n        \"default\": up.fragment.toTarget(form)\n      });\n      options.guardEvent || (options.guardEvent = up.event.build('up:form:submit', {\n        log: 'Submitting form'\n      }));\n      u.assign(options, up.link.followOptions(form, options));\n      return options;\n    };\n\n    /***\n    This event is [emitted](/up.emit) when a form is [submitted](/up.submit) through Unpoly.\n    \n    The event is emitted on the `<form>` element.\n    \n    When the form is being [validated](/input-up-validate), this event is not emitted.\n    Instead an `up:form:validate` event is emitted.\n    \n    \\#\\#\\# Changing render options\n    \n    Listeners may inspect and manipulate [render options](/up.render) for the coming fragment update.\n    \n    The code below will use a custom [transition](/up-transition)\n    when a form submission [fails](/server-errors):\n    \n    ```js\n    up.on('up:form:submit', function(event, form) {\n      event.renderOptions.failTransition = 'shake'\n    })\n    ```\n    \n    @event up:form:submit\n    @param {Element} event.target\n      The `<form>` element that will be submitted.\n    @param {Object} event.renderOptions\n      An object with [render options](/up.render) for the fragment update\n    \n      Listeners may inspect and modify these options.\n    @param event.preventDefault()\n      Event listeners may call this method to prevent the form from being submitted.\n    @stable\n     */\n    up.on('up:click', submitButtonSelector, function(event, button) {\n      var form;\n      form = e.closest(button, 'form');\n      if (form && isSubmittable(form)) {\n        return button.focus();\n      }\n    });\n\n    /***\n    Observes form fields and runs a callback when a value changes.\n    \n    This is useful for observing text fields while the user is typing.\n    \n    The unobtrusive variant of this is the [`[up-observe]`](/up-observe) attribute.\n    \n    \\#\\#\\# Example\n    \n    The following would print to the console whenever an input field changes:\n    \n        up.observe('input.query', function(value) {\n          console.log('Query is now %o', value)\n        })\n    \n    Instead of a single form field, you can also pass multiple fields,\n    a `<form>` or any container that contains form fields.\n    The callback will be run if any of the given fields change:\n    \n        up.observe('form', function(value, name) {\n          console.log('The value of %o is now %o', name, value)\n        })\n    \n    You may also pass the `{ batch: true }` option to receive all\n    changes since the last callback in a single object:\n    \n        up.observe('form', { batch: true }, function(diff) {\n          console.log('Observed one or more changes: %o', diff)\n        })\n    \n    @function up.observe\n    @param {string|Element|Array<Element>|jQuery} elements\n      The form fields that will be observed.\n    \n      You can pass one or more fields, a `<form>` or any container that contains form fields.\n      The callback will be run if any of the given fields change.\n    @param {boolean} [options.batch=false]\n      If set to `true`, the `onChange` callback will receive multiple\n      detected changes in a single diff object as its argument.\n    @param {number} [options.delay=up.form.config.observeDelay]\n      The number of miliseconds to wait before executing the callback\n      after the input value changes. Use this to limit how often the callback\n      will be invoked for a fast typist.\n    @param {Function(value, name): string} onChange\n      The callback to run when the field's value changes.\n    \n      If given as a function, it receives two arguments (`value`, `name`).\n      `value` is a string with the new attribute value and `string` is the name\n      of the form field that changed. If given as a string, it will be evaled as\n      JavaScript code in a context where (`value`, `name`) are set.\n    \n      A long-running callback function may return a promise that settles when\n      the callback completes. In this case the callback will not be called again while\n      it is already running.\n    @return {Function()}\n      A destructor function that removes the observe watch when called.\n    @stable\n     */\n    observe = function() {\n      var args, callback, elements, fields, observer, options, ref, ref1, ref2, ref3;\n      elements = arguments[0], args = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n      elements = e.list(elements);\n      fields = u.flatMap(elements, findFields);\n      callback = (ref = (ref1 = u.extractCallback(args)) != null ? ref1 : observeCallbackFromElement(elements[0])) != null ? ref : up.fail('up.observe: No change callback given');\n      options = u.extractOptions(args);\n      options.delay = (ref2 = (ref3 = options.delay) != null ? ref3 : e.numberAttr(elements[0], 'up-delay')) != null ? ref2 : config.observeDelay;\n      observer = new up.FieldObserver(fields, options, callback);\n      observer.start();\n      return function() {\n        return observer.stop();\n      };\n    };\n    observeCallbackFromElement = function(element) {\n      var rawCallback;\n      if (rawCallback = element.getAttribute('up-observe')) {\n        return new Function('value', 'name', rawCallback);\n      }\n    };\n\n    /***\n    [Observes](/up.observe) a field or form and submits the form when a value changes.\n    \n    Both the form and the changed field will be assigned a CSS class [`.up-active`](/form-up-active)\n    while the autosubmitted form is processing.\n    \n    The unobtrusive variant of this is the [`[up-autosubmit]`](/form-up-autosubmit) attribute.\n    \n    @function up.autosubmit\n    @param {string|Element|jQuery} target\n      The field or form to observe.\n    @param {Object} [options]\n      See options for [`up.observe()`](/up.observe)\n    @return {Function()}\n      A destructor function that removes the observe watch when called.\n    @stable\n     */\n    autosubmit = function(target, options) {\n      return observe(target, options, function() {\n        return submit(target);\n      });\n    };\n    findValidateTarget = function(element, options) {\n      var container, givenTarget;\n      container = getContainer(element);\n      if (u.isElementish(options.target)) {\n        return up.fragment.toTarget(options.target);\n      } else if (givenTarget = options.target || element.getAttribute('up-validate') || container.getAttribute('up-validate')) {\n        return givenTarget;\n      } else if (e.matches(element, 'form')) {\n        return up.fragment.toTarget(element);\n      } else {\n        return findValidateTargetFromConfig(element, options) || up.fail('Could not find validation target for %o (tried defaults %o)', element, config.validateTargets);\n      }\n    };\n    findValidateTargetFromConfig = function(element, options) {\n      var layer;\n      layer = up.layer.get(element);\n      return u.findResult(config.validateTargets, function(defaultTarget) {\n        if (up.fragment.get(defaultTarget, u.merge(options, {\n          layer: layer\n        }))) {\n          return defaultTarget;\n        }\n      });\n    };\n\n    /***\n    Performs a server-side validation of a form field.\n    \n    `up.validate()` submits the given field's form with an additional `X-Up-Validate`\n    HTTP header. Upon seeing this header, the server is expected to validate (but not save)\n    the form submission and render a new copy of the form with validation errors.\n    \n    The unobtrusive variant of this is the [`input[up-validate]`](/input-up-validate) selector.\n    See the documentation for [`input[up-validate]`](/input-up-validate) for more information\n    on how server-side validation works in Unpoly.\n    \n    \\#\\#\\# Example\n    \n    ```js\n    up.validate('input[name=email]', { target: '.email-errors' })\n    ```\n    \n    @function up.validate\n    @param {string|Element|jQuery} field\n      The form field to validate.\n    @param {string|Element|jQuery} [options.target]\n      The element that will be [updated](/up.render) with the validation results.\n    @return {Promise}\n      A promise that fulfills when the server-side\n      validation is received and the form was updated.\n    @stable\n     */\n    validate = function(field, options) {\n      field = up.fragment.get(field);\n      options = u.options(options);\n      options.navigate = false;\n      options.origin = field;\n      options.history = false;\n      options.target = findValidateTarget(field, options);\n      options.focus = 'keep';\n      options.fail = false;\n      options.headers || (options.headers = {});\n      options.headers[up.protocol.headerize('validate')] = field.getAttribute('name') || ':unknown';\n      options.guardEvent = up.event.build('up:form:validate', {\n        field: field,\n        log: 'Validating form'\n      });\n      return submit(field, options);\n    };\n\n    /***\n    This event is emitted before a field is being [validated](/input-up-validate).\n    \n    @event up:form:validate\n    @param {Element} event.field\n      The form field that has been changed and caused the validated request.\n    @param {Object} event.renderOptions\n      An object with [render options](/up.render) for the fragment update\n      that will show the validation results.\n    \n      Listeners may inspect and modify these options.\n    @param event.preventDefault()\n      Event listeners may call this method to prevent the validation request\n      being sent to the server.\n    @stable\n     */\n    switcherValues = function(field) {\n      var checkedButton, form, groupName, meta, value, values;\n      value = void 0;\n      meta = void 0;\n      if (e.matches(field, 'input[type=checkbox]')) {\n        if (field.checked) {\n          value = field.value;\n          meta = ':checked';\n        } else {\n          meta = ':unchecked';\n        }\n      } else if (e.matches(field, 'input[type=radio]')) {\n        form = getContainer(field);\n        groupName = field.getAttribute('name');\n        checkedButton = form.querySelector(\"input[type=radio]\" + (e.attributeSelector('name', groupName)) + \":checked\");\n        if (checkedButton) {\n          meta = ':checked';\n          value = checkedButton.value;\n        } else {\n          meta = ':unchecked';\n        }\n      } else {\n        value = field.value;\n      }\n      values = [];\n      if (u.isPresent(value)) {\n        values.push(value);\n        values.push(':present');\n      } else {\n        values.push(':blank');\n      }\n      if (u.isPresent(meta)) {\n        values.push(meta);\n      }\n      return values;\n    };\n\n    /***\n    Shows or hides a target selector depending on the value.\n    \n    See [`input[up-switch]`](/input-up-switch) for more documentation and examples.\n    \n    This function does not currently have a very useful API outside\n    of our use for `up-switch`'s UJS behavior, that's why it's currently\n    still marked `@internal`.\n    \n    @function up.form.switchTargets\n    @param {Element} switcher\n    @param {string} [options.target]\n      The target selectors to switch.\n      Defaults to an `[up-switch]` attribute on the given field.\n    @internal\n     */\n    switchTargets = function(switcher, options) {\n      var fieldValues, form, ref, targetSelector;\n      if (options == null) {\n        options = {};\n      }\n      targetSelector = (ref = options.target) != null ? ref : switcher.getAttribute('up-switch');\n      form = getContainer(switcher);\n      targetSelector || up.fail(\"No switch target given for %o\", switcher);\n      fieldValues = switcherValues(switcher);\n      return u.each(e.all(form, targetSelector), function(target) {\n        return switchTarget(target, fieldValues);\n      });\n    };\n\n    /***\n    @internal\n     */\n    switchTarget = up.mockable(function(target, fieldValues) {\n      var hideValues, show, showValues;\n      fieldValues || (fieldValues = switcherValues(findSwitcherForTarget(target)));\n      if (hideValues = target.getAttribute('up-hide-for')) {\n        hideValues = u.splitValues(hideValues);\n        show = u.intersect(fieldValues, hideValues).length === 0;\n      } else {\n        if (showValues = target.getAttribute('up-show-for')) {\n          showValues = u.splitValues(showValues);\n        } else {\n          showValues = [':present', ':checked'];\n        }\n        show = u.intersect(fieldValues, showValues).length > 0;\n      }\n      e.toggle(target, show);\n      return target.classList.add('up-switched');\n    });\n\n    /***\n    @internal\n     */\n    findSwitcherForTarget = function(target) {\n      var form, switcher, switchers;\n      form = getContainer(target);\n      switchers = e.all(form, '[up-switch]');\n      switcher = u.find(switchers, function(switcher) {\n        var targetSelector;\n        targetSelector = switcher.getAttribute('up-switch');\n        return e.matches(target, targetSelector);\n      });\n      return switcher || up.fail('Could not find [up-switch] field for %o', target);\n    };\n    getContainer = function(element) {\n      return element.form || e.closest(element, \"form, \" + (up.layer.anySelector()));\n    };\n    focusedField = function() {\n      var element;\n      if ((element = document.activeElement) && e.matches(element, fieldSelector())) {\n        return element;\n      }\n    };\n\n    /***\n    Returns whether the given form will be [submitted](/up.follow) through Unpoly\n    instead of making a full page load.\n    \n    By default Unpoly will follow forms if the element has\n    one of the following attributes:\n    \n    - `[up-submit]`\n    - `[up-target]`\n    - `[up-layer]`\n    - `[up-transition]`\n    \n    To consider other selectors to be submittable, see `up.form.config.submitSelectors`.\n    \n    @function up.form.isSubmittable\n    @param {Element|jQuery|string} form\n      The form to check.\n    @stable\n     */\n    isSubmittable = function(form) {\n      form = up.fragment.get(form);\n      return e.matches(form, fullSubmitSelector()) && !isSubmitDisabled(form);\n    };\n    isSubmitDisabled = function(form) {\n      return e.matches(form, config.noSubmitSelectors.join(','));\n    };\n\n    /***\n    Submits this form via JavaScript and updates a fragment with the server response.\n    \n    The server response is searched for the selector given in `up-target`.\n    The selector content is then [replaced](/up.replace) in the current page.\n    \n    The programmatic variant of this is the [`up.submit()`](/up.submit) function.\n    \n    \\#\\#\\# Example\n    \n    ```html\n    <form method=\"post\" action=\"/users\" up-submit>\n      ...\n    </form>\n    ```\n    \n    \\#\\#\\# Handling validation errors\n    \n    When the server was unable to save the form due to invalid params,\n    it will usually re-render an updated copy of the form with\n    validation messages.\n    \n    For Unpoly to be able to detect a failed form submission,\n    the form must be re-rendered with a non-200 HTTP status code.\n    We recommend to use either 400 (bad request) or\n    422 (unprocessable entity).\n    \n    In Ruby on Rails, you can pass a\n    [`:status` option to `render`](http://guides.rubyonrails.org/layouts_and_rendering.html#the-status-option)\n    for this:\n    \n    ```ruby\n    class UsersController < ApplicationController\n    \n      def create\n        user_params = params[:user].permit(:email, :password)\n        @user = User.new(user_params)\n        if @user.save?\n          sign_in @user\n        else\n          render 'form', status: :bad_request\n        end\n      end\n    \n    end\n    ```\n    \n    You may define different option for the failure case by infixing an attribute with `fail`:\n    \n    ```html\n    <form method=\"post\" action=\"/action\"\n      up-target=\".content\"\n      up-fail-target=\"form\"\n      up-scroll=\"auto\"\n      up-fail-scroll=\".errors\">\n      ...\n    </form>\n    ```\n    \n    See [handling server errors](/server-errors) for details.\n    \n    Note that you can also use\n    [`input[up-validate]`](/input-up-validate) to perform server-side\n    validations while the user is completing fields.\n    \n    \\#\\#\\# Giving feedback while the form is processing\n    \n    The `<form>` element will be assigned a CSS class [`.up-active`](/form.up-active) while\n    the submission is loading.\n    \n    \\#\\#\\# Short notation\n    \n    You may omit the `[up-submit]` attribute if the form has one of the following attributes:\n    \n    - `[up-target]`\n    - `[up-layer]`\n    - `[up-transition]`\n    \n    Such a form will still be submitted through Unpoly.\n    \n    \\#\\#\\# Handling all forms automatically\n    \n    You can configure Unpoly to handle *all* forms on a page without requiring an `[up-submit]` attribute.\n    \n    See [Handling all links and forms](/handling-everything).\n    \n    @selector form[up-submit]\n    \n    @params-note\n      All attributes for `a[up-follow]` may also be used.\n    \n    @stable\n     */\n    up.on('submit', fullSubmitSelector, function(event, form) {\n      if (event.defaultPrevented || isSubmitDisabled(form)) {\n        return;\n      }\n      if (typeof abortScheduledValidate === \"function\") {\n        abortScheduledValidate();\n      }\n      up.event.halt(event);\n      return up.log.muteUncriticalRejection(submit(form));\n    });\n\n    /***\n    When a form field with this attribute is changed, the form is validated on the server\n    and is updated with validation messages.\n    \n    To validate the form, Unpoly will submit the form with an additional `X-Up-Validate` HTTP header.\n    When seeing this header, the server is expected to validate (but not save)\n    the form submission and render a new copy of the form with validation errors.\n    \n    The programmatic variant of this is the [`up.validate()`](/up.validate) function.\n    \n    \\#\\#\\# Example\n    \n    Let's look at a standard registration form that asks for an e-mail and password:\n    \n        <form action=\"/users\">\n    \n          <label>\n            E-mail: <input type=\"text\" name=\"email\" />\n          </label>\n    \n          <label>\n            Password: <input type=\"password\" name=\"password\" />\n          </label>\n    \n          <button type=\"submit\">Register</button>\n    \n        </form>\n    \n    When the user changes the `email` field, we want to validate that\n    the e-mail address is valid and still available. Also we want to\n    change the `password` field for the minimum required password length.\n    We can do this by giving both fields an `up-validate` attribute:\n    \n        <form action=\"/users\">\n    \n          <label>\n            E-mail: <input type=\"text\" name=\"email\" up-validate />\n          </label>\n    \n          <label>\n            Password: <input type=\"password\" name=\"password\" up-validate />\n          </label>\n    \n          <button type=\"submit\">Register</button>\n    \n        </form>\n    \n    Whenever a field with `up-validate` changes, the form is POSTed to\n    `/users` with an additional `X-Up-Validate` HTTP header.\n    When seeing this header, the server is expected to validate (but not save)\n    the form submission and render a new copy of the form with validation errors.\n    \n    In Ruby on Rails the processing action should behave like this:\n    \n        class UsersController < ApplicationController\n    \n           * This action handles POST /users\n          def create\n            user_params = params[:user].permit(:email, :password)\n            @user = User.new(user_params)\n            if request.headers['X-Up-Validate']\n              @user.valid?  # run validations, but don't save to the database\n              render 'form' # render form with error messages\n            elsif @user.save?\n              sign_in @user\n            else\n              render 'form', status: :bad_request\n            end\n          end\n    \n        end\n    \n    Note that if you're using the `unpoly-rails` gem you can simply say `up.validate?`\n    instead of manually checking for `request.headers['X-Up-Validate']`.\n    \n    The server now renders an updated copy of the form with eventual validation errors:\n    \n        <form action=\"/users\">\n    \n          <label class=\"has-error\">\n            E-mail: <input type=\"text\" name=\"email\" value=\"foo@bar.com\" />\n            Has already been taken!\n          </label>\n    \n          <button type=\"submit\">Register</button>\n    \n        </form>\n    \n    The `<label>` around the e-mail field is now updated to have the `has-error`\n    class and display the validation message.\n    \n    \\#\\#\\# How validation results are displayed\n    \n    Although the server will usually respond to a validation with a complete,\n    fresh copy of the form, Unpoly will by default not update the entire form.\n    This is done in order to preserve volatile state such as the scroll position\n    of `<textarea>` elements.\n    \n    By default Unpoly looks for a `<fieldset>`, `<label>` or `<form>`\n    around the validating input field, or any element with an\n    `up-fieldset` attribute.\n    With the Bootstrap bindings, Unpoly will also look\n    for a container with the `form-group` class.\n    \n    You can change this default behavior by setting `up.form.config.validateTargets`:\n    \n        // Always update the entire form containing the current field (\"&\")\n        up.form.config.validateTargets = ['form &']\n    \n    You can also individually override what to update by setting the `up-validate`\n    attribute to a CSS selector:\n    \n        <input type=\"text\" name=\"email\" up-validate=\".email-errors\">\n        <span class=\"email-errors\"></span>\n    \n    \\#\\#\\# Updating dependent fields\n    \n    The `[up-validate]` behavior is also a great way to partially update a form\n    when one fields depends on the value of another field.\n    \n    Let's say you have a form with one `<select>` to pick a department (sales, engineering, ...)\n    and another `<select>` to pick an employeee from the selected department:\n    \n        <form action=\"/contracts\">\n          <select name=\"department\">...</select> <!-- options for all departments -->\n          <select name=\"employeed\">...</select> <!-- options for employees of selected department -->\n        </form>\n    \n    The list of employees needs to be updated as the appartment changes:\n    \n        <form action=\"/contracts\">\n          <select name=\"department\" up-validate=\"[name=employee]\">...</select>\n          <select name=\"employee\">...</select>\n        </form>\n    \n    In order to update the `department` field in addition to the `employee` field, you could say\n    `up-validate=\"&, [name=employee]\"`, or simply `up-validate=\"form\"` to update the entire form.\n    \n    @selector input[up-validate]\n    @param up-validate\n      The CSS selector to update with the server response.\n    \n      This defaults to a fieldset or form group around the validating field.\n    @stable\n     */\n\n    /***\n    Validates this form on the server when any field changes and shows validation errors.\n    \n    You can configure what Unpoly considers a fieldset by adding CSS selectors to the\n    `up.form.config.validateTargets` array.\n    \n    See `input[up-validate]` for detailed documentation.\n    \n    @selector form[up-validate]\n    @param up-validate\n      The CSS selector to update with the server response.\n    \n      This defaults to a fieldset or form group around the changing field.\n    @stable\n     */\n    up.on('change', '[up-validate]', function(event) {\n      var field;\n      field = findFields(event.target)[0];\n      return abortScheduledValidate = u.abortableMicrotask(function() {\n        return up.log.muteUncriticalRejection(validate(field));\n      });\n    });\n\n    /***\n    Show or hide elements when a form field is set to a given value.\n    \n    \\#\\#\\# Example: Select options\n    \n    The controlling form field gets an `up-switch` attribute with a selector for the elements to show or hide:\n    \n        <select name=\"advancedness\" up-switch=\".target\">\n          <option value=\"basic\">Basic parts</option>\n          <option value=\"advanced\">Advanced parts</option>\n          <option value=\"very-advanced\">Very advanced parts</option>\n        </select>\n    \n    The target elements can use [`[up-show-for]`](/up-show-for) and [`[up-hide-for]`](/up-hide-for)\n    attributes to indicate for which values they should be shown or hidden:\n    \n        <div class=\"target\" up-show-for=\"basic\">\n          only shown for advancedness = basic\n        </div>\n    \n        <div class=\"target\" up-hide-for=\"basic\">\n          hidden for advancedness = basic\n        </div>\n    \n        <div class=\"target\" up-show-for=\"advanced very-advanced\">\n          shown for advancedness = advanced or very-advanced\n        </div>\n    \n    \\#\\#\\# Example: Text field\n    \n    The controlling `<input>` gets an `up-switch` attribute with a selector for the elements to show or hide:\n    \n        <input type=\"text\" name=\"user\" up-switch=\".target\">\n    \n        <div class=\"target\" up-show-for=\"alice\">\n          only shown for user alice\n        </div>\n    \n    You can also use the pseudo-values `:blank` to match an empty input value,\n    or `:present` to match a non-empty input value:\n    \n        <input type=\"text\" name=\"user\" up-switch=\".target\">\n    \n        <div class=\"target\" up-show-for=\":blank\">\n          please enter a username\n        </div>\n    \n    \\#\\#\\# Example: Checkbox\n    \n    For checkboxes you can match against the pseudo-values `:checked` or `:unchecked`:\n    \n        <input type=\"checkbox\" name=\"flag\" up-switch=\".target\">\n    \n        <div class=\"target\" up-show-for=\":checked\">\n          only shown when checkbox is checked\n        </div>\n    \n        <div class=\"target\" up-show-for=\":cunhecked\">\n          only shown when checkbox is unchecked\n        </div>\n    \n    Of course you can also match against the `value` property of the checkbox element:\n    \n        <input type=\"checkbox\" name=\"flag\" value=\"active\" up-switch=\".target\">\n    \n        <div class=\"target\" up-show-for=\"active\">\n          only shown when checkbox is checked\n        </div>\n    \n    @selector input[up-switch]\n    @param up-switch\n      A CSS selector for elements whose visibility depends on this field's value.\n    @stable\n     */\n\n    /***\n    Only shows this element if an input field with [`[up-switch]`](/input-up-switch) has one of the given values.\n    \n    See [`input[up-switch]`](/input-up-switch) for more documentation and examples.\n    \n    @selector [up-show-for]\n    @param [up-show-for]\n      A space-separated list of input values for which this element should be shown.\n    @stable\n     */\n\n    /***\n    Hides this element if an input field with [`[up-switch]`](/input-up-switch) has one of the given values.\n    \n    See [`input[up-switch]`](/input-up-switch) for more documentation and examples.\n    \n    @selector [up-hide-for]\n    @param [up-hide-for]\n      A space-separated list of input values for which this element should be hidden.\n    @stable\n     */\n    up.compiler('[up-switch]', function(switcher) {\n      return switchTargets(switcher);\n    });\n    up.on('change', '[up-switch]', function(event, switcher) {\n      return switchTargets(switcher);\n    });\n    up.compiler('[up-show-for]:not(.up-switched), [up-hide-for]:not(.up-switched)', function(element) {\n      return switchTarget(element);\n    });\n\n    /***\n    Observes this field and runs a callback when a value changes.\n    \n    This is useful for observing text fields while the user is typing.\n    If you want to submit the form after a change see [`input[up-autosubmit]`](/input-up-autosubmit).\n    \n    The programmatic variant of this is the [`up.observe()`](/up.observe) function.\n    \n    \\#\\#\\# Example\n    \n    The following would run a global `showSuggestions(value)` function\n    whenever the `<input>` changes:\n    \n        <input name=\"query\" up-observe=\"showSuggestions(value)\">\n    \n    Note that the parameter name in the markup must be called `value` or it will not work.\n    The parameter name can be called whatever you want in the JavaScript, however.\n        \n    Also note that the function must be declared on the `window` object to work, like so:\n        \n        window.showSuggestions = function(selectedValue) {\n          console.log(`Called showSuggestions() with ${selectedValue}`);\n        }\n    \n    \\#\\#\\# Callback context\n    \n    The script given to `[up-observe]` runs with the following context:\n    \n    | Name     | Type      | Description                           |\n    | -------- | --------- | ------------------------------------- |\n    | `value`  | `string`  | The current value of the field        |\n    | `this`   | `Element` | The form field                        |\n    | `$field` | `jQuery`  | The form field as a jQuery collection |\n    \n    \\#\\#\\# Observing radio buttons\n    \n    Multiple radio buttons with the same `[name]` (a radio button group)\n    produce a single value for the form.\n    \n    To observe radio buttons group, use the `[up-observe]` attribute on an\n    element that contains all radio button elements with a given name:\n    \n        <div up-observe=\"formatSelected(value)\">\n          <input type=\"radio\" name=\"format\" value=\"html\"> HTML format\n          <input type=\"radio\" name=\"format\" value=\"pdf\"> PDF format\n          <input type=\"radio\" name=\"format\" value=\"txt\"> Text format\n        </div>\n    \n    @selector input[up-observe]\n    @param up-observe\n      The code to run when the field's value changes.\n    @param up-delay\n      The number of miliseconds to wait after a change before the code is run.\n    @stable\n     */\n\n    /***\n    Observes this form and runs a callback when any field changes.\n    \n    This is useful for observing text fields while the user is typing.\n    If you want to submit the form after a change see [`input[up-autosubmit]`](/input-up-autosubmit).\n    \n    The programmatic variant of this is the [`up.observe()`](/up.observe) function.\n    \n    \\#\\#\\# Example\n    \n    The would call a function `somethingChanged(value)`\n    when any `<input>` within the `<form>` changes:\n    \n        <form up-observe=\"somethingChanged(value)\">\n          <input name=\"foo\">\n          <input name=\"bar\">\n        </form>\n    \n    \\#\\#\\# Callback context\n    \n    The script given to `[up-observe]` runs with the following context:\n    \n    | Name     | Type      | Description                           |\n    | -------- | --------- | ------------------------------------- |\n    | `value`  | `string`  | The current value of the field        |\n    | `this`   | `Element` | The form field                        |\n    | `$field` | `jQuery`  | The form field as a jQuery collection |\n    \n    @selector form[up-observe]\n    @param up-observe\n      The code to run when any field's value changes.\n    @param up-delay\n      The number of miliseconds to wait after a change before the code is run.\n    @stable\n     */\n    up.compiler('[up-observe]', function(formOrField) {\n      return observe(formOrField);\n    });\n\n    /***\n    Submits this field's form when this field changes its values.\n    \n    Both the form and the changed field will be assigned a CSS class [`.up-active`](/form-up-active)\n    while the autosubmitted form is loading.\n    \n    The programmatic variant of this is the [`up.autosubmit()`](/up.autosubmit) function.\n    \n    \\#\\#\\# Example\n    \n    The following would automatically submit the form when the query is changed:\n    \n        <form method=\"GET\" action=\"/search\">\n          <input type=\"search\" name=\"query\" up-autosubmit>\n          <input type=\"checkbox\" name=\"archive\"> Include archive\n        </form>\n    \n    \\#\\#\\# Auto-submitting radio buttons\n    \n    Multiple radio buttons with the same `[name]` (a radio button group)\n    produce a single value for the form.\n    \n    To auto-submit radio buttons group, use the `[up-submit]` attribute on an\n    element that contains all radio button elements with a given name:\n    \n        <div up-autosubmit>\n          <input type=\"radio\" name=\"format\" value=\"html\"> HTML format\n          <input type=\"radio\" name=\"format\" value=\"pdf\"> PDF format\n          <input type=\"radio\" name=\"format\" value=\"txt\"> Text format\n        </div>\n    \n    @selector input[up-autosubmit]\n    @param [up-delay]\n      The number of miliseconds to wait after a change before the form is submitted.\n    @stable\n     */\n\n    /***\n    Submits the form when any field changes.\n    \n    Both the form and the field will be assigned a CSS class [`.up-active`](/form-up-active)\n    while the autosubmitted form is loading.\n    \n    The programmatic variant of this is the [`up.autosubmit()`](/up.autosubmit) function.\n    \n    \\#\\#\\# Example\n    \n    This will submit the form when either query or checkbox was changed:\n    \n        <form method=\"GET\" action=\"/search\" up-autosubmit>\n          <input type=\"search\" name=\"query\">\n          <input type=\"checkbox\" name=\"archive\"> Include archive\n        </form>\n    \n    @selector form[up-autosubmit]\n    @param [up-delay]\n      The number of miliseconds to wait after a change before the form is submitted.\n    @stable\n     */\n    up.compiler('[up-autosubmit]', function(formOrField) {\n      return autosubmit(formOrField);\n    });\n    up.on('up:framework:reset', reset);\n    return {\n      config: config,\n      submit: submit,\n      submitOptions: submitOptions,\n      isSubmittable: isSubmittable,\n      observe: observe,\n      validate: validate,\n      autosubmit: autosubmit,\n      fieldSelector: fieldSelector,\n      fields: findFields,\n      focusedField: focusedField,\n      switchTarget: switchTarget\n    };\n  })();\n\n  up.submit = up.form.submit;\n\n  up.observe = up.form.observe;\n\n  up.autosubmit = up.form.autosubmit;\n\n  up.validate = up.form.validate;\n\n}).call(this);\n\n/***\nNavigation feedback\n===================\n\nThe `up.feedback` module adds useful CSS classes to links while they are loading,\nor when they point to the current URL.\n\nBy styling these classes you may provide instant feedback to user interactions,\nimproving the perceived speed of your interface.\n\n\n\\#\\#\\# Example\n\nLet's say we have an `<nav>` element with two links, pointing to `/foo` and `/bar` respectively:\n\n```html\n<nav>\n  <a href=\"/foo\" up-follow>Foo</a>\n  <a href=\"/bar\" up-follow>Bar</a>\n</nav>\n```\n\nBy giving the navigation bar the `[up-nav]` attribute, links pointing to the current browser address are highlighted\nas we navigate through the site.\n\nIf the current URL is `/foo`, the first link is automatically marked with an [`.up-current`](/a.up-current) class:\n\n```html\n<nav up-nav>\n  <a href=\"/foo\" up-follow class=\"up-current\">Foo</a>\n  <a href=\"/bar\" up-follow>Bar</a>\n</nav>\n```\n\nWhen the user clicks on the `/bar` link, the link will receive the [`up-active`](/a.up-active) class while it is waiting\nfor the server to respond:\n\n```\n<nav up-nav>\n  <a href=\"/foo\" up-follow class=\"up-current\">Foo</a>\n  <a href=\"/bar\" up-follow class=\"up-active\">Bar</a>\n</div>\n```\n\nOnce the response is received the URL will change to `/bar` and the `up-active` class is removed:\n\n```html\n<nav up-nav>\n  <a href=\"/foo\" up-follow>Foo</a>\n  <a href=\"/bar\" up-follow class=\"up-current\">Bar</a>\n</nav>\n```\n\n@see [up-nav]\n@see a.up-current\n@see a.up-active\n\n@module up.feedback\n */\n\n(function() {\n  up.feedback = (function() {\n    var CLASS_ACTIVE, SELECTOR_LINK, around, aroundForOptions, config, e, findActivatableArea, getLayerLocation, linkURLs, navSelector, normalizeURL, onBrowserLocationChanged, reset, start, stop, u, updateFragment, updateLayerIfLocationChanged, updateLinks, updateLinksWithinNavs;\n    u = up.util;\n    e = up.element;\n\n    /***\n    Sets default options for this package.\n    \n    @property up.feedback.config\n    \n    @param {Array<string>} [config.currentClasses]\n      An array of classes to set on [links that point the current location](/a.up-current).\n    \n    @param {Array<string>} [config.navSelectors]\n      An array of CSS selectors that match [navigation components](/up-nav).\n    \n    @stable\n     */\n    config = new up.Config(function() {\n      return {\n        currentClasses: ['up-current'],\n        navSelectors: ['[up-nav]', 'nav']\n      };\n    });\n    reset = function() {\n      return config.reset();\n    };\n    CLASS_ACTIVE = 'up-active';\n    SELECTOR_LINK = 'a, [up-href]';\n    navSelector = function() {\n      return config.navSelectors.join(',');\n    };\n    normalizeURL = function(url) {\n      if (url) {\n        return u.normalizeURL(url, {\n          stripTrailingSlash: true\n        });\n      }\n    };\n    linkURLs = function(link) {\n      return link.upFeedbackURLs || (link.upFeedbackURLs = new up.LinkFeedbackURLs(link));\n    };\n    updateFragment = function(fragment) {\n      var layerOption, links;\n      layerOption = {\n        layer: up.layer.get(fragment)\n      };\n      if (up.fragment.closest(fragment, navSelector(), layerOption)) {\n        links = up.fragment.subtree(fragment, SELECTOR_LINK, layerOption);\n        return updateLinks(links, layerOption);\n      } else {\n        return updateLinksWithinNavs(fragment, layerOption);\n      }\n    };\n    updateLinksWithinNavs = function(fragment, options) {\n      var links, navs;\n      navs = up.fragment.subtree(fragment, navSelector(), options);\n      links = u.flatMap(navs, function(nav) {\n        return e.subtree(nav, SELECTOR_LINK);\n      });\n      return updateLinks(links, options);\n    };\n    getLayerLocation = function(layer) {\n      return layer.feedbackLocation || layer.location;\n    };\n    updateLinks = function(links, options) {\n      var layer, layerLocation;\n      if (options == null) {\n        options = {};\n      }\n      if (!links.length) {\n        return;\n      }\n      layer = options.layer || up.layer.get(links[0]);\n      if (layerLocation = getLayerLocation(layer)) {\n        return u.each(links, function(link) {\n          var currentClass, i, isCurrent, len, ref;\n          isCurrent = linkURLs(link).isCurrent(layerLocation);\n          ref = config.currentClasses;\n          for (i = 0, len = ref.length; i < len; i++) {\n            currentClass = ref[i];\n            e.toggleClass(link, currentClass, isCurrent);\n          }\n          return e.toggleAttr(link, 'aria-current', 'page', isCurrent);\n        });\n      }\n    };\n\n    /***\n    @function findActivatableArea\n    @param {string|Element|jQuery} element\n    @internal\n     */\n    findActivatableArea = function(element) {\n      return e.ancestor(element, SELECTOR_LINK) || element;\n    };\n\n    /***\n    Marks the given element as currently loading, by assigning the CSS class [`up-active`](/a.up-active).\n    \n    This happens automatically when following links or submitting forms through the Unpoly API.\n    Use this function if you make custom network calls from your own JavaScript code.\n    \n    If the given element is a link within an [expanded click area](/up-expand),\n    the class will be assigned to the expanded area.\n    \n    \\#\\#\\# Example\n    \n        var button = document.querySelector('button')\n    \n        button.addEventListener('click', () => {\n          up.feedback.start(button)\n          up.request(...).then(() => {\n            up.feedback.stop(button)\n          })\n        })\n    \n    @function up.feedback.start\n    @param {Element} element\n      The element to mark as active\n    @internal\n     */\n    start = function(element) {\n      return findActivatableArea(element).classList.add(CLASS_ACTIVE);\n    };\n\n    /***\n    Links that are currently [loading through Unpoly](/a-up-follow)\n    are assigned the `.up-active` class automatically.\n    \n    Style `.up-active` in your CSS to improve the perceived responsiveness\n    of your user interface.\n    \n    The `.up-active` class will be removed when the link is done loading.\n    \n    \\#\\#\\# Example\n    \n    We have a link:\n    \n    ```html\n    <a href=\"/foo\" up-follow>Foo</a>\n    ```\n    \n    The user clicks on the link. While the request is loading,\n    the link has the `up-active` class:\n    \n    ```html\n    <a href=\"/foo\" up-follow class=\"up-active\">Foo</a>\n    ```\n    \n    Once the link destination has loaded and rendered, the `.up-active` class\n    is removed and the [`.up-current`](/a.up-current) class is added:\n    \n    ```html\n    <a href=\"/foo\" up-follow class=\"up-current\">Foo</a>\n    ```\n    \n    @selector a.up-active\n    @stable\n     */\n\n    /***\n    Forms that are currently [loading through Unpoly](/form-up-submit)\n    are assigned the `.up-active` class automatically.\n    Style `.up-active` in your CSS to improve the perceived responsiveness\n    of your user interface.\n    \n    The `.up-active` class will be removed as soon as the response to the\n    form submission has been received.\n    \n    \\#\\#\\# Example\n    \n    We have a form:\n    \n    ```html\n    <form up-target=\".foo\">\n      <button type=\"submit\">Submit</button>\n    </form>\n    ```\n    \n    The user clicks on the submit button. While the form is being submitted\n    and waiting for the server to respond, the form has the `up-active` class:\n    \n    ```html\n    <form up-target=\".foo\" class=\"up-active\">\n      <button type=\"submit\">Submit</button>\n    </form>\n    ```\n    \n    Once the link destination has loaded and rendered, the `.up-active` class\n    is removed.\n    \n    @selector form.up-active\n    @stable\n     */\n\n    /***\n    Marks the given element as no longer loading, by removing the CSS class [`.up-active`](/a.up-active).\n    \n    This happens automatically when network requests initiated by the Unpoly API have completed.\n    Use this function if you make custom network calls from your own JavaScript code.\n    \n    @function up.feedback.stop\n    @param {Element} element\n      The link or form that has finished loading.\n    @internal\n     */\n    stop = function(element) {\n      return findActivatableArea(element).classList.remove(CLASS_ACTIVE);\n    };\n    around = function(element, fn) {\n      var result;\n      start(element);\n      result = fn();\n      u.always(result, function() {\n        return stop(element);\n      });\n      return result;\n    };\n    aroundForOptions = function(options, fn) {\n      var element, feedbackOpt;\n      if (feedbackOpt = options.feedback) {\n        if (u.isBoolean(feedbackOpt)) {\n          element = options.origin;\n        } else {\n          element = feedbackOpt;\n        }\n      }\n      if (element) {\n        element = up.fragment.get(element);\n        return around(element, fn);\n      } else {\n        return fn();\n      }\n    };\n\n    /***\n    Marks this element as a navigation component, such as a menu or navigation bar.\n    \n    When a link within an `[up-nav]` element points to [its layer's location](/up.layer.location),\n    it is assigned the [`.up-current`](/a.up-current) class. When the browser navigates to another location, the class is removed automatically.\n    \n    You may also assign `[up-nav]` to an individual link instead of an navigational container.\n    \n    If you don't want to manually add this attribute to every navigational element,\n    you can configure selectors to automatically match your navigation components in `up.feedback.config.navs`.\n    \n    \n    \\#\\#\\# Example\n    \n    Let's take a simple menu with two links. The menu has been marked with the `[up-nav]` attribute:\n    \n    ```html\n    <div up-nav>\n      <a href=\"/foo\">Foo</a>\n      <a href=\"/bar\">Bar</a>\n    </div>\n    ```\n    \n    If the browser location changes to `/foo`, the first link is marked as `.up-current`:\n    \n    ```html\n    <div up-nav>\n      <a href=\"/foo\" class=\"up-current\">Foo</a>\n      <a href=\"/bar\">Bar</a>\n    </div>\n    ```\n    \n    If the browser location changes to `/bar`, the first link automatically loses its `.up-current` class. Now the second link is marked as `.up-current`:\n    \n    ```html\n    <div up-nav>\n      <a href=\"/foo\">Foo</a>\n      <a href=\"/bar\" class=\"up-current\">Bar</a>\n    </div>\n    ```\n    \n    \n    \\#\\#\\# When is a link \"current\"?\n    \n    When no [overlay](/up.layer) is open, the current location is the URL displayed\n    in the browser's address bar. When the link in question is placed in an overlay,\n    the current location is the location of that overlay, even if that\n    overlay doesn't have [visible history](/up.Layer.prototype.historyVisible).\n    \n    A link matches the current location (and is marked as `.up-current`) if it matches either:\n    \n    - the link's `[href]` attribute\n    - the link's `[up-href]` attribute\n    - the URL pattern in the link's [`[up-alias]`](/a-up-alias) attribute\n    \n    @selector [up-nav]\n    @stable\n     */\n\n    /***\n    Links within `[up-nav]` may use the `[up-alias]` attribute to pass a [URL pattern](/url-patterns) for which they\n    should also be highlighted as [`.up-current`](a.up-current).\n    \n    \\#\\#\\# Example\n    \n    The link below will be highlighted with `.up-current` at both `/profile` and `/profile/edit` locations:\n    \n    ```html\n    <div up-nav>\n      <a href=\"/profile\" up-alias=\"/profile/edit\">Profile</a>\n    </div>\n    ```\n    \n    To pass more than one alternative URLs, use a [URL pattern](/url-patterns).\n    \n    @selector a[up-alias]\n    @param up-alias\n      A [URL pattern](/url-patterns) with alternative URLs.\n    @stable\n     */\n\n    /***\n    When a link within an `[up-nav]` element points to the current location, it is assigned the `.up-current` class.\n    \n    See [`[up-nav]`](/up-nav) for more documentation and examples.\n    \n    @selector a.up-current\n    @stable\n     */\n    updateLayerIfLocationChanged = function(layer) {\n      var currentLocation, processedLocation;\n      processedLocation = layer.feedbackLocation;\n      currentLocation = normalizeURL(layer.location);\n      if (!processedLocation || processedLocation !== currentLocation) {\n        layer.feedbackLocation = currentLocation;\n        return updateLinksWithinNavs(layer.element, {\n          layer: layer\n        });\n      }\n    };\n    onBrowserLocationChanged = function() {\n      var frontLayer;\n      frontLayer = up.layer.front;\n      if (frontLayer.showsLiveHistory()) {\n        return updateLayerIfLocationChanged(frontLayer);\n      }\n    };\n    up.on('up:location:changed', function(_event) {\n      return onBrowserLocationChanged();\n    });\n    up.on('up:fragment:inserted', function(_event, newFragment) {\n      return updateFragment(newFragment);\n    });\n    up.on('up:layer:location:changed', function(event) {\n      return updateLayerIfLocationChanged(event.layer);\n    });\n    up.on('up:framework:reset', reset);\n    return {\n      config: config,\n      start: start,\n      stop: stop,\n      around: around,\n      aroundForOptions: aroundForOptions,\n      normalizeURL: normalizeURL\n    };\n  })();\n\n}).call(this);\n\n/***\nPassive updates\n===============\n\nThis package contains functionality to passively receive updates from the server.\n\n@see [up-hungry]\n@see [up-poll]\n\n@module up.radio\n */\n\n(function() {\n  up.radio = (function() {\n    var config, e, hungrySelector, reset, shouldPoll, startPolling, stopPolling, u;\n    u = up.util;\n    e = up.element;\n\n    /***\n    Configures defaults for passive updates.\n    \n    @property up.radio.config\n    \n    @param {Array<string>} [config.hungrySelectors]\n      An array of CSS selectors that is replaced whenever a matching element is found in a response.\n      These elements are replaced even when they were not targeted directly.\n    \n      By default this contains the [`[up-hungry]`](/up-hungry) attribute.\n    \n    @param {number} [config.pollInterval=30000]\n      The default [polling](/up-poll] interval in milliseconds.\n    \n    @param {boolean|string|Function(Element)} [config.pollEnabled=true]\n      Whether Unpoly will follow instructions to poll fragments, like the `[up-poll]` attribute.\n    \n      When set to `'auto'` Unpoly will poll if one of the following applies:\n    \n      - The browser tab is in the foreground\n      - The fragment's layer is the [frontmost layer](/up.layer.front).\n      - We should not [avoid optional requests](/up.network.shouldReduceRequests)\n    \n      When set to `true`, Unpoly will always allow polling.\n    \n      When set to `false`, Unpoly will never allow polling.\n    \n      You may also pass a function that accepts the polling fragment and returns `true`, `false` or `'auto'`.\n    \n    @stable\n     */\n    config = new up.Config(function() {\n      return {\n        hungrySelectors: ['[up-hungry]'],\n        pollInterval: 30000,\n        pollEnabled: 'auto'\n      };\n    });\n    reset = function() {\n      return config.reset();\n    };\n\n    /***\n    @function up.radio.hungrySelector\n    @internal\n     */\n    hungrySelector = function() {\n      return config.hungrySelectors.join(',');\n    };\n\n    /***\n    Elements with an `[up-hungry]` attribute are updated whenever the server\n    sends a matching element, even if the element isn't targeted.\n    \n    Use cases for this are unread message counters or notification flashes.\n    Such elements often live in the layout, outside of the content area that is\n    being replaced.\n    \n    @selector [up-hungry]\n    @param [up-transition]\n      The transition to use when this element is updated.\n    @stable\n     */\n\n    /***\n    Starts [polling](/up-poll) the given element.\n    \n    @function up.radio.startPolling\n    @param {Element|jQuery|string} fragment\n      The fragment to reload periodically.\n    @param {number} options.interval\n      The reload interval in milliseconds.\n    \n      Defaults to `up.radio.config.pollInterval`.\n    @stable\n     */\n    startPolling = function(fragment, options) {\n      var destructor, doReload, doSchedule, interval, lastRequest, ref, ref1, stopped;\n      if (options == null) {\n        options = {};\n      }\n      interval = (ref = (ref1 = options.interval) != null ? ref1 : e.numberAttr(fragment, 'up-interval')) != null ? ref : config.pollInterval;\n      stopped = false;\n      lastRequest = null;\n      options.onQueued = function(request) {\n        return lastRequest = request;\n      };\n      doReload = function() {\n        if (stopped) {\n          return;\n        }\n        if (shouldPoll(fragment)) {\n          return u.always(up.reload(fragment, options), doSchedule);\n        } else {\n          up.puts('[up-poll]', 'Polling is disabled');\n          return doSchedule(Math.min(10 * 1000, interval));\n        }\n      };\n      doSchedule = function(delay) {\n        if (delay == null) {\n          delay = interval;\n        }\n        if (stopped) {\n          return;\n        }\n        return setTimeout(doReload, delay);\n      };\n      destructor = function() {\n        stopped = true;\n        return lastRequest != null ? lastRequest.abort() : void 0;\n      };\n      up.on(fragment, 'up:poll:stop', destructor);\n      doSchedule();\n      return destructor;\n    };\n\n    /***\n    Stops [polling](/up-poll) the given element.\n    \n    @function up.radio.stopPolling\n    @param {Element|jQuery|string} fragment\n      The fragment to stop reloading.\n    @stable\n     */\n    stopPolling = function(element) {\n      return up.emit(element, 'up:poll:stop');\n    };\n    shouldPoll = function(fragment) {\n      var ref, setting;\n      setting = u.evalOption(config.pollEnabled, fragment);\n      if (setting === 'auto') {\n        return !document.hidden && !up.network.shouldReduceRequests() && ((ref = up.layer.get(fragment)) != null ? typeof ref.isFront === \"function\" ? ref.isFront() : void 0 : void 0);\n      }\n      return setting;\n    };\n\n    /***\n    Elements with an `[up-poll]` attribute are [reloaded](/up.reload) from the server periodically.\n    \n    \\#\\#\\# Example\n    \n    Assume an application layout with an unread message counter.\n    You can use `[up-poll]` to refresh the counter every 30 seconds:\n    \n    ```html\n    <div class=\"unread-count\" up-poll>\n      2 new messages\n    </div>\n    ```\n    \n    \\#\\#\\# Controlling the reload interval\n    \n    You may set an optional `[up-interval]` attribute to set the reload interval in milliseconds:\n    \n    ```html\n    <div class=\"unread-count\" up-poll up-interval=\"10000\">\n      2 new messages\n    </div>\n    ```\n    \n    If the value is omitted, a global default is used. You may configure the default like this:\n    \n    ```js\n    up.radio.config.pollInterval = 10000\n    ```\n    \n    \\#\\#\\# Controlling the source URL\n    \n    The element will be reloaded from the URL from which it was originally loaded.\n    \n    To reload from another URL, set an `[up-source]` attribute on the polling element:\n    \n    ```html\n    <div class=\"unread-count\" up-poll up-source=\"/unread-count\">\n      2 new messages\n    </div>\n    ```\n    \n    \\#\\#\\# Skipping updates when nothing changed\n    \n    When polling a fragment periodically we want to avoid rendering unchanged content.\n    This saves <b>CPU time</b> and reduces the <b>bandwidth cost</b> for a\n    request/response exchange to **~1 KB**.\n    \n    To achieve this we timestamp your fragments with an `[up-time]` attribute to indicate\n    when the underlying data was last changed. See `[up-time]` for a detailed example.\n    \n    @selector [up-poll]\n    @param [up-interval]\n      The reload interval in milliseconds.\n    \n      Defaults to `up.radio.config.pollInterval`.\n    @stable\n     */\n    up.compiler('[up-poll]', startPolling);\n    up.on('up:framework:reset', reset);\n    return {\n      config: config,\n      hungrySelector: hungrySelector,\n      startPolling: startPolling,\n      stopPolling: stopPolling\n    };\n  })();\n\n}).call(this);\n\n/***\nPlay nice with Rails UJS\n========================\n */\n\n(function() {\n  up.rails = (function() {\n    var e, isRails, u;\n    u = up.util;\n    e = up.element;\n    isRails = function() {\n      var ref;\n      return window._rails_loaded || window.Rails || ((ref = window.jQuery) != null ? ref.rails : void 0);\n    };\n    return u.each(['method', 'confirm'], function(feature) {\n      var dataAttribute, upAttribute;\n      dataAttribute = \"data-\" + feature;\n      upAttribute = \"up-\" + feature;\n      return up.macro(\"a[\" + dataAttribute + \"]\", function(link) {\n        if (isRails() && up.link.isFollowable(link)) {\n          e.setMissingAttr(link, upAttribute, link.getAttribute(dataAttribute));\n          return link.removeAttribute(dataAttribute);\n        }\n      });\n    });\n  })();\n\n}).call(this);\n(function() {\n  up.framework.boot();\n\n}).call(this);\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","//import './index.css';\nimport up from 'unpoly';\n\nlet _noop = up.util.memoize(function () {});\n"],"sourceRoot":""}